<!doctype html>
<!-- ORT Import v3.2 - Build 2025-01-18 - Prompt v8: enriched format (subtitle, practical_context, practical_info, road_type) -->
<html lang="fr" data-page="import_ia">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JK3QGQGDDL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-JK3QGQGDDL');gtag('config','GT-WF83FMCX');</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JK3QGQGDDL"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js',new Date());gtag('config','G-JK3QGQGDDL');gtag('config','GT-WF83FMCX');</script>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>OneRoadTrip ‚Äì Importer & G√©n√©rer JSON</title>
<style>
  :root{ --bg:#113f7a; --panel:#113f7a; --card:#fff; --ink:#113f7a; --accent:#113f7a; --bd:#c3d6b6; --danger:#e11d48; --danger-bg:#fee2e2; --warning:#f59e0b; --warning-bg:#fef3c7 }
  *{box-sizing:border-box}
  body{margin:0;background:url("/assets/image_index.webp") center/cover fixed #113f7a;color:#e7f6fb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}

  /* Accord√©on progressif mobile */
  @media (max-width: 768px) {
    .section-collapsed {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
    }
    .section-expanded {
      max-height: none;
      opacity: 1;
      transition: all 0.3s ease;
      pointer-events: auto;
    }
    
    /* Indicateur de progression */
    .section-pending {
      opacity: 0.5;
      position: relative;
    }
    .section-pending::before {
      content: 'üîí';
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 20px;
    }
    
    /* Passer les deux cadres en 1 colonne sur mobile */
  #section2Container {
    grid-template-columns: 1fr !important;
  }
  
  #section2Container.section-collapsed {
    display: none !important;
  }
  
  #section2Container.section-expanded {
    display: grid !important;
  }
  
  #section34Container {
    display: grid !important;
  }
  
  #section3Container {
    display: none !important;
  }
  
  #section3Container.section-collapsed {
    display: none !important;
  }
  
  #section3Container.section-expanded {
    display: grid !important;
  }
  
  #section4Container {
    display: none !important;
  }
  
  #section4Container.section-collapsed {
    display: none !important;
  }
  
  #section4Container.section-expanded {
    display: grid !important;
  }
    
    /* Ajuster les paddings sur mobile */
    .section-premium, .section-group {
      padding: 12px !important;
      font-size: 14px;
    }
    
    .section-premium-title, .section-group-title {
      font-size: 12px !important;
      padding: 3px 8px !important;
    }
    
    textarea, pre {
      font-size: 12px !important;
    }
    
    /* Header mobile */
    header {
      flex-wrap: wrap;
      padding: 8px 12px !important;
    }
    
    .brand {
      font-size: 14px !important;
    }
    
    header select, .hdr-btn {
      font-size: 13px !important;
      padding: 6px 8px !important;
    }
    
    /* Wrap responsive */
    .wrap {
      padding: 12px !important;
    }
    
    /* Cards plus compactes */
    .card {
      padding: 12px !important;
    }
    
    .card h2 {
      font-size: 16px !important;
    }
    
    /* Boutons mobile - plus grands pour le tactile */
    .btn {
      padding: 12px 16px !important;
      font-size: 14px !important;
      min-height: 44px; /* Taille tactile recommand√©e */
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    /* Liens externes */
    .btn.link {
      font-size: 13px !important;
      padding: 10px 12px !important;
    }
    
    /* Modales mobile */
    .modal-card {
      max-width: 95% !important;
      margin: 10px !important;
    }
  }

  header{position:sticky;top:0;z-index:10;background:url("/assets/image_index.webp") center/cover no-repeat #113f7a;border-bottom:2px solid rgba(255,255,255,0.2);box-shadow:0 2px 12px rgba(0,0,0,0.2);padding:10px 16px;display:flex;gap:12px;align-items:center}
  .brandlink{display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none}
  .brandlink img{width:40px;height:40px}
  header .brand{font-weight:800}
  header .sp{flex:1}
  header select{appearance:none;background:#fff;border:1px solid #113f7a;border-radius:10px;padding:8px 10px;color:#113f7a}
  .auth{position:relative}
  .hdr-btn{padding:8px 10px;border-radius:10px;border:1px solid #113f7a;background:#fff;color:#113f7a;font-weight:600;cursor:pointer}
  .hdr-btn:hover{background:#f0f4f8}
  .auth-pop{position:absolute;right:0;top:calc(100% + 6px);background:#fff;color:var(--ink);border:1px solid var(--bd);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.15);padding:8px;display:none;min-width:260px}
  .auth-pop .hdr-btn{display:block;width:100%;margin:6px 0;background:var(--panel);border:1px solid var(--panel);color:#fff}
  .auth-pop .hdr-btn.out{background:#fff;color:var(--panel)}
  .userline{display:none;padding:6px 8px;border-bottom:1px solid #c3d6b6;margin-bottom:6px}
  .userline .name{font-weight:700}
  .userline .mail{font-size:.9em;color:#475569}

  .grid{display:block}
.card{background:var(--card);color:var(--ink);border:1px solid rgba(0,0,0,.08);border-radius:14px;padding:14px;margin-bottom:14px}
.section-group .card{border:none;box-shadow:none}
.section-group .card:first-of-type{margin-top:20px}
  .card h2{margin:0 0 8px;font-size:18px}
  textarea{width:100%;height:140px;min-height:140px;max-height:140px;border:1px solid #cbd5e1;border-radius:10px;padding:10px;resize:none;font-family:ui-monospace,Consolas,monospace;font-size:13px;overflow:auto}
  pre{background:#f8fafc;border:1px solid #e5e7eb;border-radius:10px;padding:10px;overflow:auto;color:#0f172a;font-size:12px;height:140px;min-height:140px;max-height:140px}
  
 .section-group{border:2px solid #113f7a;border-radius:14px;padding:18px;margin-bottom:40px;margin-top:50px;position:relative}
  .section-group-title{position:absolute;top:-14px;left:20px;background:#fff;padding:4px 12px;font-weight:600;font-size:13px;color:#113f7a;line-height:1.5;max-width:calc(100% - 40px);border-radius:6px;box-shadow:0 2px 4px rgba(17,63,122,0.1)}
  .section-premium{border:2px solid #f59e0b;border-radius:14px;padding:18px;margin-bottom:14px;position:relative}
  .section-premium-title{position:absolute;top:-14px;left:20px;background:#fff;padding:4px 12px;font-weight:600;font-size:13px;color:#f59e0b;line-height:1.5;border-radius:6px;box-shadow:0 2px 4px rgba(245,158,11,0.1)}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{padding:10px 14px;border-radius:12px;border:1px solid #ffffff80;background:#113f7a;color:#fff;cursor:pointer;text-decoration:none;font-size:14px;transition:all .2s}
  .btn:hover{background:#0d2f5e}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn.ghost{background:#fff;color:var(--ink);border:1px solid var(--ink)}
  .btn.ghost:hover{background:#f8fafc}
  .btn.link{background:#ffffff1a;border:1px solid #ffffff80}
  .btn.link:hover{background:#ffffff2b}
  .status{margin-top:10px;padding:10px;border-radius:8px;border:1px solid}
  .status.ok{background:#f0fdf4;border-color:#bbf7d0;color:#166534}
  .status.err{background:#fef2f2;border-color:#fecaca;color:#dc2626}
  .status.warn{background:var(--warning-bg);border-color:#fde047;color:#92400e}
  .muted{font-size:13px;color:#475569;margin-top:6px}
  .info-box{background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px;padding:10px;margin-top:8px;font-size:13px;color:#1e40af}
  .step-num{display:inline-block;width:24px;height:24px;line-height:24px;text-align:center;background:var(--accent);color:#fff;border-radius:50%;font-weight:700;font-size:14px;margin-right:8px}

  footer{margin:16px 0 26px;text-align:center;font-size:14px}
  footer a{color:#c3d6b6;text-decoration:none}
  footer a:hover{text-decoration:underline}

  #emailModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);align-items:center;justify-content:center;z-index:10000}
  .modal-card{width:min(440px,92vw);background:#fff;border-radius:14px;border:1px solid #c3d6b6;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.16);color:var(--ink)}
  .modal-card h3{margin:0 0 6px}
  .input{width:100%;padding:10px 12px;border:1px solid #113f7a;border-radius:10px;margin:8px 0}
  .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:8px}
  .btn-outline{background:#fff;color:#113f7a;border:1px solid #113f7a;border-radius:10px;padding:8px 12px;cursor:pointer}
  .btn-primary{background:#113f7a;color:#fff;border:1px solid #113f7a;border-radius:10px;padding:8px 12px;cursor:pointer}

  .loader{display:inline-block;width:16px;height:16px;border:2px solid #fff;border-top:2px solid transparent;border-radius:50%;animation:spin 1s linear infinite;margin-left:8px}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* === NEW: Options card fine-tune */
  .opt-row{display:grid;grid-template-columns: 28px 1fr;gap:10px;align-items:flex-start}
  .opt-row+.opt-row{margin-top:10px}
  .opt-note{font-size:12px;color:#334155;margin-top:6px}
  .opt-inline{display:flex;gap:10px;align-items:center;margin-top:8px}
  .opt-disabled{opacity:.5}

  /* === Interpretation options grid (4 columns) */
  .interp-grid{display:grid;grid-template-columns:repeat(4, 1fr);gap:12px;margin-top:14px}
  @media(max-width:1024px){ .interp-grid{grid-template-columns:repeat(2, 1fr)} }
  @media(max-width:640px){ .interp-grid{grid-template-columns:1fr} }
  .interp-option{border:2px solid #cbd5e1;border-radius:12px;padding:14px;cursor:pointer;transition:all .2s;background:#fff;position:relative}
  .interp-option:hover{border-color:#113f7a;background:#f8fafc}
  .interp-option input[type="radio"]{position:absolute;top:12px;right:12px;width:20px;height:20px;cursor:pointer}
  .interp-option.selected{border-color:#113f7a;background:#eff6ff}
  .interp-option h3{margin:0 0 8px;font-size:15px;font-weight:700;color:#113f7a;padding-right:30px}
  .interp-option p{margin:0;font-size:13px;color:#475569;line-height:1.5}
</style>
</head>
<body>
<header>
  <a class="brandlink" href="presentation.html"><img src="../assets/symbol.webp" alt="Logo"><div class="brand">OneRoadTrip</div></a>
  <div class="sp"></div>
  <select id="langSel" aria-label="Langue">
    <option value="fr">Fran√ßais</option><option value="en">English</option>
    <option value="it">Italiano</option><option value="es">Espa√±ol</option>
    <option value="pt">Portugu√™s</option><option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
  </select>
  <div class="auth">
    <button id="openAuth" class="hdr-btn" type="button">Se connecter</button>
    <div id="authPop" class="auth-pop" role="dialog" aria-label="Connexion">
      <div class="userline" id="userLine"><div class="name" id="meName"></div><div class="mail" id="meEmail"></div></div>
      <button id="btnGoogle" class="hdr-btn" type="button">Google</button>
      <button id="btnEmail" class="hdr-btn" type="button">E-mail</button>
      <button id="btnLogout" class="hdr-btn out" type="button" style="display:none">D√©connexion</button>
    </div>
  </div>

<script>
!function(){
  try{
    var hdr = document.querySelector('header'); if(!hdr) return;
    hdr.style.display = (getComputedStyle(hdr).display==='flex' ? 'flex' : hdr.style.display || 'flex');
    hdr.style.flexWrap = 'wrap';
    if(document.getElementById('ortDashRow')) return;

    var lang = (localStorage.getItem('lang') || document.documentElement.lang || 'fr').toLowerCase();
    var MSG = ({
      fr:'Vous devez √™tre enregistr√© pour acc√©der au Dashboard.',
      en:'You must be signed in to access the Dashboard.',
      it:'Devi essere registrato per accedere alla Dashboard.',
      es:'Debe estar registrado para accedere al Panel.',
      pt:'Voc√™ precisa estar conectado para acessar o Dashboard.',
      ar:'Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ŸÖÿ≥ÿ¨ŸëŸÑŸãÿß ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ.'
    })[lang] || 'Vous devez √™tre enregistr√© pour acc√©der au Dashboard.';

    var row = document.createElement('div');
    row.id = 'ortDashRow';
    row.style.flexBasis = '100%';
    row.style.display = 'flex';
    row.style.justifyContent = 'center';
    row.style.alignItems = 'center';
    row.style.marginTop = '-15px';
    row.style.marginBottom = '0';

    var a = document.createElement('a');
    a.href = 'dashboard_user.html?lang=' + lang;
    a.textContent = 'Dashboard';
    a.className = 'hdr-btn';
    a.style.textDecoration = 'none';
    a.style.whiteSpace = 'nowrap';
    a.style.padding = a.style.padding || '6px 12px';
    a.style.borderRadius = a.style.borderRadius || '10px';

    a.addEventListener('click', function(ev){
      var user = (window.firebase && window.firebase.auth && window.firebase.auth().currentUser) || null;
      if(!user){
        ev.preventDefault();
        var box = document.createElement('div');
        Object.assign(box.style, {
          position:'fixed', left:'50%', top:'18px', transform:'translateX(-50%)',
          background:'#fff', color:'#113f7a',
          padding:'10px 14px', borderRadius:'10px',
          border:'1px solid #c3d6b6', boxShadow:'0 6px 18px rgba(0,0,0,.15)',
          zIndex:9999, maxWidth:'90%', fontFamily:'system-ui,Segoe UI,Roboto,Arial,sans-serif'
        });
        box.textContent = MSG;
        document.body.appendChild(box);
        setTimeout(function(){ box.remove(); }, 2400);
      }
    });

    row.appendChild(a);
    hdr.appendChild(row);
  }catch(_){}
}();
</script>

</header>

<div class="wrap">
  <!-- 1) Mode de g√©n√©ration simplifi√© -->
  <section class="card" style="margin-bottom:14px">
    <h2><span class="step-num">1</span><span id="optTitle"></span></h2>
    
    <!-- Texte explicatif pour les utilisateurs -->
    <p id="optExplain" style="color:#475569;line-height:1.6;margin-bottom:16px">Vous pouvez trouver un itin√©raire sur le web, ou un descriptif de lieux que vous voulez visiter, ou coller plusieurs descriptifs de lieux et g√©n√©rer un prompt que vous copierez √† une intelligence artificielle de votre choix. Inutile de nettoyer votre copie, vous pouvez copier la page enti√®re et la coller telle quelle dans le premier onglet. Vous n'aurez plus qu'√† recopier la r√©ponse de l'IA dans le troisi√®me onglet pour avoir un itin√©raire sur mesure compl√®tement modifiable.</p>
    
    <!-- Message pour utilisateurs normaux -->
    <div id="userModeInfo" class="info-box" style="background:#e0f2fe;border:1px solid #0ea5e9;padding:16px;border-radius:10px;margin-bottom:16px">
      <p style="margin:0;color:#0369a1;font-weight:500" id="userModeText">L'itin√©raire sera automatiquement optimis√© g√©ographiquement pour √©viter les allers-retours.</p>
    </div>
    
    <!-- Input cach√© pour garder la compatibilit√© (mode logic par d√©faut) -->
    <input type="hidden" name="opt-mode" value="logic" id="opt-default-mode" />
      
    <!-- Options admin - 4 choix directs (r√©serv√© admin) -->
    <div class="interp-grid" id="adminOptionsGrid" style="display:none">
      <label class="interp-option" for="opt-follow">
        <input id="opt-follow" name="opt-mode" type="radio" value="follow" />
        <h3>üìç Parcours strict</h3>
        <p>Conserver l'ordre exact de la source</p>
      </label>
      <label class="interp-option selected" for="opt-logic">
        <input id="opt-logic" name="opt-mode" type="radio" value="logic" checked />
        <h3>üó∫Ô∏è Parcours logique</h3>
        <p>Optimiser g√©ographiquement</p>
      </label>
      <label class="interp-option" for="opt-seed">
        <input id="opt-seed" name="opt-mode" type="radio" value="seed" />
        <h3>üè† Bases + boucles</h3>
        <p>Excursions depuis villes d'attache</p>
      </label>
      <label class="interp-option" for="opt-citytrip">
        <input id="opt-citytrip" name="opt-mode" type="radio" value="citytrip" />
        <h3>üèôÔ∏è City trip</h3>
        <p>1 attraction = 1 jour</p>
      </label>
    </div>
    
    <!-- Champ villes pour mode seed (admin) -->
    <div id="seedCitiesWrap" style="display:none;margin-top:12px">
      <input id="seedCities" class="input" type="text" placeholder="Ex.: Nice, Marseille, Toulon" style="width:100%;border:1px solid #113f7a;padding:8px 12px;border-radius:8px">
    </div>
    
    <p class="muted" id="optNote" style="margin-top:12px"></p>
  </section>

  <!-- Grille 2 colonnes pour pav√©s 2 et 2bis -->
  <div id="section2Container" class="section-expanded" style="display:grid;grid-template-columns:1fr;gap:14px;margin-top:30px">
    
  <!-- 2) I18N - Import avec traduction automatique (Silver/Gold uniquement) - COMMENT√âE TEMPORAIREMENT
  <div class="section-premium">
    <div class="section-premium-title" id="premiumSectionTitle"></div>
    <section class="card" style="margin-bottom:0;border:none;padding:14px 0">
      <h2 style="height:75px;display:flex;align-items:center;margin:0 0 20px"><span class="step-num">2</span><span id="i18nTitle"></span></h2>
      <div class="info-box" style="height:75px;display:flex;align-items:center;margin-bottom:20px">
        <strong id="i18nNote"></strong>
      </div>
      <div style="margin-top:20px">
        <label for="i18nSource" style="display:block;margin-bottom:8px;font-weight:600" id="i18nSourceLabel"></label>
        <textarea id="i18nSource" placeholder="" style="width:100%;height:120px;min-height:120px;max-height:120px;border:1px solid #cbd5e1;border-radius:10px;padding:10px;font-family:ui-monospace,Consolas,monospace;font-size:13px"></textarea>
        <div class="row" style="margin-top:20px">
          <button id="btnI18nProcess" class="btn" type="button" disabled style="opacity:1"></button>
          <button id="btnI18nClear" class="btn ghost" type="button"></button>
        </div>
      </div>
    </section>
  </div>
  -->

  <!-- 2bis) Coller la page web - GRATUIT -->
  <div class="section-premium" style="border-color:#10b981;grid-column:1/-1;width:100%;">
    <div class="section-premium-title" style="color:#10b981;box-shadow:0 2px 4px rgba(16,185,129,0.1)">Gratuit</div>
    <section class="card" style="margin-bottom:0;border:none;padding:14px 0">
      <h2 id="t1" style="height:75px;display:flex;align-items:center;margin:0 0 20px"><span class="step-num">2</span><span id="t1text">Collez la page web</span></h2>
      <div class="info-box" style="background:#d1fae5;border-color:#86efac;color:#065f46;height:75px;display:flex;align-items:center;margin-bottom:20px">
        <strong id="hint2bis"></strong>
      </div>
      <div style="margin-top:20px">
        <label for="src" style="display:block;margin-bottom:8px;font-weight:600" id="labelSrc">Collez le texte source ici :</label>
        <textarea id="src" placeholder="" aria-label="Source text" style="height:120px;min-height:120px;max-height:120px"></textarea>
                <div class="muted" id="hint1"></div>
<div class="row" style="margin-top:20px">
          <button class="btn" id="btn-gen" type="button"></button>
          <button class="btn ghost" id="btn-clear" type="button"></button>
        </div>
      </div>
    </section>
  </div>
  
  </div><!-- Fin grille 2 colonnes -->

  <!-- Sections 3-4 group√©es avec titre gratuit - pour r√©f√©rence seulement -->
  <div id="section34Container" class="section-group section-collapsed" style="display: none !important;">
    <div class="section-group-title" id="freeSectionTitle"></div>
  </div>

<script>
// === Gestion Accord√©on Progressif Mobile ===
(function(){
  // V√©rifier si on est sur mobile
  function isMobile() {
    return window.innerWidth <= 768;
  }
  
  function expandSection(sectionId) {
    console.log('[ORT] expandSection called with:', sectionId);
    const section = document.getElementById(sectionId);
    console.log('[ORT] section found:', section);
    if (!section) {
      console.log('[ORT] section NOT FOUND!');
      return;
    }
    
    // Appliquer les classes sans v√©rifier isMobile - laisse le CSS g√©rer
    console.log('[ORT] Applying expanded classes');
    section.classList.remove('section-collapsed');
    section.classList.add('section-expanded');
    console.log('[ORT] classList now:', section.className);
    
    // Scroll vers la section avec un d√©lai pour l'animation
    setTimeout(() => {
      console.log('[ORT] scrolling into view');
      section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 300);
  }
  
  function collapseSection(sectionId) {
    console.log('[ORT] collapseSection called with:', sectionId);
    const section = document.getElementById(sectionId);
    if (!section) {
      console.log('[ORT] collapseSection: section NOT FOUND!');
      return;
    }
    
    console.log('[ORT] Applying collapsed classes');
    section.classList.remove('section-expanded');
    section.classList.add('section-collapsed');
    console.log('[ORT] classList now:', section.className);
  }
  
  // Initialiser : section 2 visible, sections 3-4 masqu√©es sur mobile
  if (isMobile()) {
    // Section 2 doit √™tre visible par d√©faut (c'est l√† qu'on colle le texte)
    const s2 = document.getElementById('section2Container');
    if (s2) {
      s2.classList.remove('section-collapsed');
      s2.classList.add('section-expanded');
    }
    // Sections 3-4 restent cach√©es jusqu'√† la g√©n√©ration du prompt
    document.getElementById('section34Container')?.classList.add('section-collapsed');
    document.getElementById('section3Container')?.classList.add('section-collapsed');
    document.getElementById('section4Container')?.classList.add('section-collapsed');
  }
  
  // Rendre les fonctions accessibles globalement
  window.ORT_expandSection = expandSection;
  window.ORT_collapseSection = collapseSection;
  window.ORT_isMobile = isMobile;
})();

// === Gestion Options admin (follow/logic/seed/citytrip) ===
(function(){
  // Initialisation appel√©e quand l'admin est d√©tect√©
  window.initAdminOptions = function() {
    const adminOptionsGrid = document.getElementById('adminOptionsGrid');
    const seedWrap = document.getElementById('seedCitiesWrap');
    const seedInput = document.getElementById('seedCities');
    
    if(!adminOptionsGrid) return;
    
    const optionCards = adminOptionsGrid.querySelectorAll('.interp-option');
    const radios = adminOptionsGrid.querySelectorAll('input[type="radio"]');
    
    // Gestion du clic sur les cartes
    optionCards.forEach(card => {
      card.addEventListener('click', function(e){
        if(e.target.tagName === 'INPUT') return;
        const radio = this.querySelector('input[type="radio"]');
        if(radio) {
          radio.checked = true;
          updateAdminSelection();
        }
      });
    });
    
    // Gestion du changement de s√©lection
    radios.forEach(radio => {
      radio.addEventListener('change', updateAdminSelection);
    });
    
    function updateAdminSelection(){
      // Mettre √† jour l'apparence des cartes
      optionCards.forEach(card => {
        const radio = card.querySelector('input[type="radio"]');
        if(radio && radio.checked){
          card.classList.add('selected');
        } else {
          card.classList.remove('selected');
        }
      });
      
      // Afficher/masquer le champ villes si mode seed
      const selected = document.querySelector('#adminOptionsGrid input[type="radio"]:checked');
      if(seedWrap && seedInput){
        if(selected && selected.value === 'seed'){
          seedWrap.style.display = '';
          seedInput.disabled = false;
        } else {
          seedWrap.style.display = 'none';
          seedInput.disabled = true;
        }
      }
    }
    
    // Initialiser l'√©tat
    updateAdminSelection();
  };
})();
</script>

  <main class="grid" aria-live="polite">
    <!-- 3) Prompt g√©n√©r√© -->
    <div id="section3Container" class="section-collapsed">
    <section class="card">
      <h2 id="t2"><span class="step-num">3</span><span id="t2text">Prompt IA g√©n√©r√©</span></h2>
      <pre id="prompt" aria-label="Prompt IA √† copier"></pre>
      <div class="row">
        <button class="btn" id="btn-copy" type="button"></button>
        <button class="btn ghost" id="btn-clear-prompt" type="button"></button>
        <a class="btn link" href="https://chat.openai.com/" target="_blank" rel="noopener">ChatGPT</a>
        <a class="btn link" href="https://claude.ai/" target="_blank" rel="noopener">Claude</a>
        <a class="btn link" href="https://gemini.google.com/" target="_blank" rel="noopener">Gemini</a>
      </div>
      <div class="muted" id="hint2"></div>
    </section>
  </div><!-- /section3Container -->

  <div id="section4Container" class="section-collapsed">
    <!-- 4) Coller la r√©ponse JSON -->
    <section class="card">
      <h2 id="t3"><span class="step-num">4</span><span id="t3text">Collez la r√©ponse de l'IA</span></h2>
      <textarea id="json-return" placeholder="" aria-label="JSON response"></textarea>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="btn-validate-json" type="button"></button>
        <button class="btn ghost" id="btn-clear-json" type="button"></button>
      </div>
      <div id="json-status" class="status" style="display:none"></div>
      <div id="json-info" class="info-box" style="display:none"></div>
    </section>
  </div><!-- /section4Container -->
  </main>

  <!-- === SECTION ADMIN: Visualisation et export des RT === -->
  <section id="adminRTViewer" class="section-group" style="display:none;margin-top:40px;background:rgba(220,38,38,0.05)">
    <div class="section-group-title" style="background:#dc2626;color:#fff">üî¥ ADMIN ‚Äî Visualiser / Exporter les itin√©raires</div>
    
    <div class="card" style="margin-top:20px">
      <h2>üìÇ Charger un fichier JSON d'itin√©raires</h2>
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:12px">
        <input type="file" id="adminRTFile" accept=".json" style="flex:1;min-width:200px">
        <span style="color:#64748b;font-size:13px">ou</span>
        <input type="text" id="adminRTUrl" placeholder="URL du fichier JSON (ex: ./data/itins/FR.json)" style="flex:2;min-width:250px;padding:8px 12px;border:1px solid #cbd5e1;border-radius:8px">
        <button class="btn ghost" id="adminLoadUrl" type="button">Charger URL</button>
      </div>
      <div id="adminRTStatus" style="display:none;padding:8px;border-radius:6px;font-size:13px"></div>
    </div>

    <div class="card" id="adminRTNavCard" style="display:none">
      <h2>üó∫Ô∏è Navigation dans les itin√©raires</h2>
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:16px">
        <button class="btn ghost" id="adminPrevRT" type="button" style="font-size:20px;padding:8px 16px">‚óÄ</button>
        <div style="flex:1;text-align:center">
          <div id="adminRTCounter" style="font-size:14px;color:#64748b">0 / 0</div>
          <div id="adminRTTitle" style="font-size:18px;font-weight:700;color:#113f7a;margin-top:4px">‚Äî</div>
          <div id="adminRTMeta" style="font-size:13px;color:#64748b;margin-top:2px"></div>
        </div>
        <button class="btn ghost" id="adminNextRT" type="button" style="font-size:20px;padding:8px 16px">‚ñ∂</button>
      </div>
      
      <!-- Aper√ßu rapide -->
      <div id="adminRTPreview" style="background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:12px;max-height:300px;overflow-y:auto;font-size:13px;margin-bottom:16px">
        <em style="color:#94a3b8">Aucun itin√©raire charg√©</em>
      </div>
      
      <!-- Actions -->
      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <button class="btn" id="adminExportPrompt" type="button">üìù G√©n√©rer prompt de r√©√©criture</button>
        <button class="btn ghost" id="adminCopyJSON" type="button">üìã Copier JSON brut</button>
        <button class="btn ghost" id="adminOpenRT" type="button">üîó Ouvrir dans RT Detail</button>
      </div>
    </div>

    <!-- Zone de prompt g√©n√©r√© -->
    <div class="card" id="adminPromptCard" style="display:none">
      <h2>üìù Prompt de r√©√©criture</h2>
      <p style="font-size:13px;color:#64748b;margin-bottom:12px">Copiez ce prompt et collez-le √† l'IA avec vos articles de remplacement. Le JSON retourn√© aura le m√™me itin_id et pourra remplacer l'ancien via import.</p>
      <textarea id="adminPromptOutput" style="height:400px;font-size:12px" readonly></textarea>
      <div style="margin-top:10px;display:flex;gap:10px">
        <button class="btn" id="adminCopyPrompt" type="button">üìã Copier le prompt</button>
        <button class="btn ghost" id="adminClosePrompt" type="button">Fermer</button>
      </div>
    </div>

    <!-- Option suppression autres langues -->
    <div class="card" style="margin-top:14px">
      <h2>üóëÔ∏è Gestion des autres langues</h2>
      <p style="font-size:13px;color:#64748b;margin-bottom:12px">
        Apr√®s r√©√©criture du FR, supprimez les versions EN/ES/IT/PT/AR pour les r√©g√©n√©rer proprement via traduction.
      </p>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
          <input type="checkbox" id="adminDeleteOtherLangs" style="width:18px;height:18px">
          <span style="font-weight:600;color:#dc2626">Supprimer les autres langues (EN, ES, IT, PT, AR)</span>
        </label>
      </div>
      <button class="btn" id="adminDeleteLangsBtn" type="button" style="background:#dc2626;display:none">
        üóëÔ∏è Supprimer maintenant les autres langues
      </button>
      <div id="adminDeleteStatus" style="display:none;margin-top:10px;padding:10px;border-radius:8px;font-size:13px"></div>
    </div>
  </section>

  <footer>
    <a href="mentions-legales.html">Mentions l√©gales</a> ¬∑
    <a href="politique-confidentialite.html">Confidentialit√©</a> ¬∑
    <a href="politique-cookies.html">Cookies</a>
  </footer>
</div>

<!-- Email modal (align√© sur quest_simple) -->
<div id="emailModal">
  <div class="modal-card">
    <h3>Connexion par e-mail</h3>
    <input id="emailInput" class="input" type="email" placeholder="E-mail">
    <div class="input-wrap">
      <input id="pwdInput" class="input" type="password" placeholder="Mot de passe">
      <button type="button" class="eye-btn" id="togglePwd">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
      </button>
    </div>
    <div id="pwd2Wrap" style="display:none">
      <input id="pwd2Input" class="input" type="password" placeholder="R√©p√©ter mot de passe">
    </div>
    <div id="emailAlert" class="alert" style="display:none"></div>
    <div class="actions">
      <button id="btnCancelEmail" class="btn-outline" type="button">Annuler</button>
      <button id="btnDoEmail" class="btn-primary" type="button">Continuer</button>
    </div>
      <div class="links">
      <button id="btnForgot" class="link" type="button">Mot de passe oubli√© ?</button>
      <button id="btnSignup" class="link" type="button">Cr√©er un compte</button>
    </div>
  </div><!-- /modal-card -->
</div><!-- /emailModal -->

<!-- Modal Configuration Voyage -->
<div id="configTripModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);align-items:center;justify-content:center;z-index:10000">
  <div class="modal-card" style="max-width:500px;animation:modalPop 0.3s ease;box-shadow:0 20px 60px rgba(0,0,0,0.4);border:3px solid #113f7a">
    <h3 id="cfgTitleText" style="color:#113f7a;margin-bottom:16px;font-size:1.4em;text-align:center">üóìÔ∏è Configurer votre voyage</h3>
    
    <div style="background:#e0f2fe;border:1px solid #0ea5e9;border-radius:8px;padding:12px;margin-bottom:16px;color:#0369a1;font-size:14px;text-align:center">
      <strong>Derni√®re √©tape !</strong> D√©finissez vos dates pour finaliser l'import.
    </div>
    
    <div style="margin-bottom:14px">
      <label id="cfgStartDateLabel" style="display:block;font-weight:600;margin-bottom:6px">Date de d√©part :</label>
      <input type="date" id="cfgStartDate" class="input" style="width:100%;font-size:16px;padding:12px">
    </div>
    
    <div style="margin-bottom:14px">
      <label id="cfgNbDaysLabel" style="display:block;font-weight:600;margin-bottom:6px">Nombre de jours souhait√© :</label>
      <input type="number" id="cfgNbDays" class="input" value="7" min="1" max="60" style="width:100%;font-size:16px;padding:12px">
    </div>
    
    <div class="actions" style="margin-top:20px;gap:12px">
      <button id="btnCancelConfig" class="btn-outline" type="button" style="padding:12px 20px">Annuler</button>
      <button id="btnValidateConfig" class="btn-primary" type="button" style="padding:12px 24px;font-size:16px;font-weight:700">‚úÖ Valider et ouvrir</button>
    </div>
  </div>
</div>
<style>
@keyframes modalPop {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
</style>

<!-- Charge la config centralis√©e AVANT l‚Äôinit Firebase -->
<script src="/js/ort-config.js"></script>
<script src="/js/ort-tripid.js"></script>

<script>
// === Firebase config (pr√©prod/prod) ‚Äî via ORT_CONFIG ===
(function(){
  const host = location.hostname;
  const isPreprod = /oneroadtrip-preprod|localhost|127\.0\.0\.1/.test(host);
  const cfg = isPreprod ? (window.ORT_CONFIG?.PREPROD || {}) : (window.ORT_CONFIG?.PROD || {});
  const safe = (cfg && cfg.apiKey) ? cfg : (window.ORT_CONFIG?.PREPROD || {});
  window.__FIREBASE_CONFIG__ = safe;
})();
</script>

<script>
(function(){
  function loadScript(src){
    return new Promise((ok,ko)=>{
      const s=document.createElement('script');
      s.src=src; s.onload=ok; s.onerror=()=>ko(new Error('load '+src));
      document.head.appendChild(s);
    });
  }
  window.__ensureFirebase__ = async function(){
    if (window.firebase?.apps?.length) return window.firebase;
    await loadScript('https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js');
    await loadScript('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js');
    window.firebase.initializeApp(window.__FIREBASE_CONFIG__ || {});
    await window.firebase.auth().setPersistence(window.firebase.auth.Auth.Persistence.LOCAL);
    return window.firebase;
  };
})();
</script>

<script>
// === PROMPT TEMPLATES v8 - Admin & User ===
// User: mode "logic" par d√©faut | Admin: sous-modes follow/logic/seed/citytrip

const PROMPTS = {
  // ============================================
  // FRAN√áAIS v8 - Format enrichi
  // ============================================
  fr: ({mode, seeds, modelSubMode, modelSeeds}) => {
    const isAdmin = mode === 'model';
    const effectiveMode = isAdmin ? modelSubMode : 'logic';
    const effectiveSeeds = isAdmin ? modelSeeds : seeds;
    
    return `Tu es un extracteur de donn√©es structur√©es. Produis UNIQUEMENT du JSON valide, sans texte, sans balises Markdown.

Transforme le contenu SOURCE en JSON "itins" (UN SEUL objet). Suis cet exemple :

{
  "itins": [{
    "itin_id": "LA::nord::luang-prabang-vang-vieng",
    "language": "fr",
    "created_at": "${new Date().toISOString().split('T')[0]}T12:00:00Z",
    "source_url": "",
    "dept_code": "LP",
    "dept_name": "Luang Prabang",
    "title": "Entre temples et karsts du Nord Laos",
    "subtitle": "Des moines de Luang Prabang aux lagons turquoise de Vang Vieng",
    "estimated_days_base": 3,
    "pacing_rules": {
      "factors": {"slow": 1.25, "standard": 1.0, "fast": 0.75},
      "merge_threshold": 0.85
    },
    "practical_context": {
      "best_months": ["novembre", "d√©cembre", "janvier", "f√©vrier"],
      "highlights": [
        "Procession des moines √† l'aube (tak bat)",
        "Temples dor√©s de Luang Prabang",
        "Grottes et lagons turquoise de Vang Vieng",
        "Navigation sur le M√©kong"
      ]
    },
    "days_plan": [
      {
        "day": 1,
        "slice": 1,
        "region_code": "LA-LP",
        "suggested_days": 1.5,
        "night": {
          "place_id": "LA::luang_prabang",
          "map_keywords": [
            "Wat Xieng Thong Luang Prabang",
            "Mount Phousi Luang Prabang",
            "Royal Palace Luang Prabang",
            "Wat Mai Luang Prabang",
            "Wat Visoun Luang Prabang",
            "Wat Xieng Mouane Luang Prabang"
          ],
          "coords": [19.8856, 102.1347],
          "map_keywords": [
            "Wat Xieng Thong Luang Prabang",
            "Mont Phousi Luang Prabang",
            "Palais Royal Luang Prabang",
            "Wat Mai Luang Prabang",
            "Wat Visoun Luang Prabang",
            "Wat Xieng Mouane Luang Prabang"
          ]
        },
        "visits": [
          {"text": "Les toits du Vat Xieng Thong descendent jusqu'au sol. Ses mosa√Øques de verre rouge illustrent la vie du Bouddha."},
          {"text": "Montez les 328 marches du mont Phousi pour voir le M√©kong et la Nam Khan se rejoindre."},
          {"text": "Le Palais Royal expose le tr√¥ne et le Phra Bang, bouddha d'or qui a donn√© son nom √† la ville."},
          {"text": "Le porche dor√© du Vat Mai est sculpt√© de sc√®nes du Ramayana. Les fid√®les s'y retrouvent au Nouvel An lao."},
          {"text": "Le Vat Visoun date de 1513. On y voit un grand Bouddha en bois et le stupa That Makmo."},
          {"text": "Suivez la Nam Khan jusqu'au Vat Xieng Mouane o√π les moines tissent des textiles traditionnels."}
        ],
        "activities": [
          {"text": "Levez-vous √† l'aube pour le tak bat : les moines passent en silence collecter leur nourriture.", "practical_info": {"best_time": "5h30-6h30", "tip": "Restez discret, pas de flash"}},
          {"text": "Le march√© de nuit s'installe sur Sisavangvong Road d√®s 17h. Textiles, artisanat et lanternes."},
          {"text": "Apprenez √† cuisiner lao : laap, tam mak houng, khao niaw.", "practical_info": {"duration": "3h", "type": "Cours de cuisine"}}
        ],
        "to_next_leg": {
          "distance_km": 230,
          "drive_min": 270,
          "transport_mode": "car",
          "road_type": "Goudron sinueux",
          "method": "heuristic"
        }
      },
      {
        "day": 2,
        "slice": 1,
        "region_code": "LA-VT",
        "suggested_days": 1.0,
        "night": {
          "place_id": "LA::vang_vieng",
          "map_keywords": [
            "Tham Chang Cave Vang Vieng",
            "Blue Lagoon Vang Vieng",
            "Tham Phu Kham Cave Vang Vieng",
            "Bamboo Bridge Vang Vieng",
            "Tham Nam Cave Vang Vieng"
          ],
          "coords": [18.9220, 102.4476],
          "map_keywords": [
            "Tham Chang Cave Vang Vieng",
            "Blue Lagoon Vang Vieng",
            "Tham Phu Kham Cave Vang Vieng",
            "Bamboo Bridge Vang Vieng",
            "Tham Nam Cave Vang Vieng"
          ]
        },
        "visits": [
          {"text": "La grotte Tham Chang s'ouvre dans la falaise face √† la Nam Song. Un escalier monte vers ses stalactites √©clair√©es."},
          {"text": "La Blue Lagoon : eau turquoise au pied des karsts, parfaite pour la baignade."},
          {"text": "La grotte Tham Phu Kham s'enfonce sur 500 m√®tres. Un bouddha couch√© dort dans la p√©nombre."},
          {"text": "Un pont de bambou traverse la Nam Song vers les rizi√®res de la rive ouest."},
          {"text": "La grotte Tham Nam se visite en bou√©e, port√©e par une rivi√®re souterraine."}
        ],
        "activities": [
          {"text": "Descendez la Nam Song en kayak. Les falaises calcaires d√©filent de chaque c√¥t√©.", "practical_info": {"duration": "2-3h", "difficulty": "Facile"}},
          {"text": "Les parois karstiques proposent des voies d'escalade pour tous niveaux."},
          {"text": "Louez un v√©lo pour rejoindre lagunes et grottes par les chemins de terre."}
        ]
      }
    ]
  }]
}

üìã R√àGLES CRITIQUES :

1. ORDRE LOGIQUE ‚Äî R√©organiser les √©tapes pour un itin√©raire g√©ographiquement coh√©rent. √âviter les aller-retours.

2. ‚ö†Ô∏è DISTINCTION VISITS vs ACTIVITIES (IMPORTANT) :
   **visits[] = LIEUX √† voir** 
   - Monuments, temples, cath√©drales, mus√©es, sites arch√©ologiques, grottes, ch√¢teaux, palais
   - D√©crit CE QU'ON VOIT : architecture, histoire, collections
   - Exemple : "La cath√©drale Notre-Dame domine la ville de sa fl√®che de 142 m√®tres"
   
   **activities[] = ACTIONS √† faire**
   - Randonn√©es, kayak, v√©lo, plong√©e, cours de cuisine, march√©s, croisi√®res, safaris, parachute
   - D√©crit CE QU'ON FAIT : exp√©riences, activit√©s sportives, culturelles, gastronomiques
   - Exemple : "Descendez la Nam Song en kayak. Les falaises calcaires d√©filent de chaque c√¥t√©."
   
   ‚ùå NE JAMAIS mettre un mus√©e, monument ou lieu dans activities
   ‚ùå NE JAMAIS r√©p√©ter le m√™me contenu dans visits et activities

3. 5-8 visits + 3-6 activities par day minimum ‚Äî enrichir si la source manque de contenu
4. suggested_days : 0.5 | 1.0 | 1.5 ‚Äî au-del√†, √©clater en plusieurs days avec m√™me place_id
5. estimated_days_base = CEIL(somme des suggested_days) ‚Äî ex: 1.5 + 1.0 = 2.5 ‚Üí 3
6. to_next_leg sur tous les days SAUF le dernier
7. coords = [lat, lon] du centre-ville ‚Äî ne PAS inventer de coordonn√©es pr√©cises
8. itin_id = CC::region::slug (CC = ISO2 : FR, LA, TH, HR, IT...)
9. region_code = CC-XX (code r√©gional usuel, ex: LA-LP, HR-21, FR-84, IT-PUG)
10. dept_code = abr√©viation r√©gionale usuelle (LP, 21, 84, PUG...)
11. slice = toujours 1
12. source_url = URL de la SOURCE si disponible
13. language = "fr" ‚Äî TOUS les textes en fran√ßais (traduire si source en autre langue, garder noms propres d'origine : Wat, Piazza, Playa...)

üìã FORMAT ENRICHI (OBLIGATOIRE) :
15. subtitle = 1 phrase d'accroche sous le titre (style "Des temples dor√©s aux plages de r√™ve")
16. practical_context.best_months = tableau des meilleurs mois pour visiter (ex: ["mai", "juin", "septembre"])
17. practical_context.highlights = 4-6 points forts de l'itin√©raire
18. practical_info = ajouter sur les activit√©s importantes (randos, safaris, camping, locations...) avec duration, difficulty, tip, best_time selon contexte
19. road_type = ajouter dans to_next_leg UNIQUEMENT si route non goudronn√©e (ex: "Piste", "Gravel", "Goudron puis piste")
20. ‚ö†Ô∏è map_keywords = OBLIGATOIRE dans night{} pour chaque jour
    - Array de mots-cl√©s pour Google Maps
    - Format: "Nom exact du lieu + Ville" (ex: "Wat Xieng Thong Luang Prabang")
    - Reprendre TOUTES les visits du jour dans l'ORDRE LOGIQUE de visite
    - 5-8 keywords par jour selon le nombre de visits
    - Les keywords doivent √™tre recherchables sur Google Maps

‚úçÔ∏è STYLE D'√âCRITURE ‚Äî VARIER LES FORMES :
- Informatif simple : "Les toits du Vat Xieng Thong descendent jusqu'au sol. Ses mosa√Øques..."
- Imp√©ratif : "Rejoignez...", "Empruntez...", "Poussez la porte...", "Grimpez...", "Traversez..." ‚Äî varie les verbes
- Narratif : "Les moines tissent encore...", "Les fid√®les affluent..."
- Invitation : "Rendez-vous √† l'aube pour le tak bat"
- Question/suggestion : "Envie de voir le M√©kong d'en haut ? Mont Phousi et ses 328 marches"

ALTERNER ces formes pour casser la monotonie. Ne pas encha√Æner plus de 2 textes du m√™me style.

PAS DE MOTS POMPEUX / IA (Obligatoire) : garder un style simple, informatif qui explique ce qu'il y a √† voir et pourquoi c'est int√©ressant. Donner des d√©tails historiques, architecturaux, naturels concrets.

${effectiveMode === 'seed' ? `
üè† MODE BASES + BOUCLES - BASES : ${effectiveSeeds || '[extraire du texte]'}
Structure : BASE ‚Üí excursions ‚Üí retour BASE (tous les 3-5j) ‚Üí nouvelle BASE...
` : ''}
${effectiveMode === 'citytrip' ? `
üèôÔ∏è MODE CITY TRIP - Chaque attraction = 1 day distinct. night.place_id = l'attraction.
` : ''}
${effectiveMode === 'follow' ? `
üìç MODE SUIVI STRICT - Conserver l'ordre exact des √©tapes de la source.
` : ''}
${isAdmin ? `
üö´ NEUTRALISATION (MODE ADMIN) - Ces JSON seront diffus√©s publiquement.
‚úÖ GARDER : Mus√©es, monuments, temples, parcs, sites UNESCO, march√©s publics
‚ùå SUPPRIMER : Commerces nomm√©s ‚Üí "Les loueurs proposent..." | Personnes ‚Üí supprimer | Prix ‚Üí omettre | "√† moto" ‚Üí "par la route" | Dates r√©centes ‚Üí supprimer | 1√®re personne ‚Üí reformuler
` : ''}

üö´ INTERDIT : Phrases sans verbe ("Cath√©drale gothique. Vitraux. Crypte.")

SOURCE :
`;
  },

  // ============================================
  // ENGLISH v8 - Enriched format
  // ============================================
  en: ({mode, seeds, modelSubMode, modelSeeds}) => {
    const isAdmin = mode === 'model';
    const effectiveMode = isAdmin ? modelSubMode : 'logic';
    const effectiveSeeds = isAdmin ? modelSeeds : seeds;
    
    return `You are a structured data extractor. Output ONLY valid JSON, no text, no Markdown.

Transform SOURCE content into JSON "itins" (SINGLE object). Follow this example:

{
  "itins": [{
    "itin_id": "LA::north::luang-prabang-vang-vieng",
    "language": "en",
    "created_at": "${new Date().toISOString().split('T')[0]}T12:00:00Z",
    "source_url": "",
    "dept_code": "LP",
    "dept_name": "Luang Prabang",
    "title": "Temples and Karsts of Northern Laos",
    "subtitle": "From the monks of Luang Prabang to the turquoise lagoons of Vang Vieng",
    "estimated_days_base": 3,
    "pacing_rules": {
      "factors": {"slow": 1.25, "standard": 1.0, "fast": 0.75},
      "merge_threshold": 0.85
    },
    "practical_context": {
      "best_months": ["November", "December", "January", "February"],
      "highlights": [
        "Dawn alms giving ceremony (tak bat)",
        "Golden temples of Luang Prabang",
        "Caves and turquoise lagoons of Vang Vieng",
        "Mekong river navigation"
      ]
    },
    "days_plan": [
      {
        "day": 1,
        "slice": 1,
        "region_code": "LA-LP",
        "suggested_days": 1.5,
        "night": {
          "place_id": "LA::luang_prabang",
          "map_keywords": [
            "Wat Xieng Thong Luang Prabang",
            "Mount Phousi Luang Prabang",
            "Royal Palace Luang Prabang",
            "Wat Mai Luang Prabang",
            "Wat Visoun Luang Prabang",
            "Wat Xieng Mouane Luang Prabang"
          ]
          "coords": [19.8856, 102.1347]
        },
        "visits": [
          {"text": "Wat Xieng Thong's roofs sweep down to ground level. Red glass mosaics depict the Buddha's life."},
          {"text": "Climb the 328 steps of Mount Phousi to see the Mekong and Nam Khan converge."},
          {"text": "The Royal Palace displays the throne and Phra Bang, the golden Buddha that gave the city its name."},
          {"text": "Wat Mai's gilded porch is carved with Ramayana scenes. Devotees gather here during Lao New Year."},
          {"text": "Wat Visoun dates from 1513. Inside is a large wooden Buddha and That Makmo stupa."},
          {"text": "Follow the Nam Khan to Wat Xieng Mouane where monks still weave traditional textiles."}
        ],
        "activities": [
          {"text": "Wake at dawn for tak bat: monks pass silently to collect their food.", "practical_info": {"best_time": "5:30-6:30am", "tip": "Stay quiet, no flash"}},
          {"text": "The night market fills Sisavangvong Road from 5pm. Textiles, crafts and lanterns."},
          {"text": "Learn to cook Lao: laap, tam mak houng, khao niaw.", "practical_info": {"duration": "3h", "type": "Cooking class"}}
        ],
        "to_next_leg": {
          "distance_km": 230,
          "drive_min": 270,
          "transport_mode": "car",
          "road_type": "Winding tarmac",
          "method": "heuristic"
        }
      },
      {
        "day": 2,
        "slice": 1,
        "region_code": "LA-VT",
        "suggested_days": 1.0,
        "night": {
          "place_id": "LA::vang_vieng",
          "map_keywords": [
            "Tham Chang Cave Vang Vieng",
            "Blue Lagoon Vang Vieng",
            "Tham Phu Kham Cave Vang Vieng",
            "Bamboo Bridge Vang Vieng",
            "Tham Nam Cave Vang Vieng"
          ],
          "coords": [18.9220, 102.4476]
        },
        "visits": [
          {"text": "Tham Chang cave opens in the cliff facing the Nam Song. Stairs lead up to illuminated stalactites."},
          {"text": "Blue Lagoon: turquoise water at the foot of karsts, perfect for swimming."},
          {"text": "Tham Phu Kham cave extends 500 meters. A reclining Buddha sleeps in the darkness."},
          {"text": "A bamboo bridge crosses the Nam Song to the rice paddies on the west bank."},
          {"text": "Tham Nam cave is explored by tubing on an underground river."}
        ],
        "activities": [
          {"text": "Kayak down the Nam Song. Limestone cliffs scroll past on both sides.", "practical_info": {"duration": "2-3h", "difficulty": "Easy"}},
          {"text": "The karst walls offer climbing routes for all levels."},
          {"text": "Rent a bike to reach lagoons and caves by dirt roads."}
        ]
      }
    ]
  }]
}

üìã CRITICAL RULES:

1. LOGICAL ORDER ‚Äî Reorganize steps for geographically coherent itinerary. Avoid backtracking.

2. ‚ö†Ô∏è VISITS vs ACTIVITIES DISTINCTION (IMPORTANT):
   **visits[] = PLACES to see**
   - Monuments, temples, cathedrals, museums, archaeological sites, caves, castles, palaces
   - Describes WHAT YOU SEE: architecture, history, collections
   - Example: "Wat Xieng Thong's roofs sweep down to ground level. Red glass mosaics depict the Buddha's life."
   
   **activities[] = ACTIONS to do**
   - Hiking, kayaking, cycling, diving, cooking classes, markets, cruises, safaris, paragliding
   - Describes WHAT YOU DO: experiences, sports, cultural or gastronomic activities
   - Example: "Kayak down the Nam Song. Limestone cliffs scroll past on both sides."
   
   ‚ùå NEVER put a museum, monument or place in activities
   ‚ùå NEVER repeat the same content in visits and activities

3. 5-8 visits + 3-6 activities per day minimum ‚Äî enrich if source lacks content
4. suggested_days: 0.5 | 1.0 | 1.5 ‚Äî beyond that, split into multiple days with same place_id
5. estimated_days_base = CEIL(sum of suggested_days) ‚Äî ex: 1.5 + 1.0 = 2.5 ‚Üí 3
6. to_next_leg on all days EXCEPT the last
7. coords = [lat, lon] of city center ‚Äî do NOT invent precise coordinates
8. itin_id = CC::region::slug (CC = ISO2: FR, LA, TH, HR, IT...)
9. region_code = CC-XX (regional code, ex: LA-LP, HR-21, FR-84, IT-PUG)
10. dept_code = regional abbreviation (LP, 21, 84, PUG...)
11. slice = always 1
12. source_url = SOURCE URL if available
13. language = "en" ‚Äî ALL texts in English (translate if source in other language, keep original proper names: Wat, Piazza, Playa...)

üìã ENRICHED FORMAT (MANDATORY):
15. subtitle = 1 catchy phrase under title (style "From golden temples to dream beaches")
16. practical_context.best_months = array of best visiting months (ex: ["May", "June", "September"])
17. practical_context.highlights = 4-6 itinerary highlights
18. practical_info = add for important activities (hikes, safaris, camping, rentals...) with duration, difficulty, tip, best_time as appropriate
19. road_type = add in to_next_leg ONLY if road is NOT standard tarmac (ex: "Track", "Gravel", "Tarmac then track")
20. ‚ö†Ô∏è map_keywords = MANDATORY in night{} for each day
    - Array of keywords for Google Maps
    - Format: "Exact place name + City" (ex: "Wat Xieng Thong Luang Prabang")
    - Include ALL visits of the day in LOGICAL visiting order
    - 5-8 keywords per day depending on number of visits
    - Keywords must be searchable on Google Maps

‚úçÔ∏è WRITING STYLE ‚Äî VARY FORMS:
- Simple informative: "Wat Xieng Thong's roofs sweep down to ground level. Its mosaics..."
- Imperative: "Head to...", "Take...", "Push open...", "Climb...", "Cross..." ‚Äî vary verbs
- Narrative: "Monks still weave...", "Devotees flock..."
- Invitation: "Meet at dawn for tak bat"
- Question/suggestion: "Want to see the Mekong from above? Mount Phousi and its 328 steps"

ALTERNATE these forms to break monotony. Don't chain more than 2 texts of the same style.

NO POMPOUS / AI WORDS (Mandatory): keep a simple, informative style that explains what there is to see and why it's interesting. Give concrete historical, architectural, natural details.

${effectiveMode === 'seed' ? `
üè† BASES + LOOPS MODE - BASES: ${effectiveSeeds || '[extract from text]'}
Structure: BASE ‚Üí excursions ‚Üí return BASE (every 3-5d) ‚Üí new BASE...
` : ''}
${effectiveMode === 'citytrip' ? `
üèôÔ∏è CITY TRIP MODE - Each attraction = 1 distinct day. night.place_id = the attraction.
` : ''}
${effectiveMode === 'follow' ? `
üìç STRICT FOLLOW MODE - Keep exact order of steps from source.
` : ''}
${isAdmin ? `
üö´ NEUTRALIZATION (ADMIN MODE) - These JSONs will be publicly distributed.
‚úÖ KEEP: Museums, monuments, temples, parks, UNESCO sites, public markets
‚ùå REMOVE: Named businesses ‚Üí "Rental companies offer..." | People ‚Üí remove | Prices ‚Üí omit | "by motorbike" ‚Üí "by road" | Recent dates ‚Üí remove | 1st person ‚Üí rephrase
` : ''}

üö´ FORBIDDEN: Sentences without verbs ("Gothic cathedral. Stained glass. Crypt.")

SOURCE:
`;
  },

  // ============================================
  // ESPA√ëOL v8
  // ============================================
  es: ({mode, seeds, modelSubMode, modelSeeds}) => {
    const isAdmin = mode === 'model';
    const effectiveMode = isAdmin ? modelSubMode : 'logic';
    const effectiveSeeds = isAdmin ? modelSeeds : seeds;
    
    return `Eres un extractor de datos estructurados. Produce SOLO JSON v√°lido, sin texto, sin Markdown.

Transforma el contenido SOURCE en JSON "itins" (UN SOLO objeto). Sigue este ejemplo:

{
  "itins": [{
    "itin_id": "LA::norte::luang-prabang-vang-vieng",
    "language": "es",
    "created_at": "${new Date().toISOString().split('T')[0]}T12:00:00Z",
    "source_url": "",
    "dept_code": "LP",
    "dept_name": "Luang Prabang",
    "title": "Templos y karsts del Norte de Laos",
    "subtitle": "De los monjes de Luang Prabang a las lagunas turquesa de Vang Vieng",
    "estimated_days_base": 3,
    "pacing_rules": {
      "factors": {"slow": 1.25, "standard": 1.0, "fast": 0.75},
      "merge_threshold": 0.85
    },
    "practical_context": {
      "best_months": ["noviembre", "diciembre", "enero", "febrero"],
      "highlights": [
        "Procesi√≥n de monjes al amanecer (tak bat)",
        "Templos dorados de Luang Prabang",
        "Cuevas y lagunas turquesa de Vang Vieng",
        "Navegaci√≥n por el Mekong"
      ]
    },
    "days_plan": [
      {
        "day": 1,
        "slice": 1,
        "region_code": "LA-LP",
        "suggested_days": 1.5,
        "night": {
          "place_id": "LA::luang_prabang",
          "map_keywords": [
            "Wat Xieng Thong Luang Prabang",
            "Mount Phousi Luang Prabang",
            "Royal Palace Luang Prabang",
            "Wat Mai Luang Prabang",
            "Wat Visoun Luang Prabang",
            "Wat Xieng Mouane Luang Prabang"
          ],
          "coords": [19.8856, 102.1347]
        },
        "visits": [
          {"text": "Los techos del Wat Xieng Thong bajan hasta el suelo. Sus mosaicos de vidrio rojo ilustran la vida de Buda."},
          {"text": "Sube los 328 escalones del monte Phousi para ver el Mekong y la Nam Khan confluir."},
          {"text": "El Palacio Real expone el trono y el Phra Bang, buda dorado que dio nombre a la ciudad."},
          {"text": "El p√≥rtico dorado del Wat Mai est√° esculpido con escenas del Ramayana. Los fieles se re√∫nen aqu√≠ en el A√±o Nuevo lao."},
          {"text": "El Wat Visoun data de 1513. Se ve un gran Buda de madera y el estupa That Makmo."},
          {"text": "Sigue la Nam Khan hasta el Wat Xieng Mouane donde los monjes tejen textiles tradicionales."}
        ],
        "activities": [
          {"text": "Lev√°ntate al amanecer para el tak bat: los monjes pasan en silencio a recoger su comida.", "practical_info": {"best_time": "5h30-6h30", "tip": "Mant√©n el silencio, sin flash"}},
          {"text": "El mercado nocturno se instala en Sisavangvong Road desde las 17h. Textiles, artesan√≠a y linternas."},
          {"text": "Aprende a cocinar lao: laap, tam mak houng, khao niaw.", "practical_info": {"duration": "3h", "type": "Clase de cocina"}}
        ],
        "to_next_leg": {
          "distance_km": 230,
          "drive_min": 270,
          "transport_mode": "car",
          "road_type": "Asfalto sinuoso",
          "method": "heuristic"
        }
      },
      {
        "day": 2,
        "slice": 1,
        "region_code": "LA-VT",
        "suggested_days": 1.0,
        "night": {
          "place_id": "LA::vang_vieng",
          "map_keywords": [
            "Tham Chang Cave Vang Vieng",
            "Blue Lagoon Vang Vieng",
            "Tham Phu Kham Cave Vang Vieng",
            "Bamboo Bridge Vang Vieng",
            "Tham Nam Cave Vang Vieng"
          ],
          "coords": [18.9220, 102.4476]
        },
        "visits": [
          {"text": "La cueva Tham Chang se abre en el acantilado frente al Nam Song. Una escalera sube hacia sus estalactitas iluminadas."},
          {"text": "Blue Lagoon: agua turquesa al pie de los karsts, perfecta para ba√±arse."},
          {"text": "La cueva Tham Phu Kham se adentra 500 metros. Un buda reclinado duerme en la penumbra."},
          {"text": "Un puente de bamb√∫ cruza el Nam Song hacia los arrozales de la orilla oeste."},
          {"text": "La cueva Tham Nam se visita en flotador, llevado por un r√≠o subterr√°neo."}
        ],
        "activities": [
          {"text": "Baja el Nam Song en kayak. Los acantilados calizos desfilan a ambos lados.", "practical_info": {"duration": "2-3h", "difficulty": "F√°cil"}},
          {"text": "Las paredes k√°rsticas ofrecen v√≠as de escalada para todos los niveles."},
          {"text": "Alquila una bici para llegar a lagunas y cuevas por caminos de tierra."}
        ]
      }
    ]
  }]
}

üìã REGLAS CR√çTICAS:

1. ORDEN L√ìGICO ‚Äî Reorganizar etapas geogr√°ficamente. Evitar retrocesos.

2. ‚ö†Ô∏è DISTINCI√ìN VISITS vs ACTIVITIES (IMPORTANTE):
   **visits[] = LUGARES para ver**
   - Monumentos, templos, catedrales, museos, sitios arqueol√≥gicos, cuevas, castillos, palacios
   - Describe LO QUE SE VE: arquitectura, historia, colecciones
   - Ejemplo: "Los techos del Wat Xieng Thong bajan hasta el suelo. Sus mosaicos de vidrio rojo ilustran la vida de Buda."
   
   **activities[] = ACCIONES para hacer**
   - Senderismo, kayak, bicicleta, buceo, clases de cocina, mercados, cruceros, safaris, parapente
   - Describe LO QUE SE HACE: experiencias, deportes, actividades culturales o gastron√≥micas
   - Ejemplo: "Baja el Nam Song en kayak. Los acantilados calizos desfilan a ambos lados."
   
   ‚ùå NUNCA poner un museo, monumento o lugar en activities
   ‚ùå NUNCA repetir el mismo contenido en visits y activities

3. 5-8 visits + 3-6 activities por d√≠a m√≠nimo ‚Äî enriquecer si la fuente carece de contenido
4. suggested_days: 0.5 | 1.0 | 1.5 ‚Äî m√°s all√°, dividir en varios d√≠as con mismo place_id
5. estimated_days_base = CEIL(suma de suggested_days) ‚Äî ej: 1.5 + 1.0 = 2.5 ‚Üí 3
6. to_next_leg en todos los d√≠as EXCEPTO el √∫ltimo
7. coords = [lat, lon] del centro ciudad ‚Äî NO inventar coordenadas precisas
8. itin_id = CC::region::slug (CC = ISO2: FR, LA, TH, HR, IT...)
9. region_code = CC-XX (c√≥digo regional, ej: LA-LP, HR-21, FR-84, IT-PUG)
10. dept_code = abreviatura regional (LP, 21, 84, PUG...)
11. slice = siempre 1
12. source_url = URL de la FUENTE si disponible
13. language = "es" ‚Äî TODOS los textos en espa√±ol (traducir si fuente en otro idioma, mantener nombres propios: Wat, Piazza, Playa...)

üìã FORMATO ENRIQUECIDO (OBLIGATORIO):
15. subtitle = 1 frase gancho bajo el t√≠tulo (estilo "De los templos dorados a las playas de ensue√±o")
16. practical_context.best_months = array de mejores meses (ej: ["mayo", "junio", "septiembre"])
17. practical_context.highlights = 4-6 puntos destacados del itinerario
18. practical_info = a√±adir en actividades importantes (caminatas, safaris, camping, alquileres...) con duration, difficulty, tip, best_time seg√∫n contexto
19. road_type = a√±adir en to_next_leg SOLO si la ruta NO es asfalto normal (ej: "Grava", "Pista", "Asfalto luego pista")
20. ‚ö†Ô∏è map_keywords = OBLIGATORIO en night{} para cada d√≠a
    - Array de palabras clave para Google Maps
    - Formato: "Nombre exacto del lugar + Ciudad" (ej: "Wat Xieng Thong Luang Prabang")
    - Incluir TODAS las visits del d√≠a en ORDEN L√ìGICO de visita
    - 5-8 keywords por d√≠a seg√∫n n√∫mero de visits
    - Las keywords deben ser buscables en Google Maps

‚úçÔ∏è ESTILO ‚Äî VARIAR LAS FORMAS:
- Informativo simple: "Los techos del Wat Xieng Thong bajan hasta el suelo. Sus mosaicos..."
- Imperativo: "Dir√≠gete a...", "Toma...", "Abre la puerta...", "Sube...", "Cruza..." ‚Äî var√≠a verbos
- Narrativo: "Los monjes tejen a√∫n...", "Los fieles acuden..."
- Invitaci√≥n: "Re√∫nete al amanecer para el tak bat"
- Pregunta/sugerencia: "¬øQuieres ver el Mekong desde arriba? Monte Phousi y sus 328 escalones"

ALTERNAR estas formas para romper la monoton√≠a. No encadenar m√°s de 2 textos del mismo estilo.

SIN PALABRAS POMPOSAS / IA (Obligatorio): mantener estilo simple, informativo que explica qu√© hay para ver y por qu√© es interesante. Dar detalles hist√≥ricos, arquitect√≥nicos, naturales concretos.

${effectiveMode === 'seed' ? `
üè† MODO BASES + BUCLES - BASES: ${effectiveSeeds || '[extraer del texto]'}
Estructura: BASE ‚Üí excursiones ‚Üí vuelta BASE (cada 3-5d) ‚Üí nueva BASE...
` : ''}
${effectiveMode === 'citytrip' ? `
üèôÔ∏è MODO CITY TRIP - Cada atracci√≥n = 1 d√≠a distinto. night.place_id = la atracci√≥n.
` : ''}
${effectiveMode === 'follow' ? `
üìç MODO SEGUIMIENTO ESTRICTO - Conservar orden exacto de etapas de la fuente.
` : ''}
${isAdmin ? `
üö´ NEUTRALIZACI√ìN (MODO ADMIN) - Estos JSON se distribuir√°n p√∫blicamente.
‚úÖ MANTENER: Museos, monumentos, templos, parques, sitios UNESCO, mercados p√∫blicos
‚ùå ELIMINAR: Comercios nombrados ‚Üí "Los alquileres ofrecen..." | Personas ‚Üí eliminar | Precios ‚Üí omitir | "en moto" ‚Üí "por carretera" | Fechas recientes ‚Üí eliminar | 1¬™ persona ‚Üí reformular
` : ''}

üö´ PROHIBIDO: Frases sin verbo ("Catedral g√≥tica. Vidrieras. Cripta.")

SOURCE:
`;
  },

  // ============================================
  // ITALIANO v8
  // ============================================
  it: ({mode, seeds, modelSubMode, modelSeeds}) => {
    const isAdmin = mode === 'model';
    const effectiveMode = isAdmin ? modelSubMode : 'logic';
    const effectiveSeeds = isAdmin ? modelSeeds : seeds;
    
    return `Sei un estrattore di dati strutturati. Produci SOLO JSON valido, senza testo, senza Markdown.

Trasforma il contenuto SOURCE in JSON "itins" (UN SOLO oggetto). Segui questo esempio:

{
  "itins": [{
    "itin_id": "LA::nord::luang-prabang-vang-vieng",
    "language": "it",
    "created_at": "${new Date().toISOString().split('T')[0]}T12:00:00Z",
    "source_url": "",
    "dept_code": "LP",
    "dept_name": "Luang Prabang",
    "title": "Templi e karst del Nord Laos",
    "subtitle": "Dai monaci di Luang Prabang alle lagune turchesi di Vang Vieng",
    "estimated_days_base": 3,
    "pacing_rules": {
      "factors": {"slow": 1.25, "standard": 1.0, "fast": 0.75},
      "merge_threshold": 0.85
    },
    "practical_context": {
      "best_months": ["novembre", "dicembre", "gennaio", "febbraio"],
      "highlights": [
        "Processione dei monaci all'alba (tak bat)",
        "Templi dorati di Luang Prabang",
        "Grotte e lagune turchesi di Vang Vieng",
        "Navigazione sul Mekong"
      ]
    },
    "days_plan": [
      {
        "day": 1,
        "slice": 1,
        "region_code": "LA-LP",
        "suggested_days": 1.5,
        "night": {
          "place_id": "LA::luang_prabang",
          "map_keywords": [
            "Wat Xieng Thong Luang Prabang",
            "Mount Phousi Luang Prabang",
            "Royal Palace Luang Prabang",
            "Wat Mai Luang Prabang",
            "Wat Visoun Luang Prabang",
            "Wat Xieng Mouane Luang Prabang"
          ],
          "coords": [19.8856, 102.1347]
        },
        "visits": [
          {"text": "I tetti del Wat Xieng Thong scendono fino a terra. I suoi mosaici di vetro rosso illustrano la vita del Buddha."},
          {"text": "Salite i 328 gradini del monte Phousi per vedere il Mekong e la Nam Khan confluire."},
          {"text": "Il Palazzo Reale espone il trono e il Phra Bang, buddha dorato che ha dato il nome alla citt√†."},
          {"text": "Il portico dorato del Wat Mai √® scolpito con scene del Ramayana. I fedeli si riuniscono qui al Capodanno lao."},
          {"text": "Il Wat Visoun risale al 1513. Si vede un grande Buddha in legno e lo stupa That Makmo."},
          {"text": "Seguite la Nam Khan fino al Wat Xieng Mouane dove i monaci tessono tessuti tradizionali."}
        ],
        "activities": [
          {"text": "Alzatevi all'alba per il tak bat: i monaci passano in silenzio a raccogliere il cibo.", "practical_info": {"best_time": "5h30-6h30", "tip": "Restate discreti, niente flash"}},
          {"text": "Il mercato notturno si installa su Sisavangvong Road dalle 17. Tessuti, artigianato e lanterne."},
          {"text": "Imparate a cucinare lao: laap, tam mak houng, khao niaw.", "practical_info": {"duration": "3h", "type": "Corso di cucina"}}
        ],
        "to_next_leg": {
          "distance_km": 230,
          "drive_min": 270,
          "transport_mode": "car",
          "road_type": "Asfalto sinuoso",
          "method": "heuristic"
        }
      },
      {
        "day": 2,
        "slice": 1,
        "region_code": "LA-VT",
        "suggested_days": 1.0,
        "night": {
          "place_id": "LA::vang_vieng",
          "map_keywords": [
            "Tham Chang Cave Vang Vieng",
            "Blue Lagoon Vang Vieng",
            "Tham Phu Kham Cave Vang Vieng",
            "Bamboo Bridge Vang Vieng",
            "Tham Nam Cave Vang Vieng"
          ],
          "coords": [18.9220, 102.4476]
        },
        "visits": [
          {"text": "La grotta Tham Chang si apre nella falesia di fronte al Nam Song. Una scala sale verso le stalattiti illuminate."},
          {"text": "Blue Lagoon: acqua turchese ai piedi dei karst, perfetta per nuotare."},
          {"text": "La grotta Tham Phu Kham si addentra per 500 metri. Un buddha sdraiato dorme nella penombra."},
          {"text": "Un ponte di bamb√π attraversa il Nam Song verso le risaie della riva ovest."},
          {"text": "La grotta Tham Nam si visita in gommone, trasportati da un fiume sotterraneo."}
        ],
        "activities": [
          {"text": "Scendete il Nam Song in kayak. Le falesie calcaree scorrono su entrambi i lati.", "practical_info": {"duration": "2-3h", "difficulty": "Facile"}},
          {"text": "Le pareti carsiche offrono vie di arrampicata per tutti i livelli."},
          {"text": "Noleggiate una bici per raggiungere lagune e grotte per strade sterrate."}
        ]
      }
    ]
  }]
}

üìã REGOLE CRITICHE:

1. ORDINE LOGICO ‚Äî Riorganizzare le tappe geograficamente. Evitare ritorni.

2. ‚ö†Ô∏è DISTINZIONE VISITS vs ACTIVITIES (IMPORTANTE):
   **visits[] = LUOGHI da vedere**
   - Monumenti, templi, cattedrali, musei, siti archeologici, grotte, castelli, palazzi
   - Descrive COSA SI VEDE: architettura, storia, collezioni
   - Esempio: "I tetti del Wat Xieng Thong scendono fino a terra. I suoi mosaici di vetro rosso illustrano la vita del Buddha."
   
   **activities[] = AZIONI da fare**
   - Escursioni, kayak, bicicletta, immersioni, corsi di cucina, mercati, crociere, safari, parapendio
   - Descrive COSA SI FA: esperienze, sport, attivit√† culturali o gastronomiche
   - Esempio: "Scendete il Nam Song in kayak. Le falesie calcaree scorrono su entrambi i lati."
   
   ‚ùå MAI mettere un museo, monumento o luogo in activities
   ‚ùå MAI ripetere lo stesso contenuto in visits e activities

3. 5-8 visits + 3-6 activities per giorno minimo ‚Äî arricchire se la fonte manca di contenuto
4. suggested_days: 0.5 | 1.0 | 1.5 ‚Äî oltre, dividere in pi√π giorni con stesso place_id
5. estimated_days_base = CEIL(somma di suggested_days) ‚Äî es: 1.5 + 1.0 = 2.5 ‚Üí 3
6. to_next_leg su tutti i giorni TRANNE l'ultimo
7. coords = [lat, lon] del centro citt√† ‚Äî NON inventare coordinate precise
8. itin_id = CC::region::slug (CC = ISO2: FR, LA, TH, HR, IT...)
9. region_code = CC-XX (codice regionale, es: LA-LP, HR-21, FR-84, IT-PUG)
10. dept_code = abbreviazione regionale (LP, 21, 84, PUG...)
11. slice = sempre 1
12. source_url = URL della FONTE se disponibile
13. language = "it" ‚Äî TUTTI i testi in italiano (tradurre se fonte in altra lingua, mantenere nomi propri: Wat, Piazza, Playa...)

üìã FORMATO ARRICCHITO (OBBLIGATORIO):
15. subtitle = 1 frase accattivante sotto il titolo (stile "Dai templi dorati alle spiagge da sogno")
16. practical_context.best_months = array dei mesi migliori (es: ["maggio", "giugno", "settembre"])
17. practical_context.highlights = 4-6 punti salienti dell'itinerario
18. practical_info = aggiungere alle attivit√† importanti (escursioni, safari, campeggio, noleggi...) con duration, difficulty, tip, best_time secondo contesto
19. road_type = aggiungere in to_next_leg SOLO se la strada NON √® asfalto normale (es: "Sterrato", "Pista", "Asfalto poi sterrato")
20. ‚ö†Ô∏è map_keywords = OBBLIGATORIO in night{} per ogni giorno
    - Array di parole chiave per Google Maps
    - Formato: "Nome esatto del luogo + Citt√†" (es: "Wat Xieng Thong Luang Prabang")
    - Includere TUTTE le visits del giorno in ORDINE LOGICO di visita
    - 5-8 keywords per giorno secondo numero di visits
    - Le keywords devono essere ricercabili su Google Maps

‚úçÔ∏è STILE ‚Äî VARIARE LE FORME:
- Informativo semplice: "I tetti del Wat Xieng Thong scendono fino a terra. I suoi mosaici..."
- Imperativo: "Dirigetevi a...", "Prendete...", "Aprite la porta...", "Salite...", "Attraversate..." ‚Äî variate verbi
- Narrativo: "I monaci tessono ancora...", "I fedeli accorrono..."
- Invito: "Trovatevi all'alba per il tak bat"
- Domanda/suggerimento: "Volete vedere il Mekong dall'alto? Monte Phousi e i suoi 328 gradini"

ALTERNARE queste forme per rompere la monotonia. Non concatenare pi√π di 2 testi dello stesso stile.

SENZA PAROLE POMPOSE / IA (Obbligatorio): mantenere stile semplice, informativo che spiega cosa c'√® da vedere e perch√© √® interessante. Dare dettagli storici, architettonici, naturali concreti.

${effectiveMode === 'seed' ? `
üè† MODO BASI + ANELLI - BASI: ${effectiveSeeds || '[estrarre dal testo]'}
Struttura: BASE ‚Üí escursioni ‚Üí ritorno BASE (ogni 3-5g) ‚Üí nuova BASE...
` : ''}
${effectiveMode === 'citytrip' ? `
üèôÔ∏è MODO CITY TRIP - Ogni attrazione = 1 giorno distinto. night.place_id = l'attrazione.
` : ''}
${effectiveMode === 'follow' ? `
üìç MODO SEGUITO STRETTO - Conservare ordine esatto delle tappe dalla fonte.
` : ''}
${isAdmin ? `
üö´ NEUTRALIZZAZIONE (MODO ADMIN) - Questi JSON saranno distribuiti pubblicamente.
‚úÖ MANTENERE: Musei, monumenti, templi, parchi, siti UNESCO, mercati pubblici
‚ùå ELIMINARE: Commerci nominati ‚Üí "I noleggi offrono..." | Persone ‚Üí eliminare | Prezzi ‚Üí omettere | "in moto" ‚Üí "su strada" | Date recenti ‚Üí eliminare | 1¬™ persona ‚Üí riformulare
` : ''}

üö´ VIETATO: Frasi senza verbo ("Cattedrale gotica. Vetrate. Cripta.")

SOURCE:
`;
  },

  // ============================================
  // PORTUGU√äS v8
  // ============================================
  pt: ({mode, seeds, modelSubMode, modelSeeds}) => {
    const isAdmin = mode === 'model';
    const effectiveMode = isAdmin ? modelSubMode : 'logic';
    const effectiveSeeds = isAdmin ? modelSeeds : seeds;
    
    return `√âs um extrator de dados estruturados. Produz APENAS JSON v√°lido, sem texto, sem Markdown.

Transforma o conte√∫do SOURCE em JSON "itins" (UM S√ì objeto). Segue este exemplo:

{
  "itins": [{
    "itin_id": "LA::norte::luang-prabang-vang-vieng",
    "language": "pt",
    "created_at": "${new Date().toISOString().split('T')[0]}T12:00:00Z",
    "source_url": "",
    "dept_code": "LP",
    "dept_name": "Luang Prabang",
    "title": "Templos e carstes do Norte do Laos",
    "subtitle": "Dos monges de Luang Prabang √†s lagoas turquesa de Vang Vieng",
    "estimated_days_base": 3,
    "pacing_rules": {
      "factors": {"slow": 1.25, "standard": 1.0, "fast": 0.75},
      "merge_threshold": 0.85
    },
    "practical_context": {
      "best_months": ["novembro", "dezembro", "janeiro", "fevereiro"],
      "highlights": [
        "Prociss√£o dos monges ao amanhecer (tak bat)",
        "Templos dourados de Luang Prabang",
        "Grutas e lagoas turquesa de Vang Vieng",
        "Navega√ß√£o no Mekong"
      ]
    },
    "days_plan": [
      {
        "day": 1,
        "slice": 1,
        "region_code": "LA-LP",
        "suggested_days": 1.5,
        "night": {
          "place_id": "LA::luang_prabang",
          "map_keywords": [
            "Wat Xieng Thong Luang Prabang",
            "Mount Phousi Luang Prabang",
            "Royal Palace Luang Prabang",
            "Wat Mai Luang Prabang",
            "Wat Visoun Luang Prabang",
            "Wat Xieng Mouane Luang Prabang"
          ],
          "coords": [19.8856, 102.1347]
        },
        "visits": [
          {"text": "Os telhados do Wat Xieng Thong descem at√© ao ch√£o. Os seus mosaicos de vidro vermelho ilustram a vida de Buda."},
          {"text": "Suba os 328 degraus do monte Phousi para ver o Mekong e a Nam Khan conflu√≠rem."},
          {"text": "O Pal√°cio Real exp√µe o trono e o Phra Bang, buda dourado que deu o nome √† cidade."},
          {"text": "O p√≥rtico dourado do Wat Mai est√° esculpido com cenas do Ramayana. Os fi√©is re√∫nem-se aqui no Ano Novo lao."},
          {"text": "O Wat Visoun data de 1513. V√™-se um grande Buda de madeira e o estupa That Makmo."},
          {"text": "Siga a Nam Khan at√© ao Wat Xieng Mouane onde os monges ainda tecem t√™xteis tradicionais."}
        ],
        "activities": [
          {"text": "Levante-se ao amanhecer para o tak bat: os monges passam em sil√™ncio para recolher a comida.", "practical_info": {"best_time": "5h30-6h30", "tip": "Mantenha o sil√™ncio, sem flash"}},
          {"text": "O mercado noturno instala-se na Sisavangvong Road a partir das 17h. T√™xteis, artesanato e lanternas."},
          {"text": "Aprenda a cozinhar lao: laap, tam mak houng, khao niaw.", "practical_info": {"duration": "3h", "type": "Aula de culin√°ria"}}
        ],
        "to_next_leg": {
          "distance_km": 230,
          "drive_min": 270,
          "transport_mode": "car",
          "road_type": "Asfalto sinuoso",
          "method": "heuristic"
        }
      },
      {
        "day": 2,
        "slice": 1,
        "region_code": "LA-VT",
        "suggested_days": 1.0,
        "night": {
          "place_id": "LA::vang_vieng",
          "map_keywords": [
            "Tham Chang Cave Vang Vieng",
            "Blue Lagoon Vang Vieng",
            "Tham Phu Kham Cave Vang Vieng",
            "Bamboo Bridge Vang Vieng",
            "Tham Nam Cave Vang Vieng"
          ],
          "coords": [18.9220, 102.4476]
        },
        "visits": [
          {"text": "A gruta Tham Chang abre-se na fal√©sia em frente ao Nam Song. Uma escada sobe para as estalactites iluminadas."},
          {"text": "Blue Lagoon: √°gua turquesa aos p√©s dos carstes, perfeita para nadar."},
          {"text": "A gruta Tham Phu Kham estende-se por 500 metros. Um buda reclinado dorme na penumbra."},
          {"text": "Uma ponte de bambu atravessa o Nam Song para os arrozais da margem oeste."},
          {"text": "A gruta Tham Nam visita-se em boia, levado por um rio subterr√¢neo."}
        ],
        "activities": [
          {"text": "Des√ßa o Nam Song de caiaque. As fal√©sias calc√°rias desfilam de ambos os lados.", "practical_info": {"duration": "2-3h", "difficulty": "F√°cil"}},
          {"text": "As paredes c√°rsticas oferecem vias de escalada para todos os n√≠veis."},
          {"text": "Alugue uma bicicleta para chegar a lagoas e grutas por caminhos de terra."}
        ]
      }
    ]
  }]
}

üìã REGRAS CR√çTICAS:

1. ORDEM L√ìGICA ‚Äî Reorganizar etapas geograficamente. Evitar retornos.

2. ‚ö†Ô∏è DISTIN√á√ÉO VISITS vs ACTIVITIES (IMPORTANTE):
   **visits[] = LUGARES para ver**
   - Monumentos, templos, catedrais, museus, s√≠tios arqueol√≥gicos, grutas, castelos, pal√°cios
   - Descreve O QUE SE V√ä: arquitetura, hist√≥ria, cole√ß√µes
   - Exemplo: "Os telhados do Wat Xieng Thong descem at√© ao ch√£o. Os seus mosaicos de vidro vermelho ilustram a vida de Buda."
   
   **activities[] = A√á√ïES para fazer**
   - Caminhadas, caiaque, bicicleta, mergulho, aulas de culin√°ria, mercados, cruzeiros, safaris, parapente
   - Descreve O QUE SE FAZ: experi√™ncias, desportos, atividades culturais ou gastron√≥micas
   - Exemplo: "Des√ßa o Nam Song de caiaque. As fal√©sias calc√°rias desfilam de ambos os lados."
   
   ‚ùå NUNCA colocar um museu, monumento ou lugar em activities
   ‚ùå NUNCA repetir o mesmo conte√∫do em visits e activities

3. 5-8 visits + 3-6 activities por dia m√≠nimo ‚Äî enriquecer se a fonte carece de conte√∫do
4. suggested_days: 0.5 | 1.0 | 1.5 ‚Äî al√©m disso, dividir em v√°rios dias com mesmo place_id
5. estimated_days_base = CEIL(soma de suggested_days) ‚Äî ex: 1.5 + 1.0 = 2.5 ‚Üí 3
6. to_next_leg em todos os dias EXCETO o √∫ltimo
7. coords = [lat, lon] do centro cidade ‚Äî N√ÉO inventar coordenadas precisas
8. itin_id = CC::region::slug (CC = ISO2: FR, LA, TH, HR, IT...)
9. region_code = CC-XX (c√≥digo regional, ex: LA-LP, HR-21, FR-84, IT-PUG)
10. dept_code = abreviatura regional (LP, 21, 84, PUG...)
11. slice = sempre 1
12. source_url = URL da FONTE se dispon√≠vel
13. language = "pt" ‚Äî TODOS os textos em portugu√™s (traduzir se fonte em outro idioma, manter nomes pr√≥prios: Wat, Piazza, Playa...)

üìã FORMATO ENRIQUECIDO (OBRIGAT√ìRIO):
15. subtitle = 1 frase de impacto sob o t√≠tulo (estilo "Dos templos dourados √†s praias de sonho")
16. practical_context.best_months = array dos melhores meses (ex: ["maio", "junho", "setembro"])
17. practical_context.highlights = 4-6 destaques do itiner√°rio
18. practical_info = adicionar nas atividades importantes (trilhas, safaris, campismo, alugueres...) com duration, difficulty, tip, best_time segundo contexto
19. road_type = adicionar em to_next_leg APENAS se a estrada N√ÉO for asfalto normal (ex: "Terra batida", "Pista", "Asfalto depois terra")
20. ‚ö†Ô∏è map_keywords = OBRIGAT√ìRIO em night{} para cada dia
    - Array de palavras-chave para Google Maps
    - Formato: "Nome exato do lugar + Cidade" (ex: "Wat Xieng Thong Luang Prabang")
    - Incluir TODAS as visits do dia em ORDEM L√ìGICA de visita
    - 5-8 keywords por dia conforme n√∫mero de visits
    - As keywords devem ser pesquis√°veis no Google Maps

‚úçÔ∏è ESTILO ‚Äî VARIAR AS FORMAS:
- Informativo simples: "Os telhados do Wat Xieng Thong descem at√© ao ch√£o. Os seus mosaicos..."
- Imperativo: "Dirija-se a...", "Tome...", "Abra a porta...", "Suba...", "Atravesse..." ‚Äî varie verbos
- Narrativo: "Os monges tecem ainda...", "Os fi√©is acorrem..."
- Convite: "Encontre-se ao amanhecer para o tak bat"
- Pergunta/sugest√£o: "Quer ver o Mekong do alto? Monte Phousi e os seus 328 degraus"

ALTERNAR estas formas para quebrar a monotonia. N√£o encadear mais de 2 textos do mesmo estilo.

SEM PALAVRAS POMPOSAS / IA (Obrigat√≥rio): manter estilo simples, informativo que explica o que h√° para ver e porqu√™ √© interessante. Dar detalhes hist√≥ricos, arquitet√≥nicos, naturais concretos.

${effectiveMode === 'seed' ? `
üè† MODO BASES + VOLTAS - BASES: ${effectiveSeeds || '[extrair do texto]'}
Estrutura: BASE ‚Üí excurs√µes ‚Üí regresso BASE (cada 3-5d) ‚Üí nova BASE...
` : ''}
${effectiveMode === 'citytrip' ? `
üèôÔ∏è MODO CITY TRIP - Cada atra√ß√£o = 1 dia distinto. night.place_id = a atra√ß√£o.
` : ''}
${effectiveMode === 'follow' ? `
üìç MODO SEGUIMENTO ESTRITO - Conservar ordem exata das etapas da fonte.
` : ''}
${isAdmin ? `
üö´ NEUTRALIZA√á√ÉO (MODO ADMIN) - Estes JSON ser√£o distribu√≠dos publicamente.
‚úÖ MANTER: Museus, monumentos, templos, parques, s√≠tios UNESCO, mercados p√∫blicos
‚ùå ELIMINAR: Com√©rcios nomeados ‚Üí "Os alugueres oferecem..." | Pessoas ‚Üí eliminar | Pre√ßos ‚Üí omitir | "de mota" ‚Üí "pela estrada" | Datas recentes ‚Üí eliminar | 1¬™ pessoa ‚Üí reformular
` : ''}

üö´ PROIBIDO: Frases sem verbo ("Catedral g√≥tica. Vitrais. Cripta.")

SOURCE:
`;
  },

  // ============================================
  // ARABIC v8
  // ============================================
  ar: ({mode, seeds, modelSubMode, modelSeeds}) => {
    const isAdmin = mode === 'model';
    const effectiveMode = isAdmin ? modelSubMode : 'logic';
    const effectiveSeeds = isAdmin ? modelSeeds : seeds;
    
    return `ÿ£ŸÜÿ™ ŸÖÿ≥ÿ™ÿÆÿ±ÿ¨ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜÿ∏ŸÖÿ©. ÿ£ŸÜÿ™ÿ¨ JSON ÿµÿßŸÑÿ≠ ŸÅŸÇÿ∑ÿå ÿ®ÿØŸàŸÜ ŸÜÿµÿå ÿ®ÿØŸàŸÜ Markdown.

ÿ≠ŸàŸëŸÑ ŸÖÿ≠ÿ™ŸàŸâ SOURCE ÿ•ŸÑŸâ JSON "itins" (ŸÉÿßÿ¶ŸÜ Ÿàÿßÿ≠ÿØ). ÿßÿ™ÿ®ÿπ Ÿáÿ∞ÿß ÿßŸÑŸÖÿ´ÿßŸÑ:

{
  "itins": [{
    "itin_id": "LA::north::luang-prabang-vang-vieng",
    "language": "ar",
    "created_at": "${new Date().toISOString().split('T')[0]}T12:00:00Z",
    "source_url": "",
    "dept_code": "LP",
    "dept_name": "ŸÑŸàÿßŸÜÿ∫ ÿ®ÿ±ÿßÿ®ÿßŸÜÿ∫",
    "title": "ŸÖÿπÿßÿ®ÿØ Ÿàÿ™ÿ¥ŸÉŸäŸÑÿßÿ™ ŸÉÿßÿ±ÿ≥ÿ™ ÿ¥ŸÖÿßŸÑ ŸÑÿßŸàÿ≥",
    "subtitle": "ŸÖŸÜ ÿ±Ÿáÿ®ÿßŸÜ ŸÑŸàÿßŸÜÿ∫ ÿ®ÿ±ÿßÿ®ÿßŸÜÿ∫ ÿ•ŸÑŸâ ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿßÿ™ ÿßŸÑŸÅŸäÿ±Ÿàÿ≤Ÿäÿ© ŸÅŸä ŸÅÿßŸÜÿ∫ ŸÅŸäŸäŸÜÿ∫",
    "estimated_days_base": 3,
    "pacing_rules": {
      "factors": {"slow": 1.25, "standard": 1.0, "fast": 0.75},
      "merge_threshold": 0.85
    },
    "practical_context": {
      "best_months": ["ŸÜŸàŸÅŸÖÿ®ÿ±", "ÿØŸäÿ≥ŸÖÿ®ÿ±", "ŸäŸÜÿßŸäÿ±", "ŸÅÿ®ÿ±ÿßŸäÿ±"],
      "highlights": [
        "ŸÖŸàŸÉÿ® ÿßŸÑÿ±Ÿáÿ®ÿßŸÜ ÿπŸÜÿØ ÿßŸÑŸÅÿ¨ÿ± (ÿ™ÿßŸÉ ÿ®ÿßÿ™)",
        "ŸÖÿπÿßÿ®ÿØ ŸÑŸàÿßŸÜÿ∫ ÿ®ÿ±ÿßÿ®ÿßŸÜÿ∫ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ©",
        "ŸÉŸáŸàŸÅ Ÿàÿ®ÿ≠Ÿäÿ±ÿßÿ™ ŸÅÿßŸÜÿ∫ ŸÅŸäŸäŸÜÿ∫ ÿßŸÑŸÅŸäÿ±Ÿàÿ≤Ÿäÿ©",
        "ÿßŸÑÿ•ÿ®ÿ≠ÿßÿ± ŸÅŸä ŸÜŸáÿ± ÿßŸÑŸÖŸäŸÉŸàŸÜÿ∫"
      ]
    },
    "days_plan": [
      {
        "day": 1,
        "slice": 1,
        "region_code": "LA-LP",
        "suggested_days": 1.5,
        "night": {
          "place_id": "LA::luang_prabang",
          "map_keywords": [
            "Wat Xieng Thong Luang Prabang",
            "Mount Phousi Luang Prabang",
            "Royal Palace Luang Prabang",
            "Wat Mai Luang Prabang",
            "Wat Visoun Luang Prabang",
            "Wat Xieng Mouane Luang Prabang"
          ],
          "coords": [19.8856, 102.1347]
        },
        "visits": [
          {"text": "ÿ™ŸÜÿ≠ÿØÿ± ÿ£ÿ≥ÿ∑ÿ≠ Ÿàÿßÿ™ ÿ¥ŸäÿßŸÜÿ∫ ÿ´ŸàŸÜÿ∫ ÿ≠ÿ™Ÿâ ÿßŸÑÿ£ÿ±ÿ∂. ŸÅÿ≥ŸäŸÅÿ≥ÿßÿ° ÿßŸÑÿ≤ÿ¨ÿßÿ¨ ÿßŸÑÿ£ÿ≠ŸÖÿ± ÿ™ÿµŸàÿ± ÿ≠Ÿäÿßÿ© ÿ®Ÿàÿ∞ÿß."},
          {"text": "ÿßÿµÿπÿØ 328 ÿØÿ±ÿ¨ÿ© ŸÖŸÜ ÿ¨ÿ®ŸÑ ŸÅŸàÿ≥Ÿä ŸÑÿ™ÿ±Ÿâ ÿßŸÑÿ™ŸÇÿßÿ° ŸÜŸáÿ±Ÿä ÿßŸÑŸÖŸäŸÉŸàŸÜÿ∫ ŸàŸÜÿßŸÖ ÿÆÿßŸÜ."},
          {"text": "Ÿäÿπÿ±ÿ∂ ÿßŸÑŸÇÿµÿ± ÿßŸÑŸÖŸÑŸÉŸä ÿßŸÑÿπÿ±ÿ¥ ŸàŸÅÿ±ÿß ÿ®ÿßŸÜÿ∫ÿå ÿ®Ÿàÿ∞ÿß ÿßŸÑÿ∞Ÿáÿ®Ÿä ÿßŸÑÿ∞Ÿä ÿ£ÿπÿ∑Ÿâ ÿßŸÑŸÖÿØŸäŸÜÿ© ÿßÿ≥ŸÖŸáÿß."},
          {"text": "ÿ®Ÿàÿßÿ®ÿ© Ÿàÿßÿ™ ŸÖÿßŸä ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ© ŸÖŸÜÿ≠Ÿàÿ™ÿ© ÿ®ŸÖÿ¥ÿßŸáÿØ ŸÖŸÜ ÿßŸÑÿ±ÿßŸÖÿßŸäÿßŸÜÿß. Ÿäÿ¨ÿ™ŸÖÿπ ÿßŸÑŸÖÿµŸÑŸàŸÜ ŸáŸÜÿß ŸÅŸä ÿ±ÿ£ÿ≥ ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑŸÑÿßŸàŸäÿ©."},
          {"text": "ŸäÿπŸàÿØ Ÿàÿßÿ™ ŸÅŸäÿ≥ŸàŸÜ ÿ•ŸÑŸâ 1513. ŸäŸèÿ±Ÿâ ÿ®Ÿàÿ∞ÿß ÿÆÿ¥ÿ®Ÿä ŸÉÿ®Ÿäÿ± Ÿàÿ≥ÿ™Ÿàÿ®ÿß ÿ∞ÿßÿ™ ŸÖÿßŸÉŸÖŸà."},
          {"text": "ÿßÿ™ÿ®ÿπ ŸÜŸáÿ± ŸÜÿßŸÖ ÿÆÿßŸÜ ÿ•ŸÑŸâ Ÿàÿßÿ™ ÿ¥ŸäÿßŸÜÿ∫ ŸÖŸàÿßŸÜ ÿ≠Ÿäÿ´ ŸÑÿß Ÿäÿ≤ÿßŸÑ ÿßŸÑÿ±Ÿáÿ®ÿßŸÜ ŸäŸÜÿ≥ÿ¨ŸàŸÜ ÿßŸÑŸÖŸÜÿ≥Ÿàÿ¨ÿßÿ™ ÿßŸÑÿ™ŸÇŸÑŸäÿØŸäÿ©."}
        ],
        "activities": [
          {"text": "ÿßÿ≥ÿ™ŸäŸÇÿ∏ ÿπŸÜÿØ ÿßŸÑŸÅÿ¨ÿ± ŸÑÿ™ÿßŸÉ ÿ®ÿßÿ™: ŸäŸÖÿ± ÿßŸÑÿ±Ÿáÿ®ÿßŸÜ ŸÅŸä ÿµŸÖÿ™ ŸÑÿ¨ŸÖÿπ ÿ∑ÿπÿßŸÖŸáŸÖ.", "practical_info": {"best_time": "5:30-6:30", "tip": "ÿßÿ®ŸÇ ÿµÿßŸÖÿ™Ÿãÿßÿå ÿ®ÿØŸàŸÜ ŸÅŸÑÿßÿ¥"}},
          {"text": "Ÿäÿ≠ŸÑ ÿßŸÑÿ≥ŸàŸÇ ÿßŸÑŸÑŸäŸÑŸä ŸÅŸä ÿ¥ÿßÿ±ÿπ ÿ≥Ÿäÿ≥ÿßŸÅÿßŸÜÿ∫ŸÅŸàŸÜÿ∫ ŸÖŸÜ ÿßŸÑÿ≥ÿßÿπÿ© 5 ŸÖÿ≥ÿßÿ°Ÿã. ŸÖŸÜÿ≥Ÿàÿ¨ÿßÿ™ Ÿàÿ≠ÿ±ŸÅ ŸäÿØŸàŸäÿ© ŸàŸÅŸàÿßŸÜŸäÿ≥."},
          {"text": "ÿ™ÿπŸÑŸÖ ÿßŸÑÿ∑ÿ®ÿÆ ÿßŸÑŸÑÿßŸàŸä: ŸÑÿßÿ®ÿå ÿ™ÿßŸÖ ŸÖÿßŸÉ ŸáŸàŸÜÿ∫ÿå ÿÆÿßŸà ŸÜŸäÿßŸà.", "practical_info": {"duration": "3 ÿ≥ÿßÿπÿßÿ™", "type": "ÿØÿ±ÿ≥ ÿ∑ÿ®ÿÆ"}}
        ],
        "to_next_leg": {
          "distance_km": 230,
          "drive_min": 270,
          "transport_mode": "car",
          "road_type": "ÿ£ÿ≥ŸÅŸÑÿ™ ŸÖÿ™ÿπÿ±ÿ¨",
          "method": "heuristic"
        }
      },
      {
        "day": 2,
        "slice": 1,
        "region_code": "LA-VT",
        "suggested_days": 1.0,
        "night": {
          "place_id": "LA::vang_vieng",
          "map_keywords": [
            "Tham Chang Cave Vang Vieng",
            "Blue Lagoon Vang Vieng",
            "Tham Phu Kham Cave Vang Vieng",
            "Bamboo Bridge Vang Vieng",
            "Tham Nam Cave Vang Vieng"
          ],
          "coords": [18.9220, 102.4476]
        },
        "visits": [
          {"text": "ŸäŸÜŸÅÿ™ÿ≠ ŸÉŸáŸÅ ÿ´ÿßŸÖ ÿ™ÿ¥ÿßŸÜÿ∫ ŸÅŸä ÿßŸÑÿ¨ÿ±ŸÅ ÿßŸÑŸÖŸàÿßÿ¨Ÿá ŸÑŸÜŸáÿ± ŸÜÿßŸÖ ÿ≥ŸàŸÜÿ∫. ÿ™ÿµÿπÿØ ÿßŸÑÿ≥ŸÑÿßŸÑŸÖ ÿ•ŸÑŸâ ÿßŸÑŸáŸàÿßÿ®ÿ∑ ÿßŸÑŸÖÿ∂Ÿäÿ¶ÿ©."},
          {"text": "ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿ© ÿßŸÑÿ≤ÿ±ŸÇÿßÿ°: ŸÖŸäÿßŸá ŸÅŸäÿ±Ÿàÿ≤Ÿäÿ© ÿπŸÜÿØ ÿ≥ŸÅÿ≠ ÿßŸÑÿ™ÿ¥ŸÉŸäŸÑÿßÿ™ ÿßŸÑŸÉÿßÿ±ÿ≥ÿ™Ÿäÿ©ÿå ŸÖÿ´ÿßŸÑŸäÿ© ŸÑŸÑÿ≥ÿ®ÿßÿ≠ÿ©."},
          {"text": "ŸäŸÖÿ™ÿØ ŸÉŸáŸÅ ÿ´ÿßŸÖ ŸÅŸà ÿÆÿßŸÖ ÿπŸÑŸâ 500 ŸÖÿ™ÿ±. ÿ®Ÿàÿ∞ÿß ŸÖÿ≥ÿ™ŸÑŸÇ ŸäŸÜÿßŸÖ ŸÅŸä ÿßŸÑÿ∏ŸÑÿßŸÖ."},
          {"text": "ÿ¨ÿ≥ÿ± ŸÖŸÜ ÿßŸÑÿÆŸäÿ≤ÿ±ÿßŸÜ Ÿäÿπÿ®ÿ± ŸÜŸáÿ± ŸÜÿßŸÖ ÿ≥ŸàŸÜÿ∫ ÿ•ŸÑŸâ ÿ≠ŸÇŸàŸÑ ÿßŸÑÿ£ÿ±ÿ≤ ŸÅŸä ÿßŸÑÿ∂ŸÅÿ© ÿßŸÑÿ∫ÿ±ÿ®Ÿäÿ©."},
          {"text": "ŸäŸèÿ≤ÿßÿ± ŸÉŸáŸÅ ÿ´ÿßŸÖ ŸÜÿßŸÖ ÿ®ÿßŸÑÿπŸàÿßŸÖÿ©ÿå ŸÖÿ≠ŸÖŸàŸÑÿßŸã ÿ®ŸÜŸáÿ± ÿ™ÿ≠ÿ™ ÿßŸÑÿ£ÿ±ÿ∂."}
        ],
        "activities": [
          {"text": "ÿßŸÜÿ≤ŸÑ ÿ®ÿßŸÑŸÇŸàÿßÿ±ÿ® ÿπŸÑŸâ ŸÜŸáÿ± ŸÜÿßŸÖ ÿ≥ŸàŸÜÿ∫. ÿ™ŸÖÿ± ÿßŸÑŸÖŸÜÿ≠ÿØÿ±ÿßÿ™ ÿßŸÑŸÉŸÑÿ≥Ÿäÿ© ÿπŸÑŸâ ŸÉŸÑÿß ÿßŸÑÿ¨ÿßŸÜÿ®ŸäŸÜ.", "practical_info": {"duration": "2-3 ÿ≥ÿßÿπÿßÿ™", "difficulty": "ÿ≥ŸáŸÑ"}},
          {"text": "ÿ™ŸàŸÅÿ± ÿ¨ÿØÿ±ÿßŸÜ ÿßŸÑŸÉÿßÿ±ÿ≥ÿ™ ÿ∑ÿ±ŸÇ ÿ™ÿ≥ŸÑŸÇ ŸÑÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ŸàŸäÿßÿ™."},
          {"text": "ÿßÿ≥ÿ™ÿ£ÿ¨ÿ± ÿØÿ±ÿßÿ¨ÿ© ŸÑŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑÿ®ÿ≠Ÿäÿ±ÿßÿ™ ŸàÿßŸÑŸÉŸáŸàŸÅ ÿπÿ®ÿ± ÿßŸÑÿ∑ÿ±ŸÇ ÿßŸÑÿ™ÿ±ÿßÿ®Ÿäÿ©."}
        ]
      }
    ]
  }]
}

üìã ÿßŸÑŸÇŸàÿßÿπÿØ ÿßŸÑÿ≠ÿßÿ≥ŸÖÿ©:

1. ÿ™ÿ±ÿ™Ÿäÿ® ŸÖŸÜÿ∑ŸÇŸä ‚Äî ÿ•ÿπÿßÿØÿ© ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖÿ≠ÿ∑ÿßÿ™ ÿ¨ÿ∫ÿ±ÿßŸÅŸäŸãÿß. ÿ™ÿ¨ŸÜÿ® ÿßŸÑÿπŸàÿØÿ©.

2. ‚ö†Ô∏è ÿßŸÑÿ™ŸÖŸäŸäÿ≤ ÿ®ŸäŸÜ VISITS Ÿà ACTIVITIES (ŸÖŸáŸÖ):
   **visits[] = ÿ£ŸÖÿßŸÉŸÜ ŸÑŸÑŸÖÿ¥ÿßŸáÿØÿ©**
   - ŸÜÿµÿ®ÿå ŸÖÿπÿßÿ®ÿØÿå ŸÉÿßÿ™ÿØÿ±ÿßÿ¶Ÿäÿßÿ™ÿå ŸÖÿ™ÿßÿ≠ŸÅÿå ŸÖŸàÿßŸÇÿπ ÿ£ÿ´ÿ±Ÿäÿ©ÿå ŸÉŸáŸàŸÅÿå ŸÇŸÑÿßÿπÿå ŸÇÿµŸàÿ±
   - ŸäÿµŸÅ ŸÖÿß ÿ™ÿ±ÿßŸá: ÿßŸÑÿπŸÖÿßÿ±ÿ©ÿå ÿßŸÑÿ™ÿßÿ±ŸäÿÆÿå ÿßŸÑŸÖÿ¨ŸÖŸàÿπÿßÿ™
   - ŸÖÿ´ÿßŸÑ: "ÿ™ŸÜÿ≠ÿØÿ± ÿ£ÿ≥ÿ∑ÿ≠ Ÿàÿßÿ™ ÿ¥ŸäÿßŸÜÿ∫ ÿ´ŸàŸÜÿ∫ ÿ≠ÿ™Ÿâ ÿßŸÑÿ£ÿ±ÿ∂. ŸÅÿ≥ŸäŸÅÿ≥ÿßÿ° ÿßŸÑÿ≤ÿ¨ÿßÿ¨ ÿßŸÑÿ£ÿ≠ŸÖÿ± ÿ™ÿµŸàÿ± ÿ≠Ÿäÿßÿ© ÿ®Ÿàÿ∞ÿß."
   
   **activities[] = ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ŸÑŸÑŸÇŸäÿßŸÖ ÿ®Ÿáÿß**
   - ÿ±ÿ≠ŸÑÿßÿ™ÿå ÿ™ÿ¨ÿØŸäŸÅÿå ÿØÿ±ÿßÿ¨ÿßÿ™ÿå ÿ∫ÿ∑ÿ≥ÿå ÿØÿ±Ÿàÿ≥ ÿ∑ÿ®ÿÆÿå ÿ£ÿ≥ŸàÿßŸÇÿå ÿ±ÿ≠ŸÑÿßÿ™ ÿ®ÿ≠ÿ±Ÿäÿ©ÿå ÿ≥ŸÅÿßÿ±Ÿäÿå ÿ∑Ÿäÿ±ÿßŸÜ ÿ¥ÿ±ÿßÿπŸä
   - ŸäÿµŸÅ ŸÖÿß ÿ™ŸÅÿπŸÑŸá: ÿ™ÿ¨ÿßÿ±ÿ®ÿå ÿ±Ÿäÿßÿ∂ÿ©ÿå ÿ£ŸÜÿ¥ÿ∑ÿ© ÿ´ŸÇÿßŸÅŸäÿ© ÿ£Ÿà ÿ™ÿ∞ŸàŸÇ ÿ∑ÿπÿßŸÖ
   - ŸÖÿ´ÿßŸÑ: "ÿßŸÜÿ≤ŸÑ ÿ®ÿßŸÑŸÇŸàÿßÿ±ÿ® ÿπŸÑŸâ ŸÜŸáÿ± ŸÜÿßŸÖ ÿ≥ŸàŸÜÿ∫. ÿ™ŸÖÿ± ÿßŸÑŸÖŸÜÿ≠ÿØÿ±ÿßÿ™ ÿßŸÑŸÉŸÑÿ≥Ÿäÿ© ÿπŸÑŸâ ŸÉŸÑÿß ÿßŸÑÿ¨ÿßŸÜÿ®ŸäŸÜ."
   
   ‚ùå ŸÑÿß ÿ™ÿ∂ÿπ ÿ£ÿ®ÿØŸãÿß ŸÖÿ™ÿ≠ŸÅŸãÿß ÿ£Ÿà ŸÜÿµÿ®Ÿãÿß ÿ£Ÿà ŸÖŸÉÿßŸÜŸãÿß ŸÅŸä activities
   ‚ùå ŸÑÿß ÿ™ŸÉÿ±ÿ± ÿ£ÿ®ÿØŸãÿß ŸÜŸÅÿ≥ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ŸÅŸä visits Ÿà activities

3. 5-8 visits + 3-6 activities ŸÑŸÉŸÑ ŸäŸàŸÖ ŸÉÿ≠ÿØ ÿ£ÿØŸÜŸâ ‚Äî ÿ•ÿ´ÿ±ÿßÿ° ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿµÿØÿ± ŸäŸÅÿ™ŸÇÿ± ŸÑŸÑŸÖÿ≠ÿ™ŸàŸâ
4. suggested_days: 0.5 | 1.0 | 1.5 ‚Äî ŸÖÿß ŸÅŸàŸÇ ÿ∞ŸÑŸÉÿå ŸÇÿ≥ŸÖ ÿ•ŸÑŸâ ÿπÿØÿ© ÿ£ŸäÿßŸÖ ÿ®ŸÜŸÅÿ≥ place_id
5. estimated_days_base = CEIL(ŸÖÿ¨ŸÖŸàÿπ suggested_days) ‚Äî ŸÖÿ´ÿßŸÑ: 1.5 + 1.0 = 2.5 ‚Üí 3
6. to_next_leg ŸÅŸä ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ŸäÿßŸÖ ÿ®ÿßÿ≥ÿ™ÿ´ŸÜÿßÿ° ÿßŸÑÿ£ÿÆŸäÿ±
7. coords = [lat, lon] ŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑŸÖÿØŸäŸÜÿ© ‚Äî ŸÑÿß ÿ™ÿÆÿ™ÿ±ÿπ ÿ•ÿ≠ÿØÿßÿ´Ÿäÿßÿ™ ÿØŸÇŸäŸÇÿ©
8. itin_id = CC::region::slug (CC = ISO2: FR, LA, TH, HR, IT...)
9. region_code = CC-XX (ÿ±ŸÖÿ≤ ÿ•ŸÇŸÑŸäŸÖŸäÿå ŸÖÿ´ÿßŸÑ: LA-LP, HR-21, FR-84, IT-PUG)
10. dept_code = ÿßÿÆÿ™ÿµÿßÿ± ÿ•ŸÇŸÑŸäŸÖŸä (LP, 21, 84, PUG...)
11. slice = ÿØÿßÿ¶ŸÖŸãÿß 1
12. source_url = ÿ±ÿßÿ®ÿ∑ ÿßŸÑŸÖÿµÿØÿ± ÿ•ŸÜ ŸàŸèÿ¨ÿØ
13. language = "ar" ‚Äî ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜÿµŸàÿµ ÿ®ÿßŸÑÿπÿ±ÿ®Ÿäÿ© (ÿ™ÿ±ÿ¨ŸÖ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ÿßŸÑŸÖÿµÿØÿ± ÿ®ŸÑÿ∫ÿ© ÿ£ÿÆÿ±Ÿâÿå ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° ÿßŸÑÿ£ÿµŸÑŸäÿ©: Wat, Piazza, Playa...)

üìã ÿßŸÑÿ™ŸÜÿ≥ŸäŸÇ ÿßŸÑŸÖŸèÿ≠ÿ≥ŸëŸÜ (ÿ•ŸÑÿ≤ÿßŸÖŸä):
15. subtitle = ÿ¨ŸÖŸÑÿ© ÿ¨ÿ∞ÿßÿ®ÿ© ÿ™ÿ≠ÿ™ ÿßŸÑÿπŸÜŸàÿßŸÜ (ŸÖÿ´ÿßŸÑ: "ŸÖŸÜ ÿßŸÑŸÖÿπÿßÿ®ÿØ ÿßŸÑÿ∞Ÿáÿ®Ÿäÿ© ÿ•ŸÑŸâ ÿßŸÑÿ¥Ÿàÿßÿ∑ÿ¶ ÿßŸÑÿ≠ÿßŸÑŸÖÿ©")
16. practical_context.best_months = ŸÖÿµŸÅŸàŸÅÿ© ÿ£ŸÅÿ∂ŸÑ ÿßŸÑÿ£ÿ¥Ÿáÿ± (ŸÖÿ´ÿßŸÑ: ["ŸÖÿßŸäŸà", "ŸäŸàŸÜŸäŸà", "ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±"])
17. practical_context.highlights = 4-6 ÿ£ÿ®ÿ±ÿ≤ ŸÖÿπÿßŸÑŸÖ ÿßŸÑÿ±ÿ≠ŸÑÿ©
18. practical_info = ÿ•ÿ∂ÿßŸÅÿ© ŸÑŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ÿßŸÑŸÖŸáŸÖÿ© (ÿ±ÿ≠ŸÑÿßÿ™ÿå ÿ≥ŸÅÿßÿ±Ÿäÿå ÿ™ÿÆŸäŸäŸÖÿå ÿ•Ÿäÿ¨ÿßÿ±ÿßÿ™...) ŸÖÿπ duration, difficulty, tip, best_time ÿ≠ÿ≥ÿ® ÿßŸÑÿ≥ŸäÿßŸÇ
19. road_type = ÿ•ÿ∂ÿßŸÅÿ© ŸÅŸä to_next_leg ŸÅŸÇÿ∑ ÿ•ÿ∞ÿß ŸÑŸÖ ÿ™ŸÉŸÜ ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿ£ÿ≥ŸÅŸÑÿ™ ÿπÿßÿØŸä (ŸÖÿ´ÿßŸÑ: "ŸÖÿ≥ÿßÿ±", "ÿ≠ÿµŸâ", "ÿ£ÿ≥ŸÅŸÑÿ™ ÿ´ŸÖ ŸÖÿ≥ÿßÿ±")
20. ‚ö†Ô∏è map_keywords = ÿ•ŸÑÿ≤ÿßŸÖŸä ŸÅŸä night{} ŸÑŸÉŸÑ ŸäŸàŸÖ
    - ŸÖÿµŸÅŸàŸÅÿ© ŸÖŸÜ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠Ÿäÿ© ŸÑÿÆÿ±ÿßÿ¶ÿ∑ ÿ¨Ÿàÿ¨ŸÑ
    - ÿßŸÑÿµŸäÿ∫ÿ©: "ÿßÿ≥ŸÖ ÿßŸÑŸÖŸÉÿßŸÜ ÿßŸÑÿØŸÇŸäŸÇ + ÿßŸÑŸÖÿØŸäŸÜÿ©" (ŸÖÿ´ÿßŸÑ: "Wat Xieng Thong Luang Prabang")
    - ÿ™ÿ∂ŸÖŸäŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≤Ÿäÿßÿ±ÿßÿ™ ŸÑŸÑŸäŸàŸÖ ÿ®ÿ™ÿ±ÿ™Ÿäÿ® ŸÖŸÜÿ∑ŸÇŸä ŸÑŸÑÿ≤Ÿäÿßÿ±ÿ©
    - 5-8 ŸÉŸÑŸÖÿßÿ™ ŸÖŸÅÿ™ÿßÿ≠Ÿäÿ© ŸÅŸä ÿßŸÑŸäŸàŸÖ ÿ≠ÿ≥ÿ® ÿπÿØÿØ ÿßŸÑÿ≤Ÿäÿßÿ±ÿßÿ™
    - Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠Ÿäÿ© ŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ®ÿ≠ÿ´ ÿπŸÑŸâ ÿÆÿ±ÿßÿ¶ÿ∑ ÿ¨Ÿàÿ¨ŸÑ

‚úçÔ∏è ÿßŸÑÿ£ÿ≥ŸÑŸàÿ® ‚Äî ÿ™ŸÜŸàŸäÿπ ÿßŸÑÿ£ÿ¥ŸÉÿßŸÑ:
- ÿ•ÿπŸÑÿßŸÖŸä ÿ®ÿ≥Ÿäÿ∑: "ÿ™ŸÜÿ≠ÿØÿ± ÿ£ÿ≥ÿ∑ÿ≠ Ÿàÿßÿ™ ÿ¥ŸäÿßŸÜÿ∫ ÿ´ŸàŸÜÿ∫ ÿ≠ÿ™Ÿâ ÿßŸÑÿ£ÿ±ÿ∂. ŸÅÿ≥ŸäŸÅÿ≥ÿßÿ°Ÿá..."
- ÿ£ŸÖÿ±Ÿä: "ÿßÿ™ÿ¨Ÿá ÿ•ŸÑŸâ...", "ÿÆÿ∞...", "ÿßŸÅÿ™ÿ≠ ÿßŸÑÿ®ÿßÿ®...", "ÿßÿµÿπÿØ...", "ÿßÿπÿ®ÿ±..." ‚Äî ŸÜŸàŸëÿπ ÿßŸÑÿ£ŸÅÿπÿßŸÑ
- ÿ≥ÿ±ÿØŸä: "ÿßŸÑÿ±Ÿáÿ®ÿßŸÜ Ÿäÿ≠ŸäŸÉŸàŸÜ...", "ÿßŸÑŸÖÿµŸÑŸàŸÜ Ÿäÿ™ŸàÿßŸÅÿØŸàŸÜ..."
- ÿØÿπŸàÿ©: "ÿßŸÑÿ™ŸÇ ÿπŸÜÿØ ÿßŸÑŸÅÿ¨ÿ± ŸÑÿ™ÿßŸÉ ÿ®ÿßÿ™"
- ÿ≥ÿ§ÿßŸÑ/ÿßŸÇÿ™ÿ±ÿßÿ≠: "ÿ™ÿ±ŸäÿØ ÿ±ÿ§Ÿäÿ© ÿßŸÑŸÖŸäŸÉŸàŸÜÿ∫ ŸÖŸÜ ÿßŸÑÿ£ÿπŸÑŸâÿü ÿ¨ÿ®ŸÑ ŸÅŸàÿ≥Ÿä Ÿà328 ÿØÿ±ÿ¨ÿ©"

ÿ®ÿØŸëŸÑ Ÿáÿ∞Ÿá ÿßŸÑÿ£ÿ¥ŸÉÿßŸÑ ŸÑŸÉÿ≥ÿ± ÿßŸÑÿ±ÿ™ÿßÿ®ÿ©. ŸÑÿß ÿ™ÿ≥ŸÑÿ≥ŸÑ ÿ£ŸÉÿ´ÿ± ŸÖŸÜ ŸÜÿµŸäŸÜ ÿ®ŸÜŸÅÿ≥ ÿßŸÑÿ£ÿ≥ŸÑŸàÿ®.

ÿ®ÿØŸàŸÜ ŸÉŸÑŸÖÿßÿ™ ŸÖŸÜŸÖŸÇÿ© / ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä (ÿ•ŸÑÿ≤ÿßŸÖŸä): ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿ£ÿ≥ŸÑŸàÿ® ÿ®ÿ≥Ÿäÿ∑ÿå ÿ•ÿπŸÑÿßŸÖŸä Ÿäÿ¥ÿ±ÿ≠ ŸÖÿß ŸäŸÖŸÉŸÜ ÿ±ÿ§Ÿäÿ™Ÿá ŸàŸÑŸÖÿßÿ∞ÿß ŸáŸà ŸÖÿ´Ÿäÿ± ŸÑŸÑÿßŸáÿ™ŸÖÿßŸÖ. ÿ£ÿπÿ∑ ÿ™ŸÅÿßÿµŸäŸÑ ÿ™ÿßÿ±ŸäÿÆŸäÿ©ÿå ŸÖÿπŸÖÿßÿ±Ÿäÿ©ÿå ÿ∑ÿ®ŸäÿπŸäÿ© ŸÖŸÑŸÖŸàÿ≥ÿ©.

${effectiveMode === 'seed' ? `
üè† Ÿàÿ∂ÿπ ÿßŸÑŸÇŸàÿßÿπÿØ + ÿßŸÑÿ≠ŸÑŸÇÿßÿ™ - ÿßŸÑŸÇŸàÿßÿπÿØ: ${effectiveSeeds || '[ÿßÿ≥ÿ™ÿÆÿ±ÿ¨ ŸÖŸÜ ÿßŸÑŸÜÿµ]'}
ŸáŸäŸÉŸÑ: ŸÇÿßÿπÿØÿ© ‚Üí ÿ±ÿ≠ŸÑÿßÿ™ ‚Üí ÿπŸàÿØÿ© ŸÇÿßÿπÿØÿ© (ŸÉŸÑ 3-5 ÿ£ŸäÿßŸÖ) ‚Üí ŸÇÿßÿπÿØÿ© ÿ¨ÿØŸäÿØÿ©...
` : ''}
${effectiveMode === 'citytrip' ? `
üèôÔ∏è Ÿàÿ∂ÿπ ÿ±ÿ≠ŸÑÿ© ÿßŸÑŸÖÿØŸäŸÜÿ© - ŸÉŸÑ ŸÖÿπŸÑŸÖ = ŸäŸàŸÖ ŸÖŸÜŸÅÿµŸÑ. night.place_id = ÿßŸÑŸÖÿπŸÑŸÖ.
` : ''}
${effectiveMode === 'follow' ? `
üìç Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿµÿßÿ±ŸÖÿ© - ÿßÿ≠ÿ™ŸÅÿ∏ ÿ®ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿØŸÇŸäŸÇ ŸÑŸÑŸÖÿ≠ÿ∑ÿßÿ™ ŸÖŸÜ ÿßŸÑŸÖÿµÿØÿ±.
` : ''}
${isAdmin ? `
üö´ ÿßŸÑÿ™ÿ≠ŸäŸäÿØ (Ÿàÿ∂ÿπ ÿßŸÑŸÖÿ≥ÿ§ŸàŸÑ) - ÿ≥ÿ™ŸèŸàÿ≤ÿπ Ÿáÿ∞Ÿá JSON ÿπŸÑŸÜŸãÿß.
‚úÖ ÿßÿ≠ÿ™ŸÅÿ∏: ŸÖÿ™ÿßÿ≠ŸÅÿå ŸÜÿµÿ®ÿå ŸÖÿπÿßÿ®ÿØÿå ÿ≠ÿØÿßÿ¶ŸÇÿå ŸÖŸàÿßŸÇÿπ ŸäŸàŸÜÿ≥ŸÉŸàÿå ÿ£ÿ≥ŸàÿßŸÇ ÿπÿßŸÖÿ©
‚ùå ÿßÿ≠ÿ∞ŸÅ: ŸÖÿ™ÿßÿ¨ÿ± ŸÖÿ≥ŸÖÿßÿ© ‚Üí "ÿ™ŸàŸÅÿ± ÿßŸÑÿ•Ÿäÿ¨ÿßÿ±ÿßÿ™..." | ÿ£ÿ¥ÿÆÿßÿµ ‚Üí ÿßÿ≠ÿ∞ŸÅ | ÿ£ÿ≥ÿπÿßÿ± ‚Üí ÿ™ÿ¨ÿßŸáŸÑ | "ÿ®ÿßŸÑÿØÿ±ÿßÿ¨ÿ© ÿßŸÑŸÜÿßÿ±Ÿäÿ©" ‚Üí "ÿ®ÿßŸÑÿ∑ÿ±ŸäŸÇ" | ÿ™Ÿàÿßÿ±ŸäÿÆ ÿ≠ÿØŸäÿ´ÿ© ‚Üí ÿßÿ≠ÿ∞ŸÅ | ÿ∂ŸÖŸäÿ± ÿßŸÑŸÖÿ™ŸÉŸÑŸÖ ‚Üí ÿ£ÿπÿØ ÿßŸÑÿµŸäÿßÿ∫ÿ©
` : ''}

üö´ ŸÖŸÖŸÜŸàÿπ: ÿ¨ŸÖŸÑ ÿ®ÿØŸàŸÜ ŸÅÿπŸÑ ("ŸÉÿßÿ™ÿØÿ±ÿßÿ¶Ÿäÿ© ŸÇŸàÿ∑Ÿäÿ©. ÿ≤ÿ¨ÿßÿ¨ ŸÖŸÑŸàŸÜ. ÿ≥ÿ±ÿØÿßÿ®.")

SOURCE:
`;
  }
};

// Helper function to get prompt
function getPromptTemplate(lang, {mode, seeds, modelSubMode, modelSeeds}) {
  const l = (lang || document.documentElement.lang || 'fr').toLowerCase();
  const fn = PROMPTS[l] || PROMPTS.fr;
  return fn({mode, seeds, modelSubMode, modelSeeds});
}

// === I18N UI labels (ajout des libell√©s options) ===
const I18N={
  fr:{
    t1text:"Coller la page",
    t2text:"Prompt IA g√©n√©r√©",
    t3text:"Coller la r√©ponse IA",
    btnValidate:"G√©n√©rer le prompt",
    btnClear:"Effacer",
    btnCopy:"Copier",
    btnValidateJson:"Valider et ouvrir",
    btnCancel:"Annuler",
    btnGo:"Valider",
    srcPlaceholder:"Collez ici le contenu complet de la page (titre, jours, descriptions...)",
    jsonPlaceholder:"Collez ici la r√©ponse JSON compl√®te de l'IA",
    emailPlaceholder:"Votre e-mail",
    pwdPlaceholder:"Mot de passe",
    hint1:"Collez le texte source puis cliquez sur 'G√©n√©rer' pour cr√©er automatiquement le prompt optimis√©.",
    hint2:"Copiez ce prompt dans ChatGPT/Claude/Gemini, puis collez la r√©ponse dans la section 3.",
    copied:"‚úì Copi√© !",
    needSrc:"Veuillez d'abord coller le texte source.",
    needSeeds:"Veuillez sp√©cifier au moins une ville de base (vos h√¥tels), s√©par√©es par des virgules.",
    needRet:"Veuillez d'abord coller la r√©ponse JSON de l'IA.",
    badJson:"JSON invalide.",
    missingItins:"La cl√© 'itins' est manquante ou vide.",
    okSaved:"‚úÖ Enregistr√© avec succ√®s ! Redirection...",
    cleanedChars:"‚úì Nettoy√© : {count} caract√®res supprim√©s (navigation, publicit√©s, etc.)",
    jsonRepaired:"‚ö†Ô∏è JSON r√©par√© automatiquement. V√©rifiez ci-dessous.",
    jsonUnrepairable:"‚ùå JSON invalide, irr√©parable : {error}",
    validating:"Validation...",
    jsonValid:"‚úì JSON valide ({count} itin√©raire(s))",
    autoRepairAttempt:"Tentative de r√©paration automatique...",
    repairSuccess:"‚úì R√©paration r√©ussie ! JSON corrig√© et format√©.",
    processing:"Traitement...",

    // NEW
    optTitle:"G√©n√©ration d'itin√©raire",
    optExplain:"Vous pouvez trouver un itin√©raire sur le web, ou un descriptif de lieux que vous voulez visiter, ou coller plusieurs descriptifs de lieux et g√©n√©rer un prompt que vous copierez √† une intelligence artificielle de votre choix. Inutile de nettoyer votre copie, vous pouvez copier la page enti√®re et la coller telle quelle dans le premier onglet. Vous n'aurez plus qu'√† recopier la r√©ponse de l'IA dans le troisi√®me onglet pour avoir un itin√©raire sur mesure compl√®tement modifiable.",
    userModeText:"L'itin√©raire sera automatiquement optimis√© g√©ographiquement pour √©viter les allers-retours.",
    opt1Title:"Suivre l'itin√©raire exactement",
    opt1Desc:"L'ordre des √©l√©ments coll√©s est respect√© tel quel",
    opt2Title:"Adopter un parcours logique",
    opt2Desc:"Id√©al si vous avez coll√© des noms de lieux",
    opt3Title:"Partir de quelques villes",
    opt3Desc:"√Ä sp√©cifier lors de la g√©n√©ration",
    opt4Title:"Tour de ville",
    opt4Desc:"1 visite = 1 bloc dans le(s) jour(s)",
    opt1Lbl:"Suivre exactement l‚Äôitin√©raire tel que copi√©",
    opt2Lbl:"Laisser l'IA adopter un parcours logique (si vous avez coll√© des noms de lieux)",
    opt3Lbl:"Partir de quelques villes choisies (√† sp√©cifier)",
    opt4Lbl:"Tour de ville (chaque visite = un bloc ordonn√© du jour)",
    optNote:"Vous pouvez √©diter votre voyage apr√®s.",
    seedPlaceholder:"ex : Nice, G√™nes, La Spezia",

    // Config voyage modal
    cfgTitle:"Configurer votre voyage",
    cfgStartDate:"Date de d√©part :",
    cfgNbDays:"Nombre de jours souhait√© :",
    cfgPace:"Rythme :",
    cfgPaceSlow:"Relax√©",
    cfgPaceStandard:"Normal",
    cfgPaceFast:"Rapide",
    cfgMaxHotels:"Changements d'h√¥tel maximum :",
    cfgBtnCancel:"Annuler",
    cfgBtnValidate:"Valider",

    // Titres sections
    premiumSectionTitle:"R√©serv√© aux abonn√©s",
    freeSectionTitle:"Gratuit : copiez une page web (Ctrl+A, Ctrl+C), collez-la dans le g√©n√©rateur de prompt, copiez le r√©sultat dans une IA de votre choix et revenez coller sa r√©ponse sans la modifier dans l'onglet 3, votre voyage est pr√™t",

    // I18N section (1bis)
    i18nTitle:"Copiez le fichier source et laissez notre IA int√©gr√©e faire le travail",
    i18nSourceLabel:"Collez votre fichier source ici :",
    btnI18nProcess:"Transformer",

    // Section 2 et 2bis - textes dans les info-box
    i18nNote:"R√©serv√© aux utilisateurs Silver et Gold. Notre IA int√©gr√©e transformera automatiquement votre contenu en format structur√©. Fonctionnalit√© en d√©veloppement.",
    hint2bis:"G√©n√©rez le prompt et copiez le r√©sultat de l'onglet 3 dans une IA de votre choix sans le modifier",
    labelSrc:"Collez le texte source ici :",
    
    // Placeholders des textareas
    i18nSourcePlaceholder:"Collez ici le contenu complet de la page (titre, jours, descriptions...). Notre IA int√©gr√©e transformera automatiquement votre contenu en format structur√©. Fonctionnalit√© en d√©veloppement.",
    srcPlaceholder2:"Collez ici le contenu complet de la page (titre, jours, descriptions...). G√©n√©rez le prompt et copiez le r√©sultat de l'onglet 3 dans une IA de votre choix sans le modifier"
  },
  en:{
    t1text:"Paste the page",
    t2text:"AI prompt generated",
    t3text:"Paste AI response",
    btnValidate:"Generate prompt",
    btnClear:"Clear",
    btnCopy:"Copy",
    btnValidateJson:"Validate and open",
    btnCancel:"Cancel",
    btnGo:"Validate",
    srcPlaceholder:"Paste the complete page content here (title, days, descriptions...)",
    jsonPlaceholder:"Paste the complete AI JSON response here",
    emailPlaceholder:"Your email",
    pwdPlaceholder:"Password",
    hint1:"Paste source text then click 'Generate' to create the optimized prompt automatically.",
    hint2:"Copy this prompt into ChatGPT/Claude/Gemini, then paste the response in section 3.",
    copied:"‚úì Copied!",
    needSrc:"Please paste the source text first.",
    needSeeds:"Please specify at least one base city (your hotels), separated by commas.",
    needRet:"Please paste the AI JSON response first.",
    badJson:"Invalid JSON.",
    missingItins:"The 'itins' key is missing or empty.",
    okSaved:"‚úÖ Saved successfully! Redirecting...",
    cleanedChars:"‚úì Cleaned: {count} characters removed (navigation, ads, etc.)",
    jsonRepaired:"‚ö†Ô∏è JSON auto-repaired. Check below.",
    jsonUnrepairable:"‚ùå Invalid JSON, unrepairable: {error}",
    validating:"Validating...",
    jsonValid:"‚úì Valid JSON ({count} itinerary(ies))",
    autoRepairAttempt:"Attempting automatic repair...",
    repairSuccess:"‚úì Repair successful! JSON corrected and formatted.",
    processing:"Processing...",

    // NEW
    optTitle:"Itinerary Generation",
    optExplain:"You can find an itinerary on the web, or a description of places you want to visit, or paste multiple place descriptions and generate a prompt to copy to an AI of your choice. No need to clean your copy, you can copy the entire page and paste it as-is in the first tab. Then simply paste the AI's response in the third tab to get a fully customizable itinerary.",
    userModeText:"The itinerary will be automatically optimized geographically to avoid backtracking.",
    opt1Title:"Follow the itinerary exactly",
    opt1Desc:"The order of pasted elements is respected as is",
    opt2Title:"Adopt a logical route",
    opt2Desc:"Ideal if you pasted place names",
    opt3Title:"Spread from a few cities",
    opt3Desc:"To be specified during generation",
    opt4Title:"City tour",
    opt4Desc:"1 visit = 1 block in the day(s)",
    opt1Lbl:"Follow exactly the copied itinerary",
    opt2Lbl:"Let AI adopt a logical route (if you pasted place names)",
    opt3Lbl:"Seed from a few chosen cities (specify)",
    opt4Lbl:"City trip (each visit = an ordered block in the day)",
    optNote:"You can edit your trip afterwards.",
    seedPlaceholder:"e.g., Nice, Genoa, La Spezia",

    // Config trip modal
    cfgTitle:"Configure your trip",
    cfgStartDate:"Departure date:",
    cfgNbDays:"Desired number of days:",
    cfgPace:"Pace:",
    cfgPaceSlow:"Relaxed",
    cfgPaceStandard:"Normal",
    cfgPaceFast:"Fast",
    cfgMaxHotels:"Maximum hotel changes:",
    cfgBtnCancel:"Cancel",
    cfgBtnValidate:"Validate",

    // Section titles
    premiumSectionTitle:"Reserved for subscribers",
    freeSectionTitle:"Free: copy a web page (select all, copy), paste it in the prompt generator, copy the result into an AI of your choice and come back to paste its response without modifying it in the third tab, your trip is ready",

    // I18N section (1bis)
    i18nTitle:"Copy the source file and let our integrated AI do it",
    i18nSourceLabel:"Paste your source file here:",
    btnI18nProcess:"Transform",

    // Section 2 and 2bis - info-box texts
    i18nNote:"Reserved for Silver and Gold users. Our integrated AI will automatically transform your content into structured format. Feature in development.",
    hint2bis:"Generate the prompt and copy the result found in 3 to an AI of your choice without modifying it",
    labelSrc:"Paste the source text here:",
    
    // Textarea placeholders
    i18nSourcePlaceholder:"Paste the complete page content here (title, days, descriptions...). Our integrated AI will automatically transform your content into structured format. Feature in development.",
    srcPlaceholder2:"Paste the complete page content here (title, days, descriptions...). Generate the prompt and copy the result found in 3 to an AI of your choice without modifying it"
  },
  it:{
    t1text:"Incolla la pagina",
    t2text:"Prompt IA generato",
    t3text:"Incolla risposta IA",
    btnValidate:"Genera prompt",
    btnClear:"Cancella",
    btnCopy:"Copia",
    btnValidateJson:"Convalida e apri",
    btnCancel:"Annulla",
    btnGo:"Convalida",
    srcPlaceholder:"Incolla qui il contenuto completo (titolo, giorni, descrizioni...)",
    jsonPlaceholder:"Incolla qui la risposta JSON completa",
    hint1:"Incolla il testo e clicca 'Genera'.",
    hint2:"Copia questo prompt in ChatGPT/Claude/Gemini e incolla la risposta nella sezione 3.",
    copied:"‚úì Copiato!",
    needSrc:"Incolla prima il testo.",
    needSeeds:"Indica almeno una citt√† base (i tuoi hotel), separate da virgole.",
    needRet:"Incolla prima la risposta JSON.",
    badJson:"JSON non valido.",
    missingItins:"Chiave 'itins' mancante o vuota.",
    okSaved:"‚úÖ Salvato! Reindirizzamento...",
    cleanedChars:"‚úì Pulito: {count} caratteri rimossi.",
    jsonRepaired:"‚ö†Ô∏è JSON riparato automaticamente.",
    jsonUnrepairable:"‚ùå JSON non riparabile: {error}",
    validating:"Convalida...",
    jsonValid:"‚úì JSON valido ({count})",
    autoRepairAttempt:"Tentativo di riparazione...",
    repairSuccess:"‚úì Riparazione riuscita!",
    processing:"Elaborazione...",

    optTitle:"Generazione itinerario",
    optExplain:"Puoi trovare un itinerario sul web, o una descrizione di luoghi che vuoi visitare, o incollare pi√π descrizioni di luoghi e generare un prompt da copiare a un'IA di tua scelta. Non serve pulire la copia, puoi copiare l'intera pagina e incollarla cos√¨ com'√® nella prima scheda. Poi basta incollare la risposta dell'IA nella terza scheda per avere un itinerario su misura completamente modificabile.",
    userModeText:"L'itinerario sar√† automaticamente ottimizzato geograficamente per evitare ritorni.",
    opt1Title:"Seguire esattamente l'itinerario",
    opt1Desc:"L'ordine degli elementi incollati √® rispettato",
    opt2Title:"Adottare un percorso logico",
    opt2Desc:"Ideale se hai incollato nomi di luoghi",
    opt3Title:"Diramare da alcune citt√†",
    opt3Desc:"Da specificare durante la generazione",
    opt4Title:"Tour della citt√†",
    opt4Desc:"1 visita = 1 blocco nel giorno/i",
    opt1Lbl:"Seguire esattamente l‚Äôitinerario copiato",
    opt2Lbl:"Percorso logico (se hai incollato nomi di luoghi)",
    opt3Lbl:"Diramare da alcune citt√† scelte (specificare)",
    opt4Lbl:"City trip (ogni visita = blocco ordinato nel giorno)",
    optNote:"Potrai modificare il percorso a tuo piacimento.",
    seedPlaceholder:"Es.: Nizza, Genova, La Spezia",

    // Config trip modal
    cfgTitle:"Configura il tuo viaggio",
    cfgStartDate:"Data di partenza:",
    cfgNbDays:"Numero di giorni desiderati:",
    cfgPace:"Ritmo:",
    cfgPaceSlow:"Rilassato",
    cfgPaceStandard:"Normale",
    cfgPaceFast:"Sostenuto",
    cfgMaxHotels:"Cambi hotel massimi:",
    cfgBtnCancel:"Annulla",
    cfgBtnValidate:"Convalida",

    // Titoli sezioni
    premiumSectionTitle:"Riservato agli abbonati",
    freeSectionTitle:"Gratuito: copia una pagina internet (seleziona tutto, copia), incolla nel generatore di prompt, copia il risultato in un'IA di tua scelta e torna a incollare la sua risposta senza modificarla nella terza scheda, il tuo viaggio √® pronto",

    // I18N section (1bis)
    i18nTitle:"Copia il file sorgente e lascia fare alla nostra IA integrata",
    i18nSourceLabel:"Incolla qui il tuo file sorgente:",
    btnI18nProcess:"Trasforma",

    // Sezione 2 e 2bis - testi nelle info-box
    i18nNote:"Riservato agli utenti Silver e Gold. La nostra IA integrata trasformer√† automaticamente i tuoi contenuti in formato strutturato. Funzionalit√† in sviluppo.",
    hint2bis:"Genera il prompt e copia il risultato trovato in 3 in un'IA di tua scelta senza modificarlo",
    labelSrc:"Incolla qui il testo sorgente:",
    
    // Placeholder delle textarea
    i18nSourcePlaceholder:"Incolla qui il contenuto completo (titolo, giorni, descrizioni...). La nostra IA integrata trasformer√† automaticamente i tuoi contenuti in formato strutturato. Funzionalit√† in sviluppo.",
    srcPlaceholder2:"Incolla qui il contenuto completo (titolo, giorni, descrizioni...). Genera il prompt e copia il risultato trovato in 3 in un'IA di tua scelta senza modificarlo"
  },
  es:{
    t1text:"Pega la p√°gina",
    t2text:"Prompt IA generado",
    t3text:"Pega respuesta IA",
    btnValidate:"Generar prompt",
    btnClear:"Borrar",
    btnCopy:"Copiar",
    btnValidateJson:"Validar y abrir",
    btnCancel:"Cancelar",
    btnGo:"Validar",
    srcPlaceholder:"Pega aqu√≠ el contenido completo",
    jsonPlaceholder:"Pega aqu√≠ la respuesta JSON",
    hint1:"Pega y pulsa 'Generar'.",
    hint2:"Copia el prompt a ChatGPT/Claude/Gemini.",
    copied:"‚úì ¬°Copiado!",
    needSrc:"Pega el texto fuente.",
    needSeeds:"Indica al menos una ciudad base (tus hoteles), separadas por comas.",
    needRet:"Pega la respuesta JSON.",
    badJson:"JSON no v√°lido.",
    missingItins:"Falta 'itins' o est√° vac√≠o.",
    okSaved:"‚úÖ ¬°Guardado! Redirigiendo...",
    cleanedChars:"‚úì Limpiado: {count} caracteres.",
    jsonRepaired:"‚ö†Ô∏è JSON reparado autom√°ticamente.",
    jsonUnrepairable:"‚ùå JSON no reparable: {error}",
    validating:"Validando...",
    jsonValid:"‚úì JSON v√°lido ({count})",
    autoRepairAttempt:"Intentando reparar...",
    repairSuccess:"‚úì ¬°Reparado!",
    processing:"Procesando...",

    optTitle:"Generaci√≥n de itinerario",
    optExplain:"Puedes encontrar un itinerario en la web, o una descripci√≥n de lugares que quieres visitar, o pegar varias descripciones de lugares y generar un prompt para copiarlo a una IA de tu elecci√≥n. No necesitas limpiar tu copia, puedes copiar la p√°gina entera y pegarla tal cual en la primera pesta√±a. Luego solo tienes que pegar la respuesta de la IA en la tercera pesta√±a para tener un itinerario a medida completamente modificable.",
    userModeText:"El itinerario ser√° optimizado autom√°ticamente geogr√°ficamente para evitar retrocesos.",
    opt1Title:"Seguir el itinerario exactamente",
    opt1Desc:"El orden de los elementos pegados se respeta",
    opt2Title:"Adoptar una ruta l√≥gica",
    opt2Desc:"Ideal si pegaste nombres de lugares",
    opt3Title:"Esparcir desde algunas ciudades",
    opt3Desc:"A especificar durante la generaci√≥n",
    opt4Title:"Tour de la ciudad",
    opt4Desc:"1 visita = 1 bloque en el/los d√≠a(s)",
    opt1Lbl:"Seguir exactamente el itinerario copiado",
    opt2Lbl:"Recorrido l√≥gico (si pegaste nombres de lugares)",
    opt3Lbl:"Esparcir desde ciudades semilla (especificar)",
    opt4Lbl:"City trip (cada visita = bloque ordenado en el d√≠a)",
    optNote:"Luego podr√°s modificar tu recorrido a tu gusto.",
    seedPlaceholder:"Ej.: Niza, G√©nova, La Spezia",

    // Config trip modal
    cfgTitle:"Configura tu viaje",
    cfgStartDate:"Fecha de salida:",
    cfgNbDays:"N√∫mero de d√≠as deseados:",
    cfgPace:"Ritmo:",
    cfgPaceSlow:"Tranquilo",
    cfgPaceStandard:"Normal",
    cfgPaceFast:"Intenso",
    cfgMaxHotels:"Cambios de hotel m√°ximos:",
    cfgBtnCancel:"Cancelar",
    cfgBtnValidate:"Validar",

    // T√≠tulos secciones
    premiumSectionTitle:"Reservado para suscriptores",
    freeSectionTitle:"Gratis: copie una p√°gina de internet (seleccionar todo, copiar), p√©guela en el generador de prompt, copie el resultado en una IA de su elecci√≥n y vuelva a pegar su respuesta sin modificarla en la tercera pesta√±a, su viaje est√° listo",

    // I18N section (1bis)
    i18nTitle:"Copia el archivo fuente y deja que nuestra IA integrada lo haga",
    i18nSourceLabel:"Pega tu archivo fuente aqu√≠:",
    btnI18nProcess:"Transformar",

    // Secci√≥n 2 y 2bis - textos en las info-box
    i18nNote:"Reservado para usuarios Silver y Gold. Nuestra IA integrada transformar√° autom√°ticamente tu contenido en formato estructurado. Funcionalidad en desarrollo.",
    hint2bis:"Genera el prompt y copia el resultado encontrado en 3 en una IA de tu elecci√≥n sin modificarlo",
    labelSrc:"Pega el texto fuente aqu√≠:",
    
    // Placeholders de las textarea
    i18nSourcePlaceholder:"Pega aqu√≠ el contenido completo (t√≠tulo, d√≠as, descripciones...). Nuestra IA integrada transformar√° autom√°ticamente tu contenido en formato estructurado. Funcionalidad en desarrollo.",
    srcPlaceholder2:"Pega aqu√≠ el contenido completo (t√≠tulo, d√≠as, descripciones...). Genera el prompt y copia el resultado encontrado en 3 en una IA de tu elecci√≥n sin modificarlo"
  },
  pt:{
    t1text:"Cole a p√°gina",
    t2text:"Prompt IA gerado",
    t3text:"Cole a resposta IA",
    btnValidate:"Gerar prompt",
    btnClear:"Limpar",
    btnCopy:"Copiar",
    btnValidateJson:"Validar e abrir",
    btnCancel:"Cancelar",
    btnGo:"Validar",
    srcPlaceholder:"Cole o conte√∫do completo",
    jsonPlaceholder:"Cole a resposta JSON",
    hint1:"Cole e clique 'Gerar'.",
    hint2:"Copie o prompt para ChatGPT/Claude/Gemini.",
    copied:"‚úì Copiado!",
    needSrc:"Cole o texto fonte primeiro.",
    needSeeds:"Indique pelo menos uma cidade base (seus hot√©is), separadas por v√≠rgulas.",
    needRet:"Cole a resposta JSON primeiro.",
    badJson:"JSON inv√°lido.",
    missingItins:"'itins' ausente ou vazio.",
    okSaved:"‚úÖ Salvo! Redirecionando...",
    cleanedChars:"‚úì Limpo: {count} caracteres.",
    jsonRepaired:"‚ö†Ô∏è JSON reparado automaticamente.",
    jsonUnrepairable:"‚ùå JSON irrecuper√°vel: {error}",
    validating:"Validando...",
    jsonValid:"‚úì JSON v√°lido ({count})",
    autoRepairAttempt:"Tentando reparo...",
    repairSuccess:"‚úì Reparo bem-sucedido!",
    processing:"Processando...",

    optTitle:"Gera√ß√£o de itiner√°rio",
    optExplain:"Pode encontrar um itiner√°rio na web, ou uma descri√ß√£o de lugares que quer visitar, ou colar v√°rias descri√ß√µes de lugares e gerar um prompt para copiar a uma IA da sua escolha. N√£o precisa limpar a sua c√≥pia, pode copiar a p√°gina inteira e col√°-la tal como est√° na primeira aba. Depois √© s√≥ colar a resposta da IA na terceira aba para ter um itiner√°rio personalizado completamente modific√°vel.",
    userModeText:"O itiner√°rio ser√° automaticamente otimizado geograficamente para evitar retornos.",
    opt1Title:"Seguir o itiner√°rio exatamente",
    opt1Desc:"A ordem dos elementos colados √© respeitada",
    opt2Title:"Adotar uma rota l√≥gica",
    opt2Desc:"Ideal se voc√™ colou nomes de lugares",
    opt3Title:"Espalhar de algumas cidades",
    opt3Desc:"A ser especificado durante a gera√ß√£o",
    opt4Title:"Tour pela cidade",
    opt4Desc:"1 visita = 1 bloco no(s) dia(s)",
    opt1Lbl:"Seguir exatamente o itiner√°rio copiado",
    opt2Lbl:"Roteiro l√≥gico (se colou nomes de lugares)",
    opt3Lbl:"Partir de cidades semente (especificar)",
    opt4Lbl:"City trip (cada visita = bloco ordenado no dia)",
    optNote:"Voc√™ poder√° editar o roteiro como quiser.",
    seedPlaceholder:"Ex.: Nice, G√™nova, La Spezia",

    // Config trip modal
    cfgTitle:"Configure sua viagem",
    cfgStartDate:"Data de partida:",
    cfgNbDays:"N√∫mero de dias desejados:",
    cfgPace:"Ritmo:",
    cfgPaceSlow:"Tranquilo",
    cfgPaceStandard:"Normal",
    cfgPaceFast:"Intenso",
    cfgMaxHotels:"Mudan√ßas de hotel m√°ximas:",
    cfgBtnCancel:"Cancelar",
    cfgBtnValidate:"Validar",

    // T√≠tulos das se√ß√µes
    premiumSectionTitle:"Reservado para assinantes",
    freeSectionTitle:"Gr√°tis: copie uma p√°gina da internet (selecionar tudo, copiar), cole no gerador de prompt, copie o resultado em uma IA de sua escolha e volte para colar sua resposta sem modific√°-la na terceira aba, sua viagem est√° pronta",

    // I18N section (1bis)
    i18nTitle:"Copie o arquivo fonte e deixe nossa IA integrada fazer",
    i18nSourceLabel:"Cole seu arquivo fonte aqui:",
    btnI18nProcess:"Transformar",

    // Se√ß√£o 2 e 2bis - textos nas info-box
    i18nNote:"Reservado para usu√°rios Silver e Gold. Nossa IA integrada transformar√° automaticamente seu conte√∫do em formato estruturado. Funcionalidade em desenvolvimento.",
    hint2bis:"Gere o prompt e copie o resultado encontrado em 3 em uma IA de sua escolha sem modific√°-lo",
    labelSrc:"Cole o texto fonte aqui:",
    
    // Placeholders das textarea
    i18nSourcePlaceholder:"Cole o conte√∫do completo (t√≠tulo, dias, descri√ß√µes...). Nossa IA integrada transformar√° automaticamente seu conte√∫do em formato estruturado. Funcionalidade em desenvolvimento.",
    srcPlaceholder2:"Cole o conte√∫do completo (t√≠tulo, dias, descri√ß√µes...). Gere o prompt e copie o resultado encontrado em 3 em uma IA de sua escolha sem modific√°-lo"
  },
  ar:{
    t1text:"ÿßŸÑÿµŸÇ ÿßŸÑÿµŸÅÿ≠ÿ©",
    t2text:"ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ∑ŸÑÿ®",
    t3text:"ÿßŸÑÿµŸÇ ÿ•ÿ¨ÿßÿ®ÿ© JSON",
    btnValidate:"ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ∑ŸÑÿ®",
    btnClear:"ŸÖÿ≥ÿ≠",
    btnCopy:"ŸÜÿ≥ÿÆ",
    btnValidateJson:"ÿ™ÿ´ÿ®Ÿäÿ™ ŸàŸÅÿ™ÿ≠",
    btnCancel:"ÿ•ŸÑÿ∫ÿßÿ°",
    btnGo:"ÿ™ÿ´ÿ®Ÿäÿ™",
    srcPlaceholder:"ÿßŸÑÿµŸÇ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÉÿßŸÖŸÑ",
    jsonPlaceholder:"ÿßŸÑÿµŸÇ ÿ•ÿ¨ÿßÿ®ÿ© JSON ÿßŸÑŸÉÿßŸÖŸÑÿ©",
    hint1:"ÿßŸÑÿµŸÇ ÿ´ŸÖ ÿßÿ∂ÿ∫ÿ∑ 'ÿ•ŸÜÿ¥ÿßÿ°'.",
    hint2:"ÿßŸÜÿ≥ÿÆ ÿßŸÑÿ∑ŸÑÿ® ÿ•ŸÑŸâ ChatGPT/Claude/Gemini.",
    copied:"‚úì ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ!",
    needSrc:"ÿßŸÑÿµŸÇ ÿßŸÑŸÜÿµ ÿ£ŸàŸÑÿßŸã.",
    needSeeds:"ÿ≠ÿØÿØ ŸÖÿØŸäŸÜÿ© ŸÇÿßÿπÿØÿ© Ÿàÿßÿ≠ÿØÿ© ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ (ŸÅŸÜÿßÿØŸÇŸÉ)ÿå ŸÖŸÅÿµŸàŸÑÿ© ÿ®ŸÅŸàÿßÿµŸÑ.",
    needRet:"ÿßŸÑÿµŸÇ ÿ•ÿ¨ÿßÿ®ÿ© JSON ÿ£ŸàŸÑÿßŸã.",
    badJson:"JSON ÿ∫Ÿäÿ± ÿµÿßŸÑÿ≠.",
    missingItins:"'itins' ŸÖŸÅŸÇŸàÿØÿ© ÿ£Ÿà ŸÅÿßÿ±ÿ∫ÿ©.",
    okSaved:"‚úÖ ÿ™ŸÖ ÿßŸÑÿ≠ŸÅÿ∏! ÿ•ÿπÿßÿØÿ© ÿ™Ÿàÿ¨ŸäŸá...",
    cleanedChars:"‚úì ÿ™ŸÖ ÿßŸÑÿ™ŸÜÿ∏ŸäŸÅ: {count} ÿ≠ÿ±ŸÅŸãÿß.",
    jsonRepaired:"‚ö†Ô∏è ÿ™ŸÖ ÿ•ÿµŸÑÿßÿ≠ JSON ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß.",
    jsonUnrepairable:"‚ùå ÿ∫Ÿäÿ± ŸÇÿßÿ®ŸÑ ŸÑŸÑÿ•ÿµŸÑÿßÿ≠: {error}",
    validating:"ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÇŸÇ...",
    jsonValid:"‚úì JSON ÿµÿßŸÑÿ≠ ({count})",
    autoRepairAttempt:"ŸÖÿ≠ÿßŸàŸÑÿ© ÿ•ÿµŸÑÿßÿ≠ ÿ™ŸÑŸÇÿßÿ¶Ÿä...",
    repairSuccess:"‚úì ÿ™ŸÖ ÿßŸÑÿ•ÿµŸÑÿßÿ≠!",
    processing:"ÿ¨ÿßÿ±Ÿç ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©...",

    optTitle:"ÿ•ŸÜÿ¥ÿßÿ° ÿÆÿ∑ ÿßŸÑÿ≥Ÿäÿ±",
    optExplain:"ŸäŸÖŸÉŸÜŸÉ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿÆÿ∑ ÿ≥Ÿäÿ± ÿπŸÑŸâ ÿßŸÑŸàŸäÿ®ÿå ÿ£Ÿà ŸàÿµŸÅ ŸÑŸÑÿ£ŸÖÿßŸÉŸÜ ÿßŸÑÿ™Ÿä ÿ™ÿ±ŸäÿØ ÿ≤Ÿäÿßÿ±ÿ™Ÿáÿßÿå ÿ£Ÿà ŸÑÿµŸÇ ÿπÿØÿ© ÿ£ŸàÿµÿßŸÅ ŸÑŸÑÿ£ŸÖÿßŸÉŸÜ Ÿàÿ•ŸÜÿ¥ÿßÿ° prompt ŸÑŸÜÿ≥ÿÆŸá ÿ•ŸÑŸâ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ. ŸÑÿß ÿ≠ÿßÿ¨ÿ© ŸÑÿ™ŸÜÿ∏ŸäŸÅ ŸÜÿ≥ÿÆÿ™ŸÉÿå ŸäŸÖŸÉŸÜŸÉ ŸÜÿ≥ÿÆ ÿßŸÑÿµŸÅÿ≠ÿ© ÿ®ÿ£ŸÉŸÖŸÑŸáÿß ŸàŸÑÿµŸÇŸáÿß ŸÉŸÖÿß ŸáŸä ŸÅŸä ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ£ŸàŸÑ. ÿ´ŸÖ ŸÖÿß ÿπŸÑŸäŸÉ ÿ≥ŸàŸâ ŸÑÿµŸÇ ÿ±ÿØ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ŸÅŸä ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ´ÿßŸÑÿ´ ŸÑŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ÿÆÿ∑ ÿ≥Ÿäÿ± ŸÖÿÆÿµÿµ ŸÇÿßÿ®ŸÑ ŸÑŸÑÿ™ÿπÿØŸäŸÑ ÿ®ÿßŸÑŸÉÿßŸÖŸÑ.",
    userModeText:"ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≠ÿ≥ŸäŸÜ ÿÆÿ∑ ÿßŸÑÿ≥Ÿäÿ± ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿßŸã ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÑÿ™ÿ¨ŸÜÿ® ÿßŸÑÿ±ÿ¨Ÿàÿπ.",
    opt1Title:"ÿßÿ™Ÿëÿ®ÿßÿπ ÿßŸÑŸÖÿ≥ÿßÿ± ÿ®ÿßŸÑÿ∂ÿ®ÿ∑",
    opt1Desc:"ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖŸÑÿµŸÇÿ© ŸÖÿ≠ÿ™ÿ±ŸÖ ŸÉŸÖÿß ŸáŸà",
    opt2Title:"ÿßÿπÿ™ŸÖÿßÿØ ÿ∑ÿ±ŸäŸÇ ŸÖŸÜÿ∑ŸÇŸä",
    opt2Desc:"ŸÖÿ´ÿßŸÑŸä ÿ•ÿ∞ÿß ŸÑÿµŸÇÿ™ ÿ£ÿ≥ŸÖÿßÿ° ÿ£ŸÖÿßŸÉŸÜ",
    opt3Title:"ÿßŸÑÿßŸÜÿ∑ŸÑÿßŸÇ ŸÖŸÜ ÿ®ÿπÿ∂ ÿßŸÑŸÖÿØŸÜ",
    opt3Desc:"Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØŸáÿß ÿπŸÜÿØ ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°",
    opt4Title:"ÿ¨ŸàŸÑÿ© ŸÅŸä ÿßŸÑŸÖÿØŸäŸÜÿ©",
    opt4Desc:"ÿ≤Ÿäÿßÿ±ÿ© Ÿàÿßÿ≠ÿØÿ© = ŸÉÿ™ŸÑÿ© Ÿàÿßÿ≠ÿØÿ© ŸÅŸä ÿßŸÑŸäŸàŸÖ/ÿßŸÑÿ£ŸäÿßŸÖ",
    opt1Lbl:"ÿßÿ™Ÿëÿ®ÿßÿπ ÿßŸÑŸÖÿ≥ÿßÿ± ÿßŸÑŸÖŸÜÿ≥ŸàÿÆ ÿ≠ÿ±ŸÅŸäŸãÿß",
    opt2Lbl:"ŸÖÿ≥ÿßÿ± ŸÖŸÜÿ∑ŸÇŸä (ÿ•ÿ∞ÿß ŸÑÿµŸÇÿ™ ÿ£ÿ≥ŸÖÿßÿ° ÿ£ŸÖÿßŸÉŸÜ)",
    opt3Lbl:"ÿßŸÑÿßŸÜÿ∑ŸÑÿßŸÇ ŸÖŸÜ ŸÖÿØŸÜ ÿ£ÿ≥ÿßÿ≥Ÿäÿ© (ÿßÿ∞ŸÉÿ±Ÿáÿß)",
    opt4Lbl:"ŸÖÿ≥ÿßÿ± ÿØÿßÿÆŸÑ ÿßŸÑŸÖÿØŸäŸÜÿ© (ŸÉŸÑ ÿ≤Ÿäÿßÿ±ÿ© = ŸÉÿ™ŸÑÿ© ŸÖÿ±ÿ™ÿ®ÿ©)",
    optNote:"ŸäŸÖŸÉŸÜŸÉ ÿ™ÿπÿØŸäŸÑ ŸÖÿ≥ÿßÿ±ŸÉ ŸÉŸÖÿß ÿ™ÿ¥ÿßÿ° ŸÑÿßÿ≠ŸÇŸãÿß.",
    seedPlaceholder:"ŸÖÿ´ÿßŸÑ: ŸÜŸäÿ≥ÿå ÿ¨ŸÜŸàÿ©ÿå ŸÑÿß ÿ≥ÿ®Ÿäÿ™ÿ≥Ÿäÿß",

    // Config trip modal
    cfgTitle:"ŸÇŸÖ ÿ®ÿ™ŸÉŸàŸäŸÜ ÿ±ÿ≠ŸÑÿ™ŸÉ",
    cfgStartDate:"ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©:",
    cfgNbDays:"ÿπÿØÿØ ÿßŸÑÿ£ŸäÿßŸÖ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©:",
    cfgPace:"ÿßŸÑÿ•ŸäŸÇÿßÿπ:",
    cfgPaceSlow:"ŸáÿßÿØÿ¶",
    cfgPaceStandard:"ÿπÿßÿØŸä",
    cfgPaceFast:"ÿ≥ÿ±Ÿäÿπ",
    cfgMaxHotels:"ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑÿ™ÿ∫ŸäŸäÿ± ÿßŸÑŸÅŸÜÿßÿØŸÇ:",
    cfgBtnCancel:"ÿ•ŸÑÿ∫ÿßÿ°",
    cfgBtnValidate:"ÿ™ÿ£ŸÉŸäÿØ",

    // ÿπŸÜÿßŸàŸäŸÜ ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ
    premiumSectionTitle:"ŸÖÿ≠ÿ¨Ÿàÿ≤ ŸÑŸÑŸÖÿ¥ÿ™ÿ±ŸÉŸäŸÜ",
    freeSectionTitle:"ŸÖÿ¨ÿßŸÜŸä: ÿßŸÜÿ≥ÿÆ ÿµŸÅÿ≠ÿ© ÿ•ŸÜÿ™ÿ±ŸÜÿ™ (ÿ™ÿ≠ÿØŸäÿØ ÿßŸÑŸÉŸÑÿå ŸÜÿ≥ÿÆ)ÿå ÿßŸÑÿµŸÇŸáÿß ŸÅŸä ŸÖŸàŸÑÿØ ÿßŸÑÿ∑ŸÑÿ®ÿå ÿßŸÜÿ≥ÿÆ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ŸÅŸä ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ ŸàÿπÿØ ŸÑŸÑÿµŸÇ ÿ•ÿ¨ÿßÿ®ÿ™Ÿá ÿØŸàŸÜ ÿ™ÿπÿØŸäŸÑŸáÿß ŸÅŸä ÿπŸÑÿßŸÖÿ© ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ´ÿßŸÑÿ´ÿ©ÿå ÿ±ÿ≠ŸÑÿ™ŸÉ ÿ¨ÿßŸáÿ≤ÿ©",

    // I18N section (1bis)
    i18nTitle:"ÿßŸÜÿ≥ÿÆ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑŸÖÿµÿØÿ± ŸàÿØÿπ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿØŸÖÿ¨ ŸäŸÇŸàŸÖ ÿ®ÿ∞ŸÑŸÉ",
    i18nSourceLabel:"ÿßŸÑÿµŸÇ ŸÖŸÑŸÅŸÉ ÿßŸÑŸÖÿµÿØÿ± ŸáŸÜÿß:",
    btnI18nProcess:"ÿ™ÿ≠ŸàŸäŸÑ",

    // ÿßŸÑŸÇÿ≥ŸÖ 2 Ÿà 2bis - ŸÜÿµŸàÿµ ŸÅŸä ÿµŸÜÿßÿØŸäŸÇ ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™
    i18nNote:"ŸÖÿ≠ÿ¨Ÿàÿ≤ ŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸä Silver Ÿà Gold. ÿ≥ŸäŸÇŸàŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿØŸÖÿ¨ ŸÑÿØŸäŸÜÿß ÿ®ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ÿ•ŸÑŸâ ÿ™ŸÜÿ≥ŸäŸÇ ŸÖŸÜÿ∏ŸÖ. ÿßŸÑŸÖŸäÿ≤ÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±.",
    hint2bis:"ÿ£ŸÜÿ¥ÿ¶ ÿßŸÑÿ∑ŸÑÿ® ŸàÿßŸÜÿ≥ÿÆ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© ŸÅŸä 3 ÿ•ŸÑŸâ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ ÿØŸàŸÜ ÿ™ÿπÿØŸäŸÑŸáÿß",
    labelSrc:"ÿßŸÑÿµŸÇ ÿßŸÑŸÜÿµ ÿßŸÑŸÖÿµÿØÿ± ŸáŸÜÿß:",
    
    // ÿπŸÜÿßÿµÿ± ŸÜÿßÿ¶ÿ®ÿ© ŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑŸÜÿµ
    i18nSourcePlaceholder:"ÿßŸÑÿµŸÇ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÉÿßŸÖŸÑ (ÿßŸÑÿπŸÜŸàÿßŸÜÿå ÿßŸÑÿ£ŸäÿßŸÖÿå ÿßŸÑÿ£ŸàÿµÿßŸÅ...). ÿ≥ŸäŸÇŸàŸÖ ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä ÿßŸÑŸÖÿØŸÖÿ¨ ŸÑÿØŸäŸÜÿß ÿ®ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿÆÿßÿµ ÿ®ŸÉ ÿ™ŸÑŸÇÿßÿ¶ŸäŸãÿß ÿ•ŸÑŸâ ÿ™ŸÜÿ≥ŸäŸÇ ŸÖŸÜÿ∏ŸÖ. ÿßŸÑŸÖŸäÿ≤ÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±.",
    srcPlaceholder2:"ÿßŸÑÿµŸÇ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÉÿßŸÖŸÑ (ÿßŸÑÿπŸÜŸàÿßŸÜÿå ÿßŸÑÿ£ŸäÿßŸÖÿå ÿßŸÑÿ£ŸàÿµÿßŸÅ...). ÿ£ŸÜÿ¥ÿ¶ ÿßŸÑÿ∑ŸÑÿ® ŸàÿßŸÜÿ≥ÿÆ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑŸÖŸàÿ¨ŸàÿØÿ© ŸÅŸä 3 ÿ•ŸÑŸâ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ±ŸÉ ÿØŸàŸÜ ÿ™ÿπÿØŸäŸÑŸáÿß"
  }
};

// DOM helpers
const $ = (s, r=document)=>r.querySelector(s);

// Nettoyage source (inchang√©)
function cleanSourceText(raw) {
  let text = raw;
  const originalLength = text.length;
  const removePatterns = [
    /(?:menu|navigation|nav-|navbar|header-menu|footer-menu)[\s\S]{0,300}?(?=\n\n|\n[A-Z√Ä√Ç√Ñ√â√à√ä√ã√ç√é√ì√ô√õ√ú]|$)/gi,
    /(?:cookie|cookies?|politique des cookies)[\s\S]{0,200}?(?=\n\n|$)/gi,
    /(?:newsletter|subscribe|abonnez-vous|inscrivez-vous)[\s\S]{0,150}?(?=\n\n|$)/gi,
    /(?:r√©seaux sociaux|social media|follow us|suivez-nous)[\s\S]{0,150}?(?=\n\n|$)/gi,
    /(?:publicit√©|advertisement|sponsored|sponsoris√©)[\s\S]{0,200}?(?=\n\n|$)/gi,
    /(?:¬©|copyright|tous droits r√©serv√©s|all rights reserved).*$/gim,
    /(?:mentions l√©gales|politique de confidentialit√©|conditions d'utilisation|terms of service|privacy policy|legal notice)[\s\S]{0,100}?(?=\n|$)/gim,
    /(?:contactez-nous|contact us|about us|√† propos|qui sommes-nous)[\s\S]{0,100}?(?=\n\n|$)/gim,
    /\b(?:facebook|twitter|instagram|linkedin|youtube|pinterest|tiktok)\b[\s\S]{0,100}?(?=\n|$)/gim,
    /(?:share|partager|share this|partager cet article)[\s\S]{0,80}?(?=\n|$)/gi
  ];
  removePatterns.forEach(pattern => { text = text.replace(pattern, ''); });
  text = text.replace(/https?:\/\/[^\s]+/g, '');
  text = text.replace(/[\w.-]+@[\w.-]+\.[a-z]{2,}/gi, '');
  text = text.split('\n').filter(line => {
    const trimmed = line.trim();
    return trimmed.length === 0 || trimmed.length > 15;
  }).join('\n');
  text = text.replace(/\n{3,}/g, '\n\n');
  text = text.replace(/[ \t]+/g, ' ');
  text = text.trim();
  const removed = originalLength - text.length;
  return { cleaned: text, removed };
}

// R√©paration JSON (inchang√©)
function tryRepairJSON(raw) { /* ... identique √† ta version ... */ 
  let text = raw.trim();
  const repairs = [];
  if(text.includes('```')){
    text = text.replace(/```json\s*/gi,'').replace(/```\s*/g,'');
    repairs.push('markdown removed');
  }
  const firstBrace = text.indexOf('{');
  const lastBrace = text.lastIndexOf('}');
  if(firstBrace === -1 || lastBrace === -1 || lastBrace <= firstBrace) { throw new Error('No valid JSON structure found'); }
  if(firstBrace > 0 || lastBrace < text.length - 1) { text = text.substring(firstBrace, lastBrace + 1); repairs.push('extracted JSON from text'); }
  let quoteCount = (text.match(/(?<!\\)"/g) || []).length;
  if(quoteCount % 2 !== 0) {
    const lastCloseBrace = text.lastIndexOf('}');
    const lastColon = text.lastIndexOf(':', lastCloseBrace);
    const lastComma = text.lastIndexOf(',', lastCloseBrace);
    const insertPos = Math.max(lastColon, lastComma) + 1;
    if(insertPos > 0 && insertPos < lastCloseBrace) { text = text.substring(0, insertPos) + '"' + text.substring(insertPos); repairs.push('balanced quotes'); }
  }
  text = text.replace(/,(\s*[}\]])/g, '$1');
  repairs.push('removed trailing commas');
  text = text.replace(/}(\s*)(\{)/g, '},$1$2');
  text = text.replace(/\](\s*)(\{)/g, '],$1$2');
  text = text.replace(/}(\s*)(\[)/g, '},$1$2');
  text = text.replace(/"([^"]+)"\s+(["{[])/g, '"$1":$2');
  text = text.replace(/:\s*"([^"]*)\n([^"]*?)"/g, ':"$1 $2"');
  text = text.replace(/\/\*[\s\S]*?\*\//g, '');
  text = text.replace(/\/\/.*/g, '');
  if(repairs.length > 0) { console.log('JSON repairs applied:', repairs); }
  return text;
}

// Auto-correction namespace (v2.3)
function autoCorrectNamespace(data) {
  const corrections = [];
  if(!data.itins || !Array.isArray(data.itins)) return {data, corrections};
  
  data.itins.forEach((itin, idx) => {
    if(!itin.itin_id) return;
    
    const parts = String(itin.itin_id).split('::');
    const ns = parts[0] || '';
    
    // Si namespace invalide (CC, XX, etc.), essayer de d√©tecter le pays via dept_code
    if(ns === 'CC' || ns === 'XX' || ns.length !== 2 || !/^[A-Z]{2}$/.test(ns)) {
      let country = null;
      const deptCode = String(itin.dept_code || '').toUpperCase();
      
      // Mappings basiques
      if(/^\d{2}[AB]?$/.test(deptCode)) country = 'FR';
      else if(['RM','MI','FI','TO','NA','PA','GE','BO','VE','PD','VR','TS'].includes(deptCode)) country = 'IT';
      else if(['MA','BA','SE','VA','CA','BI','MU','AL','CO','GR'].includes(deptCode)) country = 'ES';
      else if(['LI','PO','FA','CO','AV','BR','EV','PT','VC','BJ','CB','GU'].includes(deptCode)) country = 'PT';
      else if(['AN','IS','IZ','BU','AD','AY','DI','ER'].includes(deptCode)) country = 'TR';
      
      if(country) {
        const oldId = itin.itin_id;
        parts[0] = country;
        itin.itin_id = parts.join('::');
        corrections.push(`itin_id: "${oldId}" ‚Üí "${itin.itin_id}"`);
        
        // Corriger aussi les place_id
        if(itin.days_plan && Array.isArray(itin.days_plan)) {
          itin.days_plan.forEach((day, dayIdx) => {
            if(day.night && day.night.place_id) {
              const placeParts = String(day.night.place_id).split('::');
              const placeNs = placeParts[0] || '';
              if(placeNs === 'CC' || placeNs === 'XX' || placeNs.length !== 2) {
                const oldPlaceId = day.night.place_id;
                placeParts[0] = country;
                day.night.place_id = placeParts.join('::');
                corrections.push(`place_id jour ${day.day || dayIdx+1}: "${oldPlaceId}" ‚Üí "${day.night.place_id}"`);
              }
            }
          });
        }
      }
    }
  });
  
  return {data, corrections};
}

// Validation structure (inchang√©)
function validateItinStructure(data) {
  const errors = [];
  if(!data.itins || !Array.isArray(data.itins)) { errors.push("Missing 'itins' array"); return { valid: false, errors }; }
  if(data.itins.length === 0) { errors.push("'itins' array is empty"); return { valid: false, errors }; }
  data.itins.forEach((itin, idx) => {
    if(!itin.itin_id) errors.push(`Itin ${idx}: missing itin_id`);
    if(!itin.title) errors.push(`Itin ${idx}: missing title`);
    if(!itin.days_plan || !Array.isArray(itin.days_plan)) { errors.push(`Itin ${idx}: missing or invalid days_plan`); }
  });
  return { valid: errors.length === 0, errors };
}

// Places auto (inchang√©)
function generatePlacesFromItin(data) {
  const placesMap = new Map();
  (data.itins || []).forEach(itin => {
    (itin.days_plan || []).forEach(day => {
      const night = day.night || {};
      const pid = night.place_id; if (!pid) return;
      const coords = Array.isArray(night.coords) ? night.coords : [0,0];
      const [lat, lon] = coords;
      if (!placesMap.has(pid)) {
        const parts = String(pid).split('::');
        const cc = (parts[0] || 'XX').toUpperCase();
        const slug = parts[1] || 'unknown';
        const name = slug.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        placesMap.set(pid, { place_id: pid, name, lat: lat || 0, lon: lon || 0, cc, kinds: ["city"], visits: [], hotels: [], images: [] });
      }
      const place = placesMap.get(pid);
      if (Array.isArray(day.visits))     place.visits.push(...day.visits);
      if (Array.isArray(day.activities)) place.visits.push(...day.activities);
    });
  });
  const firstId = data?.itins?.[0]?.itin_id || '';
  const country = (String(firstId).split('::')[0] || 'XX').toUpperCase();
  return { version: "1.0", country, places: Array.from(placesMap.values()) };
}

function slugify(s){
  return (s||'trip').toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');
}

// Applique I18N
function setLang(lang){
  localStorage.setItem('lang', lang);
  const t=I18N[lang]||I18N.fr;
  
  // Text content
  const t1 = $('#t1text'); if(t1) t1.textContent=t.t1text;
  const t2 = $('#t2text'); if(t2) t2.textContent=t.t2text;
  const t3 = $('#t3text'); if(t3) t3.textContent=t.t3text;
  const h1 = $('#hint1'); if(h1) h1.textContent=t.hint1;
  const h2 = $('#hint2'); if(h2) h2.textContent=t.hint2;
  
  // Buttons
  const btnGen = $('#btn-gen'); if(btnGen) btnGen.textContent=t.btnValidate;
  const btnClear = $('#btn-clear'); if(btnClear) btnClear.textContent=t.btnClear;
  const btnClearPrompt = $('#btn-clear-prompt'); if(btnClearPrompt) btnClearPrompt.textContent=t.btnClear;
  const btnClearJson = $('#btn-clear-json'); if(btnClearJson) btnClearJson.textContent=t.btnClear;
  const btnCopy = $('#btn-copy'); if(btnCopy) btnCopy.textContent=t.btnCopy;
  const btnValidateJson = $('#btn-validate-json'); if(btnValidateJson) btnValidateJson.textContent=t.btnValidateJson;
  const bCancel = $('#btnCancelEmail'); if (bCancel) bCancel.textContent = t.btnCancel;
  const bDo     = $('#btnDoEmail');     if (bDo)     bDo.textContent     = t.btnGo;
  
  // Placeholders
  const i18nSource = $('#i18nSource'); if(i18nSource) i18nSource.placeholder=t.i18nSourcePlaceholder;
  const src = $('#src'); if(src) src.placeholder=t.srcPlaceholder2;
  const jsonReturn = $('#json-return'); if(jsonReturn) jsonReturn.placeholder=t.jsonPlaceholder;

  // NEW: options labels
  const optTitle = $('#optTitle'); if(optTitle) optTitle.textContent = t.optTitle;
  const optExplain = $('#optExplain'); if(optExplain) optExplain.textContent = t.optExplain;
  const userModeText = $('#userModeText'); if(userModeText) userModeText.textContent = t.userModeText || t.optTitle;
  const opt1Title = $('#opt1Title'); if(opt1Title) opt1Title.textContent = t.opt1Title;
  const opt1Desc = $('#opt1Desc'); if(opt1Desc) opt1Desc.textContent = t.opt1Desc;
  const opt2Title = $('#opt2Title'); if(opt2Title) opt2Title.textContent = t.opt2Title;
  const opt2Desc = $('#opt2Desc'); if(opt2Desc) opt2Desc.textContent = t.opt2Desc;
  const opt3Title = $('#opt3Title'); if(opt3Title) opt3Title.textContent = t.opt3Title;
  const opt3Desc = $('#opt3Desc'); if(opt3Desc) opt3Desc.textContent = t.opt3Desc;
  const opt4Title = $('#opt4Title'); if(opt4Title) opt4Title.textContent = t.opt4Title;
  const opt4Desc = $('#opt4Desc'); if(opt4Desc) opt4Desc.textContent = t.opt4Desc;
  const optNote = $('#optNote'); if(optNote) optNote.textContent = t.optNote;
  const seed = $('#seedCities'); if(seed) seed.placeholder = t.seedPlaceholder;

  // Section titles
  const premiumSectionTitle = $('#premiumSectionTitle'); if(premiumSectionTitle) premiumSectionTitle.textContent = t.premiumSectionTitle;
  const freeSectionTitle = $('#freeSectionTitle'); if(freeSectionTitle) freeSectionTitle.textContent = t.freeSectionTitle;

  // I18N section (1bis)
  const i18nTitle = $('#i18nTitle'); if(i18nTitle) i18nTitle.textContent = t.i18nTitle;
  const i18nNote = $('#i18nNote'); if(i18nNote) i18nNote.textContent = t.i18nNote;
  const i18nSourceLabel = $('#i18nSourceLabel'); if(i18nSourceLabel) i18nSourceLabel.textContent = t.i18nSourceLabel;
  const btnI18nProcess = $('#btnI18nProcess'); if(btnI18nProcess) btnI18nProcess.textContent = t.btnI18nProcess;
  const btnI18nClear = $('#btnI18nClear'); if(btnI18nClear) btnI18nClear.textContent = t.btnClear;

  // Section 2bis
  const hint2bis = $('#hint2bis'); if(hint2bis) hint2bis.textContent = t.hint2bis;
  const labelSrc = $('#labelSrc'); if(labelSrc) labelSrc.textContent = t.labelSrc;

  // Config trip modal I18N
  const cfgTitleText = $('#cfgTitleText'); if(cfgTitleText) cfgTitleText.textContent = t.cfgTitle || 'Configurez votre voyage';
  const cfgStartDateLabel = $('#cfgStartDateLabel'); if(cfgStartDateLabel) cfgStartDateLabel.textContent = t.cfgStartDate || 'Date de d√©part :';
  const cfgNbDaysLabel = $('#cfgNbDaysLabel'); if(cfgNbDaysLabel) cfgNbDaysLabel.textContent = t.cfgNbDays || 'Nombre de jours souhait√©s :';
  const cfgPaceLabel = $('#cfgPaceLabel'); if(cfgPaceLabel) cfgPaceLabel.textContent = t.cfgPace || 'Rythme :';
  const cfgPaceSlowOpt = $('#cfgPaceSlowOpt'); if(cfgPaceSlowOpt) cfgPaceSlowOpt.textContent = t.cfgPaceSlow || 'Tranquille';
  const cfgPaceStandardOpt = $('#cfgPaceStandardOpt'); if(cfgPaceStandardOpt) cfgPaceStandardOpt.textContent = t.cfgPaceStandard || 'Normal';
  const cfgPaceFastOpt = $('#cfgPaceFastOpt'); if(cfgPaceFastOpt) cfgPaceFastOpt.textContent = t.cfgPaceFast || 'Soutenu';
  const cfgMaxHotelsLabel = $('#cfgMaxHotelsLabel'); if(cfgMaxHotelsLabel) cfgMaxHotelsLabel.textContent = t.cfgMaxHotels || 'Changements d\'h√¥tel maximum :';
  const btnCancelConfig = $('#btnCancelConfig'); if(btnCancelConfig) btnCancelConfig.textContent = t.cfgBtnCancel || 'Annuler';
  const btnValidateConfig = $('#btnValidateConfig'); if(btnValidateConfig) btnValidateConfig.textContent = t.cfgBtnValidate || 'Valider';

  const ei = $('#emailInput'); if(ei) ei.placeholder = t.emailPlaceholder || ei.placeholder;
  const pi = $('#pwdInput');   if(pi) pi.placeholder = t.pwdPlaceholder   || pi.placeholder;

  document.documentElement.lang=lang;
  document.querySelector('.brandlink')?.setAttribute('href', 'presentation.html?lang='+lang);

  if (window.__refreshAuthLabel) { try { window.__refreshAuthLabel(); } catch(_){} }

  try {
    const open = document.getElementById('openAuth');
    if (open) {
      const LABELS = {
        fr:{signin:'Se connecter',  account:'Mon compte'},
        en:{signin:'Sign in',        account:'My account'},
        it:{signin:'Accedi',         account:'Il mio account'},
        es:{signin:'Iniciar sesi√≥n', account:'Mi cuenta'},
        pt:{signin:'Iniciar sess√£o', account:'Minha conta'},
        ar:{signin:'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ',   account:'ÿ≠ÿ≥ÿßÿ®Ÿä'}
      };
      const LBL = (LABELS[lang] || LABELS.fr);
      const user = (window.firebase && window.firebase.auth && window.firebase.auth().currentUser) || null;
      open.textContent = user ? (user.displayName || user.email || LBL.account) : LBL.signin;
    }
  } catch(_) {}
}

// Init langue
(function(){
  const SUPPORTED_LANGS = ['fr', 'en', 'es', 'it', 'pt', 'ar'];
  const urlLang = new URLSearchParams(location.search).get('lang');
  const saved   = localStorage.getItem('lang');
  const navLang = ((navigator.languages && navigator.languages[0]) || navigator.language || 'fr').slice(0,2).toLowerCase();
  let lang = urlLang || saved || navLang;
  lang = (lang || 'fr').slice(0,2).toLowerCase();
  if (!SUPPORTED_LANGS.includes(lang)) lang = 'fr';
  localStorage.setItem('lang', lang); // Synchroniser
  $('#langSel').value = lang;
  setLang(lang);
  $('#langSel').addEventListener('change', (e)=>{
    const code = e.target.value || 'fr';
    setLang(code);
    try {
      const u = new URL(location.href);
      u.searchParams.set('lang', code);
      history.replaceState(null, '', u.toString());
    } catch(e) {
      // Ignore history errors in iframe/restricted contexts
    }
  });
})();

// === v3: Code seed input supprim√© (plus de mode seed pour utilisateurs) ===

// G√©n√©rer le prompt (MAJ: utilise options + supprime th√®mes impos√©s)
const btnGen = $('#btn-gen');
if(btnGen) {
  console.log('[ORT] btn-gen listener attached');
  btnGen.addEventListener('click', ()=>{
    console.log('[ORT] btn-gen clicked');
    const raw = $('#src').value.trim();
    const t = I18N[document.documentElement.lang]||I18N.fr;
    const btn = $('#btn-gen');
    if(!raw){ alert(t.needSrc); return; }

  // r√©cup√®re le mode
  const adminOptionsGrid = document.getElementById('adminOptionsGrid');
  const isAdmin = adminOptionsGrid && adminOptionsGrid.style.display !== 'none';
  
  let mode = 'logic'; // Mode par d√©faut pour les utilisateurs
  let modelSubMode = null;
  
  if(isAdmin) {
    // Mode admin - r√©cup√©rer le choix depuis les radios
    mode = 'model'; // Indique au prompt d'activer les r√®gles admin
    const selectedRadio = document.querySelector('#adminOptionsGrid input[type="radio"]:checked');
    modelSubMode = selectedRadio ? selectedRadio.value : 'logic';
  }
  
  const seeds = ($('#seedCities')?.value || '').trim();
  const modelSeeds = seeds; // M√™me champ pour les deux
  
  // Validation : si mode seed, au moins une ville requise
  if(isAdmin && modelSubMode === 'seed' && !seeds){
    alert('Veuillez indiquer au moins une ville d\'attache pour le mode essaimage.');
    return;
  }

  btn.disabled = true;
  btn.innerHTML = t.processing + '<span class="loader"></span>';

  setTimeout(() => {
    const {cleaned, removed} = cleanSourceText(raw);
    const lang = (document.documentElement.lang || localStorage.getItem('lang') || 'en').toLowerCase();
    const head = getPromptTemplate(lang,{mode, seeds, modelSubMode, modelSeeds});
    $('#prompt').textContent = head + cleaned;

    btn.disabled = false;
    btn.textContent = t.btnValidate;

    if(removed > 100) {
      const hint1 = $('#hint1');
      if(hint1) {
        hint1.textContent = t.cleanedChars.replace('{count}', removed);
        hint1.style.color = '#059669';
        hint1.style.fontWeight = '600';
      }
    } else {
      const hint1 = $('#hint1');
      if(hint1) {
        hint1.textContent = t.hint1;
        hint1.style.color = '';
        hint1.style.fontWeight = '';
      }
    }
    
    // Ouvrir la section 3 (prompt) sur mobile et fermer la section 2
    console.log('[ORT] About to collapse/expand sections');
    if(window.ORT_expandSection){
      console.log('[ORT] ORT_expandSection exists');
      if(window.ORT_collapseSection) {
        console.log('[ORT] Calling collapseSection(section2Container)');
        window.ORT_collapseSection('section2Container');
        setTimeout(() => {
          console.log('[ORT] Calling expandSection(section3Container) after delay');
          window.ORT_expandSection('section3Container');
        }, 350);
      } else {
        console.log('[ORT] ORT_collapseSection not available, calling expandSection directly');
        window.ORT_expandSection('section3Container');
      }
    } else {
      console.log('[ORT] ORT_expandSection NOT available!');
    }
  }, 100);
  });
}

const btnCopy = $('#btn-copy');
if(btnCopy) {
  btnCopy.addEventListener('click', ()=>{
    const text = $('#prompt').textContent||'';
    if(!text) return;
    navigator.clipboard.writeText(text).then(() => {
      const t = I18N[document.documentElement.lang]||I18N.fr;
      const btn = $('#btn-copy');
      const orig = btn.textContent;
      btn.textContent = t.copied;
      btn.style.background = '#059669';
      console.log('[ORT] Prompt copi√©');
      
      // Toujours passer √† section 4 apr√®s copie
      console.log('[ORT] Preparing section4 transition');
      setTimeout(()=> { 
        btn.textContent = orig; 
        btn.style.background = ''; 
        
        // Apr√®s 500ms suppl√©mentaires, ouvrir section 4
        setTimeout(() => {
          console.log('[ORT] Transitioning to section4');
          if(window.ORT_collapseSection && window.ORT_expandSection) {
            console.log('[ORT] ORT functions available, collapsing section3');
            window.ORT_collapseSection('section3Container');
            setTimeout(() => {
              console.log('[ORT] Expanding section4');
              window.ORT_expandSection('section4Container');
            }, 350);
          } else {
            console.log('[ORT] ORT functions NOT available!');
          }
        }, 500);
      }, 2000);
    });
  });
}

const btnClear = $('#btn-clear');
if(btnClear) {
  btnClear.addEventListener('click', ()=>{
    $('#src').value='';
    $('#prompt').textContent='';
    $('#json-return').value='';
    const h1 = $('#hint1');
    if(h1) {
      h1.textContent='';
      h1.style.color='';
      h1.style.fontWeight='';
    }
    $('#json-status').style.display='none';
    $('#json-info').style.display='none';
  });
}
const btnClearPrompt = $('#btn-clear-prompt');
if(btnClearPrompt) {
  btnClearPrompt.addEventListener('click', ()=>{ $('#prompt').textContent=''; });
}

const btnClearJson = $('#btn-clear-json');
if(btnClearJson) {
  btnClearJson.addEventListener('click', ()=>{
    $('#json-return').value='';
    $('#json-status').style.display='none';
    $('#json-info').style.display='none';
  });
}

// Validation JSON (inchang√©)
$('#btn-validate-json').addEventListener('click', ()=>{
  const lang = document.documentElement.lang || 'fr';
  const t = I18N[lang]||I18N.fr;
  const raw = $('#json-return').value.trim();
  const st = $('#json-status');
  const info = $('#json-info');
  const btn = $('#btn-validate-json');

  if(!raw){
    st.className='status err';
    st.textContent=t.needRet;
    st.style.display='block';
    info.style.display='none';
    return;
  }

  btn.disabled = true;
  btn.innerHTML = t.validating + '<span class="loader"></span>';
  st.style.display='none';
  info.style.display='none';

  setTimeout(() => {
    let data; let repaired = false;
    try{
let cleaned = raw;
if(raw.includes('```')){
  cleaned = raw.replace(/```json\s*/gi,'').replace(/```\s*/g,'').trim();
}
cleaned = cleaned
  .replace(/[""]/g, '"')
  .replace(/['']/g, "'")
  .replace(/[‚Äî‚Äì]/g, '-')
  .replace(/\u00A0/g, ' ')
  .normalize('NFC');
      data = JSON.parse(cleaned);
    }catch(e){
      info.textContent = t.autoRepairAttempt;
      info.style.display = 'block';
      try{
        const repairedText = tryRepairJSON(raw);
        data = JSON.parse(repairedText);
        repaired = true;
        $('#json-return').value = JSON.stringify(data, null, 2);
        info.textContent = t.repairSuccess;
      }catch(e2){
        st.className='status err';
        st.textContent=t.jsonUnrepairable.replace('{error}', e2.message);
        st.style.display='block';
        info.style.display='none';
        btn.disabled = false;
        btn.textContent = t.btnValidateJson;
        return;
      }
    }

    // Auto-correction namespace (v2.3)
    const correctionResult = autoCorrectNamespace(data);
    data = correctionResult.data;
    if(correctionResult.corrections.length > 0) {
      $('#json-return').value = JSON.stringify(data, null, 2);
      info.innerHTML = '‚úÖ Corrections: ' + correctionResult.corrections.map(c => '<br>‚Ä¢ ' + c).join('');
      info.style.display = 'block';
    }

    const validation = validateItinStructure(data);
    if(!validation.valid){
      st.className='status err';
      st.textContent= validation.errors.join('; ');
      st.style.display='block';
      info.style.display='none';
      btn.disabled = false;
      btn.textContent = t.btnValidateJson;
      return;
    }

    const itins = data;
    const itin = data.itins[0];
    const title = itin.title || 'roadtrip';
    const country = itin.itin_id ? itin.itin_id.split('::')[0] : 'XX';

    if(!repaired) {
      info.textContent = t.jsonValid.replace('{count}', data.itins.length);
      info.style.display = 'block';
    }

    const places = generatePlacesFromItin(itins);

    function cleanJSON(obj) {
      let str = JSON.stringify(obj);
      str = str.replace(/[""]/g, '"');
      str = str.replace(/['']/g, "'");
      str = str.replace(/≈ì/g, 'oe');
      str = str.replace(/≈í/g, 'OE');
      str = str.normalize('NFC');
      return JSON.parse(str);
    }

    const key = `${country}_${slugify(title)}_${Date.now()}`;

    try{
      const cleanedItins = cleanJSON(itins);
      const cleanedPlaces = cleanJSON(places);
      localStorage.setItem(`ORT_TEMP_TRIP_${key}_itins`, JSON.stringify(cleanedItins));
      localStorage.setItem(`ORT_TEMP_TRIP_${key}_places`, JSON.stringify(cleanedPlaces));

      (async function saveToIndexedDB() {
        try {
          const firstItinId = (itins?.itins?.[0]?.itin_id) || '';
          const cc = (firstItinId.split('::')[0] || '').toUpperCase();
          if (!cc || cc === 'XX') { console.warn('‚ö†Ô∏è Code pays invalide:', cc); return; }
          const Cc = cc.charAt(0) + cc.slice(1).toLowerCase();
          const seqKey = `ORT_ADD_SEQ_${cc}`;
          let seq = (parseInt(localStorage.getItem(seqKey) || '0', 10) || 0) + 1;
          localStorage.setItem(seqKey, String(seq));
          const fname = `${Cc}.add.${seq}.json`;
          if (navigator.storage?.estimate) {
            const estimate = await navigator.storage.estimate();
            const availableMB = (estimate.quota - estimate.usage) / 1024 / 1024;
            console.log(`üíæ Espace: ${availableMB.toFixed(2)} MB disponible`);
          }
          return new Promise((resolve, reject) => {
            const request = indexedDB.open('ORT_CACHE', 2);
            request.onerror = () => { reject(request.error); };
            request.onupgradeneeded = (e) => {
              const db = e.target.result;
              if (db.objectStoreNames.contains('itineraries')) { db.deleteObjectStore('itineraries'); }
              db.createObjectStore('itineraries', { keyPath: 'id' });
            };
            request.onsuccess = (e) => {
              const db = e.target.result;
              try {
                const transaction = db.transaction(['itineraries'], 'readwrite');
                const store = transaction.objectStore('itineraries');
                const payload = {
                  id: `${cc}/${fname}`,
                  country: cc,
                  filename: fname,
                  timestamp: Date.now(),
                  itins: itins?.itins || [],
                  places: places?.places || []
                };
                const putRequest = store.put(payload);
                putRequest.onsuccess = () => { resolve(true); };
                putRequest.onerror = () => { reject(putRequest.error); };
                transaction.oncomplete = () => { db.close(); };
                transaction.onerror = () => { db.close(); reject(transaction.error); };
              } catch (err) { db.close(); reject(err); }
            };
          });
        } catch (e) { console.error('‚ùå Erreur IndexedDB:', e); }
      })();

    }catch(e){
      console.error('Storage error:', e);
      st.className='status err';
      st.textContent='Erreur de stockage local. Donn√©es trop volumineuses ?';
      st.style.display='block';
      btn.disabled = false;
      btn.textContent = t.btnValidateJson;
      return;
    }

    st.className='status ok';
    st.textContent = t.okSaved;
    st.style.display='block';
    
    // Stocker la cl√© pour la redirection apr√®s config
    window.__pendingTripKey = key;
    
    // Afficher la modale de configuration
    const configModal = document.getElementById('configTripModal');
    if(configModal){
      // Initialiser la date √† aujourd'hui
      const today = new Date().toISOString().split('T')[0];
      const startDateInput = document.getElementById('cfgStartDate');
      if(startDateInput) startDateInput.value = today;
      
      // Initialiser le nombre de jours avec estimated_days_base
      const nbDaysInput = document.getElementById('cfgNbDays');
      if(nbDaysInput && itin.estimated_days_base) {
        nbDaysInput.value = Math.round(itin.estimated_days_base);
      }
      
      configModal.style.display = 'flex';
    }
  }, 200);
});

// === Gestion de la modale de configuration voyage ===
(function(){
  const configModal = document.getElementById('configTripModal');
  const btnCancel = document.getElementById('btnCancelConfig');
  const btnValidate = document.getElementById('btnValidateConfig');
  
  if(!configModal) return;
  
  // Annuler - fermer la modale
  if(btnCancel){
    btnCancel.addEventListener('click', ()=>{
      configModal.style.display = 'none';
    });
  }
  
  // Valider - r√©cup√©rer les valeurs et rediriger
  if(btnValidate){
    btnValidate.addEventListener('click', ()=>{
      const key = window.__pendingTripKey;
      if(!key) return;
      
      const departDate = document.getElementById('cfgStartDate')?.value || '';
      const days = document.getElementById('cfgNbDays')?.value || '7';
      
      // R√©cup√©rer l'itin√©raire stock√© pour v√©rifier les themes
      const pendingKey = window.__pendingTripKey;
      const itinsStr = localStorage.getItem(`ORT_TEMP_TRIP_${pendingKey}_itins`);
      const itinsData = itinsStr ? JSON.parse(itinsStr) : null;
      const itin = itinsData?.itins?.[0];
      const isCreator = itin?.themes?.includes('creator');
      
      if(isCreator) {
        // Redirection CREATOR via sessionStorage
        sessionStorage.setItem('ortCurrentItinerary', JSON.stringify(itin));
        window.location.href = `./roadtrip_detail_simple.html?from=import`;
      } else {
        // Redirection EXPERT (comportement actuel)
        // G√©n√©rer un tripId coh√©rent
        const tripId = `custom::${key}`;
        
        // Stocker dans ORT_TRIPID et localStorage
        if (window.ORT_TRIPID) {
          window.ORT_TRIPID.store(tripId);
        } else {
          localStorage.setItem('ORT_CURRENT_TRIP_ID', tripId);
        }
        
        // Construire l'URL avec tous les param√®tres
        const params = new URLSearchParams({
          from: 'temp',
          rtKey: key,
          tripId: tripId,
          departDate: departDate,
          days: days
        });
        
        // D√©tecter mobile et rediriger directement vers roadtrip_mobile
        const isMobile = /Android|iPhone|iPad|iPod|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const targetPage = (isMobile && window.innerWidth < 900) ? 'roadtrip_mobile.html' : 'roadtrip_detail.html';
        
        window.location.href = `./${targetPage}?${params.toString()}`;
      }
    });
  }
  
  // Fermer si clic en dehors
  configModal.addEventListener('click', (e)=>{
    if(e.target === configModal) configModal.style.display = 'none';
  });
})();

// === Header Auth popup + Firebase (identique, conserv√©)
(function(){
  const $id = (id)=>document.getElementById(id);
  const btnOpen = $id('openAuth'), pop = $id('authPop');
  const btnGoogle = $id('btnGoogle'), btnEmail = $id('btnEmail'), btnLogout = $id('btnLogout');
  if(!btnOpen || !pop) return;

  const toggle = () => { pop.style.display = (pop.style.display==='none'||!pop.style.display) ? 'block' : 'none'; };
  const hide   = (e) => { if(!pop.contains(e.target) && e.target !== btnOpen) pop.style.display = 'none'; };
  btnOpen.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(); });
  document.addEventListener('click', hide);
  pop.addEventListener('click', e => e.stopPropagation());

  function loadScript(src){
    return new Promise((ok,ko)=>{
      const s=document.createElement('script');
      s.src=src; s.onload=ok; s.onerror=()=>ko(new Error('load '+src));
      document.head.appendChild(s);
    });
  }
  async function ensureFirebase(){
    if(window.firebase?.apps?.length) return window.firebase;
    await loadScript('https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js');
    await loadScript('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js');
    window.firebase.initializeApp(window.__FIREBASE_CONFIG__ || {});
    await window.firebase.auth().setPersistence(window.firebase.auth.Auth.Persistence.LOCAL);
    return window.firebase;
  }

  function setHeaderLabel(user){
    const lang = localStorage.getItem('lang') || document.documentElement.lang || 'fr';
    const LABELS = {
      fr:{signin:'Se connecter',  account:'Mon compte'},
      en:{signin:'Sign in',        account:'My account'},
      it:{signin:'Accedi',         account:'Il mio account'},
      es:{signin:'Iniciar sesi√≥n', account:'Mi cuenta'},
      pt:{signin:'Iniciar sess√£o', account:'Minha conta'},
      ar:{signin:'ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ',   account:'ÿ≠ÿ≥ÿßÿ®Ÿä'}
    };
    const LBL = LABELS[lang] || LABELS.fr;
    if(user){
      btnOpen.textContent = user.displayName || user.email || LBL.account;
      const ul = document.getElementById('userLine');
      const nm = document.getElementById('meName');
      const em = document.getElementById('meEmail');
      if(ul){ ul.style.display='block'; }
      if(nm){ nm.textContent = user.displayName || ''; }
      if(em){ em.textContent = user.email || ''; }
      btnLogout.style.display=''; btnGoogle.style.display='none'; btnEmail.style.display='none';
    }else{
      btnOpen.textContent = LBL.signin;
      const ul = document.getElementById('userLine');
      if(ul){ ul.style.display='none'; }
      btnLogout.style.display='none'; btnGoogle.style.display=''; btnEmail.style.display='';
    }
  }
  window.__refreshAuthLabel = function(){ try{ const u = (window.firebase && window.firebase.auth && window.firebase.auth().currentUser) || null; setHeaderLabel(u); }catch{ setHeaderLabel(null); } };

  if(btnGoogle){
    btnGoogle.addEventListener('click', async()=>{
      try{
        const fb = await ensureFirebase();
        await fb.auth().signInWithPopup(new fb.auth.GoogleAuthProvider());
        pop.style.display='none';
      }catch(_){}
    });
  }
  if(btnEmail){
    btnEmail.addEventListener('click', ()=>{
      pop.style.display = 'none';
      const m = document.getElementById('emailModal');
      if(m){
        m.style.display = 'flex';
        const inp = document.getElementById('emailInput');
        if(inp) inp.focus();
      }
    });
  }
  if(btnLogout){
    btnLogout.addEventListener('click', async()=>{
      try{ const fb=await ensureFirebase(); await fb.auth().signOut(); }catch(_){}
    });
  }
  ensureFirebase().then(fb=>{ fb.auth().onAuthStateChanged((user)=>{ setHeaderLabel(user); checkModelOptionVisibility(user); }); }).catch(()=>{ setHeaderLabel(null); checkModelOptionVisibility(null); });

  // Fonction pour afficher/masquer les options admin
  function checkModelOptionVisibility(user){
    const adminOptionsGrid = document.getElementById('adminOptionsGrid');
    const userModeInfo = document.getElementById('userModeInfo');
    const adminRTViewer = document.getElementById('adminRTViewer');
    
    console.log('[ORT] checkModelOptionVisibility called, user:', user ? user.email : 'null');
    
    if(user && user.email === 'marcsorci@free.fr'){
      console.log('[ORT] Admin detected - showing admin options');
      // Activer le mode admin - afficher les 4 options
      if(adminOptionsGrid) adminOptionsGrid.style.display = '';
      if(userModeInfo) userModeInfo.style.display = 'none';
      if(adminRTViewer) adminRTViewer.style.display = '';
      // Activer le script de gestion des options
      if(window.initAdminOptions) window.initAdminOptions();
      // Initialiser le viewer RT
      if(window.initAdminRTViewer) window.initAdminRTViewer();
    } else {
      // Mode utilisateur normal
      if(adminOptionsGrid) adminOptionsGrid.style.display = 'none';
      if(userModeInfo) userModeInfo.style.display = '';
      if(adminRTViewer) adminRTViewer.style.display = 'none';
    }
  }

  const modal = document.getElementById('emailModal');
  const emailInput = document.getElementById('emailInput');
  const pwdInput   = document.getElementById('pwdInput');
  const pwd2Wrap   = document.getElementById('pwd2Wrap');
  const pwd2Input  = document.getElementById('pwd2Input');
  const emailAlert = document.getElementById('emailAlert');
  const btnDo      = document.getElementById('btnDoEmail');
  const btnCancel  = document.getElementById('btnCancelEmail');
  const btnForgot  = document.getElementById('btnForgot');
  const btnSignup  = document.getElementById('btnSignup');
  const togglePwd  = document.getElementById('togglePwd');

  let mode = 'login';

  function showAlert(kind, msg){
    if(!emailAlert) return;
    emailAlert.className = 'alert ' + (kind==='ok' ? 'alert-success' : 'alert-error');
    emailAlert.textContent = msg;
    emailAlert.style.display = 'block';
  }
  function clearAlert(){ if(emailAlert){ emailAlert.style.display='none'; emailAlert.textContent=''; } }

  function setMode(next){
    mode = next; clearAlert();
    if(next === 'signup'){
      pwd2Wrap.style.display = '';
      btnDo.textContent = 'Cr√©er mon compte';
      btnSignup.textContent = 'J‚Äôai d√©j√† un compte';
    }else{
      pwd2Wrap.style.display = 'none';
      btnDo.textContent = 'Continuer';
      btnSignup.textContent = 'Cr√©er un compte';
    }
  }
  setMode('login');

  function closeModal(){ if(modal) modal.style.display='none'; }
  btnCancel?.addEventListener('click', closeModal);
  modal?.addEventListener('click', (e)=>{ if(e.target === modal) closeModal(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && modal?.style.display==='flex') closeModal(); });
  togglePwd?.addEventListener('click', ()=>{ const t = pwdInput?.getAttribute('type') === 'password' ? 'text' : 'password'; pwdInput?.setAttribute('type', t); });
  btnSignup?.addEventListener('click', ()=>{ setMode(mode === 'signup' ? 'login' : 'signup'); });
  btnForgot?.addEventListener('click', async ()=>{
    clearAlert();
    try{
      const fb = await __ensureFirebase__();
      const email = (emailInput?.value||'').trim();
      if(!email){ showAlert('err','Saisissez votre e-mail.'); return; }
      await fb.auth().sendPasswordResetEmail(email);
      showAlert('ok','E-mail de r√©initialisation envoy√©.');
    }catch(e){ showAlert('err', e?.message || '√âchec de l‚Äôenvoi.'); }
  });
  btnDo?.addEventListener('click', async ()=>{
    clearAlert();
    const email = (emailInput?.value||'').trim();
    const pwd   = (pwdInput?.value||'').trim();
    const pwd2  = (pwd2Input?.value||'').trim();
    if(!email || !pwd){ showAlert('err','E-mail et mot de passe requis.'); return; }
    if(mode==='signup' && pwd!==pwd2){ showAlert('err','Les mots de passe ne correspondent pas.'); return; }
    try{
      const fb = await __ensureFirebase__();
      if(mode==='signup'){
        const cred = await fb.auth().createUserWithEmailAndPassword(email, pwd);
        try{ await cred.user.sendEmailVerification(); }catch(_){}
        await fb.auth().signOut();
        showAlert('ok','Compte cr√©√©. V√©rifiez votre e-mail puis reconnectez-vous.');
      }else{
        await fb.auth().signInWithEmailAndPassword(email, pwd);
        closeModal(); pop.style.display='none';
      }
    }catch(e){ showAlert('err', e?.message || 'Erreur d‚Äôauthentification.'); }
  });
})();

// === ADMIN RT VIEWER - Navigation et export des itin√©raires ===
window.initAdminRTViewer = function() {
  console.log('[ADMIN RT] Initializing RT Viewer...');
  
  let allItins = [];
  let currentIndex = 0;
  let sourceFileName = '';
  
  const fileInput = document.getElementById('adminRTFile');
  const urlInput = document.getElementById('adminRTUrl');
  const loadUrlBtn = document.getElementById('adminLoadUrl');
  const statusDiv = document.getElementById('adminRTStatus');
  const navCard = document.getElementById('adminRTNavCard');
  const prevBtn = document.getElementById('adminPrevRT');
  const nextBtn = document.getElementById('adminNextRT');
  const counterDiv = document.getElementById('adminRTCounter');
  const titleDiv = document.getElementById('adminRTTitle');
  const metaDiv = document.getElementById('adminRTMeta');
  const previewDiv = document.getElementById('adminRTPreview');
  const exportPromptBtn = document.getElementById('adminExportPrompt');
  const copyJSONBtn = document.getElementById('adminCopyJSON');
  const openRTBtn = document.getElementById('adminOpenRT');
  const promptCard = document.getElementById('adminPromptCard');
  const promptOutput = document.getElementById('adminPromptOutput');
  const copyPromptBtn = document.getElementById('adminCopyPrompt');
  const closePromptBtn = document.getElementById('adminClosePrompt');
  
  function showStatus(msg, type) {
    statusDiv.style.display = 'block';
    statusDiv.textContent = msg;
    statusDiv.style.background = type === 'ok' ? '#f0fdf4' : type === 'err' ? '#fef2f2' : '#fef3c7';
    statusDiv.style.color = type === 'ok' ? '#166534' : type === 'err' ? '#dc2626' : '#92400e';
    statusDiv.style.border = `1px solid ${type === 'ok' ? '#bbf7d0' : type === 'err' ? '#fecaca' : '#fde047'}`;
  }
  
  function loadItins(data, filename) {
    try {
      const parsed = typeof data === 'string' ? JSON.parse(data) : data;
      
      // Supporter diff√©rents formats de fichiers
      if (parsed.itineraries && Array.isArray(parsed.itineraries)) {
        allItins = parsed.itineraries;
      } else if (parsed.itins && Array.isArray(parsed.itins)) {
        allItins = parsed.itins;
      } else if (parsed.modules && Array.isArray(parsed.modules)) {
        allItins = parsed.modules;
      } else if (Array.isArray(parsed)) {
        allItins = parsed;
      } else {
        // Chercher la premi√®re cl√© qui contient un array
        const keys = Object.keys(parsed);
        for (const key of keys) {
          if (Array.isArray(parsed[key]) && parsed[key].length > 0) {
            allItins = parsed[key];
            console.log('[ADMIN RT] Found array in key:', key);
            break;
          }
        }
      }
      
      sourceFileName = filename;
      currentIndex = 0;
      
      if (!allItins || allItins.length === 0) {
        showStatus('‚ùå Aucun itin√©raire trouv√©. Structure: ' + Object.keys(parsed).join(', '), 'err');
        navCard.style.display = 'none';
        return;
      }
      
      showStatus(`‚úÖ ${allItins.length} itin√©raire(s) charg√©(s) depuis ${filename}`, 'ok');
      navCard.style.display = '';
      renderCurrent();
    } catch (e) {
      showStatus('‚ùå Erreur de parsing JSON: ' + e.message, 'err');
      navCard.style.display = 'none';
    }
  }
  
  function renderCurrent() {
    if (allItins.length === 0) return;
    
    const itin = allItins[currentIndex];
    counterDiv.textContent = `${currentIndex + 1} / ${allItins.length}`;
    titleDiv.textContent = itin.title || itin.name || itin.itin_id || itin.module_id || '(sans titre)';
    
    // Supporter days_plan (itins) ou steps (modules) ou places
    const daysData = itin.days_plan || itin.steps || itin.places || [];
    const days = daysData.length || 0;
    const totalVisits = daysData.reduce((sum, d) => sum + (d.visits?.length || 0), 0) || 0;
    const totalActs = daysData.reduce((sum, d) => sum + (d.activities?.length || 0), 0) || 0;
    const id = itin.itin_id || itin.module_id || itin.id || '?';
    metaDiv.textContent = `${id} ‚Ä¢ ${days} jour(s)/√©tape(s) ‚Ä¢ ${totalVisits} visites ‚Ä¢ ${totalActs} activit√©s`;
    
    // Aper√ßu des jours/√©tapes
    let previewHTML = '';
    if (daysData.length > 0) {
      daysData.forEach((day, i) => {
        const nightPlace = day.night?.place_id || day.place_id || day.name || '?';
        const visitsCount = day.visits?.length || 0;
        const actsCount = day.activities?.length || 0;
        const dayNum = day.day || (i + 1);
        const sugDays = day.suggested_days || day.nights || '?';
        
        previewHTML += `<div style="margin-bottom:8px;padding:8px;background:#fff;border-radius:6px;border-left:3px solid #113f7a">
          <strong>Jour/√âtape ${dayNum}</strong> ‚Äî ${nightPlace} (${sugDays}j)
          <div style="font-size:12px;color:#64748b;margin-top:4px">
            ${visitsCount} visite(s): ${(day.visits || []).slice(0,2).map(v => (v.text || v.name || '').slice(0,50) + '...').join(' | ') || '‚Äî'}
          </div>
          <div style="font-size:12px;color:#64748b">
            ${actsCount} activit√©(s): ${(day.activities || []).slice(0,2).map(a => (a.text || a.name || '').slice(0,50) + '...').join(' | ') || '‚Äî'}
          </div>
        </div>`;
      });
    } else {
      previewHTML = '<em style="color:#94a3b8">Pas de days_plan/steps</em>';
    }
    previewDiv.innerHTML = previewHTML;
    
    // Activer/d√©sactiver les boutons
    prevBtn.disabled = currentIndex === 0;
    nextBtn.disabled = currentIndex >= allItins.length - 1;
  }
  
  // Event listeners
  fileInput?.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => loadItins(ev.target.result, file.name);
    reader.onerror = () => showStatus('Erreur de lecture du fichier', 'err');
    reader.readAsText(file);
  });
  
  loadUrlBtn?.addEventListener('click', async () => {
    const url = urlInput.value.trim();
    if (!url) { showStatus('Entrez une URL', 'warn'); return; }
    showStatus('Chargement...', 'warn');
    try {
      const resp = await fetch(url);
      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();
      loadItins(data, url.split('/').pop());
    } catch (e) {
      showStatus('‚ùå Erreur: ' + e.message, 'err');
    }
  });
  
  prevBtn?.addEventListener('click', () => {
    if (currentIndex > 0) { currentIndex--; renderCurrent(); }
  });
  
  nextBtn?.addEventListener('click', () => {
    if (currentIndex < allItins.length - 1) { currentIndex++; renderCurrent(); }
  });
  
  copyJSONBtn?.addEventListener('click', () => {
    if (allItins.length === 0) return;
    const json = JSON.stringify({ itins: [allItins[currentIndex]] }, null, 2);
    navigator.clipboard.writeText(json).then(() => {
      copyJSONBtn.textContent = '‚úÖ Copi√© !';
      setTimeout(() => copyJSONBtn.textContent = 'üìã Copier JSON brut', 1500);
    });
  });
  
  openRTBtn?.addEventListener('click', () => {
    if (allItins.length === 0) return;
    const itin = allItins[currentIndex];
    const cc = itin.itin_id?.split('::')[0] || 'XX';
    const itinId = itin.itin_id || '';
    window.open(`./roadtrip_detail.html?cc=${cc}&itin=${encodeURIComponent(itinId)}`, '_blank');
  });
  
  exportPromptBtn?.addEventListener('click', () => {
    if (allItins.length === 0) return;
    const itin = allItins[currentIndex];
    
    const prompt = generateRewritePrompt(itin);
    promptOutput.value = prompt;
    promptCard.style.display = '';
  });
  
  copyPromptBtn?.addEventListener('click', () => {
    navigator.clipboard.writeText(promptOutput.value).then(() => {
      copyPromptBtn.textContent = '‚úÖ Copi√© !';
      setTimeout(() => copyPromptBtn.textContent = 'üìã Copier le prompt', 1500);
    });
  });
  
  closePromptBtn?.addEventListener('click', () => {
    promptCard.style.display = 'none';
  });
  
  // === Gestion suppression autres langues ===
  const deleteOtherLangsCheckbox = document.getElementById('adminDeleteOtherLangs');
  const deleteLangsBtn = document.getElementById('adminDeleteLangsBtn');
  const deleteStatus = document.getElementById('adminDeleteStatus');
  
  deleteOtherLangsCheckbox?.addEventListener('change', () => {
    if (deleteLangsBtn) {
      deleteLangsBtn.style.display = deleteOtherLangsCheckbox.checked ? '' : 'none';
    }
  });
  
  deleteLangsBtn?.addEventListener('click', async () => {
    if (allItins.length === 0) {
      showDeleteStatus('‚ùå Aucun itin√©raire charg√©', 'err');
      return;
    }
    
    const itin = allItins[currentIndex];
    const itinId = itin.itin_id || itin.id;
    const cc = itinId?.split('::')[0] || itin.country || 'XX';
    
    if (!itinId) {
      showDeleteStatus('‚ùå Pas d\'itin_id trouv√©', 'err');
      return;
    }
    
    const confirmMsg = `Supprimer les versions EN, ES, IT, PT, AR de:\n\n"${itin.title}"\n(${itinId})\n\nLa version FR sera conserv√©e.`;
    if (!confirm(confirmMsg)) return;
    
    deleteLangsBtn.disabled = true;
    deleteLangsBtn.textContent = '‚è≥ Suppression...';
    showDeleteStatus('‚è≥ Suppression en cours...', 'warn');
    
    try {
      const resp = await fetch('http://localhost:8030/api/delete-itinerary', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          country: cc.toUpperCase(), 
          itinId: itinId,
          languages: ['en', 'es', 'it', 'pt', 'ar'],
          confirmedBy: 'marcsorci@free.fr'
        })
      });
      
      const result = await resp.json();
      
      if (result.success) {
        showDeleteStatus(`‚úÖ Supprim√© de: ${result.deletedFrom || 'fichiers autres langues'}`, 'ok');
      } else {
        showDeleteStatus(`‚ùå Erreur: ${result.error || '√âchec'}`, 'err');
      }
    } catch(err) {
      showDeleteStatus(`‚ùå Serveur non accessible (localhost:8030): ${err.message}`, 'err');
    } finally {
      deleteLangsBtn.disabled = false;
      deleteLangsBtn.textContent = 'üóëÔ∏è Supprimer maintenant les autres langues';
    }
  });
  
  function showDeleteStatus(msg, type) {
    if (!deleteStatus) return;
    deleteStatus.style.display = 'block';
    deleteStatus.textContent = msg;
    deleteStatus.style.background = type === 'ok' ? '#f0fdf4' : type === 'err' ? '#fef2f2' : '#fef3c7';
    deleteStatus.style.color = type === 'ok' ? '#166534' : type === 'err' ? '#dc2626' : '#92400e';
    deleteStatus.style.border = `1px solid ${type === 'ok' ? '#bbf7d0' : type === 'err' ? '#fecaca' : '#fde047'}`;
  }
  
  function generateRewritePrompt(itin) {
    const hasPC = !!itin.practical_context;
    
    // Extraire les segments ou cr√©er des segments automatiques
    const segments = itin.segments || [];
    
    // Si pas de segments d√©finis, cr√©er des segments de 3 jours max
    const autoSegments = [];
    if (segments.length === 0 && itin.days_plan) {
      for (let i = 0; i < itin.days_plan.length; i += 3) {
        const fromDay = itin.days_plan[i].day;
        const toDay = Math.min(itin.days_plan[Math.min(i + 2, itin.days_plan.length - 1)].day, itin.days_plan[itin.days_plan.length - 1].day);
        autoSegments.push({
          from_day: fromDay,
          to_day: toDay,
          days: itin.days_plan.slice(i, Math.min(i + 3, itin.days_plan.length))
        });
      }
    }
    
    const workingSegments = segments.length > 0 ? segments : autoSegments;
    
    return `Tu es un expert en cr√©ation d'itin√©raires de voyage. Je vais te fournir un JSON existant que tu dois r√©√©crire et enrichir PAR SEGMENTS.

üéØ OBJECTIF : R√©√©crire ET enrichir cet itin√©raire SEGMENT PAR SEGMENT avec des informations V√âRIFI√âES.

üìã JSON COMPLET √Ä AM√âLIORER :
\`\`\`json
${JSON.stringify({ itins: [itin] }, null, 2)}
\`\`\`

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üì¶ APPROCHE PAR SEGMENTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Cet itin√©raire sera trait√© en ${workingSegments.length} segments :

${workingSegments.map((seg, i) => `
SEGMENT ${i + 1} : Jours ${seg.from_day} √† ${seg.to_day}
${itin.days_plan.filter(d => d.day >= seg.from_day && d.day <= seg.to_day).map(d => `  ‚Ä¢ Jour ${d.day} : ${d.night.place_id}`).join('\n')}
`).join('\n')}

‚ö†Ô∏è PROC√âDURE IMPORTANTE :
1Ô∏è‚É£ Commence par le SEGMENT 1 UNIQUEMENT
2Ô∏è‚É£ Recherche web SEULEMENT pour les lieux du Segment 1
3Ô∏è‚É£ R√©dige le JSON complet pour le Segment 1
4Ô∏è‚É£ Passe au Segment 2, puis 3, etc.
5Ô∏è‚É£ √Ä LA FIN, fusionne tous les segments en UN SEUL JSON final

üö® NE RECHERCHE PAS TOUS LES LIEUX D'UN COUP - Traite segment par segment !

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üîç RECHERCHE WEB PAR SEGMENT
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
Pour CHAQUE segment, recherche UNIQUEMENT les lieux de CE segment.

${workingSegments.map((seg, i) => `
**SEGMENT ${i + 1} - Lieux √† rechercher POUR CE SEGMENT :**
${[...new Set(itin.days_plan.filter(d => d.day >= seg.from_day && d.day <= seg.to_day).map(d => d.night.place_id))].map(p => `- ${p}`).join('\n')}
`).join('\n')}

üéØ M√âTHODOLOGIE :
- **√âtape 1** : Recherche web pour le Segment 1 uniquement (${[...new Set(itin.days_plan.filter(d => d.day >= workingSegments[0].from_day && d.day <= workingSegments[0].to_day).map(d => d.night.place_id))].length} lieux)
- **√âtape 2** : R√©dige visits/activities pour le Segment 1
- **√âtape 3** : Passe au Segment 2 (ne recherche que ces nouveaux lieux)
- **√âtape 4** : Continue ainsi pour tous les segments
- **√âtape 5** : Fusionne tout en UN JSON final

Si tu manques d'infos sur un lieu ‚Üí DEMANDE √† l'user de fournir une source pour CE lieu
N'INVENTE RIEN

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úÖ √Ä CONSERVER TEL QUEL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- itin_id: "${itin.itin_id}"
- Tous les coords et place_id
- La structure days_plan (m√™mes jours, m√™me ordre)
- to_next_leg.distance_km et to_next_leg.drive_min

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
‚úçÔ∏è FORMAT ET STYLE (identique pour tous les segments)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

**VISITS (5-8 par jour) - EXEMPLES :**
\`\`\`json
"visits": [
  {"text": "Les toits du Vat Xieng Thong descendent jusqu'au sol. Ses mosa√Øques de verre rouge illustrent la vie du Bouddha."},
  {"text": "Montez les 328 marches du mont Phousi pour voir le M√©kong et la Nam Khan se rejoindre."},
  {"text": "Le Palais Royal expose le tr√¥ne et le Phra Bang, bouddha d'or qui a donn√© son nom √† la ville."}
]
\`\`\`

‚ö†Ô∏è **DISTINCTION VISITS vs ACTIVITIES (CRITIQUE) :**
- **visits[] = LIEUX √† voir** : monuments, temples, cath√©drales, mus√©es, sites arch√©ologiques, ch√¢teaux, grottes
  ‚Üí D√©crit CE QU'ON VOIT (architecture, histoire, collections)
- **activities[] = ACTIONS √† faire** : randonn√©es, kayak, v√©lo, plong√©e, cours de cuisine, march√©s, safaris, croisi√®res
  ‚Üí D√©crit CE QU'ON FAIT (exp√©riences, sports, activit√©s culturelles/gastronomiques)
- ‚ùå NE JAMAIS mettre un mus√©e, monument ou lieu dans activities
- ‚ùå NE JAMAIS r√©p√©ter le m√™me contenu dans visits et activities

**STYLE D'√âCRITURE - VARIER LES FORMES :**
- Informatif simple : "Les toits descendent jusqu'au sol. Ses mosa√Øques..."
- Imp√©ratif : "Rejoignez...", "Empruntez...", "Poussez la porte...", "Grimpez...", "Traversez..."
- Narratif : "Les moines tissent encore...", "Les fid√®les affluent..."
- Invitation : "Rendez-vous √† l'aube pour..."
- Question : "Envie de voir X ?"

‚ö†Ô∏è ALTERNER ces formes. Ne pas encha√Æner plus de 2 textes du m√™me style.
‚ö†Ô∏è PAS DE MOTS POMPEUX / IA : style simple avec d√©tails historiques CONCRETS

**ACTIVITIES (3-6 par jour) - EXEMPLES :**
\`\`\`json
"activities": [
  {"text": "Levez-vous √† l'aube pour le tak bat : les moines passent en silence.", "practical_info": {"best_time": "5h30-6h30", "tip": "Restez discret"}},
  {"text": "Le march√© de nuit s'installe d√®s 17h. Textiles, artisanat et lanternes."}
]
\`\`\`

**PRACTICAL_INFO selon type d'activit√© :**
\`\`\`json
// Randonn√©e
"practical_info": {
  "distance": "10 km",
  "duration": "~4h",
  "difficulty": "Mod√©r√©"
}

// Visite guid√©e
"practical_info": {
  "duration": "2h",
  "booking": "R√©servation conseill√©e"
}
\`\`\`

**PRACTICAL_CONTEXT ${hasPC ? '(existe, am√©liorer si besoin)' : '‚ùå MANQUANT ‚Üí CR√âER'} :**
\`\`\`json
"practical_context": {
  "best_months": ["mai", "juin", "septembre", "octobre"],
  "highlights": [
    "Point fort 1 (lieu embl√©matique)",
    "Point fort 2 (exp√©rience unique)",
    "Point fort 3",
    "Point fort 4"
  ]
}
\`\`\`

**TO_NEXT_LEG :**
- Ajouter "road_type" UNIQUEMENT si la route N'EST PAS du goudron classique
- Exemples : "Gravel" / "Piste" / "Route de montagne non goudronn√©e" / "Goudron puis gravel"
- Si route goudronn√©e normale ‚Üí ne pas ajouter road_type

**MAP_KEYWORDS ‚ö†Ô∏è OBLIGATOIRE :**
\`\`\`json
"night": {
  "place_id": "FR::strasbourg",
  "coords": [48.5734, 7.7521],
  "map_keywords": [
    "Cath√©drale Notre-Dame Strasbourg",
    "Petite France Strasbourg",
    "Palais Rohan Strasbourg",
    "Mus√©e Alsacien Strasbourg",
    "Ponts Couverts Strasbourg"
  ]
}
\`\`\`
- Reprendre TOUTES les visits principales du jour
- Format: "Nom exact du lieu + Ville"
- Ordre LOGIQUE de visite (circuit coh√©rent)
- 5-8 keywords par jour
- Doivent √™tre recherchables sur Google Maps

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üö´ NEUTRALISATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
- Pas de commerces nomm√©s ‚Üí "Les loueurs proposent..."
- Pas de personnes nomm√©es
- Pas de prix
- Pas de dates r√©centes
- "√† moto" ‚Üí "par la route"

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéØ R√âSULTAT ATTENDU
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
1. JSON final complet { "itins": [...] } avec TOUS les segments fusionn√©s
2. Liste de tes SOURCES par segment :

**SOURCES PAR SEGMENT :**
- Segment 1 (Jours ${workingSegments[0]?.from_day}-${workingSegments[0]?.to_day}) : URL1, URL2...
- Segment 2 (Jours ${workingSegments[1]?.from_day}-${workingSegments[1]?.to_day}) : URL1, URL2...
etc.

Le JSON final doit remplacer directement l'ancien dans ${sourceFileName || 'le fichier source'}.

Si tu manques d'informations pour un lieu, √©cris :
"‚ö†Ô∏è INFORMATIONS INSUFFISANTES pour [nom du lieu] - veuillez fournir une source"`;
  }
  
  console.log('[ADMIN RT] ‚úÖ RT Viewer initialized');
};

// Auto-init si admin d√©j√† d√©tect√©
if (document.getElementById('adminRTViewer')?.style.display !== 'none') {
  window.initAdminRTViewer?.();
}
</script>
</body>
</html>