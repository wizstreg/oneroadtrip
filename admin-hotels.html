<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>ORT Admin - S√©lection H√¥tels</title>
<style>
body { font-family: system-ui; padding: 20px; max-width: 1800px; margin: 0 auto; background: #f8fafc; }
h1 { color: #0f172a; margin: 0; }
.header { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

/* Stats */
.stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 15px 0; }
.stat-card { background: #eff6ff; padding: 15px; border-radius: 8px; border: 1px solid #bfdbfe; }
.stat-card h3 { margin: 0 0 5px; color: #1e40af; font-size: 14px; }
.stat-card .value { font-size: 24px; font-weight: bold; color: #0f172a; }

/* Layout */
.main-layout { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
.places-panel { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; max-height: calc(100vh - 200px); overflow-y: auto; }
.hotels-panel { background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; }

/* Places list */
.filter-bar { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
.filter-bar input, .filter-bar select { padding: 8px 12px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; }
.filter-bar input { flex: 1; min-width: 150px; }

.place-item { padding: 12px; border: 1px solid #e2e8f0; border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s; }
.place-item:hover { border-color: #2563eb; background: #f8fafc; }
.place-item.selected { border-color: #2563eb; background: #eff6ff; }
.place-item.done { border-left: 4px solid #10b981; }
.place-item.partial { border-left: 4px solid #f59e0b; }
.place-item .place-name { font-weight: 600; color: #1e293b; }
.place-item .place-meta { font-size: 12px; color: #64748b; margin-top: 4px; }
.place-item .hotel-count { display: inline-block; background: #dbeafe; color: #1e40af; padding: 2px 8px; border-radius: 10px; font-size: 11px; margin-left: 8px; }
.place-item .selected-count { background: #d1fae5; color: #065f46; }

/* Hotels grid */
.hotels-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #e2e8f0; }
.hotels-header h2 { margin: 0; color: #1e293b; }
.hotels-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }

.hotel-card { background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; overflow: hidden; transition: all 0.2s; }
.hotel-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
.hotel-card.selected { border-color: #10b981; background: #f0fdf4; }
.hotel-card.selected .hotel-checkbox { background: #10b981; color: white; }

.hotel-image { width: 100%; height: 180px; object-fit: cover; background: #e2e8f0; }
.hotel-content { padding: 15px; }
.hotel-name { font-weight: 600; color: #1e293b; font-size: 16px; margin-bottom: 8px; }
.hotel-meta { display: flex; gap: 15px; margin-bottom: 10px; }
.hotel-score { background: #1e40af; color: white; padding: 4px 10px; border-radius: 6px; font-weight: bold; }
.hotel-reviews { color: #64748b; font-size: 13px; }
.hotel-price { color: #059669; font-weight: 600; }
.hotel-address { font-size: 12px; color: #64748b; margin-bottom: 10px; }

.hotel-actions { display: flex; gap: 8px; flex-wrap: wrap; }
.hotel-checkbox { padding: 8px 16px; border: 2px solid #cbd5e1; border-radius: 6px; background: white; cursor: pointer; font-size: 13px; transition: all 0.2s; }
.hotel-checkbox:hover { border-color: #10b981; }

/* Photo URL input */
.photo-section { margin-top: 12px; padding-top: 12px; border-top: 1px solid #e2e8f0; }
.photo-section label { font-size: 12px; color: #64748b; display: block; margin-bottom: 4px; }
.photo-input { display: flex; gap: 8px; }
.photo-input input { flex: 1; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 12px; }
.photo-input button { padding: 8px 12px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; }
.photo-preview { margin-top: 8px; }
.photo-preview img { max-width: 100%; max-height: 100px; border-radius: 6px; }
.custom-photos { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.custom-photo-thumb { position: relative; }
.custom-photo-thumb img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; }
.custom-photo-thumb .remove-photo { position: absolute; top: -5px; right: -5px; background: #dc2626; color: white; border: none; border-radius: 50%; width: 18px; height: 18px; cursor: pointer; font-size: 10px; }

/* Buttons */
.btn { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; transition: all 0.2s; }
.btn:hover { opacity: 0.9; transform: translateY(-1px); }
.btn-primary { background: #2563eb; color: white; }
.btn-success { background: #10b981; color: white; }
.btn-warning { background: #f59e0b; color: white; }
.btn-sm { padding: 6px 12px; font-size: 12px; }

/* Status */
.status { padding: 12px 16px; border-radius: 6px; margin: 10px 0; font-size: 14px; }
.status.success { background: #f0fdf4; border: 1px solid #bbf7d0; color: #166534; }
.status.error { background: #fef2f2; border: 1px solid #fecaca; color: #dc2626; }
.status.info { background: #eff6ff; border: 1px solid #bfdbfe; color: #1e40af; }

/* Modal export */
.modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; }
.modal.show { display: flex; }
.modal-content { background: white; border-radius: 12px; padding: 25px; max-width: 800px; width: 90%; max-height: 80vh; overflow: auto; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.modal-header h3 { margin: 0; }
.modal-close { background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b; }
.modal pre { background: #f1f5f9; padding: 15px; border-radius: 8px; font-size: 12px; max-height: 400px; overflow: auto; }

/* Progress */
.progress-bar { background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden; margin: 10px 0; }
.progress-fill { height: 100%; background: linear-gradient(90deg, #10b981, #059669); transition: width 0.3s; }

/* Stay22 link config */
.config-section { background: #fef3c7; border: 1px solid #fde047; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
.config-section label { font-weight: 600; color: #92400e; }
.config-section input { margin-top: 8px; width: 100%; padding: 10px; border: 1px solid #fde047; border-radius: 6px; }

/* Empty state */
.empty-state { text-align: center; padding: 60px 20px; color: #64748b; }
.empty-state svg { width: 80px; height: 80px; margin-bottom: 20px; opacity: 0.5; }
</style>
</head>
<body>

<div class="header">
    <h1>üè® ORT Admin - S√©lection H√¥tels</h1>
    <p style="color:#64748b;margin:5px 0 0">S√©lectionnez 2-3 h√¥tels par place et ajoutez leurs photos</p>
    
    <div class="stats">
        <div class="stat-card">
            <h3>üìç Places</h3>
            <div class="value" id="statPlaces">0</div>
        </div>
        <div class="stat-card">
            <h3>üè® H√¥tels trouv√©s</h3>
            <div class="value" id="statHotels">0</div>
        </div>
        <div class="stat-card">
            <h3>‚úÖ Places compl√©t√©es</h3>
            <div class="value" id="statDone">0</div>
        </div>
        <div class="stat-card">
            <h3>üéØ H√¥tels s√©lectionn√©s</h3>
            <div class="value" id="statSelected">0</div>
        </div>
    </div>
    
    <div class="config-section">
        <label>üîó Stay22 LMA ID (pour les liens affili√©s)</label>
        <input type="text" id="stay22Id" placeholder="692f0c75b2478d16bb9b22fa" value="692f0c75b2478d16bb9b22fa">
    </div>
    
    <div style="display:flex;gap:10px;flex-wrap:wrap;">
        <input type="file" id="fileInput" accept=".json" style="display:none">
        <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">üìÇ Charger hotels_scrape.json</button>
        <button class="btn btn-success" onclick="exportSelected()">üíæ Exporter s√©lection</button>
        <button class="btn btn-warning" onclick="saveProgress()">üìù Sauvegarder progression</button>
        <button class="btn" style="background:#64748b;color:white" onclick="loadProgress()">üì• Charger progression</button>
    </div>
    
    <div id="statusMsg" class="status" style="display:none"></div>
</div>

<div class="main-layout">
    <!-- Panel gauche: liste des places -->
    <div class="places-panel">
        <div class="filter-bar">
            <input type="text" id="searchPlace" placeholder="üîç Rechercher une place...">
            <select id="filterCountry">
                <option value="">Tous pays</option>
            </select>
            <select id="filterStatus">
                <option value="">Tous</option>
                <option value="done">‚úÖ Compl√©t√©s</option>
                <option value="partial">üü° Partiels</option>
                <option value="todo">‚¨ú √Ä faire</option>
            </select>
        </div>
        <div id="placesList"></div>
    </div>
    
    <!-- Panel droit: h√¥tels de la place s√©lectionn√©e -->
    <div class="hotels-panel">
        <div id="hotelsContent">
            <div class="empty-state">
                <div style="font-size:60px">üè®</div>
                <h3>Chargez le fichier hotels_scrape.json</h3>
                <p>Puis s√©lectionnez une place dans la liste de gauche</p>
            </div>
        </div>
    </div>
</div>

<!-- Modal export -->
<div class="modal" id="exportModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>üì¶ Export JSON</h3>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div>
            <button class="btn btn-primary btn-sm" onclick="copyExport()">üìã Copier</button>
            <button class="btn btn-success btn-sm" onclick="downloadExport()">üíæ T√©l√©charger</button>
        </div>
        <pre id="exportContent"></pre>
    </div>
</div>

<script>
// ============ STATE ============
let allData = {};           // Donn√©es brutes du scrape
let selections = {};        // {place_id: {hotels: [...], customPhotos: {...}}}
let currentPlaceId = null;

// ============ INIT ============
document.getElementById('fileInput').addEventListener('change', handleFileLoad);
document.getElementById('searchPlace').addEventListener('input', renderPlacesList);
document.getElementById('filterCountry').addEventListener('change', renderPlacesList);
document.getElementById('filterStatus').addEventListener('change', renderPlacesList);

// ============ FILE LOADING ============
function handleFileLoad(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(evt) {
        try {
            allData = JSON.parse(evt.target.result);
            showStatus(`‚úÖ ${Object.keys(allData).length} places charg√©es`, 'success');
            populateCountryFilter();
            renderPlacesList();
            updateStats();
        } catch(err) {
            showStatus('‚ùå Erreur parsing JSON: ' + err.message, 'error');
        }
    };
    reader.readAsText(file);
}

function populateCountryFilter() {
    const countries = new Set();
    Object.values(allData).forEach(p => countries.add(p.country));
    
    const select = document.getElementById('filterCountry');
    select.innerHTML = '<option value="">Tous pays</option>';
    [...countries].sort().forEach(cc => {
        select.innerHTML += `<option value="${cc}">${cc}</option>`;
    });
}

// ============ RENDER PLACES LIST ============
function renderPlacesList() {
    const search = document.getElementById('searchPlace').value.toLowerCase();
    const countryFilter = document.getElementById('filterCountry').value;
    const statusFilter = document.getElementById('filterStatus').value;
    
    let places = Object.values(allData);
    
    // Filtres
    if (search) {
        places = places.filter(p => p.name.toLowerCase().includes(search) || p.place_id.toLowerCase().includes(search));
    }
    if (countryFilter) {
        places = places.filter(p => p.country === countryFilter);
    }
    if (statusFilter) {
        places = places.filter(p => {
            const sel = selections[p.place_id];
            const selectedCount = sel?.hotels?.length || 0;
            if (statusFilter === 'done') return selectedCount >= 2;
            if (statusFilter === 'partial') return selectedCount === 1;
            if (statusFilter === 'todo') return selectedCount === 0;
            return true;
        });
    }
    
    // Trier par nom
    places.sort((a, b) => a.name.localeCompare(b.name));
    
    const container = document.getElementById('placesList');
    
    if (places.length === 0) {
        container.innerHTML = '<div class="empty-state"><p>Aucune place trouv√©e</p></div>';
        return;
    }
    
    container.innerHTML = places.map(p => {
        const sel = selections[p.place_id];
        const selectedCount = sel?.hotels?.length || 0;
        const statusClass = selectedCount >= 2 ? 'done' : selectedCount === 1 ? 'partial' : '';
        const selectedClass = p.place_id === currentPlaceId ? 'selected' : '';
        
        return `
            <div class="place-item ${statusClass} ${selectedClass}" onclick="selectPlace('${p.place_id}')">
                <div class="place-name">
                    ${p.name}
                    <span class="hotel-count">${p.hotels?.length || 0} h√¥tels</span>
                    ${selectedCount > 0 ? `<span class="hotel-count selected-count">‚úì ${selectedCount} s√©lect.</span>` : ''}
                </div>
                <div class="place-meta">${p.country} ¬∑ ${p.place_id}</div>
            </div>
        `;
    }).join('');
}

// ============ SELECT PLACE ============
function selectPlace(placeId) {
    currentPlaceId = placeId;
    renderPlacesList();
    renderHotels();
}

// ============ RENDER HOTELS ============
function renderHotels() {
    const container = document.getElementById('hotelsContent');
    
    if (!currentPlaceId || !allData[currentPlaceId]) {
        container.innerHTML = '<div class="empty-state"><p>S√©lectionnez une place</p></div>';
        return;
    }
    
    const place = allData[currentPlaceId];
    const hotels = place.hotels || [];
    const sel = selections[currentPlaceId] || { hotels: [], customPhotos: {} };
    
    const stay22Id = document.getElementById('stay22Id').value;
    
    container.innerHTML = `
        <div class="hotels-header">
            <div>
                <h2>üè® ${place.name}</h2>
                <p style="color:#64748b;margin:5px 0 0">${place.country} ¬∑ ${hotels.length} h√¥tels trouv√©s</p>
            </div>
            <div>
                <span style="color:#64748b">${sel.hotels.length}/3 s√©lectionn√©s</span>
            </div>
        </div>
        
        ${hotels.length === 0 ? `
            <div class="empty-state">
                <p>Aucun h√¥tel trouv√© pour cette place</p>
            </div>
        ` : `
            <div class="hotels-grid">
                ${hotels.map((h, idx) => {
                    const isSelected = sel.hotels.some(s => s.name === h.name);
                    const customPhotos = sel.customPhotos[h.name] || [];
                    const stay22Link = `https://www.stay22.com/allez/booking?campaign=692f0c75b2478d16bb9b22fa&link=https://www.booking.com/searchresults.html?ss=${encodeURIComponent(h.name + ' ' + place.name)}`;
                    
                    return `
                        <div class="hotel-card ${isSelected ? 'selected' : ''}" data-hotel-idx="${idx}">
                            <img class="hotel-image" src="${h.imageUrl || 'https://via.placeholder.com/400x200?text=Hotel'}" 
                                 onerror="this.src='https://via.placeholder.com/400x200?text=Hotel'" alt="${h.name}">
                            <div class="hotel-content">
                                <div class="hotel-name">${h.name}</div>
                                <div class="hotel-meta">
                                    <span class="hotel-score">${h.score}</span>
                                    <span class="hotel-reviews">${h.reviews} avis</span>
                                    ${h.price ? `<span class="hotel-price">${h.price}‚Ç¨</span>` : ''}
                                </div>
                                <div class="hotel-address">${h.address || ''}</div>
                                
                                <div class="hotel-actions">
                                    <button class="hotel-checkbox" onclick="toggleHotel('${h.name.replace(/'/g, "\\'")}', ${idx})">
                                        ${isSelected ? '‚úÖ S√©lectionn√©' : '‚òê S√©lectionner'}
                                    </button>
                                    <a href="${stay22Link}" target="_blank" class="btn btn-sm" style="background:#0ea5e9;color:white;text-decoration:none">
                                        üîó Booking
                                    </a>
                                    <a href="https://www.google.com/search?tbm=isch&q=${encodeURIComponent(h.name + ' hotel')}" target="_blank" class="btn btn-sm" style="background:#ea4335;color:white;text-decoration:none">
                                        üì∑ Google Images
                                    </a>
                                </div>
                                
                                ${isSelected ? `
                                    <div class="photo-section">
                                        <label>üì∑ Photos personnalis√©es (du site de l'h√¥tel)</label>
                                        <div class="photo-input">
                                            <input type="text" id="photoUrl-${idx}" placeholder="https://hotel-site.com/photo.jpg">
                                            <button onclick="addCustomPhoto('${h.name.replace(/'/g, "\\'")}', ${idx})">Ajouter</button>
                                        </div>
                                        <div class="custom-photos" id="customPhotos-${idx}">
                                            ${customPhotos.map((url, pi) => `
                                                <div class="custom-photo-thumb">
                                                    <img src="${url}" onerror="this.style.display='none'">
                                                    <button class="remove-photo" onclick="removeCustomPhoto('${h.name.replace(/'/g, "\\'")}', ${pi})">√ó</button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
        `}
    `;
}

// ============ TOGGLE HOTEL SELECTION ============
function toggleHotel(hotelName, idx) {
    if (!currentPlaceId) return;
    
    if (!selections[currentPlaceId]) {
        selections[currentPlaceId] = { hotels: [], customPhotos: {} };
    }
    
    const sel = selections[currentPlaceId];
    const place = allData[currentPlaceId];
    const hotel = place.hotels[idx];
    
    const existingIdx = sel.hotels.findIndex(h => h.name === hotelName);
    
    if (existingIdx >= 0) {
        // D√©s√©lectionner
        sel.hotels.splice(existingIdx, 1);
        delete sel.customPhotos[hotelName];
    } else {
        // S√©lectionner (max 3)
        if (sel.hotels.length >= 3) {
            showStatus('‚ö†Ô∏è Maximum 3 h√¥tels par place', 'error');
            return;
        }
        sel.hotels.push({
            name: hotel.name,
            score: hotel.score,
            reviews: hotel.reviews,
            price: hotel.price,
            address: hotel.address,
            bookingUrl: hotel.bookingUrl,
            imageUrl: hotel.imageUrl
        });
        sel.customPhotos[hotelName] = [];
    }
    
    renderHotels();
    renderPlacesList();
    updateStats();
}

// ============ CUSTOM PHOTOS ============
function addCustomPhoto(hotelName, idx) {
    const input = document.getElementById(`photoUrl-${idx}`);
    const url = input.value.trim();
    
    if (!url) return;
    if (!url.startsWith('http')) {
        showStatus('‚ö†Ô∏è URL invalide', 'error');
        return;
    }
    
    const sel = selections[currentPlaceId];
    if (!sel.customPhotos[hotelName]) {
        sel.customPhotos[hotelName] = [];
    }
    
    if (sel.customPhotos[hotelName].length >= 5) {
        showStatus('‚ö†Ô∏è Maximum 5 photos par h√¥tel', 'error');
        return;
    }
    
    sel.customPhotos[hotelName].push(url);
    input.value = '';
    renderHotels();
}

function removeCustomPhoto(hotelName, photoIdx) {
    const sel = selections[currentPlaceId];
    if (sel?.customPhotos?.[hotelName]) {
        sel.customPhotos[hotelName].splice(photoIdx, 1);
        renderHotels();
    }
}

// ============ STATS ============
function updateStats() {
    const placesCount = Object.keys(allData).length;
    const hotelsCount = Object.values(allData).reduce((sum, p) => sum + (p.hotels?.length || 0), 0);
    const doneCount = Object.values(selections).filter(s => s.hotels?.length >= 2).length;
    const selectedCount = Object.values(selections).reduce((sum, s) => sum + (s.hotels?.length || 0), 0);
    
    document.getElementById('statPlaces').textContent = placesCount;
    document.getElementById('statHotels').textContent = hotelsCount;
    document.getElementById('statDone').textContent = doneCount;
    document.getElementById('statSelected').textContent = selectedCount;
}

// ============ EXPORT ============
function exportSelected() {
    const stay22Id = document.getElementById('stay22Id').value;
    
    const exportData = {};
    
    for (const [placeId, sel] of Object.entries(selections)) {
        if (!sel.hotels || sel.hotels.length === 0) continue;
        
        const place = allData[placeId];
        if (!place) continue;
        
        exportData[placeId] = {
            place_id: placeId,
            name: place.name,
            country: place.country,
            coords: place.coords,
            hotels: sel.hotels.map(h => ({
                name: h.name,
                score: h.score,
                reviews: h.reviews,
                price: h.price,
                address: h.address,
                // Lien Stay22 affili√©
                stay22_link: `https://www.stay22.com/allez/booking?campaign=${stay22Id}&link=https://www.booking.com/searchresults.html?ss=${encodeURIComponent(h.name + ' ' + place.name)}`,
                // Photos: custom d'abord, puis Booking en fallback
                photos: sel.customPhotos[h.name]?.length > 0 
                    ? sel.customPhotos[h.name] 
                    : (h.imageUrl ? [h.imageUrl] : [])
            }))
        };
    }
    
    const json = JSON.stringify(exportData, null, 2);
    document.getElementById('exportContent').textContent = json;
    document.getElementById('exportModal').classList.add('show');
}

function copyExport() {
    const content = document.getElementById('exportContent').textContent;
    navigator.clipboard.writeText(content);
    showStatus('‚úÖ Copi√© dans le presse-papier', 'success');
}

function downloadExport() {
    const content = document.getElementById('exportContent').textContent;
    const blob = new Blob([content], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'hotels_selected.json';
    a.click();
    URL.revokeObjectURL(url);
}

function closeModal() {
    document.getElementById('exportModal').classList.remove('show');
}

// ============ SAVE/LOAD PROGRESS ============
function saveProgress() {
    const data = {
        selections,
        timestamp: new Date().toISOString()
    };
    const json = JSON.stringify(data);
    localStorage.setItem('ort_hotels_progress', json);
    
    // Aussi t√©l√©charger
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'hotels_progress.json';
    a.click();
    URL.revokeObjectURL(url);
    
    showStatus('‚úÖ Progression sauvegard√©e', 'success');
}

function loadProgress() {
    // D'abord essayer localStorage
    const stored = localStorage.getItem('ort_hotels_progress');
    if (stored) {
        try {
            const data = JSON.parse(stored);
            selections = data.selections || {};
            showStatus(`‚úÖ Progression restaur√©e (${Object.keys(selections).length} places)`, 'success');
            renderPlacesList();
            updateStats();
            return;
        } catch(e) {}
    }
    
    // Sinon demander un fichier
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(evt) {
            try {
                const data = JSON.parse(evt.target.result);
                selections = data.selections || {};
                showStatus(`‚úÖ Progression charg√©e (${Object.keys(selections).length} places)`, 'success');
                renderPlacesList();
                updateStats();
            } catch(err) {
                showStatus('‚ùå Erreur: ' + err.message, 'error');
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

// ============ STATUS ============
function showStatus(msg, type = 'info') {
    const el = document.getElementById('statusMsg');
    el.textContent = msg;
    el.className = 'status ' + type;
    el.style.display = 'block';
    setTimeout(() => { el.style.display = 'none'; }, 4000);
}

// Auto-load from localStorage on page load
window.addEventListener('load', () => {
    const stored = localStorage.getItem('ort_hotels_progress');
    if (stored) {
        try {
            const data = JSON.parse(stored);
            selections = data.selections || {};
            console.log(`Restored ${Object.keys(selections).length} selections from localStorage`);
        } catch(e) {}
    }
});
</script>
</body>
</html>
