<!doctype html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) - Deferred to avoid cookie conflicts with ort-footer -->
<script>
  window.addEventListener('DOMContentLoaded', () => {
    setTimeout(() => {
      const script = document.createElement('script');
      script.async = true;
      script.src = 'https://www.googletagmanager.com/gtag/js?id=G-JK3QGQGDDL';
      document.head.appendChild(script);
      
      window.dataLayer = window.dataLayer || [];
      window.gtag = function(){window.dataLayer.push(arguments);};
      window.gtag('js', new Date());
      window.gtag('config', 'G-JK3QGQGDDL', {
        'allow_ad_personalization_signals': false,
        'allow_google_signals': false,
        'user_properties': {
          'language': localStorage.getItem('lang') || 'fr'
        }
      });
    }, 2000);
  });
</script>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes, maximum-scale=5.0">
  <title>OneRoadTrip - Plan Your Dream Road Trip | 667+ Itineraries Worldwide</title>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Plan your perfect road trip with OneRoadTrip. 667+ curated itineraries across 82 countries, 4000+ stages, interactive maps, and booking links. Free to use.">
  <meta name="keywords" content="road trip, travel planner, itinerary, vacation planning, travel routes, road trip map, travel guide">
  <meta name="author" content="OneRoadTrip">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://www.oneroadtrip.com/presentation.html">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://www.oneroadtrip.com/presentation.html">
  <meta property="og:title" content="OneRoadTrip - Plan Your Dream Road Trip">
  <meta property="og:description" content="667+ curated road trip itineraries across 82 countries. Interactive maps, detailed stages, and booking links. 100% free.">
  <meta property="og:image" content="https://www.oneroadtrip.com/assets/og-image.webp">
  <meta property="og:locale" content="en_US">
  <meta property="og:locale:alternate" content="fr_FR">
  <meta property="og:locale:alternate" content="es_ES">
  <meta property="og:locale:alternate" content="it_IT">
  <meta property="og:locale:alternate" content="pt_PT">
  <meta property="og:locale:alternate" content="ar_SA">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@OneRoadTrip2025">
  <meta name="twitter:title" content="OneRoadTrip - Plan Your Dream Road Trip">
  <meta name="twitter:description" content="667+ curated road trip itineraries across 82 countries. Interactive maps and booking links.">
  <meta name="twitter:image" content="https://www.oneroadtrip.com/assets/og-image.webp">
  
  <!-- Hreflang for multilingual SEO -->
  <link rel="alternate" hreflang="fr" href="https://www.oneroadtrip.com/presentation.html?lang=fr">
  <link rel="alternate" hreflang="en" href="https://www.oneroadtrip.com/presentation.html?lang=en">
  <link rel="alternate" hreflang="es" href="https://www.oneroadtrip.com/presentation.html?lang=es">
  <link rel="alternate" hreflang="it" href="https://www.oneroadtrip.com/presentation.html?lang=it">
  <link rel="alternate" hreflang="pt" href="https://www.oneroadtrip.com/presentation.html?lang=pt">
  <link rel="alternate" hreflang="ar" href="https://www.oneroadtrip.com/presentation.html?lang=ar">
  <link rel="alternate" hreflang="x-default" href="https://www.oneroadtrip.com/presentation.html">
  
  <!-- Preconnect for performance -->
  <link rel="preconnect" href="https://oneroadtrip-prod.firebaseapp.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://basemaps.cartocdn.com" crossorigin>
  <link rel="preconnect" href="b.basemaps.cartocdn.com" crossorigin>
  <link rel="preconnect" href="c.basemaps.cartocdn.com" crossorigin>
  <link rel="dns-prefetch" href="https://www.googletagmanager.com">
  <!-- Preload critical Leaflet assets -->
  <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" as="script">
  <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" as="style">
  <!-- Favicon inline pour √©viter /favicon.ico 404 -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' fill='%23113f7a'/%3E%3Ctext x='32' y='40' text-anchor='middle' font-family='Arial' font-size='28' fill='white'%3EOR%3C/text%3E%3C/svg%3E">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
  <style>
    :root{ --bg:#f6f9fb; --ink:#113f7a; --acc:#113f7a; --card:#ffffff; --bd:#c3d6b6; --mut:#64748b; --warn:#eab308; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:url("/assets/image_index.webp") center/cover fixed #113f7a;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}

    [dir="rtl"] body{ text-align:right }
    [dir="rtl"] .noticeBar,[dir="rtl"] .cols,[dir="rtl"] .full,[dir="rtl"] .ctaRow,[dir="rtl"] .fullGrid{ direction:rtl }
    [dir="rtl"] .ctaRow{ justify-content:flex-end }

header{position:sticky;top:0;z-index:10000;background:url("/assets/image_index.webp") center/cover no-repeat #113f7a;color:#fff;padding:12px 16px;display:flex;flex-direction:column;gap:12px;border-bottom:2px solid rgba(255,255,255,0.2);box-shadow:0 2px 12px rgba(0,0,0,0.2)}

/* Lignes du header */
.header-row-1{display:flex;align-items:center;gap:12px;width:100%}
.header-row-2{display:flex;align-items:center;gap:12px;width:100%;flex-wrap:wrap}

.brandlink{display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none}
.brandlink img{width:80px;height:80px}



    .brand{font-weight:800;font-size:20px}
    .langpick{appearance:none;background:#fff;border:1px solid #113f7a;border-radius:10px;padding:8px 10px;cursor:pointer;color:#113f7a;font-size:14px}
 .auth{position:relative}
.btn{padding:8px 12px;border-radius:10px;border:1px solid #ffffff80;background:#ffffff1a;color:#fff;cursor:pointer;font-size:14px}
.btn:hover{background:#ffffff2b}
.btn:disabled{opacity:.6;cursor:not-allowed}
/* Bouton header g√©n√©rique pour le lien Dashboard */
.hdr-btn{display:inline-block;padding:8px 12px;border-radius:10px;
  border:1px solid #113f7a;background:#fff;color:#113f7a;text-decoration:none;cursor:pointer;font-weight:600;font-size:14px}
.hdr-btn:hover{background:#e8f4fc}
.hdr-btn:focus-visible{outline:2px solid #c3d6b6;outline-offset:2px}

/* Badge mode */
.mode-badge{display:inline-block;padding:6px 12px;border-radius:8px;font-size:13px;font-weight:700;margin-left:12px}
.mode-badge.simple{background:linear-gradient(135deg, #4a1d1d 0%, #cf8282 100%);color:#fff}
.mode-badge.expert{background:linear-gradient(135deg, #21476b 0%, #10b981 100%);color:#fff}

/* Responsive mobile header */
/* 4 Carr√©s principaux */
.ort-card:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,0.25)}
.city-suggestions div{padding:10px 12px;cursor:pointer;border-bottom:1px solid #eee;font-size:14px}
.city-suggestions div:hover{background:#f0f7ff}
.city-suggestions div:last-child{border-bottom:none}
@media (max-width: 600px) {
  .ort-grid-4{grid-template-columns:1fr !important}
  .route-builder-form{grid-template-columns:1fr !important}
}
@media (max-width: 768px) {
  header{padding:8px 10px;gap:6px}
  .header-row-1{gap:8px}
  .header-row-2{gap:6px;justify-content:flex-start}
  .brandlink img{width:50px;height:50px}
  .brand{font-size:16px}
  .langpick{padding:5px 6px;font-size:12px}
  .btn,.hdr-btn{padding:5px 8px;font-size:12px}
  .mode-badge{display:none !important}
}

/* Desktop: une seule ligne */
@media (min-width: 769px) {
  header{flex-direction:row;align-items:center}
  .header-row-1,.header-row-2{width:auto}
  .header-row-1{flex:1}
}

/* Modal budget */
.budget-modal-overlay{display:none;position:fixed;inset:0;z-index:99999;background:rgba(0,0,0,.7);align-items:flex-start;justify-content:center;padding-top:5vh;overflow-y:auto}
.budget-modal-overlay.show{display:flex}
.budget-modal{background:#e8f4fc;border-radius:14px;max-width:600px;width:90%;padding:28px;box-shadow:0 20px 60px rgba(0,0,0,.3);animation:modalSlideIn .3s ease;border:2px solid #113f7a;margin-bottom:5vh;max-height:90vh;overflow-y:auto}
@keyframes modalSlideIn{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}
.budget-modal h3{margin:0 0 16px;color:#113f7a;font-size:22px;font-weight:800}
.budget-modal p{margin:0 0 20px;color:#113f7a;font-size:15px}
.budget-modal label{color:#113f7a}
.budget-modal .filter-input,.budget-modal .filter-select{border:1px solid #113f7a;background:#fff;color:#113f7a}
.budget-modal .filter-input:focus,.budget-modal .filter-select:focus{outline:2px solid #113f7a;outline-offset:2px}
.budget-modal-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:20px}
.budget-modal-btn{padding:12px 24px;border-radius:8px;border:0;cursor:pointer;font-weight:700;font-size:15px;transition:all .2s}
.budget-modal-btn.primary{background:#113f7a;color:#fff}
.budget-modal-btn.primary:hover{background:#0d2f5a}
.budget-modal-btn.secondary{background:#fff;color:#113f7a;border:2px solid #113f7a}
.budget-modal-btn.secondary:hover{background:#e8f4fc}

/* Clusters personnalis√©s */
.marker-cluster{background:transparent !important}
.marker-cluster div{background:rgba(30,136,229,0.85);border-radius:50%;font-weight:600;color:#fff;font-size:11px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 6px rgba(0,0,0,0.3);border:2px solid #fff}
.marker-cluster-small div{width:28px;height:28px;font-size:10px}
.marker-cluster-medium div{background:rgba(46,125,50,0.85);width:34px;height:34px;font-size:11px}
.marker-cluster-large div{background:rgba(255,152,0,0.9);width:40px;height:40px;font-size:12px}
/* Clusters plus grands sur mobile/tablette */
@media (max-width: 1024px) {
  .marker-cluster-small div{width:40px;height:40px;font-size:14px}
  .marker-cluster-medium div{width:48px;height:48px;font-size:15px}
  .marker-cluster-large div{width:56px;height:56px;font-size:16px}
}

/* √âtoiles */
.star-marker{filter:drop-shadow(0 1px 3px rgba(0,0,0,0.4));transition:transform 0.15s ease}
.star-marker:hover{transform:scale(1.2)}
.star-marker.selected{filter:drop-shadow(0 2px 4px rgba(225,29,72,0.5))}

/* L√©gende carte */
.map-legend{position:absolute;bottom:30px;left:10px;background:rgba(255,255,255,0.95);border-radius:8px;padding:10px 12px;box-shadow:0 2px 8px rgba(0,0,0,0.2);z-index:1000;font-size:12px;max-width:160px}
.map-legend-title{font-weight:700;color:#113f7a;margin-bottom:8px;font-size:13px}
.map-legend-item{display:flex;align-items:center;gap:8px;margin-bottom:5px}
.map-legend-item:last-child{margin-bottom:0}
.legend-star{flex-shrink:0}
.legend-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0;border:1.5px solid #fff;box-shadow:0 1px 2px rgba(0,0,0,0.3)}
.legend-dot.incontournable{background:#1565C0}
.legend-dot.recommande{background:#43A047}
.legend-dot.decouvrir{background:#7CB342}
.legend-dot.standard{background:#78909C}
.legend-dot.selected{background:#e11d48}
.map-legend-label{color:#333;font-size:11px}

.auth-pop{position:absolute;right:0;top:44px;background:#fff;color:var(--ink);border:1px solid var(--bd);border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.15);padding:8px;display:none;min-width:260px;z-index:10001}
.auth-pop .btn{display:block;width:100%;margin:6px 0;background:var(--acc);border:1px solid var(--acc);color:#fff}
.auth-pop .btn.out{background:#fff;color:var(--acc)}

    main{max-width:1200px;margin:18px auto 40px;padding:0 16px}
    .intro{background:var(--card);border:1px solid var(--bd);border-radius:14px;padding:18px;margin-bottom:20px}
    .intro h1{margin:0 0 4px;font-size:26px}

    /* MAP EXPLORER SECTION */
    .map-explorer{background:var(--acc);border:2px solid var(--acc);border-radius:14px;padding:15px;margin-bottom:14px;cursor:pointer;transition:all .3s;min-height:60px;display:flex;align-items:center;justify-content:center}
    .map-explorer:hover{box-shadow:0 4px 16px rgba(17,63,122,.3);transform:translateY(-2px)}
    .map-explorer h2{margin:0;font-size:22px;color:#fff;text-align:center;line-height:1.4}
    
    /* Responsive mobile pour map-explorer */
    @media (max-width: 768px) {
      main{padding:0 12px;margin-bottom:60px}
      .intro h1{font-size:22px}
      .map-explorer{padding:12px;min-height:50px}
      .map-explorer h2{font-size:16px;line-height:1.3}
    }
    
    /* Lien "Devenir cr√©ateur" */
    .creator-link-wrap{margin-top:20px;text-align:center;margin-bottom:20px;padding:0 16px}
    .creator-link{color:#fff;text-decoration:none;font-size:18px;font-weight:700;display:inline-block;padding:14px 28px;transition:all .2s;text-shadow:0 1px 2px rgba(0,0,0,0.3);background:rgba(255,255,255,0.15);border-radius:8px;border:2px solid rgba(255,255,255,0.4)}
    .creator-link:hover{color:#fff;background:rgba(255,255,255,0.25);transform:scale(1.05);border-color:rgba(255,255,255,0.6)}
    @media (max-width: 768px) {
      .creator-link{font-size:16px;padding:12px 24px}
    }
    
    /* FULLSCREEN MAP MODE */
    .map-fullscreen{position:fixed;inset:0;z-index:10001;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;padding:20px}
    .map-fullscreen.active{display:flex}
    .map-fullscreen-content{background:#fff;border-radius:14px;width:100%;max-width:1600px;height:90vh;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.3)}
    .map-fullscreen-header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:16px 20px;border-bottom:2px solid var(--acc);background:var(--card);position:sticky;top:0;z-index:998;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
    .map-fullscreen-header h2{margin:0;color:var(--acc);font-size:20px}
    
    /* Compteur itin√©raires visibles */
    .visible-itins-count{background:linear-gradient(135deg, #21476b 0%, #10b981 100%);color:#fff;padding:6px 14px;border-radius:20px;font-size:13px;font-weight:700;white-space:nowrap}
    
    .map-fullscreen-close{background:var(--acc);color:#fff;border:none;border-radius:8px;padding:8px 16px;cursor:pointer;font-weight:700;font-size:14px}
    .map-fullscreen-close:hover{background:#0d2f5a}
    .map-fullscreen-main{display:flex;flex:1;overflow:hidden}
    .map-fullscreen-body{flex:1;position:relative;overflow:hidden}
    .map-fullscreen-sidebar{width:320px;background:#f8f9fa;border-left:1px solid var(--bd);overflow-y:auto;padding:20px;overflow-anchor:none}
    #mapContainerFull{width:100%;height:100%}
    
    /* Bouton toggle filtres mobile */
    .filters-toggle-mobile{display:none;position:absolute;top:10px;left:10px;z-index:1001;background:#113f7a;color:#fff;border:none;border-radius:8px;padding:10px 16px;cursor:pointer;font-weight:700;font-size:14px;box-shadow:0 2px 8px rgba(0,0,0,0.3)}
    .filters-toggle-mobile:active{transform:scale(0.95)}
    
    /* Responsive mobile : masquer sidebar par d√©faut, afficher avec bouton */
    @media (max-width: 768px) {
      .map-fullscreen-sidebar{position:absolute;top:0;right:-100%;width:80%;max-width:300px;height:100%;z-index:1002;transition:right 0.3s ease;box-shadow:-2px 0 10px rgba(0,0,0,0.3)}
      .map-fullscreen-sidebar.show{right:0}
      .filters-toggle-mobile{display:block}
    }
    
    /* Aper√ßu itin√©raire */
    /* Aper√ßu itin√©raire ‚Äî plein hauteur carte (colonne droite) */
    .itin-preview{
      position:absolute;
      top:8px;
      right:8px;
      bottom:8px;           /* ‚Üê prend toute la hauteur de la carte */
      left:auto;
      width:360px;
      max-width:360px;
      background:#fff;
      border-radius:12px;
      padding:16px;
      box-shadow:0 8px 24px rgba(0,0,0,.2);
      z-index:1000;
      border:2px solid var(--acc);
      overflow-y:auto;      /* ‚Üê scroll interne si contenu long */
    }
    .itin-preview h3{margin:0 0 12px;color:var(--acc);font-size:18px;padding-right:30px}
    .itin-preview .preview-close{position:absolute;top:12px;right:12px;background:none;border:none;color:var(--mut);font-size:20px;cursor:pointer;padding:0;width:24px;height:24px;line-height:1}
    .itin-preview .preview-close:hover{color:var(--acc)}

/* Responsive mobile pour preview */
@media (max-width: 768px) {
  /* Aper√ßu en BAS de l'√©cran, au-dessus de la barre */
  .itin-preview{
    position:fixed !important;
    top:auto !important;
    left:0 !important;
    right:0 !important;
    bottom:70px !important; /* Align√© avec la hauteur de la barre (70px) */
    width:100% !important;
    max-width:100% !important;
    height:auto !important;
    max-height:55vh !important;
    z-index:1004 !important; /* SOUS la l√©gende (1005) */
    overflow-y:auto !important;
    -webkit-overflow-scrolling:touch !important; /* Scroll fluide iOS */
    background:#fff !important;
    border-radius:16px 16px 0 0 !important;
    padding:20px !important;
    box-shadow:0 -4px 20px rgba(0,0,0,0.3) !important;
    border:none !important;
    border-top:3px solid var(--acc) !important;
    pointer-events:auto !important; /* Cliquable */
  }
  
  /* Masquer le bouton dans l'aper√ßu sur mobile */
  .itin-preview .btn-select {
    display:none !important;
  }
  
  /* Barre d'action mobile TOUJOURS visible en bas */
  .mobile-action-bar {
    display:none !important;
    position:fixed !important;
    bottom:0 !important;
    left:0 !important;
    right:0 !important;
    background:#fff !important;
    padding:10px 16px 12px 16px !important;
    box-shadow:0 -2px 10px rgba(0,0,0,0.2) !important;
    z-index:1003 !important;
    border-top:2px solid var(--acc) !important;
    height:70px !important;
    pointer-events:auto !important;
  }
  
  .select-itin-btn-mobile {
    display:block !important;
    width:100% !important;
    padding:16px !important;
    background:var(--acc) !important;
    color:#fff !important;
    border:none;
    border-radius:8px;
    font-size:18px;
    font-weight:700;
    cursor:pointer;
    pointer-events:auto !important;
  }
  
  .select-itin-btn-mobile:active {
    background:#0d2f5a;
    transform:scale(0.98);
  }
  
  /* L√©gende carte - Ajuster position pour ne pas √™tre cach√©e */
  .map-legend {
    bottom:80px !important; /* Au-dessus de la barre (70px + marge) */
    z-index:1005 !important; /* AU-DESSUS de tout */
    pointer-events:auto !important;
  }
  
  /* S'assurer que la carte reste interactive */
  #mapContainerFull {
    pointer-events:auto !important;
  }
  
  /* Bouton fermeture aper√ßu - toujours visible */
  .preview-close {
    position:sticky !important;
    top:0 !important;
    z-index:10 !important;
    pointer-events:auto !important;
  }
  
  /* Sidebar filtres AU-DESSUS de l'aper√ßu quand affich√©e */
  .map-fullscreen-sidebar {
    z-index:1007 !important; /* Au-dessus de tout */
  }
}

/* Barre action mobile - cach√©e par d√©faut sur desktop */
.mobile-action-bar {
  display:none;
}

.select-itin-btn-mobile {
  display:none;
}

/* Modale confirmation mobile */
.mobile-confirm-modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  z-index:10000;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.mobile-confirm-modal.show {
  display:flex;
}

.mobile-confirm-content {
  background:#fff;
  border-radius:12px;
  padding:24px;
  max-width:400px;
  width:100%;
  box-shadow:0 8px 32px rgba(0,0,0,0.3);
}

.mobile-confirm-content h3 {
  margin:0 0 16px 0;
  color:var(--acc);
  font-size:18px;
  line-height:1.4;
}

#mobileConfirmInfo {
  margin-bottom:24px;
  color:#555;
  font-size:14px;
  line-height:1.6;
}

.mobile-confirm-actions {
  display:flex;
  gap:12px;
}

.mobile-confirm-actions button {
  flex:1;
  padding:14px;
  border:none;
  border-radius:8px;
  font-size:16px;
  font-weight:700;
  cursor:pointer;
}

.mobile-btn-cancel {
  background:#e5e7eb;
  color:#374151;
}

.mobile-btn-cancel:active {
  background:#d1d5db;
}

.mobile-btn-validate {
  background:var(--acc);
  color:#fff;
}

.mobile-btn-validate:active {
  background:#0d2f5a;
}

/* Modale de s√©lection mobile */
.mobile-selection-modal{
  display:none !important;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  z-index:10000;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.mobile-selection-modal.show{
  display:flex !important;
}

/* NEW: grille photo du preview */
.itin-preview .preview-photos{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  margin:8px 0 12px;
}
.itin-preview .preview-photos img{
  width:100%;
  aspect-ratio:1/1;
  object-fit:cover;
  border-radius:8px;
}

/* === Preview dans l‚Äôonglet Filtres === */
.itin-preview.in-sidebar{
  position:static;     /* plus d‚Äôabsolu sur la carte */
  inset:auto;          /* annule top/right/bottom/left */
  width:auto;
  max-width:none;
  height:auto;
  margin:0 0 12px 0;   /* espace sous le bloc */
  overflow:visible;    /* laisse scroller la sidebar */
  box-shadow:none;     /* look panneau colonne */
}




       #previewInfo{margin-bottom:12px;color:var(--mut);font-size:14px}
    #previewInfo div{margin:4px 0}
    /* FULL HEIGHT: plus de tronquage √† 120px, laisse le panneau g√©rer le scroll */
    #previewCities{
      margin-bottom:12px;
      padding:10px;
      background:#f8f9fa;
      border-radius:8px;
      font-size:13px;
      color:var(--ink);
      max-height:none;          /* ‚Üê supprim√© */
      overflow:visible;         /* ‚Üê pas de scrollbar interne */
      white-space:normal;       /* ‚Üê retour √† la ligne naturel */
      line-height:1.35;
      word-break:break-word;
    }
    .preview-path-simplified{margin-bottom:12px;padding:10px;background:#e8f4f8;border-radius:8px;border:1px solid #b3d9e8}

    .preview-path-simplified .path-title{font-weight:700;color:var(--acc);margin-bottom:6px;font-size:13px}
    .preview-path-simplified .path-flow{display:flex;align-items:center;gap:6px;flex-wrap:wrap;font-size:12px}
    .preview-path-simplified .city-node{padding:4px 8px;background:#fff;border:1px solid var(--acc);border-radius:6px;color:var(--acc);font-weight:600}
    .preview-path-simplified .arrow{color:var(--mut);font-weight:700}
    .btn-select{width:100%;padding:10px;background:var(--acc);color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:14px}
    .btn-select:hover{background:#0d2f5a}
    
    /* Am√©lioration mobile pour le bouton */
    @media (max-width: 768px) {
      .btn-select{padding:14px;font-size:16px;margin-top:12px}
    }
    
    /* Sidebar filters */
    .map-controls-vertical h3{margin:0 0 16px;color:var(--acc);font-size:18px;padding-bottom:12px;border-bottom:2px solid var(--acc)}
    .filter-group{margin-bottom:16px}
    .filter-group label{display:block;font-weight:600;margin-bottom:6px;color:var(--ink);font-size:14px}
    .filter-select,.filter-input{width:100%;padding:10px 12px;border:1px solid var(--bd);border-radius:8px;background:#fff;font-size:14px}
    .filter-select:focus,.filter-input:focus{outline:2px solid var(--acc);outline-offset:2px}
    .btn-reset-full{width:100%;padding:10px;background:var(--acc);color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;margin-top:8px;font-size:14px}
    .btn-reset-full:hover{background:#0d2f5a}
    .filter-count-box{margin-top:20px;padding:12px;background:#fff;border:1px solid var(--bd);border-radius:8px;text-align:center}
    .filter-count-box span{font-weight:700;color:var(--acc);font-size:15px}
    
    /* Selection panel */
    .selection-panel{margin-top:24px;padding:16px;background:#fff;border:2px solid var(--acc);border-radius:10px}
    .selection-panel h4{margin:0 0 12px;color:var(--acc);font-size:16px;font-weight:700}
    #selectedList{margin-bottom:12px;max-height:300px;overflow-y:auto;min-height:50px;display:block;width:100%}
    .selected-item{display:flex;align-items:center;justify-content:space-between;padding:8px;margin-bottom:8px;background:#f8f9fa;border-radius:8px;font-size:13px;width:100%;box-sizing:border-box}
    .selected-item-title{flex:1;font-weight:600;color:var(--ink);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0}
    .selected-item-remove{background:none;border:none;color:#dc2626;cursor:pointer;font-size:18px;padding:0 4px;line-height:1;flex-shrink:0}
    .selected-item-remove:hover{color:#991b1b}
    .selected-item:last-child{margin-bottom:0}
    .btn-validate{width:100%;padding:10px;background:#22c55e;color:#fff;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:14px}
    .btn-validate:hover{background:#16a34a}
    
    .leaflet-popup-content{min-width:200px}
    .leaflet-popup-content h3{margin:0 0 6px;color:var(--acc)}
    .leaflet-popup-content .itin-days{font-weight:600;color:var(--mut)}
    .leaflet-popup-content .itin-region{font-size:13px;color:var(--mut);margin:4px 0}
    .leaflet-popup-content .itin-link{display:inline-block;margin-top:8px;padding:6px 12px;background:var(--acc);color:#fff;text-decoration:none;border-radius:8px;font-size:14px}
    .leaflet-popup-content .itin-link:hover{background:#0d2f5a}
    
    @media (max-width:900px){
      .map-fullscreen-main{flex-direction:column}
      .map-fullscreen-sidebar{width:100%;max-height:300px;border-left:none;border-top:1px solid var(--bd)}
      .itin-preview{
        top:auto; bottom:8px; right:8px; left:8px;
        width:auto; max-width:none; max-height:60vh;  /* paneau large, hauteur raisonnable */
      }
    }@media (max-width:900px){
  .hdr-row{display:none}
  .langpick{max-width:80px}
}

    .cols{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:10px}
    @media (max-width:900px){ .cols{grid-template-columns:1fr} }

    /* Panels with equal height and aligned CTAs */
    .panel{background:#fff;border:1px solid var(--bd);border-radius:12px;padding:14px;display:flex;flex-direction:column;min-height:340px}
    .panel h2{margin:0 0 12px;padding-bottom:8px;font-size:17px;color:var(--mut);border-bottom:2px solid var(--bd);font-weight:700}
    .panel .grow{flex:1}
    .panel ul{margin:6px 0 0 18px}
    .panel li{margin:6px 0}
    .ctaRow{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:center;margin-top:auto} /* <- push CTAs to bottom */
    .cta{background:var(--acc);color:#fff;border:1px solid var(--acc);border-radius:12px;padding:10px 14px;font-weight:800;cursor:pointer}
    
    /* Builder box (mode expert) */.builder-box{background:linear-gradient(135deg, #113f7a 0%, #5ba4d4 100%);border-radius:14px;padding:20px;box-shadow:0 4px 12px rgba(17,63,122,.3);cursor:pointer;transition:all .3s}
    .builder-content{text-align:center}
    .builder-box h2{margin:0 0 10px;font-size:22px;color:#fff;font-weight:800}
    .builder-box p{margin:0 0 16px;color:#fff;font-size:15px;opacity:.95}
   .builder-box .cta{background:#fff;color:#113f7a;border:2px solid #fff;font-size:15px;display:none}
    .builder-box .cta:hover{background:rgba(255,255,255,.9);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
    
    /* Coloration dynamique des boutons selon le mode */
    .mode-simple .cta{background:linear-gradient(135deg, #4a1d1d 0%, #cf8282 100%);border-color:#4a1d1d}
    .mode-simple .map-explorer{background:linear-gradient(135deg, #4a1d1d 0%, #cf8282 100%);border-color:#4a1d1d}
   
    .mode-simple .map-explorer:hover{box-shadow:0 4px 16px rgba(74,29,29,.3)}
    .mode-simple .budget-modal-btn.primary{background:#00b2ff}
    .mode-simple .budget-modal-btn.primary:hover{background:#0095d9}
    .mode-simple .btn-validate{background:#00b2ff}
    .mode-simple .btn-validate:hover{background:#0095d9}
    
    .mode-expert .cta{background:linear-gradient(135deg, #113f7a 0%, #5ba4d4 100%);border-color:#113f7a}
    .mode-expert .cta:hover{background:#0d2f5a}
    .mode-expert .map-explorer{background:linear-gradient(135deg, #113f7a 0%, #5ba4d4 100%);border-color:#113f7a}
    .mode-expert .map-explorer:hover{box-shadow:0 4px 16px rgba(17,63,122,.3)}
    .mode-expert .budget-modal-btn.primary{background:#21476b}
    .mode-expert .budget-modal-btn.primary:hover{background:#047857}
    .mode-expert .btn-validate{background:#21476b}
    .mode-expert .btn-validate:hover{background:#047857}

    .full{background:#fff;border:1px solid var(--bd);border-radius:12px;padding:16px;margin-top:14px}
    .full h2{margin:0 0 8px;color:var(--acc);font-size:18px}
    .full ul{margin:6px 0 0 18px}
    .full li{margin:6px 0}
    .muted{color:var(--mut);font-size:14px}

    /* bottom panel layout with image on the right */
    .fullGrid{display:grid;grid-template-columns:2fr 1fr;gap:16px;align-items:start}
    @media (max-width:900px){ .fullGrid{grid-template-columns:1fr} }
    .pilot{width:100%;max-width:520px;border-radius:12px;border:1px solid var(--bd);box-shadow:0 4px 16px rgba(0,0,0,.12)}

    .support{margin-top:14px;padding:12px;border:1px solid var(--warn);background:#fef9c3;border-radius:12px;color:#713f12;font-size:15px}

    footer{margin:26px 0 20px;text-align:center;font-size:14px;opacity:.9}
    footer a, footer button.link{color:var(--acc);text-decoration:none;background:none;border:0;cursor:pointer}
    footer a:hover, footer button.link:hover{text-decoration:underline}

    #cookieBanner{position:fixed;left:50%;transform:translateX(-50%);bottom:12px;z-index:99999;display:none}
    #cookieBanner .panel{max-width:520px;background:#fff;border:1px solid var(--bd);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.12);padding:10px}
    #cookiePrefs{display:none;margin-top:6px;text-align:left}
    #cookiePrefs label{display:flex;align-items:center;gap:8px;margin:4px 0}
  #cookieBanner .row{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;margin-top:8px}
#cookieBanner .btn{background:#fff;color:#113f7a;border:1px solid #113f7a}       /* ‚Üê boutons visibles sur fond blanc */
#cookieBanner #btnAccept{background:#113f7a;color:#fff;border-color:#113f7a}     /* ‚Üê bouton 'Tout accepter' en accent */


/* Email modal */
#emailModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);align-items:center;justify-content:center;z-index:10000}
.modal-card{width:min(440px,92vw);background:#fff;border-radius:14px;border:1px solid #c3d6b6;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.16);color:var(--ink)}
.modal-card h3{margin:0 0 6px}
.input{width:100%;padding:10px 12px;border:1px solid #113f7a;border-radius:10px;margin:8px 0}
.muted{font-size:13px;color:#475569}
.links{display:flex;align-items:center;gap:10px}
.link{background:none;border:0;color:#113f7a;cursor:pointer;text-decoration:underline;padding:0}
.actions{display:flex;gap:10px;justify-content:flex-end;margin-top:8px}
.btn-outline{background:#fff;color:var(--acc);border:1px solid var(--acc);border-radius:10px;padding:8px 12px;cursor:pointer}
.btn-primary{background:var(--acc);color:#fff;border:1px solid var(--acc);border-radius:10px;padding:8px 12px;cursor:pointer}
.alert{padding:12px;border-radius:8px;margin:8px 0;border:1px solid}
.alert-success{background:#f0fdf4;border-color:#bbf7d0;color:#166534}
.alert-error{background:#fef2f2;border-color:#fecaca;color:#dc2626}
.input-wrap{position:relative}
.eye-btn{position:absolute;right:8px;top:50%;transform:translateY(-50%);border:0;background:transparent;cursor:pointer;padding:6px;border-radius:8px}
.eye-btn:focus{outline:2px solid #c3d6b6;outline-offset:2px}
.eye-btn svg{width:20px;height:20px}

/* Filter badge counter */
.filter-badge{background:#ef4444;color:#fff;border-radius:12px;padding:2px 8px;font-size:12px;font-weight:700;margin-left:6px}

/* === TABLEAU TARIFS === */
.pricing-wrap{max-width:1200px;margin:32px auto 0;padding:0 16px}
.pricing-section{position:relative}
.pricing-toggle{display:none;align-items:center;gap:8px;background:#113f7a;color:#fff;padding:12px 16px;border-radius:8px;margin-bottom:16px;cursor:pointer;border:none;font-size:15px;font-weight:600}
.pricing-toggle svg{width:20px;height:20px;flex-shrink:0}
.pricing-table{width:100%;border-collapse:separate;border-spacing:0 10px}
.pricing-table thead th{background:#dfe8f4;color:#0d3159;padding:14px 12px;font-weight:700;text-align:center;font-size:14px}
.pricing-table thead th:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px;text-align:left}
.pricing-table thead th:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
.pricing-table tbody td{background:#fff;padding:14px 12px;border-top:1px solid #e6eef7;border-bottom:1px solid #e6eef7;font-size:14px}
.pricing-table tbody tr td:first-child{border-left:1px solid #e6eef7;border-top-left-radius:10px;border-bottom-left-radius:10px;font-weight:600}
.pricing-table tbody tr td:last-child{border-right:1px solid #e6eef7;border-top-right-radius:10px;border-bottom-right-radius:10px}
.price{font-weight:800;font-size:1.25rem}
.yes{color:#157347;font-weight:700}
.no{color:#9b1c1c;font-weight:700}
.plans-head{display:flex;gap:10px;align-items:center;justify-content:flex-end}
.badge{background:#0d3159;color:#fff;border-radius:999px;padding:4px 10px;font-size:.8rem}

/* Responsive mobile pour le tableau des prix */
@media (max-width: 768px) {
  .pricing-toggle{display:flex}
  .pricing-table{display:none}
  .pricing-table.show{display:table}
  .pricing-table{font-size:12px}
  .pricing-table thead th{padding:10px 6px;font-size:12px}
  .pricing-table tbody td{padding:10px 6px;font-size:11px}
  .pricing-table tbody tr td:first-child{font-size:12px}
  .price{font-size:1rem}
  .badge{font-size:.7rem;padding:3px 8px}
  .plans-head{flex-direction:column;gap:4px}
}

  </style>

  
</head>
<body>
<header>
  <div class="header-row-1">
    <a class="brandlink" id="homeLink" href="#">
      <img src="/assets/symbol.webp" alt="Logo"><div class="brand">OneRoadTrip</div>
    </a>

  </div>
  
  <div class="header-row-2">

    <button id="backToPresentation" class="hdr-btn" style="display:none">‚Üê <span id="backBtnText">Retour</span></button>
    <select id="langSel" class="langpick" aria-label="Langue">
      <option value="fr">Fran√ßais</option>
      <option value="en">English</option>
    <option value="it">Italiano</option>
    <option value="es">Espa√±ol</option>
    <option value="pt">Portugu√™s</option>
    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
  </select>
  <div class="auth">
    <button id="openAuth" class="btn" type="button">
      <span>Se connecter</span>
    </button>
    <div id="authPop" class="auth-pop" role="dialog" aria-label="Connexion">
      <button id="btnGoogle" class="btn" type="button">Google</button>
      <button id="btnEmail" class="btn" type="button">E-mail</button>
      <button id="btnLogout" class="btn out" type="button" style="display:none">D√©connexion</button>
    </div>
  </div>
  </div>
</header>

<main>
  <div class="intro" style="display:none">
    <h1 id="title"></h1>
  </div>

  <!-- 4 CARR√âS + ROUTE BUILDER -->
  <div style="max-width:800px;margin:0 auto;padding:8px 16px;">
    
    <!-- Grille 2x2 -->
    <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:16px;">
      
      <!-- Carr√© 1: Choisir sur carte -->
      <div class="ort-card" id="mapExplorerPreview" style="background:#113f7a;border-radius:10px;padding:16px;cursor:pointer;text-align:center;">
        <h3 id="mapTitle" style="margin:0;font-size:15px;color:#fff;line-height:1.4;"></h3>
      </div>
      
      <!-- Carr√© 2: Construire de A √† Z -->
      <div class="ort-card" id="buildFromScratch" style="background:#113f7a;border-radius:10px;padding:16px;cursor:pointer;text-align:center;">
        <h3 id="buildTitle" style="margin:0;font-size:15px;color:#fff;line-height:1.4;"></h3>
      </div>
      
      <!-- Carr√© 3: Trouver sur le web -->
      <div class="ort-card" id="importFromWeb" style="background:#113f7a;border-radius:10px;padding:16px;cursor:pointer;text-align:center;">
        <h3 id="importTitle" style="margin:0;font-size:15px;color:#fff;line-height:1.4;"></h3>
      </div>
      
      <!-- Carr√© 4: Itin√©raires cr√©ateurs -->
      <div class="ort-card" id="creatorsSection" style="background:#113f7a;border-radius:10px;padding:16px;cursor:pointer;text-align:center;">
        <h3 id="creatorsTitle2" style="margin:0;font-size:15px;color:#fff;line-height:1.4;"></h3>
        <a id="becomeCreator" href="creator-terms.html" style="display:block;margin:6px 0 0;font-size:12px;color:rgba(255,255,255,0.8);text-decoration:underline;" onclick="event.stopPropagation();"></a>
      </div>
    </div>
    
    <!-- Route Builder compact -->
    <div style="background:rgba(17,63,122,0.9);border-radius:10px;padding:16px;backdrop-filter:blur(4px);">
      <h3 id="routeBuilderTitle" style="margin:0 0 12px;color:#fff;font-size:15px;text-align:center;"></h3>
      
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;">
        <!-- Ville de d√©part -->
        <div class="rb-field" style="position:relative;">
          <label id="labelStartCity" style="display:block;color:#fff;font-size:12px;margin-bottom:4px;">Ville de d√©part</label>
          <input type="text" id="inputStartCity" autocomplete="off" style="width:100%;padding:8px 10px;border:1px solid #3b82f6;border-radius:6px;font-size:14px;box-sizing:border-box;">
          <div id="startCitySuggestions" class="city-suggestions" style="display:none;position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-radius:6px;max-height:150px;overflow-y:auto;z-index:1000;"></div>
          <small id="warnStartCity" style="display:none;color:#fbbf24;font-size:11px;margin-top:2px;"></small>
          <!-- Case √† cocher Circuit - sur la m√™me ligne -->
          <div style="display:flex;align-items:center;gap:6px;margin-top:6px;">
            <input type="checkbox" id="checkLoopMode" style="width:14px;height:14px;cursor:pointer;accent-color:#3b82f6;">
            <label for="checkLoopMode" id="labelLoopMode" style="color:#94a3b8;font-size:11px;cursor:pointer;">üîÑ Circuit (retour au d√©part)</label>
          </div>
        </div>
        
        <!-- Ville d'arriv√©e -->
        <div class="rb-field" id="endCityContainer" style="position:relative;">
          <label id="labelEndCity" style="display:block;color:#fff;font-size:12px;margin-bottom:4px;">Ville d'arriv√©e</label>
          <input type="text" id="inputEndCity" autocomplete="off" style="width:100%;padding:8px 10px;border:1px solid #3b82f6;border-radius:6px;font-size:14px;box-sizing:border-box;">
          <div id="endCitySuggestions" class="city-suggestions" style="display:none;position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #ddd;border-radius:6px;max-height:150px;overflow-y:auto;z-index:1000;"></div>
          <small id="warnEndCity" style="display:none;color:#fbbf24;font-size:11px;margin-top:2px;"></small>
        </div>
        
        <!-- Km max / D√©tour / Dur√©e sur une ligne -->
        <div style="grid-column:span 2;display:flex;gap:10px;align-items:flex-end;">
          <div style="flex:1;">
            <label id="labelMaxKm" style="display:block;color:#fff;font-size:11px;margin-bottom:4px;">Km/√©tape</label>
            <select id="inputMaxKm" style="width:100%;padding:8px 6px;border:1px solid #3b82f6;border-radius:6px;font-size:13px;box-sizing:border-box;background:#fff;">
              <option value="20">20</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="150">150</option>
              <option value="200" selected>200</option>
              <option value="300">300</option>
              <option value="500">500</option>
            </select>
          </div>
          <div style="flex:1;">
            <label id="labelDetour" style="display:block;color:#fff;font-size:11px;margin-bottom:4px;">D√©tour</label>
            <select id="inputDetour" style="width:100%;padding:8px 6px;border:1px solid #3b82f6;border-radius:6px;font-size:13px;box-sizing:border-box;background:#fff;">
              <option value="0">0 km</option>
              <option value="20">20 km</option>
              <option value="50" selected>50 km</option>
              <option value="100">100 km</option>
            </select>
          </div>
          <div style="flex:1;">
            <label id="labelDuration" style="display:block;color:#fff;font-size:11px;margin-bottom:4px;">Dur√©e</label>
            <div style="display:flex;align-items:center;gap:4px;">
              <input type="number" id="inputDuration" min="1" max="50" value="7" style="width:50px;padding:8px 4px;border:1px solid #3b82f6;border-radius:6px;font-size:13px;box-sizing:border-box;text-align:center;">
              <span id="labelDays" style="color:#fff;font-size:12px;">j</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Bouton -->
      <button id="btnGenerateRoute" style="display:block;width:100%;margin-top:12px;padding:10px;background:linear-gradient(135deg,#113f7a,#1e5a9e);color:#fff;border:none;border-radius:6px;font-size:14px;font-weight:600;cursor:pointer;">
        <span id="generateBtnText">G√©n√©rer mon itin√©raire</span>
      </button>
    </div>
  </div>

  <!-- FULLSCREEN MAP MODAL -->
  <div id="mapFullscreen" class="map-fullscreen">
    <div class="map-fullscreen-content">
      <div class="map-fullscreen-header">
        <h2 id="mapTitleFull" style="text-align:center;flex:1"></h2>
        <span id="visibleItinsCount" class="visible-itins-count"></span>
        <button id="closeMapFull" class="map-fullscreen-close">‚úï <span id="closeBtnText">Fermer</span></button>
      </div>
      <!-- Bandeau de s√©lection en haut -->
      <div id="selectionBanner" style="display:none;position:sticky;top:0;z-index:999;background:linear-gradient(135deg,#113f7a,#1e5a9e);padding:12px 20px;border-bottom:2px solid rgba(255,255,255,0.2);">
        <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;">
          <div id="selectionBannerItems" style="display:flex;flex-wrap:wrap;gap:8px;flex:1;"></div>
          <button id="btnContinueSelection" onclick="validateAndContinue()" style="background:#10b981;color:#fff;border:none;padding:10px 24px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;white-space:nowrap;">Continuer ‚Üí</button>
        </div>
      </div>
      <div class="map-fullscreen-main">
        <div class="map-fullscreen-body">
          <div id="mapContainerFull"></div>
          
          <!-- Bouton toggle filtres mobile -->
          <button id="toggleFiltersMobile" class="filters-toggle-mobile">
            <span id="filtersBtnText">Filtres</span>
          </button>
          
          <!-- L√©gende de la carte -->
          <div class="map-legend" id="mapLegend">
            <div class="map-legend-title" id="legendTitle">Itin√©raires</div>
            <div class="map-legend-item">
              <svg class="legend-star" width="16" height="16" viewBox="0 0 24 24" fill="#1565C0" stroke="#fff" stroke-width="2">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
              </svg>
              <span class="map-legend-label" id="legendIncontournable">Incontournable</span>
            </div>
            <div class="map-legend-item">
              <div class="legend-dot recommande"></div>
              <span class="map-legend-label" id="legendRecommande">Recommand√©</span>
            </div>
            <div class="map-legend-item">
              <div class="legend-dot decouvrir"></div>
              <span class="map-legend-label" id="legendDecouvrir">√Ä d√©couvrir</span>
            </div>
            <div class="map-legend-item">
              <div class="legend-dot standard"></div>
              <span class="map-legend-label" id="legendStandard">Standard</span>
            </div>
            <div class="map-legend-item">
              <div class="legend-dot selected"></div>
              <span class="map-legend-label" id="legendSelected">S√©lectionn√©</span>
            </div>
          </div>
          
          <!-- Aper√ßu au survol -->
<div id="itinPreview" class="itin-preview" style="display:none">
  <button onclick="closeItinPreview()" style="position:absolute;top:10px;right:10px;background:#e5e7eb;color:#333;border:none;padding:8px 12px;border-radius:6px;font-size:14px;cursor:pointer;z-index:10;">‚úï</button>
  <h3 id="previewTitle"></h3>

  <!-- NEW: conteneur des 4 photos li√©es aux lieux de l‚Äôitin -->
  <div class="preview-photos" id="previewPhotos"></div>
  <!-- ‚Ä¶ autres infos ‚Ä¶ -->

            <div id="previewInfo"></div>
            <div id="previewPathSimplified" class="preview-path-simplified" style="display:none">
              <div class="path-title">Parcours simplifi√© :</div>
              <div class="path-flow" id="previewPathFlow"></div>
            </div>
            <div id="previewCities"></div>
            <button id="previewSelectBtn" style="width:100%;margin-top:12px;background:#10b981;color:#fff;border:none;padding:12px 16px;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;">+ Ajouter √† ma s√©lection</button>
          </div>
        </div>
        
        <!-- Barre fixe bouton s√©lection (mobile uniquement) -->
        <div id="mobileActionBar" class="mobile-action-bar">
          <button id="mobileCancelBtn" class="mobile-btn-cancel">
            <span id="mobileCancelBtnText">Annuler</span>
          </button>
          <button id="selectItinBtnMobile" class="select-itin-btn-mobile">
            <span id="selectItinBtnMobileText">Valider</span>
          </button>
        </div>
        
        <!-- Modale confirmation simple mobile -->
        <div id="mobileConfirmModal" class="mobile-confirm-modal">
          <div class="mobile-confirm-content">
            <h3 id="mobileConfirmTitle"></h3>
            <div id="mobileConfirmInfo"></div>
            <div class="mobile-confirm-actions">
              <button id="mobileConfirmCancel" class="mobile-btn-cancel">
                <span id="mobileConfirmCancelText">Annuler</span>
              </button>
              <button id="mobileConfirmValidate" class="mobile-btn-validate">
                <span id="mobileConfirmValidateText">Valider</span>
              </button>
            </div>
          </div>
        </div>
        
        <!-- Modale de s√©lection mobile uniquement -->
        <div id="mobileSelectionModal" class="mobile-selection-modal">
          <div class="mobile-selection-content" style="background:#fff;border-radius:12px;max-width:95vw;width:400px;max-height:85vh;overflow:hidden;">
            <div class="mobile-selection-header" style="display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#113f7a;border-radius:12px 12px 0 0;">
              <button id="mobileModalSelect" style="background:#10b981;color:#fff;border:none;padding:10px 20px;border-radius:8px;font-weight:600;font-size:14px;">S√©lectionner</button>
              <h3 id="mobileModalTitle" style="flex:1;text-align:center;color:#fff;margin:0 10px;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"></h3>
              <button id="mobileModalCancel" style="background:rgba(255,255,255,0.2);border:none;color:#fff;font-size:20px;cursor:pointer;padding:0;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;">‚úï</button>
            </div>
            <div class="mobile-selection-body" style="padding:16px;max-height:calc(85vh - 60px);overflow-y:auto;">
              <div id="mobileModalInfo" style="margin-bottom:12px;"></div>
              <div id="mobileModalPhotos" style="margin:12px 0;"></div>
              <div id="mobileModalSteps" style="margin-top:16px;font-size:14px;border-top:1px solid #e5e7eb;padding-top:12px;"></div>
            </div>
          </div>
        </div>
        
        <div class="map-fullscreen-sidebar">
          <div class="map-controls-vertical">
            <h3 id="filterTitle"></h3>
            
            <div class="filter-group">
              <label for="filterDaysFull" id="labelDaysFull"></label>
              <select id="filterDaysFull" class="filter-select">
                <option value="">Tous</option>
                <option value="1-3">1-3 jours</option>
                <option value="4-7">4-7 jours</option>
                <option value="8-14">8-14 jours</option>
                <option value="15+">15+ jours</option>
              </select>
            </div>
            <div class="filter-group">
         <label for="filterDistanceFull" id="labelDistanceFull" style="display:none"></label>
<select id="filterDistanceFull" class="filter-select" style="display:none">
  <option value="">Toutes</option>
  <option value="0-500">0-500 km</option>
  <option value="501-1000">501-1000 km</option>
  <option value="1001-2000">1001-2000 km</option>
  <option value="2001+">2001+ km</option>
</select>

            </div>
            <div class="filter-group">
       <label for="filterCountryFull" id="labelCountryFull" style="display:none"></label>
<select id="filterCountryFull" class="filter-select" style="display:none">
  <option value="">Tous</option>
</select>

            </div>
            <div class="filter-group">
        <label for="filterRegionFull" id="labelRegionFull" style="display:none"></label>
<select id="filterRegionFull" class="filter-select" style="display:none">
  <option value="">Toutes</option>
</select>
    </div>
            <div class="filter-group">
              <label for="filterThemeFull" id="labelThemeFull"></label>
<select id="filterThemeFull" class="filter-select">
  <option value="">Tous</option>
  <!-- Options g√©n√©r√©es dynamiquement depuis themes.i18n.json -->
</select>
            </div>
            <div class="filter-group">
              <label for="searchItinFull" id="labelSearchFull"></label>
              <input type="text" id="searchItinFull" class="filter-input" placeholder="Mot-cl√©...">
            </div>
            <button id="btnResetFiltersFull" class="btn-reset-full"></button>
            <div class="filter-count-box">
              <span id="filterCountFull"></span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- TABLEAU COMPLET account.html -->
  <div class="full pricing-section" style="display:none;margin-top:24px">
    <!-- Bouton pour afficher/masquer les prix sur mobile -->
    <button class="pricing-toggle" id="pricingToggle">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"/>
        <path d="M12 16v-4M12 8h.01"/>
      </svg>
      <span id="pricingToggleText">Voir les tarifs d√©taill√©s</span>
    </button>
    
    <table class="pricing-table" id="pricing-table">
      <thead>
        <tr>
          <th data-i18n="col.feature">Fonctionnalit√©s</th>
          <th><div class="plans-head"><span data-i18n="plan.bronze">Bronze</span></div></th>
          <th><div class="plans-head"><span data-i18n="plan.silver">Silver</span><span class="badge" data-i18n="plan.popular">Le plus populaire</span></div></th>
          <th><div class="plans-head"><span data-i18n="plan.gold">Gold</span></div></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td data-i18n="row.price">Prix mensuel</td>
          <td class="price" data-i18n="pricing.bronze.price">Gratuit</td>
          <td class="price" data-i18n="pricing.silver.price">4,99 ‚Ç¨/mois</td>
          <td class="price" data-i18n="pricing.gold.price">9,99 ‚Ç¨/mois</td>
        </tr>
        <tr>
          <td data-i18n="row.core">C≈ìur d'ORT (itin√©raires modifiables, d√©tails d'√©tapes, points d'int√©r√™ts, liens de r√©servation)</td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
        </tr>
        <tr>
          <td data-i18n="row.stories">Stories publiques & partage</td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
        </tr>
        <tr>
          <td data-i18n="row.pdf">Export PDF complet du voyage</td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
        </tr>
        <tr>
          <td data-i18n="row.maps">Cartes interactives</td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
          <td><span class="yes" data-i18n="yes">Oui</span></td>
        </tr>
        <tr>
          <td data-i18n="row.rtlimit">Roadtrips pouvant √™tre stock√©s dans le dashboard</td>
          <td data-i18n="pricing.bronze.rtlimit">3</td>
          <td data-i18n="pricing.silver.rtlimit">20</td>
          <td data-i18n="pricing.gold.rtlimit">50</td>
        </tr>
        <tr>
          <td data-i18n="row.photosday">Photos par jour pouvant √™tre publi√©es dans votre story</td>
          <td data-i18n="pricing.bronze.photos">3</td>
          <td data-i18n="pricing.silver.photos">15</td>
          <td data-i18n="pricing.gold.photos">50</td>
        </tr>
        <tr>
          <td data-i18n="row.storage">Espace total photos</td>
          <td data-i18n="pricing.bronze.storage">1 Go</td>
          <td data-i18n="pricing.silver.storage">20 Go</td>
          <td data-i18n="pricing.gold.storage">100 Go</td>
        </tr>
        <tr>
          <td data-i18n="row.ai">Assistance IA (cr√©ations automatiques d'itin√©raires et avis sur le voyage)</td>
          <td><span class="no" data-i18n="no">Non</span></td>
          <td data-i18n="pricing.silver.ia">10 actions par mois</td>
          <td data-i18n="pricing.gold.ia">30 actions par mois</td>
        </tr>
        <tr>
          <td data-i18n="row.backup">Sauvegarde Cloud (s√©curit√© de vos donn√©es)</td>
          <td><span class="no" data-i18n="no">Non</span></td>
          <td data-i18n="pricing.silver.backup">Automatique</td>
          <td data-i18n="pricing.gold.backup">Automatique</td>
        </tr>
        <tr>
          <td data-i18n="row.family">Espace famille / amis (inviter des proches)</td>
          <td><span class="no" data-i18n="no">Non</span></td>
          <td data-i18n="pricing.silver.family">Jusqu'√† 3 invit√©s</td>
          <td data-i18n="pricing.gold.family">Jusqu'√† 10 invit√©s</td>
        </tr>
      </tbody>
    </table>
  </div>

</main>

<!-- DEBUG PANEL -->
<div id="debugPanel" style="position:fixed;bottom:20px;right:20px;background:rgba(0,0,0,0.9);color:#0f0;padding:12px;border-radius:8px;font-family:monospace;font-size:11px;z-index:99999;max-width:280px;border:2px solid #0f0;line-height:1.5;">
  <strong style="display:block;margin-bottom:8px;">‚öôÔ∏è DEBUG</strong>
  <div>FPS: <span id="debugFPS">--</span></div>
  <div>Markers: <span id="debugMarkers">--</span></div>
  <div>Zoom: <span id="debugZoom">--</span></div>
  <div>Coords: <span id="debugCoords">--</span></div>
  <div>Event: <span id="debugEvent">--</span></div>
  <div>Memory: <span id="debugMemory">--</span></div>
</div>

<footer id="footer-legal"></footer>


<!-- Firebase compat est charg√© dynamiquement par ensureFirebase() (v10.12.2) -->
<script async src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script async src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script>
/* ===== I18N TRANSLATIONS ===== */
const T = {
  fr: {
    notice: "Sans inscription, vos itin√©raires ne seront pas sauvegard√©s",
    title: "OneRoadTrip ‚Äì Cr√©ez le voyage de vos r√™ves",
    
    // Mode Expert : Construisez de A √† Z
    builder_title: "Construisez votre itin√©raire de A √† Z",
    builder_text: "Partez d'une page blanche et cr√©ez votre voyage √©tape par √©tape en s√©lectionnant des lieux sur une carte interactive du monde entier.",
    builder_btn: "Commencer la cr√©ation",
    
    // Option simplifi√©e
    left_title: "Cr√©ez votre voyage en 5 questions simples",
    left_list: [
      "Quelle destination vous fait r√™ver ?",
      "Combien de jours partez-vous ?",
      "Quel style de voyage pr√©f√©rez-vous : aventure, d√©tente, culture ?",
      "Comment vous d√©placerez-vous sur place ?",
      "Quel est votre budget approximatif ?"
    ],
    btn_simple: "Je commence maintenant",
    
    // Option compl√®te
// Option compl√®te
right_title: "Trouvez sur le web un itin√©raire ou une liste de lieux qui vous inspire et construisez le voyage de vos r√™ves",
creators_title: "Voir les itin√©raires propos√©s par des cr√©ateurs de contenus",
become_creator: "Devenir cr√©ateur",
right_lead: "",
right_list: [
  "Copiez l'itin√©raire* qui vous inspire depuis n'importe quel site web",
  "Utilisez un assistant IA pour l'optimiser selon nos instructions (ChatGPT, Claude...)",
  "Collez le r√©sultat dans notre interface",
  "Obtenez instantan√©ment un voyage 100% modifiable et personnalisable"
],
right_note: "*Important : Assurez-vous que le contenu copi√© est libre de droits",
    btn_full: "J'importe un voyage",
    
    // R√©sultats
    bottom_title: "Votre voyage cl√© en main comprend",
    bottom_list: [
      "Itin√©raire d√©taill√© jour par jour avec dur√©es de trajet optimis√©es",
      "Carte interactive avec toutes vos √©tapes g√©olocalis√©es",
      "Modification illimit√©e de votre parcours en temps r√©el",
      "R√©servation directe des vols et locations de v√©hicules",
      "Acc√®s aux meilleurs h√¥tels via nos partenaires privil√©gi√©s",
      "R√©servation d'activit√©s et d'exp√©riences uniques",
      "Options compl√®tes d'assurance voyage"
    ],
    
    stage_hdr: "Pour chaque √©tape de votre voyage, d√©couvrez :",
    stage_1: "Programme quotidien optimis√© avec horaires sugg√©r√©s",
    stage_2: "Points d'int√©r√™t incontournables et vos ajouts personnalis√©s",
    stage_3: "Carte d√©taill√©e avec itin√©raire de visite optimis√©",
    stage_4: "S√©lection d'h√©bergements adapt√©s √† votre budget",
    
    doc_line: "Export en PDF ou PowerPoint ‚Ä¢ Acc√®s mobile hors-ligne ‚Ä¢ Partage facile avec vos compagnons de voyage",
    support: "OneRoadTrip est 100% gratuit. Les r√©servations via nos liens partenaires nous aident √† maintenir le service sans aucun surco√ªt pour vous. Merci pour votre soutien !",
    
    login: "Se connecter",
    badge_mode_simple: "Mode Simplifi√©",
    badge_mode_expert: "Mode Expert",
    cookie_text: "Nous utilisons des cookies essentiels pour votre connexion. Les cookies optionnels sont d√©sactiv√©s par d√©faut.",
    cookie_opt_a: "Statistiques d'utilisation",
    cookie_opt_m: "Marketing cibl√©",
    cookie_btn_p: "Personnaliser",
    cookie_btn_r: "Tout refuser",
    cookie_btn_a: "Tout accepter",
    pricing_show: "Voir les tarifs d√©taill√©s",
    pricing_hide: "Masquer les tarifs",
    mapTitle:"Choisissez votre itin√©raire sur une carte",
    buildTitle:"Construisez votre itin√©raire de A √† Z",
    importTitle:"Trouvez sur le web un itin√©raire qui vous inspire",
    creatorsTitle:"Itin√©raires propos√©s par les cr√©ateurs",
    becomeCreator:"Devenir cr√©ateur",
    routeBuilderTitle:"üöó Laissez-nous construire votre itin√©raire",
    labelStartCity:"Ville de d√©part",
    labelEndCity:"Ville d'arriv√©e",
    labelLoopMode:"üîÑ Circuit (retour au d√©part)",
    labelMaxKm:"Km/√©tape",
    labelDuration:"Dur√©e",
    generateBtn:"üöÄ G√©n√©rer mon itin√©raire",
    labelDetour:"D√©tour autoris√©",
    labelDaysUnit:"jours",
    warnCityNotSelected:"‚ö†Ô∏è Ville non valid√©e - r√©sultat peut √™tre inexact",
    generatingBtn:"‚è≥ Calcul en cours...",
    placeholderStart:"Paris, Lyon...",
    placeholderEnd:"Barcelone, Rome...",
    days:"jours",
    mapClickToOpen:"Cliquez pour ouvrir la carte interactive",
    filterTitle:"Filtres",
    filtersBtnText:"üîç Filtres",
    labelDays:"Dur√©e :",
    labelDistance:"Distance :",
    labelCountry:"Pays :",
    labelRegion:"R√©gion :",
    labelTheme:"Th√®me :",
    labelSearch:"Recherche :",
    btnReset:"R√©initialiser",
    filterCount_single:"itin√©raire trouv√©",
    filterCount_plural:"itin√©raires trouv√©s",
    popupDays:"jours",
    popupViewDetails:"Voir les d√©tails",
    selectionTitle:"S√©lection (max 3)",
    selectionTitleSimple:"S√©lection (max 1)",
    selectionTitleExpert:"S√©lection (max 3)",
    compareBtn:"Voir l'itin√©raire",
    alertAlreadySelected:"D√©j√† s√©lectionn√©",
    alertMaxSelection:"Maximum 3 itin√©raires",
    alertMaxSelectionSimple:"Maximum 1 itin√©raire en mode simplifi√©",
    selectBtnText:"S√©lectionner",
    mobileSelectText:"S√©lectionner",
    mobileCancelText:"Annuler",
    mobileDays:"jours",
    mobileStops:"√©tapes",
    mobileCities:"Villes travers√©es :",
    closeBtnText:"Fermer",
    backBtnText:"Retour",
    homeBtnText:"‚Üê Retour",
    legend_title:"Itin√©raires",
    legend_incontournable:"Incontournable",
    legend_recommande:"Recommand√©",
    legend_decouvrir:"√Ä d√©couvrir",
    legend_standard:"Standard",
    legend_selected:"S√©lectionn√©",
    visible_itins_single:"itin√©raire visible",
    visible_itins_plural:"itin√©raires visibles",
    budget_modal_title:"Budget h√¥tel",
    budget_modal_text:"S√©lectionnez une ou plusieurs tranches (‚Ç¨/jour/personne) :",
    budget_confirm:"Valider",
    budget_cancel:"Annuler",
    budget_0_50:"0‚Äì50",
    budget_50_100:"50‚Äì100",
    budget_100_150:"100‚Äì150",
    budget_150_200:"150‚Äì200",
    budget_200_250:"200‚Äì250",
    budget_250_300:"250‚Äì300",
    budget_300_500:"300‚Äì500",
    budget_500plus:"Au-del√† de 500",
    budget_cancel:"Annuler",
    pace_title:"Rythme :",
    pace_fast:"Rapide",
    pace_normal:"Normal",
    pace_slow:"Tranquille",
    modal_title:"Configurez votre voyage",
    modal_departure_date:"Date de d√©part :",
    modal_num_days:"Nombre de jours souhait√©s :",
    modal_max_hotels:"Changements d'h√¥tel maximum :",
    modal_budget_label:"Budget h√¥tel (‚Ç¨/jour/personne) :",
    filterAllDays:"Tous",
    filterAllDistances:"Toutes",
    filterAllCountries:"Tous",
    filterAllRegions:"Toutes",
    filterAllThemes:"Tous",
    searchPlaceholder:"Mot-cl√©...",
    // Options de filtres
    filter_days_1_3:"1-3 jours",
    filter_days_4_7:"4-7 jours",
    filter_days_8_14:"8-14 jours",
    filter_days_15plus:"15+ jours",
    filter_dist_0_500:"0-500 km",
    filter_dist_501_1000:"501-1000 km",
    filter_dist_1001_2000:"1001-2000 km",
    filter_dist_2001plus:"2001+ km",
  filter_theme_montagne:"Montagne",
filter_theme_mer_cotes:"Mer & C√¥tes",
filter_theme_ville_histoire:"Ville & Histoire",
filter_theme_nature:"Nature",
filter_theme_culture:"Culture",
filter_theme_gastronomie_vin:"Gastronomie & Vin",
filter_theme_aventure_outdoor:"Aventure & Outdoor",
filter_theme_route_exploration:"Route & Exploration",
filter_theme_insolite_hors_sentiers:"Insolite & Hors sentiers battus",
filter_theme_faune_vie_sauvage:"Faune & Vie sauvage",
filter_theme_spiritualite_religion:"Spiritualit√© & Religion",
filter_theme_bien_etre_detente:"Bien-√™tre & D√©tente",
filter_theme_detente:"D√©tente",
filter_theme_tested_ort:"Test√© & approuv√© ORT",
  },

  en: {
    notice: "Without registration, your trips won't be saved",
    title: "OneRoadTrip ‚Äì Design Your Dream Journey",
    
    // Expert Mode: Build from Scratch
    builder_title: "Build Your Itinerary from A to Z",
    builder_text: "Start from scratch and create your trip step by step by selecting places on an interactive world map.",
    builder_btn: "Start Building",
    
    left_title: "Build Your Trip in 5 Simple Questions",
    left_list: [
      "Which destination calls to you?",
      "How many days is your adventure?",
      "What's your travel style: adventure, relaxation, culture?",
      "How will you get around locally?",
      "What's your approximate budget?"
    ],
    btn_simple: "Start Building Now",
    
right_title: "Find an itinerary or list of places on the web that inspires you and build your dream trip",
creators_title: "View itineraries proposed by content creators",
become_creator: "Become a creator",
right_lead: "",
right_list: [
  "Copy the itinerary* that inspires you from any website",
  "Use an AI assistant to optimize it following our instructions (ChatGPT, Claude...)",
  "Paste the result into our interface",
  "Instantly get a 100% editable and customizable trip"
],
right_note: "*Important: Make sure the copied content is copyright-free",
    btn_full: "Import a Trip",
    
    bottom_title: "Your Complete Travel Package Includes",
    bottom_list: [
      "Day-by-day detailed itinerary with optimized travel times",
      "Interactive map with all your geolocated destinations",
      "Unlimited real-time modifications to your route",
      "Direct booking for flights and car rentals",
      "Access to top-rated accommodations via our partners",
      "Booking for unique activities and experiences",
      "Comprehensive travel insurance options"
    ],
    
    stage_hdr: "Each destination in your journey features:",
    stage_1: "Optimized daily schedule with suggested times",
    stage_2: "Must-see attractions plus your personal additions",
    stage_3: "Detailed map with optimized visit route",
    stage_4: "Curated accommodation selection for your budget",
    
    doc_line: "Export to PDF or PowerPoint ‚Ä¢ Offline mobile access ‚Ä¢ Easy sharing with travel companions",
    support: "OneRoadTrip is 100% free. Bookings through our partner links help us keep it that way‚Äîat no extra cost to you. Thank you!",
    
    login: "Sign In",
    badge_mode_simple: "Simple Mode",
    badge_mode_expert: "Expert Mode",
    cookie_text: "We use essential cookies for authentication. Optional cookies are off by default.",
    cookie_opt_a: "Usage Analytics",
    cookie_opt_m: "Targeted Marketing",
    cookie_btn_p: "Customize",
    cookie_btn_r: "Reject All",
    cookie_btn_a: "Accept All",
    pricing_show: "View detailed pricing",
    pricing_hide: "Hide pricing",
    mapTitle:"Choose your itinerary on a map",
    buildTitle:"Build your itinerary from A to Z",
    importTitle:"Find an itinerary on the web that inspires you",
    creatorsTitle:"Itineraries from creators",
    becomeCreator:"Become a creator",
    routeBuilderTitle:"üöó Let us build your itinerary",
    labelStartCity:"Departure city",
    labelEndCity:"Arrival city",
    labelLoopMode:"üîÑ Round trip (back to start)",
    labelMaxKm:"Km/stop",
    labelDuration:"Duration",
    generateBtn:"üöÄ Generate my itinerary",
    labelDetour:"Allowed detour",
    labelDaysUnit:"days",
    warnCityNotSelected:"‚ö†Ô∏è City not validated - result may be inaccurate",
    generatingBtn:"‚è≥ Calculating...",
    placeholderStart:"Paris, London...",
    placeholderEnd:"Barcelona, Rome...",
    days:"days",
    mapClickToOpen:"Click to open interactive map",
    filterTitle:"Filters",
    filtersBtnText:"üîç Filters",
    labelDays:"Duration:",
    labelDistance:"Distance:",
    labelCountry:"Country:",
    labelRegion:"Region:",
    labelTheme:"Theme:",
    labelSearch:"Search:",
    btnReset:"Reset",
    filterCount_single:"itinerary found",
    filterCount_plural:"itineraries found",
    popupDays:"days",
    popupViewDetails:"View details",
    selectionTitle:"Selection (max 3)",
    selectionTitleSimple:"Selection (max 1)",
    selectionTitleExpert:"Selection (max 3)",
    compareBtn:"View itinerary",
    alertAlreadySelected:"Already selected",
    alertMaxSelection:"Maximum 3 itineraries",
    alertMaxSelectionSimple:"Maximum 1 itinerary in simple mode",
    selectBtnText:"Select",
    mobileSelectText:"Select",
    mobileCancelText:"Cancel",
    mobileDays:"days",
    mobileStops:"stops",
    mobileCities:"Cities:",
    closeBtnText:"Close",
    backBtnText:"Back",
    homeBtnText:"‚Üê Back",
    legend_title:"Itineraries",
    legend_incontournable:"Must-see",
    legend_recommande:"Recommended",
    legend_decouvrir:"Discover",
    legend_standard:"Standard",
    legend_selected:"Selected",
    visible_itins_single:"visible itinerary",
    visible_itins_plural:"visible itineraries",
    budget_modal_title:"Hotel Budget",
    budget_modal_text:"Select one or more ranges (‚Ç¨/day/person):",
    budget_confirm:"Validate",
    budget_cancel:"Cancel",
    budget_0_50:"0‚Äì50",
    budget_50_100:"50‚Äì100",
    budget_100_150:"100‚Äì150",
    budget_150_200:"150‚Äì200",
    budget_200_250:"200‚Äì250",
    budget_250_300:"250‚Äì300",
    budget_300_500:"300‚Äì500",
    budget_500plus:"500+",
    pace_title:"Pace:",
    pace_fast:"Fast",
    pace_normal:"Normal",
    pace_slow:"Relaxed",
    modal_title:"Configure your trip",
    modal_departure_date:"Departure date:",
    modal_num_days:"Number of days:",
    modal_max_hotels:"Maximum hotel changes:",
    modal_budget_label:"Hotel budget (‚Ç¨/day/person):",
    filterAllDays:"All",
    filterAllDistances:"All",
    filterAllCountries:"All",
    filterAllRegions:"All",
    filterAllThemes:"All",
    searchPlaceholder:"Keyword...",
    // Filter options
    filter_days_1_3:"1-3 days",
    filter_days_4_7:"4-7 days",
    filter_days_8_14:"8-14 days",
    filter_days_15plus:"15+ days",
    filter_dist_0_500:"0-500 km",
    filter_dist_501_1000:"501-1000 km",
    filter_dist_1001_2000:"1001-2000 km",
    filter_dist_2001plus:"2001+ km",
 filter_theme_montagne:"Mountain",
filter_theme_mer_cotes:"Sea & Coasts",
filter_theme_ville_histoire:"City & History",
filter_theme_nature:"Nature",
filter_theme_culture:"Culture",
filter_theme_gastronomie_vin:"Food & Wine",
filter_theme_aventure_outdoor:"Adventure & Outdoor",
filter_theme_route_exploration:"Road & Exploration",
filter_theme_insolite_hors_sentiers:"Unusual & Offbeat",
filter_theme_faune_vie_sauvage:"Wildlife",
filter_theme_spiritualite_religion:"Spirituality & Religion",
filter_theme_bien_etre_detente:"Wellness & Relax",
filter_theme_detente:"Relax",
filter_theme_tested_ort:"ORT tested & approved",
  },

  it: {
    notice: "Senza registrazione, i tuoi viaggi non verranno salvati",
    title: "OneRoadTrip ‚Äì Progetta il Viaggio dei Tuoi Sogni",
    
    // Modalit√† Esperto: Costruisci da Zero
    builder_title: "Costruisci il Tuo Itinerario da A a Z",
    builder_text: "Parti da zero e crea il tuo viaggio passo dopo passo selezionando luoghi su una mappa interattiva del mondo.",
    builder_btn: "Inizia a Costruire",
    
    left_title: "Crea il Tuo Viaggio in 5 Semplici Domande",
    left_list: [
      "Quale destinazione ti attira?",
      "Quanti giorni dura la tua avventura?",
      "Qual √® il tuo stile di viaggio: avventura, relax, cultura?",
      "Come ti sposterai sul posto?",
      "Qual √® il tuo budget approssimativo?"
    ],
    btn_simple: "Inizia Subito",
    
 right_title: "Trova sul web un itinerario o una lista di luoghi che ti ispira e costruisci il viaggio dei tuoi sogni",
creators_title: "Visualizza itinerari proposti da creatori di contenuti",
become_creator: "Diventa creatore",
right_lead: "",
right_list: [
  "Copia l'itinerario* che ti ispira da qualsiasi sito web",
  "Usa un assistente IA per ottimizzarlo seguendo le nostre istruzioni (ChatGPT, Claude...)",
  "Incolla il risultato nella nostra interfaccia",
  "Ottieni subito un viaggio 100% modificabile e personalizzabile"
],
right_note: "*Importante: Assicurati che il contenuto copiato sia libero da copyright",

    btn_full: "Importa un Viaggio",
    
    bottom_title: "Il Tuo Pacchetto Viaggio Completo Include",
    bottom_list: [
      "Itinerario dettagliato giorno per giorno con tempi di percorrenza ottimizzati",
      "Mappa interattiva con tutte le tue tappe geolocalizzate",
      "Modifiche illimitate del percorso in tempo reale",
      "Prenotazione diretta di voli e noleggio auto",
      "Accesso ai migliori alloggi tramite i nostri partner",
      "Prenotazione di attivit√† ed esperienze uniche",
      "Opzioni complete di assicurazione viaggio"
    ],
    
    stage_hdr: "Ogni tappa del tuo viaggio include:",
    stage_1: "Programma giornaliero ottimizzato con orari suggeriti",
    stage_2: "Attrazioni imperdibili pi√π le tue aggiunte personali",
    stage_3: "Mappa dettagliata con percorso di visita ottimizzato",
    stage_4: "Selezione di alloggi adatti al tuo budget",
    
    doc_line: "Esporta in PDF o PowerPoint ‚Ä¢ Accesso mobile offline ‚Ä¢ Condivisione facile con i compagni di viaggio",
    support: "OneRoadTrip √® 100% gratuito. Le prenotazioni tramite i nostri link partner ci aiutano a mantenerlo cos√¨‚Äîsenza costi extra per te. Grazie!",
    
    login: "Accedi",
    badge_mode_simple: "Modalit√† Semplice",
    badge_mode_expert: "Modalit√† Esperto",
    cookie_text: "Usiamo cookie essenziali per l'autenticazione. I cookie opzionali sono disattivati di default.",
    cookie_opt_a: "Statistiche di utilizzo",
    cookie_opt_m: "Marketing mirato",
    cookie_btn_p: "Personalizza",
    cookie_btn_r: "Rifiuta Tutto",
    cookie_btn_a: "Accetta Tutto",
    pricing_show: "Visualizza tariffe dettagliate",
    pricing_hide: "Nascondi tariffe",
    mapTitle:"Scegli il tuo itinerario su una mappa",
    buildTitle:"Costruisci il tuo itinerario dalla A alla Z",
    importTitle:"Trova sul web un itinerario che ti ispira",
    creatorsTitle:"Itinerari dei creatori",
    becomeCreator:"Diventa creatore",
    routeBuilderTitle:"üöó Lasciaci costruire il tuo itinerario",
    labelStartCity:"Citt√† di partenza",
    labelEndCity:"Citt√† di arrivo",
    labelLoopMode:"üîÑ Circuito (ritorno alla partenza)",
    labelMaxKm:"Km/tappa",
    labelDuration:"Durata",
    generateBtn:"üöÄ Genera il mio itinerario",
    labelDetour:"Deviazione autorizzata",
    labelDaysUnit:"giorni",
    warnCityNotSelected:"‚ö†Ô∏è Citt√† non convalidata - risultato potrebbe essere impreciso",
    generatingBtn:"‚è≥ Calcolo in corso...",
    placeholderStart:"Roma, Milano...",
    placeholderEnd:"Barcellona, Parigi...",
    days:"giorni",
    mapClickToOpen:"Clicca per aprire la mappa interattiva",
    filterTitle:"Filtri",
    filtersBtnText:"üîç Filtri",
    labelDays:"Durata:",
    labelDistance:"Distanza:",
    labelCountry:"Paese:",
    labelRegion:"Regione:",
    labelTheme:"Tema:",
    labelSearch:"Ricerca:",
    btnReset:"Ripristina",
    filterCount_single:"itinerario trovato",
    filterCount_plural:"itinerari trovati",
    popupDays:"giorni",
    popupViewDetails:"Vedi dettagli",
    selectionTitle:"Selezione (max 3)",
    selectionTitleSimple:"Selezione (max 1)",
    selectionTitleExpert:"Selezione (max 3)",
    compareBtn:"Vedi itinerario",
    alertAlreadySelected:"Gi√† selezionato",
    alertMaxSelection:"Massimo 3 itinerari",
    alertMaxSelectionSimple:"Massimo 1 itinerario in modalit√† semplice",
    selectBtnText:"Seleziona",
    mobileSelectText:"Seleziona",
    mobileCancelText:"Annulla",
    mobileDays:"giorni",
    mobileStops:"tappe",
    mobileCities:"Citt√†:",
    closeBtnText:"Chiudi",
    backBtnText:"Indietro",
    homeBtnText:"‚Üê Indietro",
    legend_title:"Itinerari",
    legend_incontournable:"Imperdibile",
    legend_recommande:"Consigliato",
    legend_decouvrir:"Da scoprire",
    legend_standard:"Standard",
    legend_selected:"Selezionato",
    visible_itins_single:"itinerario visibile",
    visible_itins_plural:"itinerari visibili",
    budget_modal_title:"Budget hotel",
    budget_modal_text:"Seleziona una o pi√π fasce (‚Ç¨/giorno/persona):",
    budget_confirm:"Conferma",
    budget_cancel:"Annulla",
    budget_0_50:"0‚Äì50",
    budget_50_100:"50‚Äì100",
    budget_100_150:"100‚Äì150",
    budget_150_200:"150‚Äì200",
    budget_200_250:"200‚Äì250",
    budget_250_300:"250‚Äì300",
    budget_300_500:"300‚Äì500",
    budget_500plus:"oltre 500",
    pace_title:"Ritmo:",
    pace_fast:"Veloce",
    pace_normal:"Normale",
    pace_slow:"Rilassato",
    modal_title:"Configura il tuo viaggio",
    modal_departure_date:"Data di partenza:",
    modal_num_days:"Numero di giorni:",
    modal_max_hotels:"Cambi hotel massimi:",
    modal_budget_label:"Budget hotel (‚Ç¨/giorno/persona):",
    filterAllDays:"Tutti",
    filterAllDistances:"Tutte",
    filterAllCountries:"Tutti",
    filterAllRegions:"Tutte",
    filterAllThemes:"Tutti",
    searchPlaceholder:"Parola chiave...",
    // Opzioni filtri
    filter_days_1_3:"1-3 giorni",
    filter_days_4_7:"4-7 giorni",
    filter_days_8_14:"8-14 giorni",
    filter_days_15plus:"15+ giorni",
    filter_dist_0_500:"0-500 km",
    filter_dist_501_1000:"501-1000 km",
    filter_dist_1001_2000:"1001-2000 km",
    filter_dist_2001plus:"2001+ km",
 filter_theme_montagne:"Montagna",
filter_theme_mer_cotes:"Mare & Coste",
filter_theme_ville_histoire:"Citt√† & Storia",
filter_theme_nature:"Natura",
filter_theme_culture:"Cultura",
filter_theme_gastronomie_vin:"Gastronomia & Vino",
filter_theme_aventure_outdoor:"Avventura & Outdoor",
filter_theme_route_exploration:"Strada & Esplorazione",
filter_theme_insolite_hors_sentiers:"Insolito & Fuori pista",
filter_theme_faune_vie_sauvage:"Fauna selvatica",
filter_theme_spiritualite_religion:"Spiritualit√† & Religione",
filter_theme_bien_etre_detente:"Benessere & Relax",
filter_theme_detente:"Relax",
filter_theme_tested_ort:"Verificato & approvato da ORT",

  },

  es: {
    notice: "Sin registro, tus viajes no se guardar√°n",
    title: "OneRoadTrip ‚Äì Dise√±a el Viaje de tus Sue√±os",
    
    // Modo Experto: Construye desde Cero
    builder_title: "Construye tu Itinerario de A a Z",
    builder_text: "Empieza desde cero y crea tu viaje paso a paso seleccionando lugares en un mapa interactivo del mundo.",
    builder_btn: "Comenzar a Construir",
    
    left_title: "Crea tu Viaje en 5 Preguntas Simples",
    left_list: [
      "¬øQu√© destino te llama?",
      "¬øCu√°ntos d√≠as dura tu aventura?",
      "¬øCu√°l es tu estilo de viaje: aventura, relajaci√≥n, cultura?",
      "¬øC√≥mo te desplazar√°s localmente?",
      "¬øCu√°l es tu presupuesto aproximado?"
    ],
    btn_simple: "Empezar Ahora",
right_title: "Encuentra en la web un itinerario o una lista de lugares que te inspire y construye el viaje de tus sue√±os",
creators_title: "Ver itinerarios propuestos por creadores de contenido",
become_creator: "Convertirse en creador",
right_lead: "",
right_list: [
  "Copia el itinerario* que te inspire desde cualquier sitio web",
  "Usa un asistente de IA para optimizarlo siguiendo nuestras instrucciones (ChatGPT, Claude...)",
  "Pega el resultado en nuestra interfaz",
  "Obt√©n al instante un viaje 100% modificable y personalizable"
],
right_note: "*Importante: Aseg√∫rate de que el contenido copiado est√© libre de derechos",
    btn_full: "Importar un Viaje",
    
    bottom_title: "Tu Paquete de Viaje Completo Incluye",
    bottom_list: [
      "Itinerario detallado d√≠a a d√≠a con tiempos de viaje optimizados",
      "Mapa interactivo con todos tus destinos geolocalizados",
      "Modificaciones ilimitadas de tu ruta en tiempo real",
      "Reserva directa de vuelos y alquiler de coches",
      "Acceso a los mejores alojamientos a trav√©s de nuestros socios",
      "Reserva de actividades y experiencias √∫nicas",
      "Opciones completas de seguro de viaje"
    ],
    
    stage_hdr: "Cada destino de tu viaje incluye:",
    stage_1: "Horario diario optimizado con horas sugeridas",
    stage_2: "Atracciones imprescindibles m√°s tus adiciones personales",
    stage_3: "Mapa detallado con ruta de visita optimizada",
    stage_4: "Selecci√≥n de alojamientos adaptados a tu presupuesto",
    
    doc_line: "Exporta a PDF o PowerPoint ‚Ä¢ Acceso m√≥vil sin conexi√≥n ‚Ä¢ Compartir f√°cilmente con compa√±eros de viaje",
    support: "OneRoadTrip es 100% gratuito. Las reservas a trav√©s de nuestros enlaces afiliados nos ayudan a mantenerlo as√≠‚Äîsin coste extra para ti. ¬°Gracias!",
    
    login: "Iniciar Sesi√≥n",
    badge_mode_simple: "Modo Simple",
    badge_mode_expert: "Modo Experto",
    cookie_text: "Usamos cookies esenciales para la autenticaci√≥n. Las cookies opcionales est√°n desactivadas por defecto.",
    cookie_opt_a: "Estad√≠sticas de uso",
    cookie_opt_m: "Marketing dirigido",
    cookie_btn_p: "Personalizar",
    cookie_btn_r: "Rechazar Todo",
    cookie_btn_a: "Aceptar Todo",
    pricing_show: "Ver tarifas detalladas",
    pricing_hide: "Ocultar tarifas",
    mapTitle:"Elige tu itinerario en un mapa",
    buildTitle:"Construye tu itinerario de la A a la Z",
    importTitle:"Encuentra en la web un itinerario que te inspire",
    creatorsTitle:"Itinerarios de los creadores",
    becomeCreator:"Ser creador",
    routeBuilderTitle:"üöó D√©janos construir tu itinerario",
    labelStartCity:"Ciudad de salida",
    labelEndCity:"Ciudad de llegada",
    labelLoopMode:"üîÑ Circuito (vuelta al inicio)",
    labelMaxKm:"Km/etapa",
    labelDuration:"Duraci√≥n",
    generateBtn:"üöÄ Generar mi itinerario",
    labelDetour:"Desv√≠o permitido",
    labelDaysUnit:"d√≠as",
    warnCityNotSelected:"‚ö†Ô∏è Ciudad no validada - resultado puede ser inexacto",
    generatingBtn:"‚è≥ Calculando...",
    placeholderStart:"Madrid, Barcelona...",
    placeholderEnd:"Par√≠s, Roma...",
    days:"d√≠as",
    mapClickToOpen:"Haz clic para abrir el mapa interactivo",
    filterTitle:"Filtros",
    filtersBtnText:"üîç Filtros",
    labelDays:"Duraci√≥n:",
    labelDistance:"Distancia:",
    labelCountry:"Pa√≠s:",
    labelRegion:"Regi√≥n:",
    labelTheme:"Tema:",
    labelSearch:"B√∫squeda:",
    btnReset:"Restablecer",
    filterCount_single:"itinerario encontrado",
    filterCount_plural:"itinerarios encontrados",
    popupDays:"d√≠as",
    popupViewDetails:"Ver detalles",
    selectionTitle:"Selecci√≥n (m√°x 3)",
    selectionTitleSimple:"Selecci√≥n (m√°x 1)",
    selectionTitleExpert:"Selecci√≥n (m√°x 3)",
    compareBtn:"Ver itinerario",
    alertAlreadySelected:"Ya seleccionado",
    alertMaxSelection:"M√°ximo 3 itinerarios",
    alertMaxSelectionSimple:"M√°ximo 1 itinerario en modo simple",
    selectBtnText:"Seleccionar",
    mobileSelectText:"Seleccionar",
    mobileCancelText:"Cancelar",
    mobileDays:"d√≠as",
    mobileStops:"etapas",
    mobileCities:"Ciudades:",
    closeBtnText:"Cerrar",
    backBtnText:"Volver",
    homeBtnText:"‚Üê Volver",
    legend_title:"Itinerarios",
    legend_incontournable:"Imprescindible",
    legend_recommande:"Recomendado",
    legend_decouvrir:"Por descubrir",
    legend_standard:"Est√°ndar",
    legend_selected:"Seleccionado",
    visible_itins_single:"itinerario visible",
    visible_itins_plural:"itinerarios visibles",
    budget_modal_title:"Presupuesto hotel",
    budget_modal_text:"Selecciona uno o varios rangos (‚Ç¨/d√≠a/persona):",
    budget_confirm:"Validar",
    budget_cancel:"Cancelar",
    budget_0_50:"0‚Äì50",
    budget_50_100:"50‚Äì100",
    budget_100_150:"100‚Äì150",
    budget_150_200:"150‚Äì200",
    budget_200_250:"200‚Äì250",
    budget_250_300:"250‚Äì300",
    budget_300_500:"300‚Äì500",
    budget_500plus:"m√°s de 500",
    pace_title:"Ritmo:",
    pace_fast:"R√°pido",
    pace_normal:"Normal",
    pace_slow:"Tranquilo",
    modal_title:"Configura tu viaje",
    modal_departure_date:"Fecha de salida:",
    modal_num_days:"N√∫mero de d√≠as deseados:",
    modal_max_hotels:"Cambios de hotel m√°ximos:",
    modal_budget_label:"Presupuesto hotel (‚Ç¨/d√≠a/persona):",
    filterAllDays:"Todos",
    filterAllDistances:"Todas",
    filterAllCountries:"Todos",
    filterAllRegions:"Todas",
    filterAllThemes:"Todos",
    searchPlaceholder:"Palabra clave...",
    // Opciones de filtros
    filter_days_1_3:"1-3 d√≠as",
    filter_days_4_7:"4-7 d√≠as",
    filter_days_8_14:"8-14 d√≠as",
    filter_days_15plus:"15+ d√≠as",
    filter_dist_0_500:"0-500 km",
    filter_dist_501_1000:"501-1000 km",
    filter_dist_1001_2000:"1001-2000 km",
    filter_dist_2001plus:"2001+ km",
   filter_theme_montagne:"Monta√±a",
filter_theme_mer_cotes:"Mar & Costas",
filter_theme_ville_histoire:"Ciudad & Historia",
filter_theme_nature:"Naturaleza",
filter_theme_culture:"Cultura",
filter_theme_gastronomie_vin:"Gastronom√≠a & Vino",
filter_theme_aventure_outdoor:"Aventura & Outdoor",
filter_theme_route_exploration:"Ruta & Exploraci√≥n",
filter_theme_insolite_hors_sentiers:"Ins√≥lito & Alternativo",
filter_theme_faune_vie_sauvage:"Fauna & Vida salvaje",
filter_theme_spiritualite_religion:"Espiritualidad & Religi√≥n",
filter_theme_bien_etre_detente:"Bienestar & Relajaci√≥n",
filter_theme_detente:"Relajaci√≥n",
filter_theme_tested_ort:"Probado y aprobado por ORT",

  },

  pt: {
    notice: "Sem registo, as tuas viagens n√£o ser√£o guardadas",
    title: "OneRoadTrip ‚Äì Cria a Viagem dos Teus Sonhos",
    
    // Modo Expert: Constr√≥i do Zero
    builder_title: "Constr√≥i o Teu Itiner√°rio de A a Z",
    builder_text: "Come√ßa do zero e cria a tua viagem passo a passo selecionando lugares num mapa interativo do mundo.",
    builder_btn: "Come√ßar a Construir",
    
    left_title: "Cria a Tua Viagem em 5 Perguntas Simples",
    left_list: [
      "Que destino te chama?",
      "Quantos dias dura a tua aventura?",
      "Qual √© o teu estilo de viagem: aventura, relaxamento, cultura?",
      "Como vais deslocar-te localmente?",
      "Qual √© o teu or√ßamento aproximado?"
    ],
    btn_simple: "Come√ßar Agora",
    
right_title: "Encontra na web um itiner√°rio ou uma lista de locais que te inspire e constr√≥i a viagem dos teus sonhos",
creators_title: "Ver itiner√°rios propostos por criadores de conte√∫do",
become_creator: "Tornar-se criador",
right_lead: "",
right_list: [
  "Copia o itiner√°rio* que te inspira de qualquer site",
  "Usa um assistente de IA para o otimizar de acordo com as nossas instru√ß√µes (ChatGPT, Claude...)",
  "Cola o resultado na nossa interface",
  "Obt√©m imediatamente uma viagem 100% modific√°vel e personaliz√°vel"
],
right_note: "*Importante: Garante que o conte√∫do copiado est√° livre de direitos de autor",
    btn_full: "Importar uma Viagem",
    
    bottom_title: "O Teu Pacote de Viagem Completo Inclui",
    bottom_list: [
      "Itiner√°rio detalhado dia a dia com tempos de viagem otimizados",
      "Mapa interativo com todos os destinos geolocalizados",
      "Modifica√ß√µes ilimitadas do percurso em tempo real",
      "Reserva direta de voos e aluguer de carros",
      "Acesso aos melhores alojamentos atrav√©s dos nossos parceiros",
      "Reserva de atividades e experi√™ncias √∫nicas",
      "Op√ß√µes completas de seguro de viagem"
    ],
    
    stage_hdr: "Cada destino da tua viagem inclui:",
    stage_1: "Agenda di√°ria otimizada com hor√°rios sugeridos",
    stage_2: "Atra√ß√µes imperd√≠veis mais as tuas adi√ß√µes pessoais",
    stage_3: "Mapa detalhado com rota de visita otimizada",
    stage_4: "Sele√ß√£o de alojamentos adequados ao teu or√ßamento",
    
    doc_line: "Exporta para PDF ou PowerPoint ‚Ä¢ Acesso m√≥vel offline ‚Ä¢ Partilha f√°cil com companheiros de viagem",
    support: "O OneRoadTrip √© 100% gratuito. As reservas atrav√©s dos nossos links parceiros ajudam-nos a mant√™-lo assim‚Äîsem custo extra para ti. Obrigado!",
    
    login: "Iniciar Sess√£o",
    badge_mode_simple: "Modo Simples",
    badge_mode_expert: "Modo Expert",
    cookie_text: "Usamos cookies essenciais para autentica√ß√£o. Os cookies opcionais est√£o desativados por defeito.",
    cookie_opt_a: "Estat√≠sticas de uso",
    cookie_opt_m: "Marketing direcionado",
    cookie_btn_p: "Personalizar",
    cookie_btn_r: "Rejeitar Tudo",
    cookie_btn_a: "Aceitar Tudo",
    pricing_show: "Ver pre√ßos detalhados",
    pricing_hide: "Ocultar pre√ßos",
    mapTitle:"Escolha seu itiner√°rio em um mapa",
    buildTitle:"Construa seu itiner√°rio de A a Z",
    importTitle:"Encontre na web um itiner√°rio que te inspire",
    creatorsTitle:"Itiner√°rios dos criadores",
    becomeCreator:"Tornar-se criador",
    routeBuilderTitle:"üöó Deixe-nos construir seu itiner√°rio",
    labelStartCity:"Cidade de partida",
    labelEndCity:"Cidade de chegada",
    labelLoopMode:"üîÑ Circuito (volta ao in√≠cio)",
    labelMaxKm:"Km/etapa",
    labelDuration:"Dura√ß√£o",
    generateBtn:"üöÄ Gerar meu itiner√°rio",
    labelDetour:"Desvio permitido",
    labelDaysUnit:"dias",
    warnCityNotSelected:"‚ö†Ô∏è Cidade n√£o validada - resultado pode ser impreciso",
    generatingBtn:"‚è≥ Calculando...",
    placeholderStart:"Lisboa, Porto...",
    placeholderEnd:"Barcelona, Paris...",
    days:"dias",
    mapClickToOpen:"Clique para abrir o mapa interativo",
    filterTitle:"Filtros",
    filtersBtnText:"üîç Filtros",
    labelDays:"Dura√ß√£o:",
    labelDistance:"Dist√¢ncia:",
    labelCountry:"Pa√≠s:",
    labelRegion:"Regi√£o:",
    labelTheme:"Tema:",
    labelSearch:"Pesquisa:",
    btnReset:"Redefinir",
    filterCount_single:"itiner√°rio encontrado",
    filterCount_plural:"itiner√°rios encontrados",
    popupDays:"dias",
    popupViewDetails:"Ver detalhes",
    selectionTitle:"Sele√ß√£o (m√°x 3)",
    selectionTitleSimple:"Sele√ß√£o (m√°x 1)",
    selectionTitleExpert:"Sele√ß√£o (m√°x 3)",
    compareBtn:"Ver itiner√°rio",
    alertAlreadySelected:"J√° selecionado",
    alertMaxSelection:"M√°ximo 3 itiner√°rios",
    alertMaxSelectionSimple:"M√°ximo 1 itiner√°rio em modo simples",
    selectBtnText:"Selecionar",
    mobileSelectText:"Selecionar",
    mobileCancelText:"Cancelar",
    mobileDays:"dias",
    mobileStops:"etapas",
    mobileCities:"Cidades:",
    closeBtnText:"Fechar",
    backBtnText:"Voltar",
    homeBtnText:"‚Üê Voltar",
    legend_title:"Itiner√°rios",
    legend_incontournable:"Imperd√≠vel",
    legend_recommande:"Recomendado",
    legend_decouvrir:"A descobrir",
    legend_standard:"Padr√£o",
    legend_selected:"Selecionado",
    visible_itins_single:"itiner√°rio vis√≠vel",
    visible_itins_plural:"itiner√°rios vis√≠veis",
    budget_modal_title:"Or√ßamento hotel",
    budget_modal_text:"Selecione uma ou v√°rias faixas (‚Ç¨/dia/pessoa):",
    budget_confirm:"Validar",
    budget_cancel:"Cancelar",
    budget_0_50:"0‚Äì50",
    budget_50_100:"50‚Äì100",
    budget_100_150:"100‚Äì150",
    budget_150_200:"150‚Äì200",
    budget_200_250:"200‚Äì250",
    budget_250_300:"250‚Äì300",
    budget_300_500:"300‚Äì500",
    budget_500plus:"+500",
    pace_title:"Ritmo:",
    pace_fast:"R√°pido",
    pace_normal:"Normal",
    pace_slow:"Relaxado",
    modal_title:"Configure a sua viagem",
    modal_departure_date:"Data de partida:",
    modal_num_days:"N√∫mero de dias:",
    modal_max_hotels:"Mudan√ßas de hotel m√°ximas:",
    modal_budget_label:"Or√ßamento hotel (‚Ç¨/dia/pessoa):",
    filterAllDays:"Todos",
    filterAllDistances:"Todas",
    filterAllCountries:"Todos",
    filterAllRegions:"Todas",
    filterAllThemes:"Todos",
    searchPlaceholder:"Palavra-chave...",
    // Op√ß√µes de filtros
    filter_days_1_3:"1-3 dias",
    filter_days_4_7:"4-7 dias",
    filter_days_8_14:"8-14 dias",
    filter_days_15plus:"15+ dias",
    filter_dist_0_500:"0-500 km",
    filter_dist_501_1000:"501-1000 km",
    filter_dist_1001_2000:"1001-2000 km",
    filter_dist_2001plus:"2001+ km",
   filter_theme_montagne:"Montanha",
filter_theme_mer_cotes:"Mar & Costas",
filter_theme_ville_histoire:"Cidade & Hist√≥ria",
filter_theme_nature:"Natureza",
filter_theme_culture:"Cultura",
filter_theme_gastronomie_vin:"Gastronomia & Vinho",
filter_theme_aventure_outdoor:"Aventura & Outdoor",
filter_theme_route_exploration:"Estrada & Explora√ß√£o",
filter_theme_insolite_hors_sentiers:"Ins√≥lito & Alternativo",
filter_theme_faune_vie_sauvage:"Vida selvagem",
filter_theme_spiritualite_religion:"Espiritualidade & Religi√£o",
filter_theme_bien_etre_detente:"Bem-estar & Relax",
filter_theme_detente:"Relax",
filter_theme_tested_ort:"Testado e aprovado pela ORT",

  },

  ar: {
    notice: "ÿ®ÿØŸàŸÜ ÿ™ÿ≥ÿ¨ŸäŸÑÿå ŸÑŸÜ Ÿäÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿ±ÿ≠ŸÑÿßÿ™ŸÉ",
    title: "OneRoadTrip ‚Äì ÿµŸÖŸÖ ÿ±ÿ≠ŸÑÿ© ÿ£ÿ≠ŸÑÿßŸÖŸÉ",
    
    // ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿÆÿ®Ÿäÿ±: ÿßÿ®ŸÜŸê ŸÖŸÜ ÿßŸÑÿµŸÅÿ±
    builder_title: "ÿßÿ®ŸÜŸê ŸÖÿ≥ÿßÿ±ŸÉ ŸÖŸÜ ÿßŸÑÿ£ŸÑŸÅ ÿ•ŸÑŸâ ÿßŸÑŸäÿßÿ°",
    builder_text: "ÿßÿ®ÿØÿ£ ŸÖŸÜ ÿßŸÑÿµŸÅÿ± Ÿàÿ£ŸÜÿ¥ÿ¶ ÿ±ÿ≠ŸÑÿ™ŸÉ ÿÆÿ∑Ÿàÿ© ÿ®ÿÆÿ∑Ÿàÿ© ÿπÿ®ÿ± ÿßÿÆÿ™Ÿäÿßÿ± ÿßŸÑÿ£ŸÖÿßŸÉŸÜ ÿπŸÑŸâ ÿÆÿ±Ÿäÿ∑ÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÑŸÑÿπÿßŸÑŸÖ.",
    builder_btn: "ÿßÿ®ÿØÿ£ ÿßŸÑÿ®ŸÜÿßÿ°",
    
    left_title: "ÿ£ŸÜÿ¥ÿ¶ ÿ±ÿ≠ŸÑÿ™ŸÉ ŸÅŸä 5 ÿ£ÿ≥ÿ¶ŸÑÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©",
    left_list: [
      "ÿ£Ÿä Ÿàÿ¨Ÿáÿ© ÿ™ŸÜÿßÿØŸäŸÉÿü",
      "ŸÉŸÖ ŸäŸàŸÖÿßŸã ÿ™ÿ≥ÿ™ŸÖÿ± ŸÖÿ∫ÿßŸÖÿ±ÿ™ŸÉÿü",
      "ŸÖÿß ŸáŸà ÿ£ÿ≥ŸÑŸàÿ® ÿ≥ŸÅÿ±ŸÉ: ÿßŸÑŸÖÿ∫ÿßŸÖÿ±ÿ©ÿå ÿßŸÑÿßÿ≥ÿ™ÿ±ÿÆÿßÿ°ÿå ÿßŸÑÿ´ŸÇÿßŸÅÿ©ÿü",
      "ŸÉŸäŸÅ ÿ≥ÿ™ÿ™ŸÜŸÇŸÑ ŸÖÿ≠ŸÑŸäÿßŸãÿü",
      "ŸÖÿß ŸáŸä ŸÖŸäÿ≤ÿßŸÜŸäÿ™ŸÉ ÿßŸÑÿ™ŸÇÿ±Ÿäÿ®Ÿäÿ©ÿü"
    ],
    btn_simple: "ÿßÿ®ÿØÿ£ ÿßŸÑÿ¢ŸÜ",
    
  right_title: "ÿßÿ®ÿ≠ÿ´ ÿπŸÑŸâ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ ÿπŸÜ ŸÖÿ≥ÿßÿ± ÿ£Ÿà ŸÇÿßÿ¶ŸÖÿ© ÿ£ŸÖÿßŸÉŸÜ ÿ™ŸÑŸáŸÖŸÉ Ÿàÿßÿ®ŸÜŸê ÿ±ÿ≠ŸÑÿ© ÿ£ÿ≠ŸÑÿßŸÖŸÉ",
creators_title: "ÿπÿ±ÿ∂ ŸÖÿ≥ÿßÿ±ÿßÿ™ ŸÖŸÇÿ™ÿ±ÿ≠ÿ© ŸÖŸÜ ŸÖŸÜÿ¥ÿ¶Ÿä ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ",
become_creator: "ÿ£ÿµÿ®ÿ≠ ŸÖŸÜÿ¥ÿ¶ ŸÖÿ≠ÿ™ŸàŸâ",
right_lead: "",
right_list: [
  "ÿßŸÜÿ≥ÿÆ ÿÆÿ∑ ÿßŸÑÿ≥Ÿäÿ±* ÿßŸÑÿ∞Ÿä ŸäŸÑŸáŸÖŸÉ ŸÖŸÜ ÿ£Ÿä ŸÖŸàŸÇÿπ ŸàŸäÿ®",
  "ÿßÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ≥ÿßÿπÿØ ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ŸÑÿ™ÿ≠ÿ≥ŸäŸÜŸá ŸàŸÅŸÇŸãÿß ŸÑÿ™ÿπŸÑŸäŸÖÿßÿ™ŸÜÿß (ChatGPTÿå Claude...)",
  "ÿßŸÑÿµŸÇ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ŸÅŸä Ÿàÿßÿ¨Ÿáÿ™ŸÜÿß",
  "ÿßÿ≠ÿµŸÑ ŸÅŸàÿ±Ÿãÿß ÿπŸÑŸâ ÿ±ÿ≠ŸÑÿ© ŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ™ÿπÿØŸäŸÑ ŸàÿßŸÑÿ™ÿÆÿµŸäÿµ ÿ®ŸÜÿ≥ÿ®ÿ© 100Ÿ™"
],
right_note: "*ŸÖŸáŸÖ: ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑŸÖŸÜÿ≥ŸàÿÆ ÿÆÿßŸÑŸç ŸÖŸÜ ÿ≠ŸÇŸàŸÇ ÿßŸÑÿ∑ÿ®ÿπ ŸàÿßŸÑŸÜÿ¥ÿ±",

    btn_full: "ÿßÿ≥ÿ™Ÿàÿ±ÿØ ÿ±ÿ≠ŸÑÿ©",
    
    bottom_title: "ÿ®ÿßŸÇÿ© ÿ±ÿ≠ŸÑÿ™ŸÉ ÿßŸÑŸÉÿßŸÖŸÑÿ© ÿ™ÿ¥ŸÖŸÑ",
    bottom_list: [
      "ÿÆÿ∑ ÿ≥Ÿäÿ± ŸÖŸÅÿµŸÑ ŸäŸàŸÖŸäÿßŸã ŸÖÿπ ÿ£ŸàŸÇÿßÿ™ ÿßŸÑÿ≥ŸÅÿ± ÿßŸÑŸÖŸèÿ≠ÿ≥ŸëŸÜÿ©",
      "ÿÆÿ±Ÿäÿ∑ÿ© ÿ™ŸÅÿßÿπŸÑŸäÿ© ŸÖÿπ ÿ¨ŸÖŸäÿπ Ÿàÿ¨Ÿáÿßÿ™ŸÉ ÿßŸÑŸÖÿ≠ÿØÿØÿ© ÿ¨ÿ∫ÿ±ÿßŸÅŸäÿßŸã",
      "ÿ™ÿπÿØŸäŸÑÿßÿ™ ÿ∫Ÿäÿ± ŸÖÿ≠ÿØŸàÿØÿ© ÿπŸÑŸâ ŸÖÿ≥ÿßÿ±ŸÉ ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÅÿπŸÑŸä",
      "ÿ≠ÿ¨ÿ≤ ŸÖÿ®ÿßÿ¥ÿ± ŸÑŸÑÿ±ÿ≠ŸÑÿßÿ™ ÿßŸÑÿ¨ŸàŸäÿ© Ÿàÿßÿ≥ÿ™ÿ¶ÿ¨ÿßÿ± ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™",
      "ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿ£ŸÅÿ∂ŸÑ ÿ£ŸÖÿßŸÉŸÜ ÿßŸÑÿ•ŸÇÿßŸÖÿ© ÿπÿ®ÿ± ÿ¥ÿ±ŸÉÿßÿ¶ŸÜÿß",
      "ÿ≠ÿ¨ÿ≤ ÿßŸÑÿ£ŸÜÿ¥ÿ∑ÿ© ŸàÿßŸÑÿ™ÿ¨ÿßÿ±ÿ® ÿßŸÑŸÅÿ±ŸäÿØÿ©",
      "ÿÆŸäÿßÿ±ÿßÿ™ ÿ™ÿ£ŸÖŸäŸÜ ÿ≥ŸÅÿ± ÿ¥ÿßŸÖŸÑÿ©"
    ],
    
    stage_hdr: "ŸÉŸÑ Ÿàÿ¨Ÿáÿ© ŸÅŸä ÿ±ÿ≠ŸÑÿ™ŸÉ ÿ™ÿ™ÿ∂ŸÖŸÜ:",
    stage_1: "ÿ¨ÿØŸàŸÑ ŸäŸàŸÖŸä ŸÖÿ≠ÿ≥ŸëŸÜ ŸÖÿπ ÿ£ŸàŸÇÿßÿ™ ŸÖŸÇÿ™ÿ±ÿ≠ÿ©",
    stage_2: "ŸÖÿπÿßŸÑŸÖ ŸÑÿß ÿ™ŸèŸÅŸàŸëÿ™ ÿ®ÿßŸÑÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿ•ÿ∂ÿßŸÅÿßÿ™ŸÉ ÿßŸÑÿ¥ÿÆÿµŸäÿ©",
    stage_3: "ÿÆÿ±Ÿäÿ∑ÿ© ŸÖŸÅÿµŸÑÿ© ŸÖÿπ ŸÖÿ≥ÿßÿ± ÿ≤Ÿäÿßÿ±ÿ© ŸÖÿ≠ÿ≥ŸëŸÜ",
    stage_4: "ŸÖÿ¨ŸÖŸàÿπÿ© ŸÖÿÆÿ™ÿßÿ±ÿ© ŸÖŸÜ ÿ£ŸÖÿßŸÉŸÜ ÿßŸÑÿ•ŸÇÿßŸÖÿ© ÿßŸÑŸÖŸÜÿßÿ≥ÿ®ÿ© ŸÑŸÖŸäÿ≤ÿßŸÜŸäÿ™ŸÉ",
    
    doc_line: "ÿ™ÿµÿØŸäÿ± ÿ•ŸÑŸâ PDF ÿ£Ÿà PowerPoint ‚Ä¢ ŸàÿµŸàŸÑ ŸÖÿ≠ŸÖŸàŸÑ ÿ®ŸÑÿß ÿ•ŸÜÿ™ÿ±ŸÜÿ™ ‚Ä¢ ŸÖÿ¥ÿßÿ±ŸÉÿ© ÿ≥ŸáŸÑÿ© ŸÖÿπ ÿ±ŸÅÿßŸÇ ÿßŸÑÿ≥ŸÅÿ±",
    support: "OneRoadTrip ŸÖÿ¨ÿßŸÜŸä 100Ÿ™. ÿßŸÑÿ≠ÿ¨Ÿàÿ≤ÿßÿ™ ÿπÿ®ÿ± ÿ±Ÿàÿßÿ®ÿ∑ ÿ¥ÿ±ŸÉÿßÿ¶ŸÜÿß ÿ™ÿ≥ÿßÿπÿØŸÜÿß ŸÅŸä ÿßŸÑÿ≠ŸÅÿßÿ∏ ÿπŸÑŸäŸá ŸÉÿ∞ŸÑŸÉ‚Äîÿ®ÿØŸàŸÜ ÿ™ŸÉŸÑŸÅÿ© ÿ•ÿ∂ÿßŸÅŸäÿ© ÿπŸÑŸäŸÉ. ÿ¥ŸÉÿ±ÿßŸã!",
    
    login: "ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ",
    badge_mode_simple: "ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿ®ÿ≥Ÿäÿ∑",
    badge_mode_expert: "Ÿàÿ∂ÿπ ÿßŸÑÿÆÿ®Ÿäÿ±",
    cookie_text: "ŸÜÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÑŸÅÿßÿ™ ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© ŸÑŸÑŸÖÿµÿßÿØŸÇÿ©. ŸÖŸÑŸÅÿßÿ™ ÿ™ÿπÿ±ŸäŸÅ ÿßŸÑÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ±Ÿäÿ© ŸÖÿπÿ∑ŸÑÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂ŸäÿßŸã.",
    cookie_opt_a: "ÿ•ÿ≠ÿµÿßÿ°ÿßÿ™ ÿßŸÑÿßÿ≥ÿ™ÿÆÿØÿßŸÖ",
    cookie_opt_m: "ÿßŸÑÿ™ÿ≥ŸàŸäŸÇ ÿßŸÑŸÖŸàÿ¨Ÿá",
    cookie_btn_p: "ÿ™ÿÆÿµŸäÿµ",
    cookie_btn_r: "ÿ±ŸÅÿ∂ ÿßŸÑŸÉŸÑ",
    cookie_btn_a: "ŸÇÿ®ŸàŸÑ ÿßŸÑŸÉŸÑ",
    pricing_show: "ÿπÿ±ÿ∂ ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ™ŸÅÿµŸäŸÑŸäÿ©",
    pricing_hide: "ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ£ÿ≥ÿπÿßÿ±",
    mapTitle:"ÿßÿÆÿ™ÿ± ÿÆÿ∑ ÿ≥Ÿäÿ±ŸÉ ÿπŸÑŸâ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ©",
    buildTitle:"ŸÇŸÖ ÿ®ÿ®ŸÜÿßÿ° ÿÆÿ∑ ÿ≥Ÿäÿ±ŸÉ ŸÖŸÜ ÿßŸÑÿ£ŸÑŸÅ ÿ•ŸÑŸâ ÿßŸÑŸäÿßÿ°",
    importTitle:"ÿßÿ®ÿ≠ÿ´ ÿπŸÑŸâ ÿßŸÑŸàŸäÿ® ÿπŸÜ ÿÆÿ∑ ÿ≥Ÿäÿ± ŸäŸÑŸáŸÖŸÉ",
    creatorsTitle:"ÿÆÿ∑Ÿàÿ∑ ÿ≥Ÿäÿ± ÿßŸÑŸÖÿ®ÿØÿπŸäŸÜ",
    becomeCreator:"ŸÉŸÜ ŸÖÿ®ÿØÿπŸãÿß",
    routeBuilderTitle:"üöó ÿØÿπŸÜÿß ŸÜÿ®ŸÜŸä ÿÆÿ∑ ÿ≥Ÿäÿ±ŸÉ",
    labelStartCity:"ŸÖÿØŸäŸÜÿ© ÿßŸÑÿßŸÜÿ∑ŸÑÿßŸÇ",
    labelEndCity:"ŸÖÿØŸäŸÜÿ© ÿßŸÑŸàÿµŸàŸÑ",
    labelLoopMode:"üîÑ ÿ¨ŸàŸÑÿ© (ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ÿßŸÑÿ®ÿØÿßŸäÿ©)",
    labelMaxKm:"ŸÉŸÖ/ŸÖÿ≠ÿ∑ÿ©",
    labelDuration:"ÿßŸÑŸÖÿØÿ©",
    generateBtn:"üöÄ ÿ•ŸÜÿ¥ÿßÿ° ÿÆÿ∑ ÿ≥Ÿäÿ±Ÿä",
    labelDetour:"ÿßŸÜÿ≠ÿ±ÿßŸÅ ŸÖÿ≥ŸÖŸàÿ≠",
    labelDaysUnit:"ÿ£ŸäÿßŸÖ",
    warnCityNotSelected:"‚ö†Ô∏è ÿßŸÑŸÖÿØŸäŸÜÿ© ÿ∫Ÿäÿ± ŸÖÿ§ŸÉÿØÿ© - ŸÇÿØ ÿ™ŸÉŸàŸÜ ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿ∫Ÿäÿ± ÿØŸÇŸäŸÇÿ©",
    generatingBtn:"‚è≥ ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ≠ÿ≥ÿßÿ®...",
    placeholderStart:"ÿ®ÿßÿ±Ÿäÿ≥ÿå ŸÑŸÜÿØŸÜ...",
    placeholderEnd:"ÿ®ÿ±ÿ¥ŸÑŸàŸÜÿ©ÿå ÿ±ŸàŸÖÿß...",
    days:"ÿ£ŸäÿßŸÖ",
    mapClickToOpen:"ÿßŸÜŸÇÿ± ŸÑŸÅÿ™ÿ≠ ÿßŸÑÿÆÿ±Ÿäÿ∑ÿ© ÿßŸÑÿ™ŸÅÿßÿπŸÑŸäÿ©",
    filterTitle:"ÿßŸÑŸÅŸÑÿßÿ™ÿ±",
    filtersBtnText:"üîç ÿßŸÑŸÅŸÑÿßÿ™ÿ±",
    labelDays:"ÿßŸÑŸÖÿØÿ©:",
    labelDistance:"ÿßŸÑŸÖÿ≥ÿßŸÅÿ©:",
    labelCountry:"ÿßŸÑÿ®ŸÑÿØ:",
    labelRegion:"ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©:",
    labelTheme:"ÿßŸÑŸÖŸàÿ∂Ÿàÿπ:",
    labelSearch:"ÿßŸÑÿ®ÿ≠ÿ´:",
    btnReset:"ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ",
    filterCount_single:"ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿÆÿ∑ ÿ≥Ÿäÿ±",
    filterCount_plural:"ÿ™ŸÖ ÿßŸÑÿπÿ´Ÿàÿ± ÿπŸÑŸâ ÿÆÿ∑Ÿàÿ∑ ÿ≥Ÿäÿ±",
    popupDays:"ÿ£ŸäÿßŸÖ",
    popupViewDetails:"ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ",
    selectionTitle:"ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± (ÿ®ÿ≠ÿØ ÿ£ŸÇÿµŸâ 3)",
    selectionTitleSimple:"ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± (ÿ®ÿ≠ÿØ ÿ£ŸÇÿµŸâ 1)",
    selectionTitleExpert:"ÿßŸÑÿßÿÆÿ™Ÿäÿßÿ± (ÿ®ÿ≠ÿØ ÿ£ŸÇÿµŸâ 3)",
    compareBtn:"ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥ÿßÿ±",
    alertAlreadySelected:"ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ±Ÿá ÿ®ÿßŸÑŸÅÿπŸÑ",
    alertMaxSelection:"ÿ®ÿ≠ÿØ ÿ£ŸÇÿµŸâ 3 ÿÆÿ∑Ÿàÿ∑ ÿ≥Ÿäÿ±",
    alertMaxSelectionSimple:"ÿ®ÿ≠ÿØ ÿ£ŸÇÿµŸâ ŸÖÿ≥ÿßÿ± Ÿàÿßÿ≠ÿØ ŸÅŸä ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿ®ÿ≥Ÿäÿ∑",
    alertMaxSelection:"ÿ®ÿ≠ÿØ ÿ£ŸÇÿµŸâ 3 ÿÆÿ∑Ÿàÿ∑ ÿ≥Ÿäÿ±",
    selectBtnText:"ÿßÿÆÿ™ÿ±",
    mobileSelectText:"ÿßÿÆÿ™ÿ±",
    mobileCancelText:"ÿ•ŸÑÿ∫ÿßÿ°",
    mobileDays:"ÿ£ŸäÿßŸÖ",
    mobileStops:"ŸÖÿ≠ÿ∑ÿßÿ™",
    mobileCities:"ÿßŸÑŸÖÿØŸÜ:",
    closeBtnText:"ÿ•ÿ∫ŸÑÿßŸÇ",
    backBtnText:"ÿ±ÿ¨Ÿàÿπ",
    homeBtnText:"ÿ±ÿ¨Ÿàÿπ ‚Üê",
    legend_title:"ÿÆÿ∑Ÿàÿ∑ ÿßŸÑÿ≥Ÿäÿ±",
    legend_incontournable:"ŸÑÿß ŸäŸÅŸàÿ™ŸÉ",
    legend_recommande:"ŸÖŸàÿµŸâ ÿ®Ÿá",
    legend_decouvrir:"ŸÑŸÑÿßŸÉÿ™ÿ¥ÿßŸÅ",
    legend_standard:"ÿπÿßÿØŸä",
    legend_selected:"ŸÖÿ≠ÿØÿØ",
    visible_itins_single:"ŸÖÿ≥ÿßÿ± ŸÖÿ±ÿ¶Ÿä",
    visible_itins_plural:"ŸÖÿ≥ÿßÿ±ÿßÿ™ ŸÖÿ±ÿ¶Ÿäÿ©",
    budget_modal_title:"ŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑŸÅŸÜÿØŸÇ",
    budget_modal_text:"ÿßÿÆÿ™ÿ± ŸÅÿ¶ÿ© Ÿàÿßÿ≠ÿØÿ© ÿ£Ÿà ÿ£ŸÉÿ´ÿ± (‚Ç¨/ŸäŸàŸÖ/ÿ¥ÿÆÿµ):",
    budget_confirm:"ÿ™ÿ£ŸÉŸäÿØ",
    budget_cancel:"ÿ•ŸÑÿ∫ÿßÿ°",
    budget_0_50:"0‚Äì50",
    budget_50_100:"50‚Äì100",
    budget_100_150:"100‚Äì150",
    budget_150_200:"150‚Äì200",
    budget_200_250:"200‚Äì250",
    budget_250_300:"250‚Äì300",
    budget_300_500:"300‚Äì500",
    budget_500plus:"ÿ£ŸÉÿ´ÿ± ŸÖŸÜ 500",
    pace_title:"ÿßŸÑŸàÿ™Ÿäÿ±ÿ©:",
    pace_fast:"ÿ≥ÿ±Ÿäÿπ",
    pace_normal:"ÿπÿßÿØŸä",
    pace_slow:"ŸÖÿ±Ÿäÿ≠",
    modal_title:"ŸÇŸÖ ÿ®ÿ™ŸÉŸàŸäŸÜ ÿ±ÿ≠ŸÑÿ™ŸÉ",
    modal_departure_date:"ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑŸÖÿ∫ÿßÿØÿ±ÿ©:",
    modal_num_days:"ÿπÿØÿØ ÿßŸÑÿ£ŸäÿßŸÖ:",
    modal_max_hotels:"ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™ ÿßŸÑŸÅŸÜÿØŸÇ:",
    modal_budget_label:"ŸÖŸäÿ≤ÿßŸÜŸäÿ© ÿßŸÑŸÅŸÜÿØŸÇ (‚Ç¨/ŸäŸàŸÖ/ÿ¥ÿÆÿµ):",
    filterAllDays:"ÿßŸÑŸÉŸÑ",
    filterAllDistances:"ÿßŸÑŸÉŸÑ",
    filterAllCountries:"ÿßŸÑŸÉŸÑ",
    filterAllRegions:"ÿßŸÑŸÉŸÑ",
    filterAllThemes:"ÿßŸÑŸÉŸÑ",
    searchPlaceholder:"ŸÉŸÑŸÖÿ© ŸÖŸÅÿ™ÿßÿ≠Ÿäÿ©...",
    // ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑŸÅŸÑÿßÿ™ÿ±
    filter_days_1_3:"1-3 ÿ£ŸäÿßŸÖ",
    filter_days_4_7:"4-7 ÿ£ŸäÿßŸÖ",
    filter_days_8_14:"8-14 ŸäŸàŸÖÿßŸã",
    filter_days_15plus:"15+ ŸäŸàŸÖÿßŸã",
    filter_dist_0_500:"0-500 ŸÉŸÖ",
    filter_dist_501_1000:"501-1000 ŸÉŸÖ",
    filter_dist_1001_2000:"1001-2000 ŸÉŸÖ",
    filter_dist_2001plus:"2001+ ŸÉŸÖ",
 filter_theme_montagne:"ÿßŸÑÿ¨ÿ®ÿßŸÑ",
filter_theme_mer_cotes:"ÿßŸÑÿ®ÿ≠ÿ± ŸàÿßŸÑÿ≥Ÿàÿßÿ≠ŸÑ",
filter_theme_ville_histoire:"ÿßŸÑŸÖÿØŸÜ ŸàÿßŸÑÿ™ÿßÿ±ŸäÿÆ",
filter_theme_nature:"ÿßŸÑÿ∑ÿ®Ÿäÿπÿ©",
filter_theme_culture:"ÿßŸÑÿ´ŸÇÿßŸÅÿ©",
filter_theme_gastronomie_vin:"ÿßŸÑŸÖÿ£ŸÉŸàŸÑÿßÿ™ ŸàÿßŸÑŸÜÿ®Ÿäÿ∞",
filter_theme_aventure_outdoor:"ÿßŸÑŸÖÿ∫ÿßŸÖÿ±ÿ© ŸàÿßŸÑŸáŸàÿßÿ° ÿßŸÑÿ∑ŸÑŸÇ",
filter_theme_route_exploration:"ÿßŸÑÿ∑ÿ±ŸÇ ŸàÿßŸÑÿßÿ≥ÿ™ŸÉÿ¥ÿßŸÅ",
filter_theme_insolite_hors_sentiers:"ÿ∫Ÿäÿ± ÿßŸÑŸÖÿ£ŸÑŸàŸÅ ŸàÿÆÿßÿ±ÿ¨ ÿßŸÑŸÖÿ≥ÿßÿ±",
filter_theme_faune_vie_sauvage:"ÿßŸÑÿ≠Ÿäÿßÿ© ÿßŸÑÿ®ÿ±Ÿäÿ©",
filter_theme_spiritualite_religion:"ÿßŸÑÿ±Ÿàÿ≠ÿßŸÜŸäÿ© ŸàÿßŸÑÿØŸäŸÜ",
filter_theme_bien_etre_detente:"ÿßŸÑÿπÿßŸÅŸäÿ© ŸàÿßŸÑÿßÿ≥ÿ™ÿ±ÿÆÿßÿ°",
filter_theme_detente:"ÿßÿ≥ÿ™ÿ±ÿÆÿßÿ°",
filter_theme_tested_ort:"ŸÖŸèÿÆÿ™ÿ®Ÿéÿ± ŸàŸÖŸèÿπÿ™ŸÖÿØ ŸÖŸÜ ORT",

  }
};

</script>
<!-- Charge la config centralis√©e AVANT l‚Äôinit Firebase -->
<script src="./js/ort-config.js"></script>
<script>
/* Aligne presentation.html sur quest_simple.html */
(function(){
  const host = location.hostname;
  const isPreprod = /oneroadtrip-preprod|localhost|127\.0\.0\.1/.test(host);
  const cfg = isPreprod ? (window.ORT_CONFIG?.PREPROD || {}) : (window.ORT_CONFIG?.PROD || {});
  const safe = (cfg && cfg.apiKey) ? cfg : (window.ORT_CONFIG?.PREPROD || {});
  window.__FIREBASE_CONFIG__ = safe;
})();

/* Chargeur Firebase compat + persistance LOCAL (m√™me que quest_simple.html) */
function loadScript(src){
  return new Promise((ok,ko)=>{ const s=document.createElement('script'); s.src=src; s.onload=ok; s.onerror=()=>ko(new Error('load '+src)); document.head.appendChild(s); });
}
async function ensureFirebase(){
  if(window.firebase?.apps?.length) return window.firebase;
  await loadScript('https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js');
  await loadScript('https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js');
  const cfg = window.__FIREBASE_CONFIG__ || {};
  if(!cfg.apiKey){
    alert('Config Firebase absente : ./js/ort-config.js introuvable ou vide.');
    throw new Error('Missing Firebase apiKey');
  }
  window.firebase.initializeApp(cfg);
  await window.firebase.auth().setPersistence(window.firebase.auth.Auth.Persistence.LOCAL);
  return window.firebase;
}
</script>


<script>
/* ===== MAP EXPLORER ===== */
/* ===== MAP EXPLORER ===== */

/* === SYST√àME DE COULEURS PAR RATING === */
function ratingToStars(rating) {
  // Nouveaux seuils: 8.8/7.6/6.1/3.1 + TOUTES les √©toiles agrandies
  if (rating >= 8.8) return { stars: 5, color: '#1565C0', textColor: '#fff', radius: 18, isStar: true };  // √âtoile bleue ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
  if (rating >= 7.6) return { stars: 4, color: '#0D47A1', textColor: '#fff', radius: 16, isStar: true }; // √âtoile bleu fonc√© ‚òÖ‚òÖ‚òÖ‚òÖ
  if (rating >= 6.1) return { stars: 3, color: '#43A047', textColor: '#fff', radius: 14, isStar: false }; // Vert ‚òÖ‚òÖ‚òÖ
  if (rating >= 3.1) return { stars: 2, color: '#78909C', textColor: '#fff', radius: 12, isStar: false }; // Gris-bleu ‚òÖ‚òÖ
  if (rating >= 0.1) return { stars: 1, color: '#B0BEC5', textColor: '#333', radius: 10, isStar: false }; // Gris clair ‚òÖ
  return { stars: 0, color: '#CFD8DC', textColor: '#fff', radius: 10, isStar: false }; // Gris tr√®s clair (taille min)
}

// Fonction pour cr√©er une ic√¥ne √©toile
function createStarIcon(color, size, isSelected = false) {
  const finalColor = isSelected ? '#e11d48' : color;
  return L.divIcon({
    html: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="${finalColor}" stroke="#fff" stroke-width="2">
      <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
    </svg>`,
    className: 'star-marker' + (isSelected ? ' selected' : ''),
    iconSize: [size, size],
    iconAnchor: [size/2, size/2]
  });
}

// Index global des ratings des places (charg√© depuis places_master.json)
let placesRatingIndex = {};

let allItineraries = [];
let photosData = {};
let placesPhotosIndex = null;   // NEW: index photos par lieu (photos_lieux.json)

let mapFull = null;
let markersLayerFull = null;    // Layer clusteris√© pour les marqueurs principaux
let overlaysLayer = null;       // Layer NON clusteris√© pour polylines et cityMarkers
let selectedItineraries = [];
let MAX_SELECTION = 3; // sera mis √† jour selon le mode

// NEW: registre calques par itin_id
const itinLayers = new Map();
let hoverHideTimer = null; // ‚Üê NEW: timer de masquage survol


/* === AJOUT : √©tat du pop-up itin === */
let previewPinned = false;          // reste ouvert si true
let previewLatLng = null;           // [lat,lng] du point d‚Äôancrage courant

// --- NEW: fermer le preview et tout d√©surligner ---
window.closeItinPreview = function () {
  previewPinned = false;
  const preview = document.getElementById('itinPreview');
  
  if (preview) {
    // Animation de fermeture sur mobile
    if (window.innerWidth <= 1024) {
      preview.style.transition = 'all 0.3s ease-in';
      preview.style.opacity = '0';
      preview.style.transform = 'translateY(100%)';
      
      setTimeout(() => {
        preview.style.display = 'none';
        preview.style.transition = '';
        preview.style.transform = '';
      }, 300);
    } else {
      preview.style.display = 'none';
    }
  }
  
  // Les polylines et cityMarkers sont dans overlaysLayer
  if (typeof overlaysLayer !== 'undefined' && overlaysLayer) {
    overlaysLayer.eachLayer(l => {
      if (l instanceof L.Polyline) l.setStyle({ opacity: 0 });
      else if (l instanceof L.CircleMarker && l.options && l.options.radius === 5) {
        l.setStyle({ opacity: 0, fillOpacity: 0 });
      }
    });
  }
  
  // Masquer la barre mobile
  const mobileBar = document.getElementById('mobileActionBar');
  if (mobileBar && window.innerWidth <= 1024) {
    mobileBar.style.display = 'none';
  }
  
  updateSelectionStyles(); // NEW : r√©applique le rouge sur les s√©lectionn√©s
};

// Fonction pour r√©initialiser l'√©tat de la preview proprement
function resetPreviewState() {
  previewPinned = false;
  const p = document.getElementById('itinPreview');
  if (p) {
    p.style.display = 'none';
    p.style.visibility = 'visible';
    p.style.opacity = '1';
    p.classList.add('in-sidebar');
  }
}
/* === FIN AJOUT === */


// Liste des codes pays √† essayer (sera √©tendue automatiquement)
const COUNTRY_CODES_TO_TRY = [
  'CH', 'GR', 'HR', 'CN', 'ID', 'BE', 'FR', 'US', 'DE', 'IT', 'ES', 'PT', 'NL', 
  'AT', 'PL', 'CZ', 'HU', 'RO', 'BG', 'SI', 'SK', 'BA', 'RS', 'ME', 'MK', 'AL',
  'GB', 'IE', 'SE', 'NO', 'DK', 'FI', 'IS', 'EE', 'LV', 'LT',
  'AR', 'BR', 'CL', 'CO', 'PE', 'MX', 'CA',
  'AU', 'NZ', 'JP', 'KR', 'TH', 'VN', 'MY', 'SG', 'PH', 'IN',
  'ZA', 'EG', 'MA', 'TN', 'KE', 'TZ'
];

// Mapping des codes pays vers noms complets
const COUNTRY_NAMES = {
  'CH': { fr: 'Suisse', en: 'Switzerland', it: 'Svizzera', es: 'Suiza', pt: 'Su√≠√ßa', ar: 'ÿ≥ŸàŸäÿ≥ÿ±ÿß' },
  'GR': { fr: 'Gr√®ce', en: 'Greece', it: 'Grecia', es: 'Grecia', pt: 'Gr√©cia', ar: 'ÿßŸÑŸäŸàŸÜÿßŸÜ' },
  'HR': { fr: 'Croatie', en: 'Croatia', it: 'Croazia', es: 'Croacia', pt: 'Cro√°cia', ar: 'ŸÉÿ±Ÿàÿßÿ™Ÿäÿß' },
  'CN': { fr: 'Chine', en: 'China', it: 'Cina', es: 'China', pt: 'China', ar: 'ÿßŸÑÿµŸäŸÜ' },
  'ID': { fr: 'Indon√©sie', en: 'Indonesia', it: 'Indonesia', es: 'Indonesia', pt: 'Indon√©sia', ar: 'ÿ•ŸÜÿØŸàŸÜŸäÿ≥Ÿäÿß' },
  'BE': { fr: 'Belgique', en: 'Belgium', it: 'Belgio', es: 'B√©lgica', pt: 'B√©lgica', ar: 'ÿ®ŸÑÿ¨ŸäŸÉÿß' },
  'FR': { fr: 'France', en: 'France', it: 'Francia', es: 'Francia', pt: 'Fran√ßa', ar: 'ŸÅÿ±ŸÜÿ≥ÿß' },
  'US': { fr: '√âtats-Unis', en: 'United States', it: 'Stati Uniti', es: 'Estados Unidos', pt: 'Estados Unidos', ar: 'ÿßŸÑŸàŸÑÿßŸäÿßÿ™ ÿßŸÑŸÖÿ™ÿ≠ÿØÿ©' },
  'DE': { fr: 'Allemagne', en: 'Germany', it: 'Germania', es: 'Alemania', pt: 'Alemanha', ar: 'ÿ£ŸÑŸÖÿßŸÜŸäÿß' },
  'IT': { fr: 'Italie', en: 'Italy', it: 'Italia', es: 'Italia', pt: 'It√°lia', ar: 'ÿ•Ÿäÿ∑ÿßŸÑŸäÿß' },
  'ES': { fr: 'Espagne', en: 'Spain', it: 'Spagna', es: 'Espa√±a', pt: 'Espanha', ar: 'ÿ•ÿ≥ÿ®ÿßŸÜŸäÿß' },
  'PT': { fr: 'Portugal', en: 'Portugal', it: 'Portogallo', es: 'Portugal', pt: 'Portugal', ar: 'ÿßŸÑÿ®ÿ±ÿ™ÿ∫ÿßŸÑ' },
  'GB': { fr: 'Royaume-Uni', en: 'United Kingdom', it: 'Regno Unito', es: 'Reino Unido', pt: 'Reino Unido', ar: 'ÿßŸÑŸÖŸÖŸÑŸÉÿ© ÿßŸÑŸÖÿ™ÿ≠ÿØÿ©' },
  'AT': { fr: 'Autriche', en: 'Austria', it: 'Austria', es: 'Austria', pt: '√Åustria', ar: 'ÿßŸÑŸÜŸÖÿ≥ÿß' },
  'NL': { fr: 'Pays-Bas', en: 'Netherlands', it: 'Paesi Bassi', es: 'Pa√≠ses Bajos', pt: 'Pa√≠ses Baixos', ar: 'ŸáŸàŸÑŸÜÿØÿß' },
  'AR': { fr: 'Argentine', en: 'Argentina', it: 'Argentina', es: 'Argentina', pt: 'Argentina', ar: 'ÿßŸÑÿ£ÿ±ÿ¨ŸÜÿ™ŸäŸÜ' },
  'BR': { fr: 'Br√©sil', en: 'Brazil', it: 'Brasile', es: 'Brasil', pt: 'Brasil', ar: 'ÿßŸÑÿ®ÿ±ÿßÿ≤ŸäŸÑ' },
  'CA': { fr: 'Canada', en: 'Canada', it: 'Canada', es: 'Canad√°', pt: 'Canad√°', ar: 'ŸÉŸÜÿØÿß' },
  'MX': { fr: 'Mexique', en: 'Mexico', it: 'Messico', es: 'M√©xico', pt: 'M√©xico', ar: 'ÿßŸÑŸÖŸÉÿ≥ŸäŸÉ' },
  'AU': { fr: 'Australie', en: 'Australia', it: 'Australia', es: 'Australia', pt: 'Austr√°lia', ar: 'ÿ£ÿ≥ÿ™ÿ±ÿßŸÑŸäÿß' },
  'NZ': { fr: 'Nouvelle-Z√©lande', en: 'New Zealand', it: 'Nuova Zelanda', es: 'Nueva Zelanda', pt: 'Nova Zel√¢ndia', ar: 'ŸÜŸäŸàÿ≤ŸäŸÑŸÜÿØÿß' },
  'JP': { fr: 'Japon', en: 'Japan', it: 'Giappone', es: 'Jap√≥n', pt: 'Jap√£o', ar: 'ÿßŸÑŸäÿßÿ®ÿßŸÜ' },
  'TH': { fr: 'Tha√Ølande', en: 'Thailand', it: 'Tailandia', es: 'Tailandia', pt: 'Tail√¢ndia', ar: 'ÿ™ÿßŸäŸÑÿßŸÜÿØ' },
  'IN': { fr: 'Inde', en: 'India', it: 'India', es: 'India', pt: '√çndia', ar: 'ÿßŸÑŸáŸÜÿØ' },
  'ZA': { fr: 'Afrique du Sud', en: 'South Africa', it: 'Sudafrica', es: 'Sud√°frica', pt: '√Åfrica do Sul', ar: 'ÿ¨ŸÜŸàÿ® ÿ£ŸÅÿ±ŸäŸÇŸäÿß' },
  'MA': { fr: 'Maroc', en: 'Morocco', it: 'Marocco', es: 'Marruecos', pt: 'Marrocos', ar: 'ÿßŸÑŸÖÿ∫ÿ±ÿ®' },
  'EG': { fr: '√âgypte', en: 'Egypt', it: 'Egitto', es: 'Egipto', pt: 'Egito', ar: 'ŸÖÿµÿ±' }
};

// Ouvrir la carte en plein √©cran
document.getElementById('mapExplorerPreview')?.addEventListener('click', () => {
  document.getElementById('mapFullscreen').classList.add('active');
  document.body.style.overflow = 'hidden';
  document.getElementById('backToPresentation').style.display = ''; // Afficher bouton Retour

  /* D√©place l‚Äôaper√ßu dans l‚Äôonglet Filtres (sidebar) */
  (function movePreviewToSidebar(){
    const sidebar = document.querySelector('.map-fullscreen-sidebar .map-controls-vertical');
    const preview = document.getElementById('itinPreview');
    if (sidebar && preview && preview.parentElement !== sidebar){
      sidebar.insertBefore(preview, sidebar.firstChild);
      preview.classList.add('in-sidebar');
    }
  })();

if (!mapFull) {
  setTimeout(() => {
    loadThemes(); // Charger en arri√®re-plan
    initMapFull();
    loadPhotosData();
    loadPlacesPhotosIndex();
    loadAllItineraries();
  }, 100);
} else {

    setTimeout(() => mapFull.invalidateSize(), 100);
  }
});

// Fermer la carte
document.getElementById('closeMapFull')?.addEventListener('click', () => {
  document.getElementById('mapFullscreen').classList.remove('active');
  document.body.style.overflow = '';
  document.getElementById('backToPresentation').style.display = 'none'; // Masquer bouton Retour
  if (typeof closeItinPreview === 'function') closeItinPreview();
  if (typeof resetPreviewState === 'function') resetPreviewState();
});

// Bouton Retour vers presentation.html
document.getElementById('backToPresentation')?.addEventListener('click', () => {
  document.getElementById('mapFullscreen').classList.remove('active');
  document.body.style.overflow = '';
  document.getElementById('backToPresentation').style.display = 'none'; // Masquer bouton Retour
  if (typeof closeItinPreview === 'function') closeItinPreview();
  if (typeof resetPreviewState === 'function') resetPreviewState();
});

document.getElementById('mapFullscreen')?.addEventListener('click', (e) => {
  if (e.target.id === 'mapFullscreen') {
    document.getElementById('mapFullscreen').classList.remove('active');
    document.body.style.overflow = '';
    document.getElementById('backToPresentation').style.display = 'none'; // Masquer bouton Retour
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape' && document.getElementById('mapFullscreen').classList.contains('active')) {
    document.getElementById('mapFullscreen').classList.remove('active');
    document.body.style.overflow = '';
    document.getElementById('backToPresentation').style.display = 'none'; // Masquer bouton Retour
  }
});

async function loadPhotosData() {
  try {
    let response = await fetch('data/photos-json/photos_rt.json');
    if (!response.ok) {
      response = await fetch('/mnt/user-data/uploads/photos_rt.json');
    }
    if (response.ok) {
      photosData = await response.json();
    }
  } catch (error) {
  }
}

// NEW: charge l‚Äôindex des photos par lieu (cl√© = CC::slug)
async function loadPlacesPhotosIndex() {
  try {
    let response = await fetch('data/photos-json/photos_lieux.json');
    if (!response.ok) {
      response = await fetch('/mnt/user-data/uploads/photos_lieux.json');
    }
    if (response.ok) {
      placesPhotosIndex = await response.json();
    }
  } catch (e) {
  }
}

async function loadAllItineraries() {
  try {
    // Charger l'index des pays
    const indexPaths = [
      'data/Roadtripsprefabriques/countries/countries.index.json',
      './data/Roadtripsprefabriques/countries/countries.index.json'
    ];
    
    let countryList = [];
    for (const path of indexPaths) {
      try {
        const idxRes = await fetch(path);
        if (idxRes.ok) {
          const idxJson = await idxRes.json();
          countryList = Array.isArray(idxJson) ? idxJson : (idxJson.countries || []);
          break;
        }
      } catch (err) {
      }
    }
    
    if (countryList.length === 0) {
      countryList = COUNTRY_CODES_TO_TRY.map(cc => ({ cc: cc }));
    }
    
    // D√©tecter le pays de l'utilisateur
    let userCountry = null;
    try {
      const ipRes = await fetch('https://ipapi.co/json/');
      if (ipRes.ok) {
        const ipData = await ipRes.json();
        userCountry = ipData.country_code;
      }
    } catch (e) { /* ignore */ }
    
    // S√©parer pays user et autres pays
    const getCC = c => String(c.cc || c.code || c.id || c).toUpperCase();
    const userCountryList = userCountry ? countryList.filter(c => getCC(c) === userCountry) : [];
    const otherCountries = userCountry ? countryList.filter(c => getCC(c) !== userCountry) : countryList;
    
    // Fonction pour charger un pays
    async function loadCountry(countryObj) {
      const countryCode = getCC(countryObj);
      const countryLower = countryCode.toLowerCase();
      const lang = localStorage.getItem('lang') || 'fr';
      
      await loadPlacesRatings(countryCode);
      
      // Fallback langue: langue courante ‚Üí en ‚Üí fr (sauf si d√©j√† dans la liste)
      const langFallback = lang !== 'en' && lang !== 'fr' ? [lang, 'en', 'fr'] : 
                           lang === 'en' ? ['en', 'fr'] : ['fr', 'en'];
      
      // Chemins insensibles √† la casse : dossier et fichier en majuscules OU minuscules
      const paths = [];
      for (const fl of langFallback) {
        // Dossier MAJUSCULE + Fichier MAJUSCULE
        paths.push(`data/Roadtripsprefabriques/countries/${countryCode}/${countryCode}.itins.modules-${fl}.json`);
        paths.push(`./data/Roadtripsprefabriques/countries/${countryCode}/${countryCode}.itins.modules-${fl}.json`);
        // Dossier minuscule + Fichier MAJUSCULE
        paths.push(`data/Roadtripsprefabriques/countries/${countryLower}/${countryCode}.itins.modules-${fl}.json`);
        paths.push(`./data/Roadtripsprefabriques/countries/${countryLower}/${countryCode}.itins.modules-${fl}.json`);
        // Dossier minuscule + Fichier minuscule
        paths.push(`data/Roadtripsprefabriques/countries/${countryLower}/${countryLower}.itins.modules-${fl}.json`);
        paths.push(`./data/Roadtripsprefabriques/countries/${countryLower}/${countryLower}.itins.modules-${fl}.json`);
        // Dossier MAJUSCULE + Fichier minuscule
        paths.push(`data/Roadtripsprefabriques/countries/${countryCode}/${countryLower}.itins.modules-${fl}.json`);
        paths.push(`./data/Roadtripsprefabriques/countries/${countryCode}/${countryLower}.itins.modules-${fl}.json`);
      }
      // Ancien format sans suffixe langue (toutes variantes)
      paths.push(`data/Roadtripsprefabriques/countries/${countryCode}/${countryCode}.itins.modules.json`);
      paths.push(`./data/Roadtripsprefabriques/countries/${countryCode}/${countryCode}.itins.modules.json`);
      paths.push(`data/Roadtripsprefabriques/countries/${countryLower}/${countryCode}.itins.modules.json`);
      paths.push(`./data/Roadtripsprefabriques/countries/${countryLower}/${countryCode}.itins.modules.json`);
      paths.push(`data/Roadtripsprefabriques/countries/${countryLower}/${countryLower}.itins.modules.json`);
      paths.push(`./data/Roadtripsprefabriques/countries/${countryLower}/${countryLower}.itins.modules.json`);
      
      for (const path of paths) {
        try {
          const response = await fetch(path, { cache: 'no-store' });
          if (response.ok) {
            const data = await response.json();
            const countryName = COUNTRY_NAMES[countryCode]?.[lang] || countryCode;
            return (data.itineraries || []).map(itin => ({
              ...itin,
              __id: itin.itin_id || itin.id || itin.slug || '',
              country: countryCode,
              countryName: countryName,
              days: itin.estimated_days_base || itin.days_plan?.length || 0,
              stops: countUniqueStops(itin),
              totalDistance: calculateTotalDistance(itin),
              lat: (computeItinCenter(itin).lat) || 0,
              lng: (computeItinCenter(itin).lng) || 0,
              cities: extractCities(itin),
              photos: getItinPhotos({ ...itin, country: countryCode, countryName }),
              avgRating: computeAvgRating(itin) || 5
            }));
          }
        } catch (err) { /* continue */ }
      }
      return [];
    }
    
    // √âTAPE 1: Charger le pays de l'utilisateur EN PREMIER
    if (userCountryList.length > 0) {
      const userResults = await Promise.all(userCountryList.map(loadCountry));
      const userItins = userResults.flat().filter(itin => itin.__id);
      if (userItins.length > 0) {
        allItineraries = userItins;
        populateFilters();
        displayMarkers(allItineraries);
      }
    }
    
    // √âTAPE 2: Charger les autres pays en arri√®re-plan
    const otherResults = await Promise.all(otherCountries.map(loadCountry));
    const otherItins = otherResults.flat().filter(itin => itin.__id);
    
    // Fusionner et r√©afficher
    allItineraries = [...allItineraries, ...otherItins];
    populateFilters();
    displayMarkers(allItineraries);
    
  } catch (error) {
  }
}

function getItinPhotos(itin) {
  if (!photosData) return [];
  
  // Essayer plusieurs formats de cl√©s possibles
  const possibleKeys = [
    itin.itin_id,
    itin.title,
    `${itin.country}::${itin.dept_name}`,
    `${itin.country}::${itin.title}`,
    itin.dept_name
  ];
  
  for (const key of possibleKeys) {
    if (photosData[key] && photosData[key].photos) {
      return photosData[key].photos.slice(0, 2);
    }
  }
  
  // Chercher par correspondance partielle dans les cl√©s
  for (const key in photosData) {
    if (key.includes(itin.country) && 
        (key.toLowerCase().includes(itin.dept_name?.toLowerCase() || '') ||
         key.toLowerCase().includes(itin.title.toLowerCase().substring(0, 20)))) {
      return photosData[key].photos.slice(0, 2);
    }
  }
  
  return [];
}

function calculateTotalDistance(itin) {
  if (!itin.days_plan || !Array.isArray(itin.days_plan)) return 0;
  let total = 0;
  itin.days_plan.forEach(day => {
    if (day.to_next_leg && day.to_next_leg.distance_km) {
      total += day.to_next_leg.distance_km;
    }
  });
  return Math.round(total);
}

/* === Compte le nombre d'√©tapes/stops uniques === */
function countUniqueStops(itin) {
  if (!itin.days_plan || !Array.isArray(itin.days_plan)) return 0;
  const uniquePlaces = new Set();
  itin.days_plan.forEach(day => {
    if (day.night && day.night.place_id) {
      uniquePlaces.add(day.night.place_id);
    }
  });
  return uniquePlaces.size;
}

/* === Calcul du rating moyen de l'itin√©raire via places_master === */
function computeAvgRating(itin) {
  if (!itin.days_plan || !Array.isArray(itin.days_plan)) return 5;
  let sum = 0, count = 0;
  const debugLog = [];
  
  // Parcourir TOUTES les places de l'itin√©raire (jours + nuits)
  itin.days_plan.forEach((day, dayIdx) => {
    // Essayer plusieurs noms de champs possibles pour les places du jour
    const placesArrays = [
      day.places,
      day.stops,
      day.stop_places,
      day.locations,
      day.location_ids,
      day.pois,
      day.visits
    ].filter(Array.isArray);
    
    placesArrays.forEach(placesArray => {
      placesArray.forEach(item => {
        const place_id = item?.place_id || item;
        if (place_id) {
          const placeRating = placesRatingIndex[place_id];
          if (placeRating && typeof placeRating === 'number') {
            sum += placeRating;
            count++;
            debugLog.push(`Day ${dayIdx}: ${place_id} = ${placeRating}`);
          }
        }
      });
    });
    
    // Rating de la nuit (h√©bergement)
    if (day.night && day.night.place_id) {
      const placeRating = placesRatingIndex[day.night.place_id];
      if (placeRating && typeof placeRating === 'number') {
        sum += placeRating;
        count++;
        debugLog.push(`Night ${dayIdx}: ${day.night.place_id} = ${placeRating}`);
      }
    }
  });
  
  const result = count > 0 ? Math.round(sum / count * 10) / 10 : 5;
  
  // Logs supprim√©s
  
  return result;
}

/* === Chargement des ratings depuis places_master.json === */
async function loadPlacesRatings(countryCode) {
  const cc = countryCode.toLowerCase();
  const CC = countryCode.toUpperCase();
  const lang = localStorage.getItem('lang') || 'fr';
  
  // Chercher {CC}.places.master-{lang}.json EN PREMIER
  // Puis fallback sur d'autres formats
  const paths = [
    // Format principal: CC.places.master-lang.json
    `data/Roadtripsprefabriques/countries/${CC}/${CC}.places.master-${lang}.json`,
    `./data/Roadtripsprefabriques/countries/${CC}/${CC}.places.master-${lang}.json`,
    `data/Roadtripsprefabriques/countries/${cc}/${CC}.places.master-${lang}.json`,
    `./data/Roadtripsprefabriques/countries/${cc}/${CC}.places.master-${lang}.json`,
    
    // Format avec underscore: cc_places_master-lang.json
    `data/Roadtripsprefabriques/countries/${CC}/${cc}_places_master-${lang}.json`,
    `./data/Roadtripsprefabriques/countries/${CC}/${cc}_places_master-${lang}.json`,
    `data/Roadtripsprefabriques/countries/${cc}/${cc}_places_master-${lang}.json`,
    `./data/Roadtripsprefabriques/countries/${cc}/${cc}_places_master-${lang}.json`,
    
    // Fallback: essayer d'autres langues (avec point)
    `data/Roadtripsprefabriques/countries/${CC}/${CC}.places.master-fr.json`,
    `./data/Roadtripsprefabriques/countries/${CC}/${CC}.places.master-fr.json`,
    `data/Roadtripsprefabriques/countries/${cc}/${CC}.places.master-fr.json`,
    `./data/Roadtripsprefabriques/countries/${cc}/${CC}.places.master-fr.json`,
    
    // Fallback: essayer d'autres langues (avec underscore)
    `data/Roadtripsprefabriques/countries/${CC}/${cc}_places_master-fr.json`,
    `./data/Roadtripsprefabriques/countries/${CC}/${cc}_places_master-fr.json`,
    `data/Roadtripsprefabriques/countries/${cc}/${cc}_places_master-fr.json`,
    `./data/Roadtripsprefabriques/countries/${cc}/${cc}_places_master-fr.json`,
    
    // Format ancien sans langue
    `data/Roadtripsprefabriques/countries/${CC}/${CC}.places.master.json`,
    `./data/Roadtripsprefabriques/countries/${CC}/${CC}.places.master.json`,
    `data/Roadtripsprefabriques/countries/${cc}/${CC}.places.master.json`,
    `./data/Roadtripsprefabriques/countries/${cc}/${CC}.places.master.json`,
  ];
  
  for (const path of paths) {
    try {
      const response = await fetch(path);
      if (response.ok) {
        const data = await response.json();
        if (data.places && Array.isArray(data.places)) {
          const beforeCount = Object.keys(placesRatingIndex).length;
          data.places.forEach(place => {
            if (place.place_id && typeof place.rating === 'number') {
              placesRatingIndex[place.place_id] = place.rating;
            }
          });
          const afterCount = Object.keys(placesRatingIndex).length;
        }
        return true;
      }
    } catch (err) {
      // Continuer avec le prochain chemin
    }
  }
  return false;
}

/* === AJOUT : centre moyen des nuits === */
function computeItinCenter(itin) {
  if (!itin || !Array.isArray(itin.days_plan) || itin.days_plan.length === 0) {
    return { lat: 0, lng: 0 };
  }
  let n = 0, sumLat = 0, sumLng = 0;
  itin.days_plan.forEach(day => {
    const c = day && day.night && Array.isArray(day.night.coords) ? day.night.coords : null;
    if (c && Number.isFinite(c[0]) && Number.isFinite(c[1])) {
      sumLat += c[0];
      sumLng += c[1];
      n++;
    }
  });
  return n > 0 ? { lat: sumLat / n, lng: sumLng / n } : { lat: 0, lng: 0 };
}
/* === FIN AJOUT === */

function extractCities(itin) {
  if (!itin.days_plan) return [];
  const cities = [];
  itin.days_plan.forEach(day => {
    let cityName = day?.night?.city; // Chercher d'abord city (au cas o√π)
    
    // Si pas de city, parser le place_id: "AE::abu-dhabi-centre" ‚Üí "Abu Dhabi"
    if (!cityName && day?.night?.place_id) {
      const parts = day.night.place_id.split('::');
      if (parts[1]) {
        let slug = parts[1];
        // Retirer les suffixes comme -centre, -airport, -nord, -sud, -est, -ouest, -ville, -city, etc
        slug = slug.replace(/-(centre|airport|a√©roport|nord|sud|est|ouest|ville|city|downtown|airport|port|gare)$/i, '');
        // Capitaliser proprement: "abu-dhabi" ‚Üí "Abu Dhabi"
        cityName = slug
          .split('-')
          .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
          .join(' ');
      }
    }
    
    if (cityName && !cities.includes(cityName)) {
      cities.push(cityName);
    }
  });
  return cities;
}

// NEW: retourne un tableau de cl√©s lieux "CC::slug" √† partir de l‚Äôitin
function getPlaceKeysFromItin(itin) {
  const keys = new Set();
  const days = Array.isArray(itin.days_plan) ? itin.days_plan : [];

  for (const d of days) {
    if (d?.night?.place_id) keys.add(d.night.place_id);

    if (Array.isArray(d?.visits)) {
      d.visits.forEach(v => { if (v?.place_id) keys.add(v.place_id); });
    }
    if (Array.isArray(d?.activities)) {
      d.activities.forEach(a => { if (a?.place_id) keys.add(a.place_id); });
    }
  }
  return Array.from(keys);
}

function populateFilters() {

  const lang = localStorage.getItem('lang') || 'fr';
  const L_TEXT = T[lang] || T.fr;
  
  const countries = [...new Set(allItineraries.map(i => i.countryName))].sort();
  const regions = [...new Set(allItineraries.map(i => i.dept_name).filter(Boolean))].sort();
  
  const countrySelect = document.getElementById('filterCountryFull');
  countrySelect.innerHTML = `<option value="">${L_TEXT.filterAllCountries}</option>`;
  countries.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    countrySelect.appendChild(opt);
  });
  
  const regionSelect = document.getElementById('filterRegionFull');
  regionSelect.innerHTML = `<option value="">${L_TEXT.filterAllRegions}</option>`;
  regions.forEach(r => {
    const opt = document.createElement('option');
    opt.value = r;
    opt.textContent = r;
    regionSelect.appendChild(opt);
  });
}


// Coordonn√©es centrales des pays (lat, lng, zoom)
const COUNTRY_CENTERS = {
  FR: [46.6, 2.5, 5], DE: [51.1, 10.4, 5], IT: [42.5, 12.5, 5], ES: [40.0, -3.7, 5],
  GB: [54.0, -2.5, 5], PT: [39.5, -8.0, 6], BE: [50.5, 4.5, 7], NL: [52.2, 5.3, 7],
  CH: [46.8, 8.2, 7], AT: [47.5, 14.5, 6], GR: [39.0, 22.0, 6], PL: [52.0, 19.0, 5],
  US: [39.8, -98.5, 4], CA: [56.0, -106.0, 3], MX: [23.6, -102.5, 5],
  BR: [-14.2, -51.9, 4], AR: [-38.4, -63.6, 4], CL: [-35.7, -71.5, 4],
  AU: [-25.3, 133.8, 4], NZ: [-41.0, 174.0, 5], JP: [36.2, 138.2, 5],
  CN: [35.9, 104.2, 4], KR: [36.5, 127.5, 6], IN: [20.6, 78.9, 4],
  TH: [15.9, 100.9, 5], VN: [16.0, 108.0, 5], ID: [-2.5, 118.0, 4],
  MA: [31.8, -7.1, 5], ZA: [-30.6, 24.0, 5], EG: [26.8, 30.8, 5],
  AE: [24.0, 54.0, 6], SA: [24.0, 45.0, 5], TR: [39.0, 35.0, 5],
  RU: [61.5, 105.3, 3], SE: [62.0, 15.0, 4], NO: [64.0, 10.0, 4],
  DK: [56.0, 10.0, 6], FI: [64.0, 26.0, 4], IE: [53.4, -8.2, 6]
};

// D√©tecter le pays de l'utilisateur et centrer la carte
async function detectUserCountryAndCenter() {
  try {
    // Essayer via API IP (gratuit, pas de cl√©)
    const response = await fetch('https://ipapi.co/json/', { timeout: 3000 });
    if (response.ok) {
      const data = await response.json();
      const countryCode = data.country_code;
      if (countryCode && COUNTRY_CENTERS[countryCode]) {
        const [lat, lng, zoom] = COUNTRY_CENTERS[countryCode];
        mapFull.setView([lat, lng], zoom);
        return;
      }
    }
  } catch (e) {
  }
}

// ===== MONITORING / DEBUG =====
let lastFrameTime = performance.now();
let fps = 0;
let lastEvent = '--';
let lastEventTime = 0;

function updateDebugPanel() {
  const fpsEl = document.getElementById('debugFPS');
  const markersEl = document.getElementById('debugMarkers');
  const zoomEl = document.getElementById('debugZoom');
  const coordsEl = document.getElementById('debugCoords');
  const memoryEl = document.getElementById('debugMemory');
  const eventEl = document.getElementById('debugEvent');
  
  if (!mapFull) {
    requestAnimationFrame(updateDebugPanel);
    return;
  }
  
  // FPS
  const now = performance.now();
  const deltaTime = now - lastFrameTime;
  fps = deltaTime > 0 ? Math.round(1000 / deltaTime) : 60;
  lastFrameTime = now;
  if (fpsEl) fpsEl.textContent = fps;
  
  // Markers count
  let markerCount = 0;
  if (markersLayer && markersLayer._layers) {
    markerCount = Object.keys(markersLayer._layers).length;
  }
  if (markersEl) markersEl.textContent = markerCount;
  
  // Zoom
  if (zoomEl) zoomEl.textContent = mapFull.getZoom();
  
  // Coordinates
  const center = mapFull.getCenter();
  if (coordsEl) coordsEl.textContent = `${center.lat.toFixed(2)}, ${center.lng.toFixed(2)}`;
  
  // Memory
  if (performance.memory && memoryEl) {
    const mb = (performance.memory.usedJSHeapSize / 1048576).toFixed(1);
    memoryEl.textContent = `${mb}MB`;
  }
  
  // Event
  const nowMs = Date.now();
  if (nowMs - lastEventTime > 1500) {
    lastEvent = '--';
  }
  if (eventEl) eventEl.textContent = lastEvent;
  
  requestAnimationFrame(updateDebugPanel);
}

// D√©marrer le monitoring d√®s le chargement
window.addEventListener('load', () => {
  setTimeout(() => updateDebugPanel(), 100);
});

function initMapFull() {
  mapFull = L.map('mapContainerFull').setView([46.0, 8.0], 4);
L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
    attribution: '¬© CARTO ¬© OpenStreetMap',
    maxZoom: 20
  }).addTo(mapFull);

  // Essayer de centrer sur le pays de l'utilisateur
  detectUserCountryAndCenter();

  markersLayerFull = L.markerClusterGroup({
    maxClusterRadius: 50,
    spiderfyOnMaxZoom: true,
    showCoverageOnHover: false,
    zoomToBoundsOnClick: true,
    disableClusteringAtZoom: 10,
    iconCreateFunction: function(cluster) {
      const count = cluster.getChildCount();
      let size = 'small';
      if (count > 50) size = 'large';
      else if (count > 20) size = 'medium';
      
      return L.divIcon({
        html: '<div>' + count + '</div>',
        className: 'marker-cluster marker-cluster-' + size,
        iconSize: L.point(40, 40)
      });
    }
  }).addTo(mapFull);

  // Layer s√©par√© pour les overlays (polylines et cityMarkers) - PAS clusteris√©
  overlaysLayer = L.layerGroup().addTo(mapFull);

  // --- NEW: clic sur la carte = fermer / nettoyer si on ne clique pas sur le preview
  mapFull.on('click', (e) => {
    const t = e.originalEvent?.target;
    if (!t || !t.closest || !t.closest('#itinPreview')) {
      closeItinPreview();
    }
  });

  // --- NEW: gestion du zoom pour affichage progressif des markers
  mapFull.on('zoomend', () => {
    console.log('[MAP] ZOOMEND:', mapFull.getZoom());
    lastEvent = 'ZOOMED';
    lastEventTime = Date.now();
    updateMarkersVisibility();
  });
  
  // Track map movement
  mapFull.on('movestart', () => {
    lastEvent = 'MOVING';
    lastEventTime = Date.now();
  });
  
  mapFull.on('moveend', () => {
    lastEvent = 'MOVED';
    lastEventTime = Date.now();
  });
  
  mapFull.on('zoomstart', () => {
    lastEvent = 'ZOOMING';
    lastEventTime = Date.now();
  });
}

// Seuils de zoom pour l'affichage progressif des ITIN√âRAIRES
// Moins restrictif que pour les places car il y en a moins (~700)
function getMinRatingForZoom(zoom) {
  if (zoom < 3) return 5.5;    // Zoom tr√®s global (monde): seulement 5‚òÖ
  if (zoom < 4) return 4.5;    // Zoom continent/tr√®s large: 5‚òÖ + quelques 4‚òÖ
  return 0;                     // Zoom >= 4 (pays/r√©gion): tous les itin√©raires
}

function updateMarkersVisibility() {
  if (!mapFull || !itinLayers) return;
  const zoom = mapFull.getZoom();
  // Mobile : d√©sactiver le filtrage par rating (afficher tous les itin√©raires)
  const isMobile = window.innerWidth <= 1024;
  const minRating = isMobile ? 0 : getMinRatingForZoom(zoom);
  const bounds = mapFull.getBounds(); // R√©cup√©rer les limites visibles de la carte
  let visibleCount = 0;
  
  itinLayers.forEach(({ mainMarker, polyline, cityMarkers, avgRating }, id) => {
    // Ne pas mettre 5 par d√©faut - utiliser le rating r√©el ou null
    const rating = avgRating || 0;  // Si pas de rating, consid√©rer comme bas
    const isSelected = selectedItineraries.some(i => i.itin_id === id);
    
    // V√©rifier si le marqueur est dans les bounds visibles
    const markerLatLng = mainMarker ? mainMarker.getLatLng() : null;
    const isInBounds = markerLatLng ? bounds.contains(markerLatLng) : false;
    
    if (rating >= minRating || isSelected) {
      // Afficher le marker principal (dans le cluster)
      if (mainMarker && !markersLayerFull.hasLayer(mainMarker)) {
        markersLayerFull.addLayer(mainMarker);
      }
      // Compter seulement si dans les bounds visibles
      if (isInBounds) {
        visibleCount++;
      }
    } else {
      // Masquer le marker principal
      if (mainMarker && markersLayerFull.hasLayer(mainMarker)) {
        markersLayerFull.removeLayer(mainMarker);
      }
      // Masquer aussi la polyline et les cityMarkers (dans overlaysLayer)
      if (polyline && overlaysLayer.hasLayer(polyline)) {
        overlaysLayer.removeLayer(polyline);
      }
      cityMarkers.forEach(cm => {
        if (overlaysLayer.hasLayer(cm)) {
          overlaysLayer.removeLayer(cm);
        }
      });
    }
  });
  
  // Mettre √† jour le compteur affich√©
  updateFilterCount(visibleCount);
}

function displayMarkers(itineraries) {
  if (!markersLayerFull) return;
  
  // DEBUG Desktop : afficher stats ratings
  if (window.innerWidth > 1024) {
    const ratingStats = { total: itineraries.length, withRating: 0, noRating: 0, byStars: {1:0,2:0,3:0,4:0,5:0} };
    itineraries.forEach(it => {
      if (it.avgRating && it.avgRating !== 5) { ratingStats.withRating++; } else { ratingStats.noRating++; }
      const stars = Math.round(it.avgRating || 5);
      ratingStats.byStars[stars] = (ratingStats.byStars[stars] || 0) + 1;
    });
  }
  
  markersLayerFull.clearLayers();
  if (overlaysLayer) overlaysLayer.clearLayers();;
  itinLayers.clear(); // NEW

  itineraries.forEach(itin => {
    let polyline = null;
    let cityMarkers = [];
    
    // Pr√©parer le trac√© mais ne pas l'afficher
    if (itin.days_plan && itin.days_plan.length > 1) {
      const routeCoords = [];
      
      itin.days_plan.forEach(day => {
        if (day.night && day.night.coords && Array.isArray(day.night.coords) && day.night.coords.length === 2) {
          routeCoords.push([day.night.coords[0], day.night.coords[1]]);
        }
      });
      
      // Debug: afficher les coordonn√©es du premier itin pour v√©rifier
      if (routeCoords.length >= 2 && Math.random() < 0.01) {
      }
      
      // Cr√©er le trac√© (mais invisible au d√©part, sera rendu interactif apr√®s)
      if (routeCoords.length >= 2) {
        polyline = L.polyline(routeCoords, {
          color: '#00bfff',
          weight: 3,
          opacity: 0,  // Invisible par d√©faut
          smoothFactor: 1,
          interactive: false  // Non-interactif au d√©part
        });
        
        // Cr√©er les marqueurs de villes (invisibles au d√©part) - sur overlaysLayer PAS clusteris√©
        routeCoords.forEach((coord, idx) => {
          const cityMarker = L.circleMarker(coord, {
            radius: 5,
            fillColor: '#ffd166',
            color: '#fff',
            weight: 1,
            opacity: 0,  // Invisible par d√©faut
            fillOpacity: 0
          });
          cityMarker.on('click', () => selectItinerary(itin));
          cityMarker.addTo(overlaysLayer);  // Ajout√© √† overlaysLayer, pas au cluster
          cityMarkers.push(cityMarker);
        });
        
        polyline.on('mouseover', () => {
  const isSel = selectedItineraries.some(i => i.itin_id === itin.itin_id);
  if (!isSel) {
    polyline.setStyle({ weight: 5, opacity: 0.9 });
    cityMarkers.forEach(cm => cm.setStyle({ opacity: 1, fillOpacity: 0.9 }));
  }
  if (!previewPinned) showPreview(itin);
});

polyline.on('mouseout', () => {
  const isSel = selectedItineraries.some(i => i.itin_id === itin.itin_id);
  polyline.setStyle({ weight: isSel ? 4 : 3, opacity: isSel ? 0.95 : 0 });
  if (!isSel) {
    cityMarkers.forEach(cm => cm.setStyle({ opacity: 0, fillOpacity: 0 }));
  }
});
polyline.on('click', () => {
  previewPinned = true;
  showPreview(itin);
  selectItinerary(itin);
});

        polyline.addTo(overlaysLayer);  // Ajout√© √† overlaysLayer, pas au cluster
      }
    }
    
    // Calcul du rating moyen de l'itin√©raire
    const avgRating = itin.avgRating || 5; // D√©faut √† 5 si non d√©fini
    const starInfo = ratingToStars(avgRating);
    
    // Marqueur principal au point de d√©part - √©toile ou cercle selon rating
    let marker;
    if (starInfo.isStar) {
      // √âtoile pour les incontournables (4‚òÖ+)
      // Desktop: 52px, Mobile: 64px pour √™tre vraiment visible et plus grand que les ronds
      marker = L.marker([itin.lat, itin.lng], {
        icon: createStarIcon(starInfo.color, window.innerWidth <= 1024 ? 64 : 52)
      });
    } else {
      // Cercle pour les autres
      // Sur mobile/tablette : doubler le radius pour √™tre cliquable
      const isMobile = window.innerWidth <= 1024;
      const radius = isMobile ? starInfo.radius * 2 : starInfo.radius;
      
      marker = L.circleMarker([itin.lat, itin.lng], {
        radius: radius,
        fillColor: starInfo.color,
        color: '#fff',
        weight: 2,
        opacity: 1,
        fillOpacity: 0.8
      });
    }
    marker.starInfo = starInfo;
    
  marker.on('mouseover', () => {
  const isSel = selectedItineraries.some(i => i.itin_id === itin.itin_id);
  if (!isSel && polyline) {
    polyline.setStyle({ opacity: 0.7 });
    polyline.options.interactive = true;  // Rendre interactif quand visible
  }
  if (!isSel) cityMarkers.forEach(cm => cm.setStyle({ opacity: 1, fillOpacity: 0.9 }));
  if (!previewPinned) showPreview(itin);
});


marker.on('mouseout', () => {
  setTimeout(() => {
    const preview = document.getElementById('itinPreview');
    const isSel = selectedItineraries.some(i => i.itin_id === itin.itin_id);
    const sidebar = document.querySelector('.map-fullscreen-sidebar');
    const sidebarHovered = sidebar && sidebar.matches(':hover');
    // Si √©pingl√© ou sidebar survol√©e, on ne cache pas
    if (!previewPinned && preview && !preview.matches(':hover') && !sidebarHovered) {
      preview.style.display = 'none';
    }
    if (!isSel) {
      if (polyline) {
        polyline.setStyle({ opacity: 0 });
        polyline.options.interactive = false;  // D√©sactiver l'interactivit√© quand invisible
      }
      cityMarkers.forEach(cm => cm.setStyle({ opacity: 0, fillOpacity: 0 }));
    }
  }, 250);
});

marker.on('click', () => {
  if (polyline) polyline.setStyle({ opacity: 0.7 });
  cityMarkers.forEach(cm => cm.setStyle({ opacity: 1, fillOpacity: 0.9 }));
  previewPinned = true;
  
  // Mobile/Tablette : afficher la modale de s√©lection
  if (window.innerWidth <= 1024) {
    showMobileSelectionModal(itin);
  } else {
    // Desktop : afficher le preview et s√©lectionner
    showPreview(itin);
    selectItinerary(itin);
  }
});

        marker.addTo(markersLayerFull);

    // NEW: m√©moriser les calques pour cet itin (avec starInfo et avgRating pour le zoom progressif)
    itinLayers.set(itin.itin_id, { polyline, cityMarkers, mainMarker: marker, starInfo, avgRating });
  });
  
  updateFilterCount(itineraries.length);
  updateSelectionStyles(); // NEW: r√©appliquer le rouge apr√®s redraw
  
  // Appliquer la visibilit√© selon le zoom actuel
  updateMarkersVisibility();
}


/* === MAJ : pop-up coll√© √† l'extr√™me droite + 4 photos des villes === */
// Fonction pour afficher la modale de confirmation mobile (simple)
function showMobileConfirmModal(itin) {
  const modal = document.getElementById('mobileConfirmModal');
  const lang = localStorage.getItem('lang') || 'fr';
  const L = T[lang] || T.fr;
  
  // Titre
  document.getElementById('mobileConfirmTitle').textContent = itin.title;
  
  // Infos courtes
  const starInfo = ratingToStars(itin.avgRating || 5);
  const starsDisplay = '‚òÖ'.repeat(starInfo.stars) + '‚òÜ'.repeat(5 - starInfo.stars);
  
  document.getElementById('mobileConfirmInfo').innerHTML = `
    <div style="color:${starInfo.color};font-size:18px;margin-bottom:8px">${starsDisplay}</div>
    <div><strong>${itin.days}</strong> jours ‚Ä¢ <strong>${itin.totalDistance}</strong> km</div>
    <div style="margin-top:8px;color:#666">${itin.countryName || ''}</div>
  `;
  
  // Traductions boutons
  document.getElementById('mobileConfirmCancelText').textContent = L.mobileCancelText || 'Annuler';
  document.getElementById('mobileConfirmValidateText').textContent = L.mobileSelectText || 'Valider';
  
  // Afficher
  modal.classList.add('show');
  
  // Handlers
  document.getElementById('mobileConfirmCancel').onclick = () => {
    modal.classList.remove('show');
  };
  
  document.getElementById('mobileConfirmValidate').onclick = () => {
    selectItinerary(itin);
    modal.classList.remove('show');
  };
  
  // Fermer si clic sur fond
  modal.onclick = (e) => {
    if (e.target === modal) {
      modal.classList.remove('show');
    }
  };
}

function showMobileSelectionModal(itin) {
  const modal = document.getElementById('mobileSelectionModal');
  const actionBar = document.getElementById('mobileActionBar');
  const lang = (localStorage.getItem('lang') || 'fr').toLowerCase();
  const L = T[lang] || T.fr;
  
  // Titre
  document.getElementById('mobileModalTitle').textContent = itin.title;
  
  // Rating et √©toiles
  const avgRating = itin.avgRating || 5;
  const starInfo = ratingToStars(avgRating);
  const starsDisplay = '‚òÖ'.repeat(starInfo.stars) + '‚òÜ'.repeat(5 - starInfo.stars);
  
  // Infos synth√©tiques
  const T_DAYS = { fr: 'jours', en: 'days', es: 'd√≠as', it: 'giorni', pt: 'dias', ar: 'ÿ£ŸäÿßŸÖ' };
  const T_STOPS = { fr: '√©tapes', en: 'stops', es: 'etapas', it: 'tappe', pt: 'etapas', ar: 'ŸÖÿ≠ÿ∑ÿßÿ™' };
  document.getElementById('mobileModalInfo').innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <span><strong>${itin.days}</strong> ${T_DAYS[lang] || 'jours'} ‚Ä¢ <strong>${itin.stops || 0}</strong> ${T_STOPS[lang] || '√©tapes'} ‚Ä¢ <strong>${itin.totalDistance || 0}</strong> km</span>
      <span style="color:${starInfo.color};font-size:18px;">${starsDisplay}</span>
    </div>
  `;
  
  // Photo unique
  const photoList = [];
  const seen = new Set();
  try {
    if (placesPhotosIndex && typeof placesPhotosIndex === 'object') {
      const placeKeys = getPlaceKeysFromItin(itin) || [];
      for (const k of placeKeys) {
        const arr = placesPhotosIndex[k]?.photos;
        if (Array.isArray(arr) && arr[0] && !seen.has(arr[0])) {
          seen.add(arr[0]);
          photoList.push(arr[0]);
          break;
        }
      }
    }
  } catch (err) { }
  
  if (photoList.length < 1 && Array.isArray(itin.photos) && itin.photos[0]) {
    photoList.push(itin.photos[0]);
  }
  
  // Afficher photos seulement sur desktop (>768px)
  if (photoList.length > 0 && window.innerWidth > 768) {
    const proxyUrl = `https://wsrv.nl/?url=${encodeURIComponent(photoList[0])}&w=400&h=180&fit=cover&output=webp`;
    document.getElementById('mobileModalPhotos').innerHTML = `<img src="${proxyUrl}" style="width:100%;height:150px;object-fit:cover;border-radius:8px;" alt="Photo" loading="lazy">`;
  } else {
    document.getElementById('mobileModalPhotos').innerHTML = '';
  }
  
  // √âtapes du parcours
  let stepsHtml = '';
  const T_ROUTE = { fr: 'Parcours', en: 'Route', es: 'Ruta', it: 'Percorso', pt: 'Rota', ar: 'ÿßŸÑŸÖÿ≥ÿßÿ±' };
  
  if (Array.isArray(itin.days_plan) && itin.days_plan.length > 0) {
    const cities = [];
    itin.days_plan.forEach(day => {
      let cityName = day?.night?.city; // Chercher d'abord city (au cas o√π)
      
      // Si pas de city, parser le place_id: "AE::abu-dhabi-centre" ‚Üí "Abu Dhabi"
      if (!cityName && day?.night?.place_id) {
        const parts = day.night.place_id.split('::');
        if (parts[1]) {
          let slug = parts[1];
          slug = slug.replace(/-(centre|airport|a√©roport|nord|sud|est|ouest|ville|city|downtown|port|gare)$/i, '');
          cityName = slug
            .split('-')
            .map(w => w.charAt(0).toUpperCase() + w.slice(1).toLowerCase())
            .join(' ');
        }
      }
      
      if (cityName && !cities.includes(cityName)) {
        cities.push(cityName);
      }
    });
    
    if (cities.length > 0) {
      stepsHtml = `<strong>${T_ROUTE[lang] || 'Parcours'}</strong><br>`;
      stepsHtml += `<div style="margin-top:8px;line-height:1.8;">`;
      stepsHtml += cities.map((city, i) => {
        const isLast = i === cities.length - 1;
        return `<span style="display:inline-block;padding:4px 10px;background:#f3f4f6;border-radius:12px;margin:2px 4px 2px 0;font-size:13px;">${city}</span>${isLast ? '' : '‚Üí'}`;
      }).join(' ');
      stepsHtml += `</div>`;
    }
  } else if (Array.isArray(itin.cities) && itin.cities.length > 0) {
    stepsHtml = `<strong>${T_ROUTE[lang] || 'Parcours'}</strong><br>`;
    stepsHtml += `<div style="margin-top:8px;line-height:1.8;">`;
    stepsHtml += itin.cities.map((city, i) => {
      const isLast = i === itin.cities.length - 1;
      return `<span style="display:inline-block;padding:4px 10px;background:#f3f4f6;border-radius:12px;margin:2px 4px 2px 0;font-size:13px;">${city}</span>${isLast ? '' : '‚Üí'}`;
    }).join(' ');
    stepsHtml += `</div>`;
  }
  
  document.getElementById('mobileModalSteps').innerHTML = stepsHtml;
  
  // Afficher la modale et masquer la barre d'action
  modal.classList.add('show');
  if (actionBar) actionBar.style.display = 'none';
  
  // Handlers
  document.getElementById('mobileModalSelect').onclick = () => {
    selectItinerary(itin);
    modal.classList.remove('show');
    if (actionBar) actionBar.style.display = 'flex';
  };
  
  document.getElementById('mobileModalCancel').onclick = () => {
    modal.classList.remove('show');
    if (actionBar) actionBar.style.display = 'flex';
  };
  
  modal.onclick = (e) => {
    if (e.target === modal) {
      modal.classList.remove('show');
      if (actionBar) actionBar.style.display = 'flex';
    }
  };
}


function showPreview(itin) {
  const preview = document.getElementById('itinPreview');
  // Force le scroll de la sidebar en haut pour √©viter le bug d'ancrage
  const sidebar = document.querySelector('.map-fullscreen-sidebar');
  if (sidebar) sidebar.scrollTop = 0;
  
  const lang = (localStorage.getItem('lang') || 'fr').toLowerCase();
  const T_MAP = {
    fr: { days: 'jours', km: 'km', cities: 'Villes travers√©es :' },
    en: { days: 'days', km: 'km', cities: 'Cities:' },
    it: { days: 'giorni', km: 'km', cities: 'Citt√†:' },
    es: { days: 'd√≠as', km: 'km', cities: 'Ciudades:' },
    pt: { days: 'dias', km: 'km', cities: 'Cidades:' },
    ar: { days: 'ÿ£ŸäÿßŸÖ', km: 'ŸÉŸÖ', cities: 'ÿßŸÑŸÖÿØŸÜ:' }
  };
  const t = T_MAP[lang] || T_MAP.fr;

  // Rating et √©toiles
  const avgRating = itin.avgRating || 5;
  const starInfo = ratingToStars(avgRating);
  const starsDisplay = '‚òÖ'.repeat(starInfo.stars) + '‚òÜ'.repeat(5 - starInfo.stars);

  // Labels traduits pour stops
  const T_STOPS = { fr: '√©tapes', en: 'stops', it: 'tappe', es: 'etapas', pt: 'etapas', ar: 'ŸÖÿ≠ÿ∑ÿßÿ™' };
  const stopsLabel = T_STOPS[lang] || T_STOPS.fr;

  // Titre + infos synth√©tiques
  document.getElementById('previewTitle').textContent = itin.title;
  document.getElementById('previewInfo').innerHTML = `
    <div><strong>${itin.days}</strong> ${t.days} ‚Ä¢ <strong>${itin.stops || 0}</strong> ${stopsLabel} ‚Ä¢ <strong>${itin.totalDistance}</strong> ${t.km}</div>
    <div>${itin.dept_name || itin.countryName}</div>
    <div style="color:${starInfo.color}; font-size:16px; font-weight:600; margin-top:4px">${starsDisplay}</div>
  `;


  // Photo : 1 seule pour chargement rapide
  let firstPhoto = null;
  {
    if (placesPhotosIndex && typeof placesPhotosIndex === 'object') {
      const placeKeys = getPlaceKeysFromItin(itin) || [];
      for (const k of placeKeys) {
        const arr = placesPhotosIndex[k]?.photos;
        if (Array.isArray(arr) && arr[0]) { firstPhoto = arr[0]; break; }
      }
    }
  }

  // Fallback
  if (!firstPhoto && Array.isArray(itin.photos) && itin.photos[0]) {
    firstPhoto = itin.photos[0];
  }

  // Bloc villes + photo unique (desktop seulement)
  let citiesHtml = `<strong>${t.cities}</strong><br>${(itin.cities||[]).join(' ‚Üí ')}`;
  if (firstPhoto && typeof firstPhoto === 'string' && !firstPhoto.includes('${') && window.innerWidth > 768) {
    const proxyUrl = `https://wsrv.nl/?url=${encodeURIComponent(firstPhoto)}&w=400&h=200&fit=cover&output=webp`;
    citiesHtml += `<div style="margin-top:10px;"><img src="${proxyUrl}" style="width:100%;height:120px;object-fit:cover;border-radius:8px;" alt="Photo" loading="lazy"></div>`;
  }
  document.getElementById('previewCities').innerHTML = citiesHtml;


  // Parcours simplifi√©
  const pathSimplified = document.getElementById('previewPathSimplified');
  const pathFlow = document.getElementById('previewPathFlow');
  if (Array.isArray(itin.days_plan) && itin.days_plan.length > 1) {
    const simplifiedCities = [];
    itin.days_plan.forEach(day => { 
      if (day?.night?.city && !simplifiedCities.includes(day.night.city)) simplifiedCities.push(day.night.city); 
    });
    if (simplifiedCities.length >= 2) {
      pathFlow.innerHTML = '';
      simplifiedCities.forEach((city, idx) => {
        const node = document.createElement('span');
        node.className = 'city-node';
        node.textContent = city;
        pathFlow.appendChild(node);
        if (idx < simplifiedCities.length - 1) {
          const arrow = document.createElement('span');
          arrow.className = 'arrow';
          arrow.textContent = '‚Üí';
          pathFlow.appendChild(arrow);
        }
      });
      pathSimplified.style.display = 'block';
    } else {
      pathSimplified.style.display = 'none';
    }
  } else {
    pathSimplified.style.display = 'none';
  }

  // Bouton "S√©lectionner"
  document.getElementById('previewSelectBtn').onclick = () => { selectItinerary(itin); closeItinPreview(); };

  // Barre mobile : afficher et attacher les handlers
  const mobileBar = document.getElementById('mobileActionBar');
  const mobileBtnText = document.getElementById('selectItinBtnMobileText');
  const mobileCancelBtnText = document.getElementById('mobileCancelBtnText');
  
  if (mobileBar && window.innerWidth <= 1024) {
    // Mettre √† jour les textes (i18n)
    const lang = localStorage.getItem('lang') || 'fr';
    const L = T[lang] || T.fr;
    if (mobileBtnText) mobileBtnText.textContent = L.selectBtnText || 'Valider';
    if (mobileCancelBtnText) mobileCancelBtnText.textContent = L.cancelBtnText || 'Annuler';
    
    // Afficher la barre
    mobileBar.style.display = 'flex';
    
    // Handler du bouton Valider
    const mobileBtn = document.getElementById('selectItinBtnMobile');
    if (mobileBtn) {
      mobileBtn.onclick = () => {
        selectItinerary(itin);
        mobileBar.style.display = 'none';
        closeItinPreview();
      };
    }
    
    // Handler du bouton Annuler
    const mobileCancelBtn = document.getElementById('mobileCancelBtn');
    if (mobileCancelBtn) {
      mobileCancelBtn.onclick = () => {
        mobileBar.style.display = 'none';
        closeItinPreview();
      };
    }
  }

  // Afficher dans la sidebar (g√©r√© par .in-sidebar)
  preview.style.display = 'block';
  
  // Animation d'apparition sur mobile
  if (window.innerWidth <= 1024) {
    preview.style.opacity = '0';
    preview.style.transform = 'translateY(100%)';
    setTimeout(() => {
      preview.style.transition = 'all 0.3s ease-out';
      preview.style.opacity = '1';
      preview.style.transform = 'translateY(0)';
    }, 10);
  }
}

/* === FIN MAJ === */

/* === FIN MAJ === */

// NEW: applique le style "s√©lectionn√© = rouge" sur la carte
function updateSelectionStyles(){
  const selIds = new Set(selectedItineraries.map(i => i.itin_id));
  itinLayers.forEach(({ polyline, cityMarkers = [], mainMarker, starInfo }, id) => {
    const isSel = selIds.has(id);
    // Couleur par d√©faut si starInfo absent
    const defaultColor = starInfo ? starInfo.color : '#94a3b8';
    const defaultRadius = starInfo ? starInfo.radius : 8;
    
    if (polyline) {
      polyline.setStyle({
        color:  isSel ? '#e11d48' : '#00bfff',
        weight: isSel ? 4 : 3,
        opacity:isSel ? 0.95 : 0
      });
    }
    (cityMarkers || []).forEach(cm => {
      if (!cm) return;
      cm.setStyle({
        color:'#fff',
        fillColor: isSel ? '#e11d48' : '#ffd166',
        weight:1,
        opacity:    isSel ? 1    : 0,
        fillOpacity:isSel ? 0.95 : 0
      });
    });
    // G√©rer les marqueurs : √©toile ou cercle
    if (mainMarker) {
      if (starInfo && starInfo.isStar) {
        // Pour les √©toiles, changer l'ic√¥ne
        mainMarker.setIcon(createStarIcon(isSel ? '#e11d48' : defaultColor, isSel ? 28 : 24, isSel));
      } else if (mainMarker.setStyle) {
        // Pour les cercles, utiliser setStyle
        mainMarker.setStyle({ 
          fillColor: isSel ? '#e11d48' : defaultColor,
          radius: isSel ? defaultRadius + 4 : defaultRadius  // Grossit si s√©lectionn√©
        });
      }
    }
  });
}


// Valider la s√©lection et passer √† l'√©tape suivante (modale budget)
function validateAndContinue() {
  if (selectedItineraries.length === 0) {
    const lang = localStorage.getItem('lang') || 'fr';
    const L = T[lang] || T.fr;
    alert(L.alertNoSelection || 'Veuillez s√©lectionner au moins un itin√©raire');
    return;
  }
  
  const lang = localStorage.getItem('lang') || 'fr';
  const mode = localStorage.getItem('tripMode') || 'expert';
  const totalDays = selectedItineraries.reduce((sum, itin) => sum + (itin.days || 7), 0);
  const firstTitle = selectedItineraries[0]?.title || 'Voyage';
  
  // Ouvrir la modale budget avec callback de redirection
  showBudgetModal((config) => {
    const budget = config.budget || '50-100';
    
    if (selectedItineraries.length === 1) {
      // 1 seul itin√©raire
      const id = selectedItineraries[0].itin_id;
      const cc = (id.split('::')[0] || '').toUpperCase();
      window.location.href = `roadtrip_detail.html?cc=${cc}&itin=${encodeURIComponent(id)}&lang=${lang}&mode=${mode}&budget=${budget}`;
    } else {
      // 2-3 itin√©raires -> fusion COMPOSED
      const ids = selectedItineraries.map(i => i.itin_id);
      const cc = (ids[0].split('::')[0] || '').toUpperCase();
      const composed = `COMPOSED::${ids.join('+')}`;
      window.location.href = `roadtrip_detail.html?cc=${cc}&itin=${encodeURIComponent(composed)}&lang=${lang}&mode=${mode}&budget=${budget}`;
    }
  }, totalDays, firstTitle);
}


// Ajouter un itin√©raire compl√©mentaire proche
function addMoreItinerary() {
  const lang = localStorage.getItem('lang') || 'fr';
  const L = T[lang] || T.fr;
  const mode = localStorage.getItem('tripMode') || 'expert';
  
  if (mode === 'simple') {
    alert(L.alertSimpleModeOneOnly || 'En mode simple, un seul itin√©raire.');
    return;
  }
  
  if (selectedItineraries.length >= MAX_SELECTION) {
    alert(L.alertMaxSelection || 'Vous avez atteint le maximum de s√©lections.');
    return;
  }
  
  // Fermer le preview et laisser choisir un autre itin
  closeItinPreview();
  alert(L.alertSelectAnother || 'Choisissez un autre itin√©raire sur la carte.');
}

function selectItinerary(itin) {

  const lang = localStorage.getItem('lang') || 'fr';
  const L_TEXT = T[lang] || T.fr;
  
  if (selectedItineraries.find(i => i.itin_id === itin.itin_id)) {
    alert(L_TEXT.alertAlreadySelected);
    return;
  }
  if (selectedItineraries.length >= MAX_SELECTION) {
    const mode = localStorage.getItem('tripMode') || 'expert';
    const alertMsg = (mode === 'simple') ? L_TEXT.alertMaxSelectionSimple : L_TEXT.alertMaxSelection;
    alert(alertMsg);
    return;
  }
   selectedItineraries.push(itin);
  updateSelectionPanel();
  updateSelectionStyles();
  // Ne pas cacher la preview - garder visible pour confirmer le choix
  previewPinned = true;
  const p = document.getElementById('itinPreview');
  if (p) {
    p.style.display = 'block';
    p.style.visibility = 'visible';
    p.style.opacity = '1';
  }
}


window.removeFromSelection = function(itinId) {
  selectedItineraries = selectedItineraries.filter(i => i.itin_id !== itinId);
  updateSelectionPanel();
  updateSelectionStyles();
  // R√©initialiser l'√©tat de la preview pour permettre de nouveaux survols
  previewPinned = false;
  const preview = document.getElementById('itinPreview');
  if (preview) preview.style.display = 'none';
};

function updateSelectionPanel() {
  const banner = document.getElementById('selectionBanner');
  const items = document.getElementById('selectionBannerItems');
  const btnContinue = document.getElementById('btnContinueSelection');
  
  if (!banner || !items) return;
  
  if (selectedItineraries.length > 0) {
    banner.style.display = 'block';
    items.innerHTML = selectedItineraries.map(itin => {
      const shortTitle = itin.title.length > 25 ? itin.title.substring(0, 25) + '...' : itin.title;
      return `<div style="display:inline-flex;align-items:center;background:rgba(255,255,255,0.2);padding:6px 12px;border-radius:20px;color:#fff;font-size:13px;">
        <span>${shortTitle}</span>
        <button onclick="removeFromSelection('${itin.itin_id}')" style="background:none;border:none;color:#fff;margin-left:8px;cursor:pointer;font-size:14px;opacity:0.8;">‚úï</button>
      </div>`;
    }).join('');
    
    const lang = localStorage.getItem('lang') || 'fr';
    const L = T[lang] || T.fr;
    btnContinue.textContent = (L.continueBtn || 'Continuer') + ' ‚Üí';
  } else {
    banner.style.display = 'none';
  }
}


// Fonction modal configuration voyage
function showBudgetModal(callback, itinDays, itinTitle) {
  const lang = localStorage.getItem('lang') || 'fr';
  const L = T[lang] || T.fr;
  const modal = document.getElementById('budgetModal');
  
  // Traductions
  document.getElementById('budgetModalTitle').textContent = L.modal_title || 'Configurez votre voyage';
  document.getElementById('labelDepartureDate').textContent = L.modal_departure_date || 'Date de d√©part :';
  document.getElementById('labelNumDays').textContent = L.modal_num_days || 'Nombre de jours souhait√©s :';
  document.getElementById('budgetConfirm').textContent = L.budget_confirm || 'Valider';
  document.getElementById('budgetCancel').textContent = L.budget_cancel || 'Annuler';
  
  // Initialiser la date √† aujourd'hui
  const today = new Date().toISOString().split('T')[0];
  document.getElementById('inputDepartureDate').value = today;
  
  // Initialiser le nombre de jours (depuis l'itin√©raire ou d√©faut 7)
  const numDaysInput = document.getElementById('inputNumDays');
  numDaysInput.value = itinDays || 7;
  
  // Afficher modal
  modal.classList.add('show');
  
  // Bouton Confirmer
  const confirmHandler = () => {
    modal.classList.remove('show');
    document.getElementById('budgetConfirm').removeEventListener('click', confirmHandler);
    document.getElementById('budgetCancel').removeEventListener('click', cancelHandler);
    modal.removeEventListener('click', overlayHandler);
    
    // R√©cup√©rer les valeurs
    const departureDate = document.getElementById('inputDepartureDate').value;
    const numDays = document.getElementById('inputNumDays').value;
    
    callback({ departureDate, numDays, budget: '' });
  };
  
  // Bouton Annuler
  const cancelHandler = () => {
    modal.classList.remove('show');
    document.getElementById('budgetConfirm').removeEventListener('click', confirmHandler);
    document.getElementById('budgetCancel').removeEventListener('click', cancelHandler);
    modal.removeEventListener('click', overlayHandler);
  };
  
  // Clic overlay
  const overlayHandler = (e) => {
    if (e.target === modal) cancelHandler();
  };
  
  document.getElementById('budgetConfirm').addEventListener('click', confirmHandler);
  document.getElementById('budgetCancel').addEventListener('click', cancelHandler);
  modal.addEventListener('click', overlayHandler);
}

document.getElementById('btnValidateSelection')?.addEventListener('click', () => {
  if (selectedItineraries.length === 0) return;
  const lang = (localStorage.getItem('lang') || 'fr').toLowerCase();
  const mode = localStorage.getItem('tripMode') || 'expert';

  // 1 seul RT ‚Üí d√©tail direct
  if (selectedItineraries.length === 1) {
    const itin = selectedItineraries[0];
    const id = itin.itin_id;
    const cc = (id.split('::')[0] || '').toUpperCase();
    const itinDays = itin.days || 7;
    const itinTitle = itin.title || '';
    
    // Afficher popup configuration
    showBudgetModal((config) => {
      const params = new URLSearchParams({
        cc: cc,
        itin: id,
        lang: lang,
        mode: mode,
        departure: config.departureDate,
        days: config.numDays,
        budget: config.budget
      });
      window.location.href = `roadtrip_detail.html?${params.toString()}`;
    }, itinDays, itinTitle);
    return;
  }

  // 2‚Äì3 RT ‚Üí fusion COMPOSED
  const ids = selectedItineraries.map(i => i.itin_id);
  const titles = selectedItineraries.map(i => i.title).join(' + ');
  const cc  = (ids[0].split('::')[0] || '').toUpperCase();
  const composed = `COMPOSED::${ids.join('+')}`;
  const totalDays = selectedItineraries.reduce((sum, i) => sum + (i.days || 0), 0) || 7;
  
  // Afficher popup configuration
  showBudgetModal((config) => {
    const params = new URLSearchParams({
      cc: cc,
      itin: composed,
      lang: lang,
      mode: mode,
      departure: config.departureDate,
      days: config.numDays,
      budget: config.budget
    });
    window.location.href = `roadtrip_detail.html?${params.toString()}`;
  }, totalDays, titles);
});


function updateFilterCount(count) {
  const lang = localStorage.getItem('lang') || 'fr';
  const L_TEXT = T[lang] || T.fr;
  
  // Mise √† jour du compteur dans la sidebar
  const text = count === 1 ? L_TEXT.filterCount_single : L_TEXT.filterCount_plural;
  document.getElementById('filterCountFull').textContent = `${count} ${text}`;
  
  // Mise √† jour du compteur dans le header
  updateVisibleItinsCount(count);
}

/* ===== THEME REGISTRY (13 th√®mes Excel + "tested-ort") =====
 /*
   THEMES_REG et THEMES_LABELS charg√©s dynamiquement depuis themes.i18n.json
   Ne plus √©diter manuellement - utiliser l'outil admin pour g√©rer les th√®mes
*/
let THEMES_REG = {};
let THEMES_LABELS = {};
let THEMES_DATA = null;

/* Charge themes.i18n.json et construit THEMES_REG dynamiquement */
async function loadThemes() {
  try {
    // Tenter plusieurs chemins possibles
const paths = [
  'data/Roadtripsprefabriques/countries/themes.i18n.json',
  './data/Roadtripsprefabriques/countries/themes.i18n.json',
  '/data/Roadtripsprefabriques/countries/themes.i18n.json',
  'Roadtripsprefabriques/countries/themes.i18n.json',
  '../Roadtripsprefabriques/countries/themes.i18n.json'
];

let response = null;
for (const path of paths) {
  try {
    const res = await fetch(path);
    if (res.ok) {
      response = res;
      break;
    }
  } catch (err) {
  }
}

if (!response) {
  return buildFallbackThemes();
}
    
 
    
    THEMES_DATA = await response.json();
    
    // Construction de THEMES_REG depuis le JSON
    THEMES_REG = {};
    THEMES_LABELS = {};
    
    for (const theme of THEMES_DATA.themes) {
      THEMES_REG[theme.key] = theme.synonyms || [];
      THEMES_LABELS[theme.key] = theme.label_fr;
    }
    
    
    // G√©n√©rer les options du select
    populateThemeSelect();
    
  } catch (error) {
    buildFallbackThemes();
  }
}

/* G√©n√®re les <option> du select depuis THEMES_DATA */
function populateThemeSelect(lang) {
  const select = document.getElementById('filterThemeFull');
  if (!select || !THEMES_DATA) return;
  
  const currentLang = lang || localStorage.getItem('lang') || document.documentElement.lang || 'fr';
  
  // Sauvegarder la valeur s√©lectionn√©e
  const currentValue = select.value;
  
// Garder l'option "Tous" avec traduction
select.innerHTML = '';
const allOption = document.createElement('option');
allOption.value = '';

// Utiliser les traductions i18n si disponibles
const translations = {
  fr: 'Tous',
  en: 'All', 
  it: 'Tutti',
  es: 'Todos',
  pt: 'Todos',
  ar: 'ÿßŸÑŸÉŸÑ'
};
allOption.textContent = translations[currentLang] || 'Tous';
select.appendChild(allOption);
  
  // Trier par ordre
  const sortedThemes = [...THEMES_DATA.themes].sort((a, b) => (a.order || 0) - (b.order || 0));
  
  for (const theme of sortedThemes) {
    const option = document.createElement('option');
    option.value = theme.key;
    option.textContent = theme.i18n[currentLang] || theme.label_fr;
    select.appendChild(option);
  }
  
  // Restaurer la valeur s√©lectionn√©e
  if (currentValue) select.value = currentValue;
}

/* Fallback si themes.i18n.json indisponible */
function buildFallbackThemes() {
  THEMES_REG = {
    "montagne": ["montagne","mountain","alp","alpes","massif","sommet","col"],
    "mer-cotes": ["mer","c√¥te","cotes","c√¥tes","coast","sea","plage","riviera","shore"],
    "ville-histoire": ["ville","city","cit√©","histoire","historic","heritage","old town","centro storico","casco antiguo"],
    "nature": ["nature","parc","r√©serve","reserve","for√™t","foret","forest","lac","lake","cascade","waterfall","valley","canyon"],
    "culture": ["culture","mus√©e","museum","monument","architecture","patrimoine","unesco","art"],
    "gastronomie-vin": ["gastronomie","vin","wine","food","culinaire","oenologie","≈ìnologie","bodega","cantina"],
    "aventure-outdoor": ["aventure","adventure","trek","randonn√©e","randonnee","hike","trail","kayak","rafting","via ferrata","bivouac"],
    "route-exploration": ["route","roadtrip","exploration","panoramique","scenic","drive","col routier"],
    "insolite-hors-sentiers": ["insolite","hors sentiers","offbeat","unusual","secret","hidden","alternatif","alternativo"],
    "faune-vie-sauvage": ["faune","sauvage","wildlife","animaux","birdwatching","safari"],
    "spiritualite-religion": ["spiritualit√©","spiritualite","religion","sanctuaire","abbaye","monast√®re","temple","shrine","church","ermitage"],
    "bien-etre-detente": ["bien-√™tre","bien etre","spa","thermal","onsen","wellness","relax","baln√©o","balneario","terme"],
    "detente": ["d√©tente","detente","relax","loisirs","plaisir"],
    "tested-ort": []
  };
  
  THEMES_LABELS = {
    "montagne":"Montagne","mer-cotes":"Mer & C√¥tes","ville-histoire":"Ville & Histoire",
    "nature":"Nature","culture":"Culture","gastronomie-vin":"Gastronomie & Vin",
    "aventure-outdoor":"Aventure & Outdoor","route-exploration":"Route & Exploration",
    "insolite-hors-sentiers":"Insolite & Hors sentiers battus","faune-vie-sauvage":"Faune & Vie sauvage",
    "spiritualite-religion":"Spiritualit√© & Religion","bien-etre-detente":"Bien-√™tre & D√©tente",
    "detente":"D√©tente","tested-ort":"Test√© & approuv√© ORT"
  };
  
}

/* Normalise des tokens "th√®me" depuis plusieurs champs d‚Äôun itin */
function getItinThemeTokens(i){
  const acc = new Set();
  const push = (v)=>{
    if(!v) return;
    if(Array.isArray(v)){ v.forEach(push); return; }
    String(v).split(/[|,;/]/).forEach(s=>{
      const t = s.trim().toLowerCase();
      if(t) acc.add(t);
    });
  };
  push(i.themes);
  push(i.tags);
  push(i.categories);
  push(i?.meta?.themes);
  if (i.title) {
    String(i.title).toLowerCase().split(/[^\p{L}\p{N}]+/u).forEach(w=>{
      if(w && w.length>=3) acc.add(w);
    });
  }
  return acc;
}

/* Correspondance s√©lecteur -> donn√©es itin */
/* Correspondance s√©lecteur -> donn√©es itin */
function matchesTheme(itin, themeKey){
  if (themeKey === "tested-ort") {
    return !!(itin.tested || itin.verifiedByORT || itin?.meta?.tested === true);
  }
  const tokens = getItinThemeTokens(itin);
  const syn = THEMES_REG[themeKey] || [];

  // 1) match exact (tokens)
  for (const s of syn) if (tokens.has(s)) return true;

  // 2) match "contains" souple
  for (const s of syn) for (const t of tokens) if (t.includes(s)) return true;

  // 3) si i.themes textuel contient le libell√© FR (depuis THEMES_LABELS dynamique)
  if (itin.themes && typeof itin.themes === 'string') {
    const labelFR = THEMES_LABELS[themeKey];
    if (labelFR && itin.themes.toLowerCase().includes(labelFR.toLowerCase())) return true;
  }
  return false;
}

function applyFilters() {
 
  const daysFilter = document.getElementById('filterDaysFull').value;
  /* d√©sactivation temporaire */
  const distanceFilter = '';
  const countryFilter  = '';
  const regionFilter   = '';
  /* -- */
  const themeFilter    = document.getElementById('filterThemeFull').value;
  const searchText     = document.getElementById('searchItinFull').value.toLowerCase();
  
  let filtered = allItineraries;
  
  if (daysFilter) {
    if (daysFilter === '1-3') filtered = filtered.filter(i => i.days >= 1 && i.days <= 3);
    else if (daysFilter === '4-7') filtered = filtered.filter(i => i.days >= 4 && i.days <= 7);
    else if (daysFilter === '8-14') filtered = filtered.filter(i => i.days >= 8 && i.days <= 14);
    else if (daysFilter === '15+') filtered = filtered.filter(i => i.days >= 15);
  }
  
  if (distanceFilter) {
    if (distanceFilter === '0-500') filtered = filtered.filter(i => i.totalDistance >= 0 && i.totalDistance <= 500);
    else if (distanceFilter === '501-1000') filtered = filtered.filter(i => i.totalDistance >= 501 && i.totalDistance <= 1000);
    else if (distanceFilter === '1001-2000') filtered = filtered.filter(i => i.totalDistance >= 1001 && i.totalDistance <= 2000);
    else if (distanceFilter === '2001+') filtered = filtered.filter(i => i.totalDistance >= 2001);
  }
  
  if (countryFilter) filtered = filtered.filter(i => i.countryName === countryFilter);
  if (regionFilter)  filtered = filtered.filter(i => i.dept_name === regionFilter);

  if (themeFilter) {
    const key = themeFilter.toLowerCase();
    const beforeFilter = filtered.length;
    filtered = filtered.filter(i => matchesTheme(i, key));
  }

  if (searchText) {
    filtered = filtered.filter(i => 
      (i.title || '').toLowerCase().includes(searchText) ||
      (i.dept_name || '').toLowerCase().includes(searchText) ||
      i.cities.some(city => city.toLowerCase().includes(searchText))
    );
  }
  
  displayMarkers(filtered);
  
  // Appliquer aussi la visibilit√© selon le zoom actuel
  // Cela mettra √† jour le compteur avec le nombre r√©ellement visible
  if (mapFull) {
    updateMarkersVisibility();
  }
  
  if (filtered.length > 0 && mapFull) {
    const bounds = L.latLngBounds(filtered.map(i => [i.lat, i.lng]));
    mapFull.fitBounds(bounds, { padding: [50, 50] });
  }
}

// Fonction pour mettre √† jour le compteur d'itin√©raires visibles
function updateVisibleItinsCount(count) {
  const countEl = document.getElementById('visibleItinsCount');
  if (!countEl) return;
  
  // Afficher seulement le nombre
  countEl.textContent = count;
}


document.getElementById('filterDaysFull')?.addEventListener('change', applyFilters);
/* d√©sactivation temporaire
document.getElementById('filterDistanceFull')?.addEventListener('change', applyFilters);
document.getElementById('filterCountryFull')?.addEventListener('change', applyFilters);
document.getElementById('filterRegionFull')?.addEventListener('change', applyFilters);
*/
document.getElementById('filterThemeFull')?.addEventListener('change', applyFilters);
document.getElementById('searchItinFull')?.addEventListener('input',  applyFilters);

document.getElementById('btnResetFiltersFull')?.addEventListener('click', () => {
  document.getElementById('filterDaysFull').value = '';
  document.getElementById('filterDistanceFull').value = '';
  document.getElementById('filterCountryFull').value = '';
  document.getElementById('filterRegionFull').value = '';
  document.getElementById('filterThemeFull').value = '';
  document.getElementById('searchItinFull').value = '';
  displayMarkers(allItineraries);
  if (mapFull) mapFull.setView([46.0, 8.0], 4);
});



/* ===== Auto-lang (default EN) ===== */
(function(){
  const SUP=["fr","en","it","es","pt","ar"];
  let lang = new URLSearchParams(location.search).get('lang')
           || localStorage.getItem('lang')
           || (navigator.languages && navigator.languages[0]) || navigator.language || 'en';
  lang = (lang||'en').slice(0,2).toLowerCase();
  if(!SUP.includes(lang)) lang='en';
  localStorage.setItem('lang',lang);

  // D√©tection du mode (simple ou expert)
  const urlParams = new URLSearchParams(location.search);
  let mode = urlParams.get('mode') || localStorage.getItem('tripMode') || 'expert';
  if(mode !== 'simple' && mode !== 'expert') mode = 'expert';
  localStorage.setItem('tripMode', mode);

  document.documentElement.lang=lang;
  document.documentElement.dir=(lang==='ar')?'rtl':'ltr';
  document.body.classList.add(`mode-${mode}`);
  const L=T[lang]||T.en;

  // Header
  const openAuthEl = document.getElementById('openAuth'); if (openAuthEl) openAuthEl.textContent=L.login;
  const sel=document.getElementById('langSel'); sel.value=lang;
  document.getElementById('homeLink').addEventListener('click',e=>{
    e.preventDefault(); const u=new URL('index.html', location.href); u.searchParams.set('lang', lang); location.href=u.toString();
  });
  sel.addEventListener('change',e=>{
    const code=e.target.value; localStorage.setItem('lang',code);
    const u=new URL(location.href); u.searchParams.set('lang',code); location.replace(u.toString());
  });

  // Badge mode - ins√©rer dans modeBadge existant
  const modeBadgeEl = document.getElementById('modeBadge');
  if (modeBadgeEl) {
    modeBadgeEl.className = 'mode-badge ' + mode;
    modeBadgeEl.textContent = (mode === 'simple') ? L.badge_mode_simple : L.badge_mode_expert;
    modeBadgeEl.style.display = 'inline-block';
  }

  // Helper pour setter le textContent en s√©curit√©
  const setTextById = (id, text) => { const el = document.getElementById(id); if (el) el.textContent = text; };
  const setPlaceholderById = (id, text) => { const el = document.getElementById(id); if (el) el.placeholder = text; };
  // Map section
  setTextById('mapTitle',L.mapTitle);
  setTextById('mapTitleFull',L.mapTitle);
  setTextById('closeBtnText',L.closeBtnText);
  setTextById('backBtnText',L.backBtnText);
  setTextById('filterTitle',L.filterTitle);
  setTextById('filtersBtnText',L.filtersBtnText);
  setTextById('labelDaysFull',L.labelDays);
  setTextById('labelDistanceFull',L.labelDistance);
  setTextById('labelCountryFull',L.labelCountry);
  setTextById('labelRegionFull',L.labelRegion);
  setTextById('labelThemeFull',L.labelTheme);
  setTextById('labelSearchFull',L.labelSearch);
  setPlaceholderById('searchItinFull', L.searchPlaceholder);
  setTextById('btnResetFiltersFull',L.btnReset);
  
  // L√©gende de la carte
  setTextById('legendTitle',L.legend_title || 'Itin√©raires');
  setTextById('legendIncontournable',L.legend_incontournable || 'Incontournable');
  setTextById('legendRecommande',L.legend_recommande || 'Recommand√©');
  setTextById('legendDecouvrir',L.legend_decouvrir || '√Ä d√©couvrir');
  setTextById('legendStandard',L.legend_standard || 'Standard');
  setTextById('legendSelected',L.legend_selected || 'S√©lectionn√©');
  
  // Mise √† jour selon le mode
  MAX_SELECTION = (mode === 'simple') ? 1 : 3;
  setTextById('selectionTitle', (mode === 'simple') ? L.selectionTitleSimple : L.selectionTitleExpert);
  
  setTextById('btnValidateSelection',L.compareBtn);
  setTextById('previewSelectBtn',L.selectBtnText);
  
  // Mettre √† jour les options des filtres
  const filterDays = document.getElementById('filterDaysFull');
  filterDays.options[0].text = L.filterAllDays;
  filterDays.options[1].text = L.filter_days_1_3;
  filterDays.options[2].text = L.filter_days_4_7;
  filterDays.options[3].text = L.filter_days_8_14;
  filterDays.options[4].text = L.filter_days_15plus;
  
  const filterDist = document.getElementById('filterDistanceFull');
  filterDist.options[0].text = L.filterAllDistances;
  filterDist.options[1].text = L.filter_dist_0_500;
  filterDist.options[2].text = L.filter_dist_501_1000;
  filterDist.options[3].text = L.filter_dist_1001_2000;
  filterDist.options[4].text = L.filter_dist_2001plus;
  
 // Les th√®mes sont maintenant traduits automatiquement lors de populateThemeSelect()
// On traduit l'option "Tous" ET on r√©g√©n√®re les th√®mes avec la bonne langue
const filterTheme = document.getElementById('filterThemeFull');
if (filterTheme && filterTheme.options[0]) {
  filterTheme.options[0].text = L.filterAllThemes;
}

// R√©g√©n√©rer les options de th√®mes avec la bonne langue
if (typeof populateThemeSelect === 'function' && typeof THEMES_DATA !== 'undefined' && THEMES_DATA) {
  populateThemeSelect(lang);
  // Re-traduire "Tous" apr√®s la r√©g√©n√©ration
  if (filterTheme && filterTheme.options[0]) {
    filterTheme.options[0].text = L.filterAllThemes;
  }
}

  // Toggle filtres mobile
  document.getElementById('toggleFiltersMobile')?.addEventListener('click', () => {
    const sidebar = document.querySelector('.map-fullscreen-sidebar');
    sidebar.classList.toggle('show');
  });

  // Fermer la sidebar si on clique sur la carte (mobile)
  document.getElementById('mapContainerFull')?.addEventListener('click', () => {
    if (window.innerWidth <= 1024) {
      const sidebar = document.querySelector('.map-fullscreen-sidebar');
      sidebar.classList.remove('show');
    }
  });

  // Titles & lists
  setTextById('title',L.title);

setTextById('leftTitle',L.left_title);
  setTextById('rightTitle',L.right_title);
  setTextById('creatorsTitle2',L.creatorsTitle);
  setTextById('becomeCreatorLink',L.become_creator);
  setTextById('becomeCreator',L.becomeCreator);
  setTextById('buildTitle',L.buildTitle);
  setTextById('importTitle',L.importTitle);
  setTextById('routeBuilderTitle',L.routeBuilderTitle);
  setTextById('labelStartCity',L.labelStartCity);
  setTextById('labelEndCity',L.labelEndCity);
  setTextById('labelMaxKm',L.labelMaxKm);
  setTextById('labelDuration',L.labelDuration);
  setTextById('generateBtnText',L.generateBtn);
  setTextById('labelDetour',L.labelDetour);
  setTextById('labelDays',L.labelDaysUnit);

  // Placeholders route builder
  const inputStart = document.getElementById('inputStartCity');
  const inputEnd = document.getElementById('inputEndCity');
  if (inputStart) inputStart.placeholder = L.placeholderStart || '';
  if (inputEnd) inputEnd.placeholder = L.placeholderEnd || '';
  // Options dur√©e
  const selectDuration = document.getElementById('inputDuration');
  if (selectDuration && L.days) {
    selectDuration.innerHTML = [3,5,7,10,14].map(d => `<option value="${d}"${d===7?' selected':''} >${d} ${L.days}</option>`).join('');
  }

  // Toggle pour afficher/masquer les prix sur mobile
  document.getElementById('pricingToggle')?.addEventListener('click', function() {
    const table = document.getElementById('pricing-table');
    const text = document.getElementById('pricingToggleText');
    const isVisible = table.classList.contains('show');
    
    if (isVisible) {
      table.classList.remove('show');
      text.textContent = L.pricing_show || 'Voir les tarifs d√©taill√©s';
    } else {
      table.classList.add('show');
      text.textContent = L.pricing_hide || 'Masquer les tarifs';
    }
  });

  // Cookies i18n & init
  setTextById('cookieText',L.cookie_text);
  setTextById('cookieOptAnalytics',L.cookie_opt_a);
  setTextById('cookieOptMarketing',L.cookie_opt_m);
 setTextById('btnPrefs',L.cookie_btn_p);
setTextById('btnReject',L.cookie_btn_r);
setTextById('btnAccept',L.cookie_btn_a);

// Rouvrir la banni√®re depuis le footer "Pr√©f√©rences cookies"
const cookieManageBtn = document.getElementById('manageCookies');
if (cookieManageBtn) {
  cookieManageBtn.addEventListener('click', () => {
    const banner = document.getElementById('cookieBanner');
    const prefs  = document.getElementById('cookiePrefs');
    if (banner) banner.style.display = 'block';
    if (prefs)  prefs.style.display  = 'block';
  });
}

})(); // ferme l‚ÄôIIFE externe "Auto-lang"
</script>

<script>
(function(){
  const pricingDict = {
    "fr": {
      "col.feature":"Fonctionnalit√©s","plan.bronze":"Bronze","plan.silver":"Silver","plan.gold":"Gold","plan.popular":"Le plus populaire",
      "row.price":"Prix mensuel","row.core":"C≈ìur d'ORT (itin√©raires modifiables, d√©tails d'√©tapes, points d'int√©r√™ts, liens de r√©servation)",
      "row.stories":"Stories publiques & partage","row.pdf":"Export PDF complet du voyage","row.maps":"Cartes interactives",
      "row.rtlimit":"Roadtrips pouvant √™tre stock√©s dans le dashboard","row.photosday":"Photos par jour pouvant √™tre publi√©es dans votre story",
      "row.storage":"Espace total photos","row.ai":"Assistance IA (cr√©ations automatiques d'itin√©raires et avis sur le voyage)",
      "row.backup":"Sauvegarde Cloud (s√©curit√© de vos donn√©es)","row.family":"Espace famille / amis (inviter des proches)",
      "yes":"Oui","no":"Non","pricing.bronze.price":"Gratuit","pricing.silver.price":"4,99 ‚Ç¨/mois","pricing.gold.price":"9,99 ‚Ç¨/mois",
      "pricing.bronze.rtlimit":"3","pricing.silver.rtlimit":"20","pricing.gold.rtlimit":"50",
      "pricing.bronze.photos":"3","pricing.silver.photos":"15","pricing.gold.photos":"50",
      "pricing.bronze.storage":"1 Go","pricing.silver.storage":"20 Go","pricing.gold.storage":"100 Go",
      "pricing.silver.ia":"10 actions par mois","pricing.gold.ia":"30 actions par mois",
      "pricing.silver.backup":"Automatique","pricing.gold.backup":"Automatique",
      "pricing.silver.family":"Jusqu'√† 3 invit√©s","pricing.gold.family":"Jusqu'√† 10 invit√©s"
    },
    "en": {
      "col.feature":"Features","plan.bronze":"Bronze","plan.silver":"Silver","plan.gold":"Gold","plan.popular":"Most popular",
      "row.price":"Monthly price","row.core":"ORT core (editable itineraries, step details, points of interest, booking links)",
      "row.stories":"Public stories & sharing","row.pdf":"Full trip PDF export","row.maps":"Interactive maps",
      "row.rtlimit":"Trips you can store in your dashboard","row.photosday":"Photos per day you can publish in your story",
      "row.storage":"Total photo storage","row.ai":"AI assistance (automatic itinerary creations and trip reviews)",
      "row.backup":"Cloud backup (data safety)","row.family":"Family / Friends space (invite people)",
      "yes":"Yes","no":"No","pricing.bronze.price":"Free","pricing.silver.price":"‚Ç¨4.99 / month","pricing.gold.price":"‚Ç¨9.99 / month",
      "pricing.bronze.rtlimit":"3","pricing.silver.rtlimit":"20","pricing.gold.rtlimit":"50",
      "pricing.bronze.photos":"3","pricing.silver.photos":"15","pricing.gold.photos":"50",
      "pricing.bronze.storage":"1 GB","pricing.silver.storage":"20 GB","pricing.gold.storage":"100 GB",
      "pricing.silver.ia":"10 actions / month","pricing.gold.ia":"30 actions / month",
      "pricing.silver.backup":"Automatic","pricing.gold.backup":"Automatic",
      "pricing.silver.family":"Up to 3 guests","pricing.gold.family":"Up to 10 guests"
    },
    "it": {
      "col.feature":"Funzionalit√†","plan.bronze":"Bronzo","plan.silver":"Argento","plan.gold":"Oro","plan.popular":"Il pi√π scelto",
      "row.price":"Prezzo mensile","row.core":"Cuore di ORT (itinerari modificabili, dettagli tappe, punti di interesse, link di prenotazione)",
      "row.stories":"Storie pubbliche e condivisione","row.pdf":"Esportazione PDF completa del viaggio","row.maps":"Mappe interattive",
      "row.rtlimit":"Roadtrip archiviabili nella dashboard","row.photosday":"Foto al giorno pubblicabili nella tua story",
      "row.storage":"Spazio totale foto","row.ai":"Assistenza IA (creazioni automatiche di itinerari e valutazioni del viaggio)",
      "row.backup":"Backup su cloud (sicurezza dati)","row.family":"Spazio Famiglia / Amici (inviti)",
      "yes":"S√¨","no":"No","pricing.bronze.price":"Gratuito","pricing.silver.price":"4,99 ‚Ç¨ / mese","pricing.gold.price":"9,99 ‚Ç¨ / mese",
      "pricing.bronze.rtlimit":"3","pricing.silver.rtlimit":"20","pricing.gold.rtlimit":"50",
      "pricing.bronze.photos":"3","pricing.silver.photos":"15","pricing.gold.photos":"50",
      "pricing.bronze.storage":"1 GB","pricing.silver.storage":"20 GB","pricing.gold.storage":"100 GB",
      "pricing.silver.ia":"10 azioni / mese","pricing.gold.ia":"30 azioni / mese",
      "pricing.silver.backup":"Automatico","pricing.gold.backup":"Automatico",
      "pricing.silver.family":"Fino a 3 invitati","pricing.gold.family":"Fino a 10 invitati"
    },
    "es": {
      "col.feature":"Funciones","plan.bronze":"Bronce","plan.silver":"Plata","plan.gold":"Oro","plan.popular":"El m√°s popular",
      "row.price":"Precio mensual","row.core":"N√∫cleo de ORT (itinerarios editables, detalles de etapas, puntos de inter√©s, enlaces de reserva)",
      "row.stories":"Historias p√∫blicas y compartici√≥n","row.pdf":"Exportaci√≥n completa en PDF del viaje","row.maps":"Mapas interactivos",
      "row.rtlimit":"Viajes que puedes guardar en el panel","row.photosday":"Fotos por d√≠a que puedes publicar en tu historia",
      "row.storage":"Almacenamiento total de fotos","row.ai":"Asistencia IA (creaci√≥n autom√°tica de itinerarios y evaluaci√≥n del viaje)",
      "row.backup":"Copia de seguridad en la nube (seguridad de datos)","row.family":"Espacio Familia / Amigos (invitaciones)",
      "yes":"S√≠","no":"No","pricing.bronze.price":"Gratis","pricing.silver.price":"4,99 ‚Ç¨/mes","pricing.gold.price":"9,99 ‚Ç¨/mes",
      "pricing.bronze.rtlimit":"3","pricing.silver.rtlimit":"20","pricing.gold.rtlimit":"50",
      "pricing.bronze.photos":"3","pricing.silver.photos":"15","pricing.gold.photos":"50",
      "pricing.bronze.storage":"1 GB","pricing.silver.storage":"20 GB","pricing.gold.storage":"100 GB",
      "pricing.silver.ia":"10 acciones / mes","pricing.gold.ia":"30 acciones / mes",
      "pricing.silver.backup":"Autom√°tica","pricing.gold.backup":"Autom√°tica",
      "pricing.silver.family":"Hasta 3 invitados","pricing.gold.family":"Hasta 10 invitados"
    },
    "pt": {
      "col.feature":"Funcionalidades","plan.bronze":"Bronze","plan.silver":"Prata","plan.gold":"Ouro","plan.popular":"Mais popular",
      "row.price":"Pre√ßo mensal","row.core":"N√∫cleo do ORT (itiner√°rios edit√°veis, detalhes de etapas, pontos de interesse, links de reserva)",
      "row.stories":"Stories p√∫blicas e partilha","row.pdf":"Exporta√ß√£o completa em PDF da viagem","row.maps":"Mapas interativos",
      "row.rtlimit":"Roadtrips que pode guardar no painel","row.photosday":"Fotos por dia que pode publicar na sua story",
      "row.storage":"Armazenamento total de fotos","row.ai":"Assist√™ncia IA (cria√ß√µes autom√°ticas de itiner√°rios e avalia√ß√£o da viagem)",
      "row.backup":"C√≥pia de seguran√ßa na nuvem (seguran√ßa dos dados)","row.family":"Espa√ßo Fam√≠lia / Amigos (convites)",
      "yes":"Sim","no":"N√£o","pricing.bronze.price":"Gr√°tis","pricing.silver.price":"4,99 ‚Ç¨/m√™s","pricing.gold.price":"9,99 ‚Ç¨/m√™s",
      "pricing.bronze.rtlimit":"3","pricing.silver.rtlimit":"20","pricing.gold.rtlimit":"50",
      "pricing.bronze.photos":"3","pricing.silver.photos":"15","pricing.gold.photos":"50",
      "pricing.bronze.storage":"1 GB","pricing.silver.storage":"20 GB","pricing.gold.storage":"100 GB",
      "pricing.silver.ia":"10 a√ß√µes / m√™s","pricing.gold.ia":"30 a√ß√µes / m√™s",
      "pricing.silver.backup":"Autom√°tica","pricing.gold.backup":"Autom√°tica",
      "pricing.silver.family":"At√© 3 convidados","pricing.gold.family":"At√© 10 convidados"
    },
    "ar": {
      "col.feature":"ÿßŸÑŸÖŸäÿ≤ÿßÿ™","plan.bronze":"ÿ®ÿ±ŸàŸÜÿ≤Ÿä","plan.silver":"ŸÅÿ∂Ÿä","plan.gold":"ÿ∞Ÿáÿ®Ÿä","plan.popular":"ÿßŸÑÿ£ŸÉÿ´ÿ± ÿ¥ŸäŸàÿπŸãÿß",
      "row.price":"ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ¥Ÿáÿ±Ÿä","row.core":"ÿ¨ŸàŸáÿ± ORT (ŸÖÿ≥ÿßÿ±ÿßÿ™ ŸÇÿßÿ®ŸÑÿ© ŸÑŸÑÿ™ÿπÿØŸäŸÑÿå ÿ™ŸÅÿßÿµŸäŸÑ ÿßŸÑŸÖÿ±ÿßÿ≠ŸÑÿå ŸÜŸÇÿßÿ∑ ÿßŸÑÿßŸáÿ™ŸÖÿßŸÖÿå ÿ±Ÿàÿßÿ®ÿ∑ ÿßŸÑÿ≠ÿ¨ÿ≤)",
      "row.stories":"ŸÇÿµÿµ ÿπÿßŸÖÿ© ŸàŸÖÿ¥ÿßÿ±ŸÉÿ©","row.pdf":"ÿ™ÿµÿØŸäÿ± ŸÉÿßŸÖŸÑ ŸÑŸÖŸÑŸÅ PDF ŸÑŸÑÿ±ÿ≠ŸÑÿ©","row.maps":"ÿÆÿ±ÿßÿ¶ÿ∑ ÿ™ŸÅÿßÿπŸÑŸäÿ©",
      "row.rtlimit":"ÿßŸÑÿ±ÿ≠ŸÑÿßÿ™ ÿßŸÑÿ™Ÿä ŸäŸÖŸÉŸÜ ÿ≠ŸÅÿ∏Ÿáÿß ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ","row.photosday":"ÿßŸÑÿµŸàÿ± ŸäŸàŸÖŸäŸãÿß ÿßŸÑÿ™Ÿä ŸäŸÖŸÉŸÜŸÉ ŸÜÿ¥ÿ±Ÿáÿß ŸÅŸä ŸÇÿµÿ™ŸÉ",
      "row.storage":"ÿ•ÿ¨ŸÖÿßŸÑŸä ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿµŸàÿ±","row.ai":"ŸÖÿ≥ÿßÿπÿØÿ© ÿßŸÑÿ∞ŸÉÿßÿ° ÿßŸÑÿßÿµÿ∑ŸÜÿßÿπŸä (ÿ•ŸÜÿ¥ÿßÿ° ÿ™ŸÑŸÇÿßÿ¶Ÿä ŸÑŸÑŸÖÿ≥ÿßÿ±ÿßÿ™ Ÿàÿ™ŸÇŸäŸäŸÖ ÿßŸÑÿ±ÿ≠ŸÑÿ©)",
      "row.backup":"ŸÜÿ≥ÿÆÿ© ÿßÿ≠ÿ™Ÿäÿßÿ∑Ÿäÿ© ÿ≥ÿ≠ÿßÿ®Ÿäÿ© (ÿ£ŸÖÿßŸÜ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™)","row.family":"ŸÖÿ≥ÿßÿ≠ÿ© ÿßŸÑÿπÿßÿ¶ŸÑÿ© / ÿßŸÑÿ£ÿµÿØŸÇÿßÿ° (ÿØÿπŸàÿßÿ™)",
      "yes":"ŸÜÿπŸÖ","no":"ŸÑÿß","pricing.bronze.price":"ŸÖÿ¨ÿßŸÜŸä","pricing.silver.price":"‚Ç¨4.99 / ÿ¥Ÿáÿ±ŸäŸãÿß","pricing.gold.price":"‚Ç¨9.99 / ÿ¥Ÿáÿ±ŸäŸãÿß",
      "pricing.bronze.rtlimit":"3","pricing.silver.rtlimit":"20","pricing.gold.rtlimit":"50",
      "pricing.bronze.photos":"3","pricing.silver.photos":"15","pricing.gold.photos":"50",
      "pricing.bronze.storage":"1 ÿ¨Ÿäÿ¨ÿßÿ®ÿßŸäÿ™","pricing.silver.storage":"20 ÿ¨Ÿäÿ¨ÿßÿ®ÿßŸäÿ™","pricing.gold.storage":"100 ÿ¨Ÿäÿ¨ÿßÿ®ÿßŸäÿ™",
      "pricing.silver.ia":"10 ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ / ÿ¥Ÿáÿ±","pricing.gold.ia":"30 ÿ•ÿ¨ÿ±ÿßÿ°Ÿã / ÿ¥Ÿáÿ±",
      "pricing.silver.backup":"ÿ™ŸÑŸÇÿßÿ¶Ÿä","pricing.gold.backup":"ÿ™ŸÑŸÇÿßÿ¶Ÿä",
      "pricing.silver.family":"ÿ≠ÿ™Ÿâ 3 ŸÖÿØÿπŸàŸäŸÜ","pricing.gold.family":"ÿ≠ÿ™Ÿâ 10 ŸÖÿØÿπŸàŸäŸÜ"
    }
  };
  const lang = localStorage.getItem('lang') || 'fr';
  const t = pricingDict[lang] || pricingDict.fr;
  document.querySelectorAll('#pricing-table [data-i18n]').forEach(el => {
    const k = el.getAttribute('data-i18n');
    if (k && t[k]) el.textContent = t[k];
  });
})();
</script>

<!-- Modal Budget -->
<div id="budgetModal" class="budget-modal-overlay">
  <div class="budget-modal" style="max-width:450px;">
    <h3 id="budgetModalTitle">Configurez votre voyage</h3>
    
    <div style="margin-bottom:16px;">
      <label id="labelDepartureDate" style="display:block;font-weight:600;margin-bottom:6px;">Date de d√©part :</label>
      <input type="date" id="inputDepartureDate" class="filter-input" style="width:100%;">
    </div>
    
    <div style="margin-bottom:16px;">
      <label id="labelNumDays" style="display:block;font-weight:600;margin-bottom:6px;">Nombre de jours souhait√©s :</label>
      <input type="number" id="inputNumDays" class="filter-input" style="width:100%;" min="1" max="60" value="7">
    </div>
    
    <div class="budget-modal-actions">
      <button class="budget-modal-btn secondary" id="budgetCancel">Annuler</button>
      <button class="budget-modal-btn primary" id="budgetConfirm">Valider</button>
    </div>
  </div>
</div>

<!-- ORT External Scripts -->
<script>

// ============================================
// ROUTE BUILDER - Autocompl√©tion et g√©n√©ration
// ============================================

// Config API Search - d√©tection auto local/prod
const SEARCH_API = (() => {
  const host = window.location.hostname;
  if (host === 'localhost' || host === '127.0.0.1' || host.match(/^192\.168\./)) {
    return 'http://localhost:3031';
  }
  return '/.netlify/functions';  // ‚Üê NETLIFY FUNCTIONS
})();

// √âtat du formulaire
let startCity = null; // {name, lat, lon, countryCode}
let endCity = null;

// Debounce pour l'autocompl√©tion
function debounce(fn, ms) {
  let timer;
  return (...args) => {
    clearTimeout(timer);
    timer = setTimeout(() => fn(...args), ms);
  };
}

// Recherche de villes via l'API
async function searchCities(query, lang = 'fr') {
  if (!query || query.length < 2) return [];
  const url = `${SEARCH_API}/citysearch?q=${encodeURIComponent(query)}&lang=${lang}&limit=8`;
  try {
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    return data.items || [];
  } catch (e) {
    return [];
  }
}

// Afficher les suggestions
function showSuggestions(containerId, items, onSelect) {
  const container = document.getElementById(containerId);
  if (!container) return;
  
  if (!items.length) {
    container.style.display = 'none';
    return;
  }
  
  container.innerHTML = items.map((item, i) => `
    <div data-index="${i}" style="display:flex;justify-content:space-between;align-items:center;">
      <span>${item.name}</span>
      <span style="color:#666;font-size:12px;">${item.countryCode || ''}</span>
    </div>
  `).join('');
  
  container.style.display = 'block';
  
  container.querySelectorAll('div').forEach(div => {
    div.addEventListener('click', () => {
      const idx = parseInt(div.dataset.index);
      onSelect(items[idx]);
      container.style.display = 'none';
    });
  });
}

// Initialiser l'autocompl√©tion
function initRouteBuilderAutocomplete() {
  const lang = localStorage.getItem('lang') || 'fr';
  const L = T[lang] || T.fr;
  
  const inputStart = document.getElementById('inputStartCity');
  const inputEnd = document.getElementById('inputEndCity');
  const suggestionsStart = document.getElementById('startCitySuggestions');
  const suggestionsEnd = document.getElementById('endCitySuggestions');
  const warnStart = document.getElementById('warnStartCity');
  const warnEnd = document.getElementById('warnEndCity');
  
  if (!inputStart || !inputEnd) return;
  
  // Placeholders traduits
  inputStart.placeholder = L.placeholderStart || 'Paris, Lyon...';
  inputEnd.placeholder = L.placeholderEnd || 'Barcelone, Rome...';
  
  // Autocompl√©tion d√©part
  const searchStart = debounce(async (q) => {
    const items = await searchCities(q, lang);
    showSuggestions('startCitySuggestions', items, (city) => {
      startCity = city;
      inputStart.value = city.name;
      if (warnStart) warnStart.style.display = 'none';
    });
  }, 300);
  
  inputStart.addEventListener('input', (e) => {
    startCity = null; // Reset quand l'user tape
    if (warnStart && e.target.value.length >= 2) {
      warnStart.textContent = L.warnCityNotSelected || '‚ö†Ô∏è Ville non valid√©e';
      warnStart.style.display = 'block';
    }
    searchStart(e.target.value);
  });
  inputStart.addEventListener('focus', () => {
    if (inputStart.value.length >= 2) searchStart(inputStart.value);
  });
  
  // Autocompl√©tion arriv√©e
  const searchEnd = debounce(async (q) => {
    const items = await searchCities(q, lang);
    showSuggestions('endCitySuggestions', items, (city) => {
      endCity = city;
      inputEnd.value = city.name;
      if (warnEnd) warnEnd.style.display = 'none';
    });
  }, 300);
  
  inputEnd.addEventListener('input', (e) => {
    endCity = null; // Reset quand l'user tape
    if (warnEnd && e.target.value.length >= 2) {
      warnEnd.textContent = L.warnCityNotSelected || '‚ö†Ô∏è Ville non valid√©e';
      warnEnd.style.display = 'block';
    }
    searchEnd(e.target.value);
  });
  inputEnd.addEventListener('focus', () => {
    if (inputEnd.value.length >= 2) searchEnd(inputEnd.value);
  });
  
  // Fermer les suggestions si clic ailleurs
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.rb-field')) {
      suggestionsStart.style.display = 'none';
      suggestionsEnd.style.display = 'none';
    }
  });
}

// G√©n√©rer l'itin√©raire
function initRouteBuilderSubmit() {
  const btn = document.getElementById('btnGenerateRoute');
  if (!btn) return;
  
  btn.addEventListener('click', async () => {
    const lang = localStorage.getItem('lang') || 'fr';
    const L = T[lang] || T.fr;
    
    const inputStart = document.getElementById('inputStartCity');
    const inputEnd = document.getElementById('inputEndCity');
    const checkLoop = document.getElementById('checkLoopMode');
    const isLoopMode = checkLoop?.checked || false;
    
    const startText = inputStart?.value?.trim();
    const endText = inputEnd?.value?.trim();
    
    // V√©rifier qu'on a au moins du texte pour le d√©part
    if (!startText) {
      inputStart?.focus();
      return;
    }
    
    // En mode normal (pas circuit), v√©rifier la ville d'arriv√©e
    if (!isLoopMode && !endText) {
      inputEnd?.focus();
      return;
    }
    
    // Si ville non valid√©e, faire une recherche rapide pour r√©cup√©rer les coords
    let finalStart = startCity;
    let finalEnd = isLoopMode ? null : endCity;
    
    if (!finalStart || !finalStart.lat) {
      const results = await searchCities(startText, lang);
      if (results.length > 0) {
        finalStart = results[0];
      } else {
        finalStart = { name: startText, lat: null, lon: null };
      }
    }
    
    if (!isLoopMode && (!finalEnd || !finalEnd.lat)) {
      const results = await searchCities(endText, lang);
      if (results.length > 0) {
        finalEnd = results[0];
      } else {
        finalEnd = { name: endText, lat: null, lon: null };
      }
    }
    
    const maxKm = document.getElementById('inputMaxKm').value;
    const detour = document.getElementById('inputDetour').value;
    const duration = document.getElementById('inputDuration').value;
    
    // Construire l'URL de redirection
    const params = new URLSearchParams({
      from: 'builder',
      startName: finalStart.name,
      startLat: finalStart.lat || '',
      startLon: finalStart.lon || '',
      startCC: finalStart.countryCode || '',
      endName: isLoopMode ? finalStart.name : (finalEnd?.name || ''),
      endLat: isLoopMode ? finalStart.lat : (finalEnd?.lat || ''),
      endLon: isLoopMode ? finalStart.lon : (finalEnd?.lon || ''),
      endCC: isLoopMode ? finalStart.countryCode : (finalEnd?.countryCode || ''),
      maxKm: maxKm,
      detour: detour,
      days: duration,
      lang: lang
    });
    
    // Ajouter le param√®tre loop si mode circuit
    if (isLoopMode) {
      params.set('loop', '1');
    }
    
    // Changer le texte du bouton
    btn.innerHTML = `<span>${L.generatingBtn || '‚è≥ Calcul en cours...'}</span>`;
    btn.disabled = true;
    
    // Rediriger vers roadtrip_detail avec les param√®tres
    setTimeout(() => {
      window.location.href = `roadtrip_detail.html?${params.toString()}`;
    }, 500);
  });
}

// Initialiser les handlers des 4 carr√©s
function initGridCards() {
  // Carr√© 2: Construire de A √† Z
  document.getElementById('buildFromScratch')?.addEventListener('click', () => {
    const lang = localStorage.getItem('lang') || 'fr';
    const u = new URL('carte_builder.html', location.href); u.searchParams.set('lang', lang); u.searchParams.set('mode', 'expert'); window.location.href = u.toString();
  });
  
  // Carr√© 3: Importer du web
  document.getElementById('importFromWeb')?.addEventListener('click', () => {
    const lang = localStorage.getItem('lang') || 'fr';
    window.location.href = `import.html?lang=${lang}`;
  });
  
  // Carr√© 4: Cr√©ateurs
  // Carr√© 4: Itin√©raires cr√©ateurs ‚Üí ouvre la carte avec filtre creators
  document.getElementById('creatorsSection')?.addEventListener('click', (e) => {
    if (e.target.id === 'becomeCreator') return;
    
    document.getElementById('mapFullscreen').classList.add('active');
    
    if (!THEMES_DATA || Object.keys(THEMES_REG || {}).length === 0) {
      loadThemes(); // Charger en arri√®re-plan
    }
    
    if (!mapFull) {
      setTimeout(() => {
        initMapFull();
        loadPhotosData();
        loadPlacesPhotosIndex();
        
        // Charger les itin√©raires en arri√®re-plan sans attendre
        loadAllItineraries().then(() => {
          const themeFilter = document.getElementById('filterThemeFull');
          if (themeFilter) {
            themeFilter.value = 'creators';
            applyFilters();
          }
        });
      }, 100);
    } else {
      const themeFilter = document.getElementById('filterThemeFull');
      if (themeFilter) {
        themeFilter.value = 'creators';
        applyFilters();
      }
    }
  });
}

// Mettre √† jour les textes traduits du route builder
function updateRouteBuilderTranslations() {
  const lang = localStorage.getItem('lang') || 'fr';
  const L = T[lang] || T.fr;
  
  const setTextById = (id, text) => { const el = document.getElementById(id); if (el) el.textContent = text; };
  
  setTextById('buildTitle', L.buildTitle);
  setTextById('importTitle', L.importTitle);
  setTextById('creatorsTitle2', L.creatorsTitle);
  setTextById('becomeCreator', L.becomeCreator);
  setTextById('routeBuilderTitle', L.routeBuilderTitle);
  setTextById('labelStartCity', L.labelStartCity);
  setTextById('labelEndCity', L.labelEndCity);
  setTextById('labelLoopMode', L.labelLoopMode);
  setTextById('labelMaxKm', L.labelMaxKm);
  setTextById('labelDetour', L.labelDetour);
  setTextById('labelDuration', L.labelDuration);
  setTextById('generateBtnText', L.generateBtn);
  
  // Placeholders
  const inputStart = document.getElementById('inputStartCity');
  const inputEnd = document.getElementById('inputEndCity');
  if (inputStart) inputStart.placeholder = L.placeholderStart || '';
  if (inputEnd) inputEnd.placeholder = L.placeholderEnd || '';
  
  // Options dur√©e avec traduction "jours"
  const selectDuration = document.getElementById('inputDuration');
  if (selectDuration) {
    const days = L.days || 'jours';
    selectDuration.innerHTML = [3,5,7,10,14,21].map(d => 
      `<option value="${d}"${d===7?' selected':''}>${d} ${days}</option>`
    ).join('');
  }
}

// G√©rer le mode circuit (masquer/afficher ville d'arriv√©e)
function initLoopModeToggle() {
  const checkbox = document.getElementById('checkLoopMode');
  const endContainer = document.getElementById('endCityContainer');
  
  if (!checkbox || !endContainer) return;
  
  checkbox.addEventListener('change', () => {
    if (checkbox.checked) {
      endContainer.style.display = 'none';
    } else {
      endContainer.style.display = 'block';
    }
  });
}

// Init au chargement
document.addEventListener('DOMContentLoaded', () => {
  initRouteBuilderAutocomplete();
  initRouteBuilderSubmit();
  initGridCards();
  initLoopModeToggle();
  updateRouteBuilderTranslations();
});

// Re-traduire quand la langue change
window.addEventListener('langChange', updateRouteBuilderTranslations);
</script>


<script src="/js/ort-i18n-auth.js" defer></script>
<script src="/js/ort-header.js" defer></script>
<script src="js/ort-footer.js" defer></script>
</body>
</html>